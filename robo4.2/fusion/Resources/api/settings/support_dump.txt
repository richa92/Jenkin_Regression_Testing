*** Settings ***
Documentation                   Try Some New Stuff
Library                         FusionLibrary
Library                         RoboGalaxyLibrary
Library                         OperatingSystem
Library                         BuiltIn
Library                         Collections
Library                         XML
Library                         String
Library                         json
Library							Process


*** Keywords ***
Create Support Dump And Downloads Batch On Verify
    [Documentation]    Creates support dump in a bactch one after the other and also downloads each of them when verify is set to TRUE on one view appliance. Input is a list of dictionary for various users to create.
    [Arguments]      ${sd_body_list}    ${VERIFY}=${FALSE}   ${STATUS_CODE}=200
    ${responses} =     create list
    :FOR    ${eachSD}  IN  @{sd_body_list}
	\       ${resp} =     Fusion Api Create Support Dump    ${eachSD}
    \       Run keyword if    '${VERIFY}'=='True'     Should Be Equal    '${resp['status_code']}'   '${STATUS_CODE}'    msg=Verification of status_code in create support dumps response body has FAILED    values=False
	\       Run keyword if    '${VERIFY}'=='True' and '${resp['status_code']}' == '${STATUS_CODE}'    Should Not Be Empty    ${resp['uri']}    msg=Verification of uri in create support dumps response body has FAILED
    \       ${respdownload} =     Run keyword if    '${VERIFY}'=='True' and '${resp['status_code']}' == '${STATUS_CODE}'    Fusion Api Download Support Dump    ${resp['uri']}    ../supportdump.sdmp
    \       Run keyword if    '${VERIFY}'=='True'     Should Be Equal    '${respdownload['status_code']}'   '${STATUS_CODE}'    msg=Verification of status_code in downloading support dumps has FAILED    values=False



Create Support Dump Batch
    [Documentation]    Creates support dump in a bactch one after the other on one view appliance. Input is a list of dictionary for various users to create.
    [Arguments]      ${sd_body_list}    ${VERIFY}=${FALSE}   ${STATUS_CODE}=200
    ${responses} =     create list
    :FOR    ${eachSD}  IN  @{sd_body_list}
	\       ${resp} =     Fusion Api Create Support Dump    ${eachSD}
    \       Run keyword if    '${VERIFY}'=='True'     Should Be Equal    '${resp['status_code']}'   '${STATUS_CODE}'    msg=Verification of status_code in create support dumps response body has FAILED    values=False
	\       Run keyword if    '${VERIFY}'=='True' and '${resp['status_code']}' == '${STATUS_CODE}'    Should Not Be Empty    ${resp['uri']}    msg=Verification of uri in create support dumps response body has FAILED
    Return From Keyword    ${resp['uri']}


Downloading Support Dump
    [Documentation]    Downloads a created support dump from one view appliance.
    [Arguments]      ${dump_uri}    ${VERIFY}=${FALSE}   ${STATUS_CODE}=200
    ${sdname} =    Fetch From Right        ${dump_uri}      /
    ${respdownload} =     Fusion Api Download Support Dump    ${dump_uri}    ../${sdname}
    Run keyword if    '${VERIFY}'=='True'     Should Be Equal    '${respdownload['status_code']}'   '${STATUS_CODE}'    msg=Verification of status_code in downloading support dumps has FAILED    values=False
