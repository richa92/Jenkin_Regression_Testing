*** Settings ***
Documentation                   High Level Keywords to support /rest/backups
Library                         FusionLibrary
Library                         RoboGalaxyLibrary
Library                         OperatingSystem
Library                         BuiltIn
Library                         Collections
Library                         XML
Library                         String
Library                         json
Library							Process


*** Keywords ***
Create Backup
    [Documentation]  POST /rest/backups to create a OneView backup.  Will Wait For Task2 to track task.
    [Arguments]    ${errorMessage}=None Expected     # used for negative testing
    ${task} =    fusion api create backup
    Wait For Task2    ${task}    timeout=600    interval=5    errorMessage=None Expected

Get Backup
    [Documentation]  GET /rest/backups to obtain details for the current appliance backup
    ${backup} =    fusion api get backup
    [Return]    ${backup['members'][0]}

Get Backup URI
    [Documentation]  calls Get Backup but only returns the URI of the backup
    ${backup} =    Get Backup
    [Return]    ${backup['uri']}

Download Backup
    [Documentation]    Downloads backup via /rest/backups/archive/{id}
    [Arguments]    ${uri}    ${localfile}=OneViewBackup.bkp

    # if 'archive' not in the path, then insert it as it triggers the download backup
    ${archive} =    Get Count    ${uri}    archive
    ${uri} =    Run Keyword If    ${archive}==0    Replace String Using Regexp    ${uri}    /rest/backups/    /rest/backups/archive/
    ${resp} =    Fusion Api Download Backup    ${uri}    ${localfile}
    Log    ${resp}    console=true
    [Return]  ${resp}

Upload Backup
    [Documentation]    Uploads backup via /rest/backups/archive/
    [Arguments]    ${localfile}=OneViewBackup.bkp
    ${resp} =     Fusion Api Upload Backup    ${localfile}
    Log    ${resp}    console=true
    [Return]  ${resp}

