*** Settings ***
Library             FusionLibrary
Resource            ../fusion_api_resource.txt


*** Keywords ***
Get OSDP URI
    [Documentation]    Get OSDP URI
    [Arguments]    ${osdp}
    ${uri} =    Set variable    ${None}
    ${resp} =    Fusion Api Get OS Deploymentplan    param=?filter="'name'=='${osdp}'"
    Return From Keyword If    ${resp['count']}==0    ${uri}
    ${uri} =    Run keyword if    ${resp['count']} != 0    Get From Dictionary    ${resp['members'][0]}    uri
    ...    ELSE    Log    Could not find OSDP ${osdp}    WARN    console=True
    [Return]    ${uri}

Create Deployment Server Payload
    [Documentation]    Create Deployment Server Payload
    [Arguments]    ${osdeploymentserver}    ${osdp_name}

    ${osds_body} =    Copy Dictionary    ${osdeploymentserver}
    # Network URI
    ${nwuri} =     Get from Dictionary    ${osds_body}    mgmtNetworkUri
    ${uri} =    Get Ethernet URIs    ${nwuri}
    Set to Dictionary    ${osds_body}    mgmtNetworkUri    ${uri[0]}
    # APPLIANCE URI
    ${appuri} =    Get From Dictionary    ${osds_body}    applianceUri
    ${uri} =    Get Appliance URI    ${appuri}
    Set to Dictionary    ${osds_body}    applianceUri    ${uri}
    [Return]    ${osds_body}

Get Appliance URI
    [Documentation]    Get Appliance URI
    [Arguments]    ${appliance}
    ${resp} =    Fusion Api Get i3sappliance Uri    param=?filter="'name'=='${appliance}'"
    ${uri} =    Get From Dictionary    ${resp['members'][0]}   uri
    [Return]    ${uri}
