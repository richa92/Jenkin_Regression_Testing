*** Settings ***
Library				RoboGalaxyLibrary
Library				FusionLibrary
Library				OperatingSystem
Library				BuiltIn
Library				Collections
Library		        SSHLibrary
Library				String

*** Keywords ***
#######################################
# VM
#######################################

VM setup and FTS
    [Documentation]  VM SETUP AND FTS
	[Arguments]		${VM}
	Log    [VM SETUP]    console=true
	Run Keyword If 	'${VMSETUP}' == 'yes'	VM setup		${VM}
	Get VM IP	${VM}
	Run Keyword If 	'${FTS}' == 'yes'		First Time Setup	password=hpvse123

Get VM IP
    [DOCUMENTATION]  Get VM IP
	[Arguments]		${VM}
    # Skip looking up IP from vCenter if IP provided via command line\suite variable
	Return from Keyword If	'${APPLIANCE_IP}' is not 'None'

	Log    - Connecting to vCenter ${vcenter['server']}    console=true
	${resp} = 	Connect to VI Server	${vcenter['server']}	${vcenter['user']}	${vcenter['password']}
	Log    - Retrieving IPv4 Address for ${VM}    console=true
	${IPS} = 	Get VM IPv4 Addresses	${VM}
	${APPLIANCE_IP} = 	Get From List	${IPS}	0
	Log    - Found ${APPLIANCE_IP}    console=true
    Set Suite Variable		${APPLIANCE_IP}	${APPLIANCE_IP}

VM setup
    [DOCUMENTATION]  VM setup
	[Arguments]		${VM}
	Set Log Level	TRACE
	Log    - Connecting to vCenter ${vcenter['server']}    console=true
	${resp} = 	Connect to VI Server	${vcenter['server']}	${vcenter['user']}	${vcenter['password']}
	Log    - Creating snapshot for ${VM}    console=true
	Create VM Snapshot	${VM}	oob-snapshot	True	True
	Log    - Powering on ${VM}    console=true
	Power On VM 	${VM}
	Log    - Sleeping 2 min while ${VM} boots ...    console=true
	Sleep	2 min
