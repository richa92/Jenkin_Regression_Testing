*** Settings ***
Library				FusionLibrary
Library  			BuiltIn
Library				Collections
Library             json
Library  			Dialogs
Library             OperatingSystem
Library             XML
Library             ./VcsuHelper.py

*** Keywords ***
Run VCSU to Update VC Firmware
    [Documentation]	Run Virtual Connect Support Utility to Update VC Firmware
    ...                 Run VCSU to Update VC Firmware   ${Encs}
	...             Data file needs to define:
	...                 Encs = [{'hostname': '16.125.79.45','username': 'Administrator','password': 'hpvse14','vc_firmware_url': 'http://wpstwork4.vse.rdlabs.hpecorp.net/firmware/vc/vcfwall420.bin', 'method': 'health'}]
	[Arguments]  ${Encs}  ${VERBOSE}=False
	Log    \nRun vcsu to Update VC Firmware    console=true

	${vcsu_dir} =  set variable  ${CURDIR}\\..\\..\\..\\Tools\\vcsu
	${outputs} =  Create List

	: FOR    ${Enc}    IN    @{Encs}
    \    ${hostname} =        Get From Dictionary        ${Enc}    hostname
    \    ${username} =        Get From Dictionary        ${Enc}    username
    \    ${password} =        Get From Dictionary        ${Enc}    password
    \    ${firmware_url} =    Get From Dictionary        ${Enc}    vc_firmware_url
    \    ${status}  ${return} =  Run Keyword and Ignore Error  Get From Dictionary  ${Enc}  method
	\    ${method} =  set variable if  '${status}'=='PASS'  -f ${return}   ${Empty}
	\    Log    Updating VC fimrware for ${hostname} using ${firmware_url}    console=true
    \    ${command} =  set variable  ${vcsu_dir}\\vcsu.exe -a update -i ${hostname} -u ${username} -p ${password} -l ${firmware_url} ${method} -q
    \    Log    ${command}    console=true
    \    ${output}  ${status}=  VcsuHelper.run_vcsu  ${command}
    \    Run keyword if    '${status}'=='FAIL'   Log    =====Firmware update failed!=====\n${output}    console=true
    \    Append To List   ${outputs}  ${output}

    [return]  ${output}