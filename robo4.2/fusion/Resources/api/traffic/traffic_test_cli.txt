*** Settings ***
Library    FusionLibrary
Library    Collections

*** Keywords ***

##################### PING TRAFFIC KEYWORDS
Generate Ping Traffic
    [Documentation]  Generate Ping Traffic
    Generate Ping Commands
    find reachable ip for each server
    Start Ping Traffic

Generate Ping Traffic From Test head to Server bay
    [Documentation]  Generate Ping Traffic From Test head to Server bay
    Generate Ping Commands
    Start Ping Traffic


Stop Server Side Process
    [Documentation]  Stop Server Side Process
    Stop Ping Traffic
    Stop iPerf Traffic
    Stop IOMeter Traffic

Get All Server And Its Connection Connection Information From Oneview
    [Documentation]  Get All Server And Its Connection Connection Information From Oneview
    [Arguments]    ${fusion}
    fusion api login appliance    ${fusion['ip']}    ${fusion['cred']}
    &{ov}   create dictionary
    ${ilts}  fusion api get interconnect link topology
    Set To Dictionary  ${ov}    ilts   ${ilts}
    ${les}   fusion api get logical enclosure
    Set To Dictionary  ${ov}    les   ${les}
    ${enclosures}   fusion api get enclosures
    Set To Dictionary  ${ov}    enclosures   ${enclosures}
    ${serverhardwares}   fusion api get server hardware
    Set To Dictionary  ${ov}    serverhardwares   ${serverhardwares}
    ${serverprofiles}    fusion api get server profiles
    Set To Dictionary  ${ov}    serverprofiles   ${serverprofiles}
    ${ethernet_networks}   fusion api get ethernet networks
    Set To Dictionary  ${ov}    ethernet_networks   ${ethernet_networks}
    ${fc_networks}   fusion api get fc networks
    Set To Dictionary  ${ov}    fc_networks   ${fc_networks}
    ${fcoe_networks}   fusion api get fcoe networks
    Set To Dictionary  ${ov}    fcoe_networks   ${fcoe_networks}
    ${network_sets}   fusion api get network set
    Set To Dictionary  ${ov}    network_sets   ${network_sets}
    log  ${ov}    console=True
    fusion api logout appliance
    [Return]  &{ov}

Generate Traffic From Server bay to test head
    [Documentation]  Generate Traffic From Server bay to test head
    [Arguments]    ${trafficTestData1}
    ${ov}   Get All Server And Its Connection Connection Information From Oneview    ${trafficTestData1['fusion']}
    Map OV Data And Given Data    ${trafficTestData1}    ${ov}
    Get All Server Interface Through iLO VSP Console
    Log Server Interface Data   server=all
    Generate Ping Traffic
    #Generate iPerf Traffic
    #Generate IOMeter Traffic

Generate Traffic From Test head to Server bay
    [Documentation]  Generate Traffic From Test head to Server bay
    [Arguments]    ${trafficTestData2}
    ${ov}   Get All Server And Its Connection Connection Information From Oneview    ${trafficTestData2['fusion']}
    Map OV Data And Given Data    ${trafficTestData2}    ${ov}
#    Get All Server Interface Through iLO VSP Console
#    Log Server Interface Data   server=all
    Generate Ping Traffic From Test head to Server bay
    #Generate iPerf Traffic
    #Generate IOMeter Traffic

Reset Power Off Power ON server while pinging
    [Documentation]  Reset Power Off Power ON server while pinging
    Reset Server  ${ENC1SHBAY9}  powerControl=Reset
#    Reset Server Hardware iLO and Wait for System Refresh to Finish  ${ENC1SHBAY9}  timeout=300  interval=10
    Power off Server  ${ENC1SHBAY9}  powerControl=PressAndHold
    Power on Server  SH:${ENC1SHBAY9}

Edit profile add extra connection
    [Documentation]  Edit profile add extra connection
    Power off Server  ${ENC1SHBAY9}
    ${resp} = 	Edit Server Profile	${edit_profile_add_connection}
    log to console		${resp}
    Wait For Task2	${resp}	   timeout=2400	interval=5
    Power on Server  SH:${ENC1SHBAY9}
    Wait for Server to reach POST state  ${ENC1SHBAY9}  post_state=IN_POST_DISCOVERY_COMPLETE|FINISHED_POST  timeout=5m  interval=20s

Analyse Traffic
    [Documentation]  Analyse Traffic
#    Stop Server Side Process
    ${resp} = 	Analyse Ping Traffic
    [Return]   ${resp}
#    Analyse iPerf Traffic
#    Analyse IOMeter Traffic
#    Report Traffic

Appliance Login
    [Documentation]  Appliance Login
    Set Log Level	TRACE
    log variables
    Fusion Api Login Appliance  ${APPLIANCE_IP}  ${admin_credentials}
