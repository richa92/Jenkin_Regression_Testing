*** Settings ***
Documentation     Check LLDP Neighbor Data
...               To run this suite:
...                  pybot -L DEBUG --variable FUSION_IP:<Your-FusionVM-IP> --variable SWITCH_IP:<Your-Switch-IP> check_lldp.txt 
...
...               Dependency:  Fusion needs to have claimed the switch via add_li.txt
Library           RoboGalaxyLibrary         # DVTs Robot Framework extensions
Library           FusionLibrary                  # DVTs Robot Framework extensions
Library           Collections
Library           String
Variables         resources/variables.py    ${FUSION_IP}    ${SWITCH_IP}    # Comet-DVT default variables 
Resource          resources/fusion.txt      # Comet-DVT keyword extensions for fusion
Resource          resources/switch.txt      # Comet-DVT keyword extensions for switch
Force Tags        CometTest                 # All test cases in sub test suites get these tags
Suite Setup       Log into Fusion Via REST    ${Fusion IP}    ${FUSION USERNAME}    ${FUSION PASSWORD}
Suite Teardown    Log out of Fusion Via REST

*** Variables ***
${FUSION_IP}         10.0.12.106

*** TODO:  Need to check more fields here than these after validation with the CRM Switch Team ***
***        For now these are the Fusion API LLDP fields we will check for LLDP correctness: ***
***        - remoteChassisId
***        - remotePortDescription
***        - remoteChassisIdType

*** Test Cases ***
Happy Path LLDP Check Port Only
    Login to Switch via SSH
    ${SWITCH_LLDP}=    Execute Switch Command    display lldp neighbor-information verbose
    ${FUSION_DICT}=    Get Port Neighbor Data From Fusion
	Set Suite Variable    ${FUSION_GLOBAL_DICT}    ${FUSION_DICT}
	${SWITCH_DICT}=    Comware LLDP Output to Dict    ${SWITCH_LLDP}
	Log    ${FUSION_DICT}
	Log    ${SWITCH_DICT}
	${SWITCH_DICT_CONV}=    Comware Convert LLDP To Fusion    ${SWITCH_DICT}
    Set Suite Variable    ${SWITCH_GLOBAL_DICT}    ${SWITCH_DICT_CONV}
	Log    ${SWITCH_DICT_CONV}
	${list1}=    Get Dictionary Keys    ${SWITCH_DICT_CONV}
	${list2}=    Get Dictionary Keys    ${FUSION_DICT}
	Lists Should Be Equal    ${list1}    ${list2}
    	
Happy Path LLDP Check Port And remoteChassisId field
    ${FUSION_DICT_FILTERED}=    Comware Filter LLDP    ${FUSION_GLOBAL_DICT}    remoteChassisId
    ${SWITCH_DICT_FILTERED}=    Comware Filter LLDP    ${SWITCH_GLOBAL_DICT}    remoteChassisId
    Log    ${FUSION_DICT_FILTERED}
    Log    ${SWITCH_DICT_FILTERED}
    Dictionaries Should Be Equal    ${SWITCH_DICT_FILTERED}    ${FUSION_DICT_FILTERED}

Happy Path LLDP Check Port And remotePortDescription field
    ${FUSION_DICT_FILTERED}=    Comware Filter LLDP    ${FUSION_GLOBAL_DICT}    remotePortDescription
    ${SWITCH_DICT_FILTERED}=    Comware Filter LLDP    ${SWITCH_GLOBAL_DICT}    remotePortDescription
    Log    ${FUSION_DICT_FILTERED}
    Log    ${SWITCH_DICT_FILTERED}
    Dictionaries Should Be Equal    ${SWITCH_DICT_FILTERED}    ${FUSION_DICT_FILTERED}
	
Happy Path LLDP Check Port And remoteChassisIdType field
    ${FUSION_DICT_FILTERED}=    Comware Filter LLDP    ${FUSION_GLOBAL_DICT}    remoteChassisIdType
    ${SWITCH_DICT_FILTERED}=    Comware Filter LLDP    ${SWITCH_GLOBAL_DICT}    remoteChassisIdType
    Log    ${FUSION_DICT_FILTERED}
    Log    ${SWITCH_DICT_FILTERED}
    Dictionaries Should Be Equal    ${SWITCH_DICT_FILTERED}    ${FUSION_DICT_FILTERED}