*** Settings ***
Documentation     Fusion GUI keywords 
...               = Usage =
...               | Library | resources/fusion_gui.txt |
Library           RoboGalaxyLibrary         # DVTs Robot Framework extensions
Library           FusionLibrary                  # DVTs Robot Framework extensions
Library           FusionLibrary             # DVTs Robot Framework extensions
Variables         resources/variables.py    # Comet-DVT default variables

*** Variables ***

*** Keywords ***
Login to Fusion Via GUI
    [Documentation]    Connects to the Appliance and creates a session using the Username and Password.
    [Arguments]    ${IP}=${FUSION_IP}    ${BROWSER}=${BROWSER}    ${DELAY}=${FUSION_GUI_DELAY}
    ...            ${USERNAME}=${FUSION_USERNAME}    ${PASSWORD}=${FUSION_PASSWORD}
    Log Many    ${IP}    ${BROWSER}    ${DELAY}    ${USERNAME}    ${PASSWORD}
    Open Browser    https://${IP}/#/login    ${BROWSER}
    # Click 'Continue to this website' link allowing test case to continue (for IE only).
    Run Keyword If  "${BROWSER}" == "IE"   Go To  javascript:document.getElementById('overridelink').click()
    Set Selenium Speed    ${DELAY}
    Title Should Be    OneView
    Input Text    hp-login-user    ${USERNAME}
    Input Text    hp-login-password    ${PASSWORD}
    Click Button    hp-login-button
    sleep    5

Logout Of Fusion Via GUI
    [Documentation]    Terminates the browser session.
    Close Window

First Time Setup for FusionVM
    [Documentation]    Performs the first-time setup steps via the GUI. Set password, network
    Sleep    120
    Open Browser To Login Page After Reset
    Assign Administrator Password
    Assign DHCP Networking
	Sleep    120
	Location Should Contain    activity
    Close Window

Open Browser To Login Page After Reset
    [Documentation]    Login to Fusion GUI using Factory Defaults
    [Arguments]    ${IP}=${FUSION_IP}    ${BROWSER}=${BROWSER}    ${DELAY}=${FUSION_GUI_DELAY}
    ...            ${USERNAME}=${FUSION_USERNAME}    ${PASSWORD}=${FUSION_FACTORY_PASSWORD}
    Log Many    ${IP}    ${BROWSER}    ${DELAY}    ${USERNAME}    ${PASSWORD}
    Open Browser    https://${IP}/#/login    ${BROWSER}
    # Click 'Continue to this website' link allowing test case to continue (for IE only).
    Run Keyword If  "${BROWSER}" == "IE"   Go To  javascript:document.getElementById('overridelink').click()
    Set Selenium Speed    ${DELAY}
    Title Should Be    OneView
    Input Text    hp-login-user    ${USERNAME}
    Input Text    hp-login-password    ${PASSWORD}
    Click Button    hp-login-button
    sleep    5

Assign Administrator Password
    [Documentation]    Update the factory default password
    [Arguments]    ${NEW_PASSWORD}=${FUSION_PASSWORD}
    Input Text    id=hp-initial-password-new1    ${NEW_PASSWORD}
    Input Text    id=hp-initial-password-new2    ${NEW_PASSWORD}
    Click Button    id=hp-initial-password-button-element
    sleep    5

Assign DHCP Networking
    Click Button    id=cic-network-ipv4-dhcp
    Click Button    id=cic-network-ok
    Sleep    5

Add Network
    [Documentation]    Connects to the Appliance and adds a network.
    [Arguments]    ${FUSION_IP}    ${NETWORK NAME}    ${VLAN ID}
    Go To    https://${FUSION_IP}/#/network/add/general
    #Title Should Be    Add general - Networks - HP OneView
    Input Text    cic-network-name    ${NETWORK NAME}
    Click Element    cic-network-add-ethernet-type
    Input Text    cic-network-vlan-id    ${VLAN ID}
    Click Button    cic-network-add
    
Create Logical Interconnect Group Via GUI
    [Documentation]    Connect to the Appliance and Create Logical Uplink Group.
    [Arguments]    ${FUSION_IP}    ${GROUP NAME}
    Go To    https://${FUSION_IP}/#/switchtemplate/add
    #Title Should Be    Add general - Logical Interconnect Groups - HP OneView
    Click Button    cic-switchtemplate-add
    Input Text    cic-switchtemplate-add-name    ${GROUP NAME}
    Click Button    cic-switchtemplate-add

Add Interconnect
    [Arguments]    ${BUTTON}    ${TYPE}
    # Edit the existing Logical Interconnect Group
    Click Element    id=cic-switchtemplate-actions
    Click Element    id=cic-switchtemplate-edit-action
    # Add Interconnect
    Click Button    cic-switch-template-edit-switch-${BUTTON}
    Select From List By Label    cic-switch-template-switch-type-${BUTTON}    ${TYPE}
    Click Button    cic-switchtemplate-update

Add Uplink Network
    [Arguments]    ${NAME}
    Click Element    cic-switchtemplate-dialog-networks-addNetworks
    Click Element    xpath=//td[@class=' sorting_1' and text()='${NAME}']
    Click Element    css=button.hp-add

Add Uplink Port
    [Arguments]    ${BAY}    ${PORT}
    Click Element    cic-switchtemplate-dialog-uplinks-addUplinks
    Click Element    xpath=//*[@id='hp-add-choices']/tbody/tr/td[@class=' sorting_1' and text()='${BAY}']/following-sibling::td[@class=' sorting_2' and text()='${PORT}']
    Click Element    css=button.hp-add

