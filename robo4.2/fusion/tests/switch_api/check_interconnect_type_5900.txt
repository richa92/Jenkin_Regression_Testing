*** Settings ***
Documentation     US21698: Create Interconnect Type for 5900AF
...    = Usage =
...    | pybot | -L DEBUG | -v FUSION_IP:<Your-FusionVM-IP> | check_interconnect_type_5900.txt |
...    = Variables =
...    | FUSION_IP | Required; IP address of the Fusion VM to use | 
...    | I_NAME | Optional; Interconnect-type name to validate. Default is *HP 5900AF-48XG-4QSFP+ Switch* | 
...    = Preconditions =
...    Factory Reset Settings are required. (Level 0)

Library           Collections
Library           String
Library           RoboGalaxyLibrary                       # DVTs Robot Framework extensions
Variables         resources/variables.py    ${FUSION_IP}  # Comet-DVT default variables
Resource          resources/fusion.txt                    # Comet-DVT keyword extensions
Force Tags        CometTest    PreCAT    LEVEL0           # All test cases get these tags
Suite Setup       Login to Fusion Via REST
Suite Teardown    Logout of Fusion Via REST

*** Variables ***

*** Test Cases ***
Display Interconnect Types
    ${Interconnects}=    Fusion Api Get Interconnect Types
    ${Members}    Get From Dictionary    ${Interconnects}    members
    ${Count}    Get From Dictionary    ${Interconnects}    count
    Log    'There were ${Count} interconnects returned'
    Set Suite Variable    ${Count}    ${Count}
    Set Suite Variable    ${Members}    ${Members}

Switch Name Should Be HP 5900AF
    ${Found}    Set Variable    False
    : FOR    ${Index}    IN RANGE    0    ${Count}
    \    ${Interconnect}=    Get From List    ${Members}    ${Index}
    \    Set Suite Variable    ${Interconnect}    ${Interconnect}
    \    ${Name}=    Get From Dictionary    ${Interconnect}    name
    \    Log    'Interconnect name is: ${Name}'
    \    Continue For Loop If    '${Name}'!='${I_NAME}'
    \    ${Found}    Set Variable    True
    \    Port Name is Valid
    \    Ports Are Uplink and Downlink Capable
    \    minimumFirmwareVersion and maximumFirmwareVersion are R2209 Or Later
    Should Be True    ${Found}    msg=No ${I_NAME} Device was found

*** Keywords ***
Port Name Is Valid
    @{PortInfos}=    Get From Dictionary    ${Interconnect}    portInfos
    Set Suite Variable    @{PortInfos}
    : FOR    ${Ports}    IN    @{PortInfos}
    \    ${PortName}=    Get From Dictionary    ${Ports}    portName
    \    Log    'Port Name is ${PortName}
    \    Should Match Regexp    ${PortName}    ^FortyGigE1\/0\/{4|5}{9|0|1|2}$ or ${PortName}    ^Ten-GigabitEthernet1\/0\/\\d+$

Ports Are Uplink and Downlink Capable
    @{PortInfos}=    Get From Dictionary    ${Interconnect}    portInfos
    : FOR    ${Ports}    IN    @{PortInfos}
    \    ${UpLinkCapable}    Get From Dictionary    ${Ports}    uplinkCapable
    \    Should Be True    ${UpLinkCapable}
    \    ${DownLinkCapable}    Get From Dictionary    ${Ports}    downlinkCapable
    \    Should Be True    ${DownLinkCapable}

minimumFirmwareVersion and maximumFirmwareVersion are R2209 Or Later
    ${min}    Get From Dictionary    ${Interconnect}    minimumFirmwareVersion
    ${num}    Get Substring    ${min}    -4
    Log      'minimumFirmwareVersion is ${num}'
    ${num}    Convert to Integer    ${num}
    Should Be True    ${num} > 2206    msg=minimumFirmWareVersion not met
    ${max}    Get From Dictionary    ${Interconnect}    maximumFirmwareVersion
    ${num}    Get Substring    ${max}    -4
    Log       'maximumFirmwareVersion is ${num}'
    ${num}    Convert to Integer    ${num}
    Should Be True    ${num} > 2206    msg=maximumFirmWareVersion not met
