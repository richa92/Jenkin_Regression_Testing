*** Settings ***
Documentation       Running the customer flows for changing the lig configuration
Suite Setup         Login to Fusion Via REST
Suite Teardown      Teardown
Resource            ../../DCS/Resources/resources.txt
Variables           ../../DCS/UserInputs/variables.py


*** Test Cases ***
Validation Of Hardware
    [Documentation]     This is to check whether this test suite will run on the specified hardware.
    Validation Of Hardware Inventory

DFRM Dual Conversion
    [Documentation]             This is to convert SAS LIG from Dual Domain To Single Domain And Again To Dual Domain.
    ...                         Rally ID -      OVTC30650
    [Tags]                      DUALCONVERT
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATION OF ENCLOSURE GROUP
    CREATION OF LOGICAL ENCLOSURE AND LOGICAL INTERCONNECT
    Get The Number Of Drives Present
    Check The Count Of Server Hardwares Present
    CREATE FIRST SERVER PROFILE WITH LJBOD
    ${Alert_Cnt_Bef_DD_SD}=     Get Alerts Count
    CONVERSION OF SAS LIG FROM DUAL DOMAIN TO SINGLE DOMAIN
    ${Act_alert_Post_DD_SD}=    Getting all the active alerts   ${Alert_Cnt_Bef_DD_SD}
    Validation of test alerts   ${Act_alert_Post_DD_SD}         ${ExpectedDomainConvertAlerts}
    Clear Off List
    ${Alert_Cnt_Bef_DD_UPG_LE}=                 Get Alerts Count
    UPDATE FROM GROUP LE
    ${Act_alert_Post_UFG_LE}=   Getting all the active alerts   ${Alert_Cnt_Bef_DD_UPG_LE}
    ${Act_Alert_Length}=        Get Length      ${Act_alert_Post_UFG_LE}
    Run Keyword If              '${Act_Alert_Length}' != '0'    Fail
    ...                         msg= Active Alerts present after performing UFG on LE ( Post Dual to Single Domain convert)
    Clear Off List
    ADD LJBODS TO FIRST SERVER PROFILE
    ${Alert_Cnt_Bef_SD_DD}=     Get Alerts Count
    CONVERSION OF SAS LIG FROM SINGLE DOMAIN TO DUAL DOMAIN
    ${Act_alert_Post_SD_DD}=    Getting all the active alerts   ${Alert_Cnt_Bef_SD_DD}
    Validation of test alerts   ${Act_alert_Post_SD_DD}         ${ExpectedDomainConvertAlerts}
    Clear Off List
    ${Alert_Cnt_Bef_SD_UPG_LE}=                 Get Alerts Count
    UPDATE FROM GROUP LE
    ${Act_alert_Post_UFG_LE}=   Getting all the active alerts   ${Alert_Cnt_Bef_SD_UPG_LE}
    ${Act_Alert_Length}=        Get Length      ${Act_alert_Post_UFG_LE}
    Run Keyword If              '${Act_Alert_Length}' != '0'    Fail
    ...                         msg= Active Alerts present after performing UFG on LE ( Post Single to Dual Domain convert)
    ValidationoflLISPLJBODstatus
    Clear Off List
    Sleep                       10s

DFRM Support Dump Extraction
    [Documentation]     This is to extract the support dump of logical enclosure
    ...                 Rally ID -      OVTC30497
    [Tags]              SUPPORTDUMP
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATION OF ENCLOSURE GROUP
    CREATION OF LOGICAL ENCLOSURE AND LOGICAL INTERCONNECT
    Get The Number Of Drives Present
    Check The Count Of Server Hardwares Present
    CREATE FIRST SERVER PROFILE WITH LJBOD
    DOWNLOAD LOGICAL ENCLOSURE SUPPORT DUMP
    CONVERSION OF SAS LIG FROM DUAL DOMAIN TO SINGLE DOMAIN
    UPDATE FROM GROUP LE
    DOWNLOAD LOGICAL ENCLOSURE SUPPORT DUMP
    Sleep               30s

DFRM Unassign HW From Server Profile
    [Documentation]     This is to unassign,reassign server hardware from server profile associated.
    ...                 Rally ID -                  OVTC30892
    [Tags]              UNASSIGN
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATION OF ENCLOSURE GROUP
    CREATION OF LOGICAL ENCLOSURE AND LOGICAL INTERCONNECT
    Get The Number Of Drives Present
    Check The Count Of Server Hardwares Present
    CREATE FIRST SERVER PROFILE WITH LJBOD
    UNASSIGN HARDWARE FROM SERVER HARDWARE          ${sp1_index}
    ADD LJBODS TO FIRST SERVER PROFILE
    ASSIGN ANOTHER HARDWARE TO THE SERVER PROFILE   ${sp1_index}    ${sw_hw_2_index}
    Sleep               30s

DFRM Create Independent LJBODS
    [Documentation]     this is to create the independent ljbod
    ...                 Rally ID - OVTC30479, OVTC31184, OVTC37106
    [Tags]              ILJBOD
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATION OF ENCLOSURE GROUP
    CREATION OF LOGICAL ENCLOSURE AND LOGICAL INTERCONNECT
    Get The Number Of Drives Present
    Check The Count Of Server Hardwares Present
    CREATION OF INDEPENDENT LJBODS
    Edit Of Independent LJBOD
    Deletion OF INDEPENDENT LJBODS
    Sleep               30s

DFRM CREATE SP USING EXISTING LJBODS
    [Documentation]     DFRM test to validate creation of Server profile using exisitng LJBODs
    ...                 Rally ID - OVTC42080
    [Tags]              SP_EXIST_LJBOD
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATION OF ENCLOSURE GROUP
    CREATION OF LOGICAL ENCLOSURE AND LOGICAL INTERCONNECT
    Get The Number Of Drives Present
    Check The Count Of Server Hardwares Present
    CREATION OF INDEPENDENT LJBODS
    CREATE SERVER PROFILE WITH EXISTING LJBOD
    ValidationoflLISPLJBODstatus

DFRM UFG ON LE WITH ASSIGNED AND UNASSIGNED LJBODS
    [Documentation]     DFRM Test to validate   verify & validate the UFG on LE to change the LI config from single
    ...                 to dual (or viceversa) goes through and the state & status of JBODsÂ is updated correctly
    ...                 on appliance
    ...                 Rally ID - OVTC46566
    [Tags]              UFG_LE_ASSIGN_UNASSIGN
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATION OF ENCLOSURE GROUP
    CREATION OF LOGICAL ENCLOSURE AND LOGICAL INTERCONNECT
    Get The Number Of Drives Present
    Check The Count Of Server Hardwares Present
    CREATE FIRST SERVER PROFILE WITH LJBOD
    CONVERSION OF SAS LIG FROM DUAL DOMAIN TO SINGLE DOMAIN
    UPDATE FROM GROUP LE
    ValidationoflLISPLJBODstatus

DFRM REAPPLY CONFIG FOR SINGLE DOMAIN LI
    [Documentation]     DFRM test to Perform reapply config on LI in single domain and verify the task info
    ...                 Rally ID - OVTC30881
    [Tags]              REAPPLY_SINGLE_DOMAIN
    Pre Conditions Check
    CREATION OF SINGLE DOMAIN SAS LIG
    CREATION OF SINGLE DOMAIN ENCLOSURE GROUP
    CREATION OF LOGICAL ENCLOSURE AND LOGICAL INTERCONNECT
    REAPPLY CONFIG ON LOGICAL INTERCONNECT

DFRM DELETE LJBOD POWER OFF ICM AND VALIDATE REAPPLY CONFIG
    [Documentation]         DFRM Test to Validate Reapply config on delete failed independent ljbod task
    ...                     Rally ID - OVTC36964
    [Tags]                  LJBODDEL_REAPPYLI
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATION OF ENCLOSURE GROUP
    CREATION OF LOGICAL ENCLOSURE AND LOGICAL INTERCONNECT
    Get The Number Of Drives Present
    Check The Count Of Server Hardwares Present
    CREATE FIRST SERVER PROFILE WITH LJBOD
    Efuse ICM while Deleting independent ljbods
    Efuse Interconnect      EFuseOff    ${bay_1}
    Sleep                   300s
    REAPPLY CONFIG ON LOGICAL INTERCONNECT
    Sleep                   10s
    ValidationoflLISPLJBODstatus
    Sleep                   30s

DFRM COPY LIG
    [Documentation]     DFRM regression test to verify COPY LIG functionality
    ...                 Rally ID - OVTC30885
    [Tags]              COPYLIG
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATION OF ENCLOSURE GROUP
    CREATION OF LOGICAL ENCLOSURE AND LOGICAL INTERCONNECT
    Get The Number Of Drives Present
    Check The Count Of Server Hardwares Present
    CREATE FIRST SERVER PROFILE WITH LJBOD
    COPY OF A LIG
    EDIT ENCLOSURE GROUP WITH DUAL DOMAIN LIG   CopyLig
    UPDATE FROM GROUP LE EXPECT ERROR
    EDIT SERVER PROFILE TO DELETE LJBODS
    UPDATE FROM GROUP LE
    ValidationoflLISPLJBODstatus

DFRM EDIT EG DIFFERENT LIG AND DOMAIN CONVERSION
    [Documentation]     EDIT EG and Update fron Group LI for 2 Scenarios
    ...                 Case-1: Create 2 LIG ( Single, Dual Domain), EG ( Dual domain), LE-LI (Dual Domain)
    ...                 Edit EG ( Assign Single domain LIG), UFG on LI
    ...                 Case-2: Create 2 LIG ( Single, Dual Domain), EG ( Single domain), LE-LI (Single Domain)
    ...                 Edit EG ( Assign Dual domain LIG), UFG on LI
    ...                 Rally ID - OVTC30516
    [Tags]              EDIT_EG_SINGLE_DUAL_UFG_LI
    #                   Case-1:
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATION OF SINGLE DOMAIN SAS LIG
    CREATION OF ENCLOSURE GROUP
    CREATION OF LOGICAL ENCLOSURE AND LOGICAL INTERCONNECT
    EDIT ENCLOSURE GROUP WITH SINGLE DOMAIN LIG     LIG-Single-Domain
    UPDATE FROM GROUP LE
    #                   Case-2:
    Pre Conditions Check
    CREATION OF SINGLE DOMAIN SAS LIG
    CREATION OF SINGLE DOMAIN ENCLOSURE GROUP
    CREATION OF LOGICAL ENCLOSURE AND LOGICAL INTERCONNECT
    CREATION OF DUAL DOMAIN SAS LIG
    EDIT ENCLOSURE GROUP WITH DUAL DOMAIN LIG       lig1
    UPDATE FROM GROUP LE

DFRM DELETE INDEPENDENT LJBOD WITH PERMANENT OPTION ENABLED
    [Documentation]     this is to add permanent option to true
    ...                 Rally ID - OVTC42023, OVTC42076
    [Tags]              ILJBODPERSIST
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATION OF ENCLOSURE GROUP
    CREATION OF LOGICAL ENCLOSURE AND LOGICAL INTERCONNECT
    Get The Number Of Drives Present
    Check The Count Of Server Hardwares Present
    CREATE FIRST SERVER PROFILE WITH LJBOD And persistent Enabled
    Delete All ServerProfile
    VALIDATE LJBOD STATUS
    Deletion of independent ljbods
    sleep               30s

DFRM POWER OFF ON DRIVE ENCLOSURE WHILE EDITING SERVER PROFILE
    [Documentation]             DFRM test to validate Power On/Off while editing Server profile.
    ...                         Rally ID - OVTC37219
    [Tags]                      PWRONOFFDEWEDITSP
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATION OF ENCLOSURE GROUP
    CREATION OF LOGICAL ENCLOSURE AND LOGICAL INTERCONNECT
    Get The Number Of Drives Present
    Check The Count Of Server Hardwares Present
    CREATE FIRST SERVER PROFILE WITH LJBOD
    ${driveuri}=                To Extract The Drive Enclosure Used For Creation Of LJBOD
    Drive Enclosure Power off   ${driveuri}
    Sleep                       10s
    Drive Enclosure Power on    ${driveuri}
    UPDATE FROM GROUP LE
    ValidationoflLISPLJBODstatus
    Sleep                       30s

DFRM DRIVE ENCLOSURE POWER ON OFF WITH SP AND RAID LJBOD
    [Documentation]             DFRM test to Validate Power on Off Operation for Server Profile
    ...                         with Logical drive(RAID1)
    ...                         Rally ID -      OVTC37218, OVTC37219
    [Tags]                      DEPONPOFFRAID
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATION OF ENCLOSURE GROUP
    CREATION OF LOGICAL ENCLOSURE AND LOGICAL INTERCONNECT
    Get The Number Of Drives Present
    Check The Count Of Server Hardwares Present
    Create Server Profile With Logical Drives   0               0
    ${driveuri}=                To Extract The Drive Enclosure Used For Creation Of LJBOD
    ${AlertCntBefPoff}=         Get Alerts Count
    Drive Enclosure Power off   ${driveuri}
    Sleep                       60s
#   ${listofDEalertvalues}=     Getting all the active alerts   ${AlertCntBefPoff}
#   validation of test alerts   ${listofDEalertvalues}          ${predefinedalertforpoweroffdriveenclosure}
#   Clear Off List
    ${AlertCntBefPon}=          Get Alerts Count
    Drive Enclosure Power on    ${driveuri}
    Sleep                       30s
    ${Act_alert_Post_PowerOn}=                  Getting all the active alerts   ${AlertCntBefPon}
    ${Act_Alert_Length}=        Get Length      ${Act_alert_Post_PowerOn}
    Run Keyword If              '${Act_Alert_Length}' != '0'    Fail
    ...                         msg=Some Alerts are still active after Drive Enclosure Power on
    ValidationoflLISPLJBODstatus
    Sleep                       30s

DFRM CREATE SP WITH RAID LJBOD AND PERMANENT OPTION ENABLED
    [Documentation]     DFRM test to validate SP Creation with RAID-1 and drive Permanent enabled
    ...                 Rally ID - OVTC42020
    [Tags]              SP_RAID_PERSIST_ENABLE
    Pre Conditions Check
    #Validation Of Hardware Inventory
    CREATION OF DUAL DOMAIN SAS LIG
    CREATION OF ENCLOSURE GROUP
    CREATION OF LOGICAL ENCLOSURE AND LOGICAL INTERCONNECT
    Get The Number Of Drives Present
    Check The Count Of Server Hardwares Present
    Create Server Profile With Logical Drives   0   1
    Delete All ServerProfile
    VALIDATE LJBOD STATUS
    Deletion of independent ljbods
    sleep               30s

DFRM BACKUP AND RESTORE
    [Documentation]     DFRM test to Validate Backup and Restore Operation.
    ...                 Rally ID - OVTC30898, OVTC30897, OVTC19769
    [Tags]              BKUPR
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATION OF ENCLOSURE GROUP
    CREATION OF LOGICAL ENCLOSURE AND LOGICAL INTERCONNECT
    Backup the appliance
    ${value}=           DELETE ALL LOGICAL ENCLOSURE
    Restore the Appliance
    Sleep               600s
    Check If Restore Appliance Completed
    Sleep               10s

DFRM BACKUP WITH INDEPENDENT JBOD AND RESTORE
    [Documentation]             DFRM test to validate Backup with Independent LJBODs and Restore with modifcations.
    ...                         Rally ID - OVTC19755, OVTC19768, OVTC36941
    [Tags]                      ILJBOD_BACKUPRESTR
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATION OF ENCLOSURE GROUP
    CREATION OF LOGICAL ENCLOSURE AND LOGICAL INTERCONNECT
    Get The Number Of Drives Present
    CREATION OF INDEPENDENT LJBODS
    Backup the appliance
    Deletion OF INDEPENDENT LJBODS
    ${AlertCntBefRestore}=      Get Alerts Count
    Restore the Appliance
    Sleep                       600s
    Check If Restore Appliance Completed
    Sleep                       10s
    ${listofActalertAfterRestore}=      Getting all the active alerts   ${AlertCntBefRestore}
    validation of test alerts   ${listofActalertAfterRestore}           ${ExpetedLJBODMisMatchRestoreAlert}
    Clear Off List
    REAPPLY CONFIG ON LOGICAL INTERCONNECT
    ValidateLIandLJBODStatus

DFRM BACKUP AND DELETE SP AND RECREATE SP AND RESTORE
    [Documentation]             DFRM test to validate Backup with Server Profile, Delete SP and Recreate SP, Update Group
    ...                         Restore and verify test.
    ...                         Rally ID - OVTC19768
    [Tags]                      BKUP_SP_DELETE_RESTR
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATION OF ENCLOSURE GROUP
    CREATION OF LOGICAL ENCLOSURE AND LOGICAL INTERCONNECT
    Get The Number Of Drives Present
    Check The Count Of Server Hardwares Present
    CREATE FIRST SERVER PROFILE WITH LJBOD
    Backup the appliance
    Delete All ServerProfile
    Get The Number Of Drives Present
    CREATE SECOND SERVER PROFILE WITH LJBOD
    ${AlertCntBefRestore}=      Get Alerts Count
    Restore the Appliance
    Sleep                       600s
    Check If Restore Appliance Completed
    Sleep                       10s
    ${listofActalertAfterRestore}=      Getting all the active alerts   ${AlertCntBefRestore}
    validation of test alerts   ${listofActalertAfterRestore}           ${ExpetedSPMisMatchRestoreAlert}
    Clear Off List
    REAPPLY CONFIG ON LOGICAL INTERCONNECT
    ValidateLIandLJBODStatus
    Sleep                       30s

DFRM BACKUP AND RESTORE WITH DOMAIN CONVERSIONS
    [Documentation]             DFRM test to validate Backup and Restore with Domain Conversions.
    ...                         Rally ID - OVTC45230, OVTC45121
    [Tags]                      BKUP_RESTR_DOMAIN_CONVERT
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATION OF ENCLOSURE GROUP
    CREATION OF LOGICAL ENCLOSURE AND LOGICAL INTERCONNECT
    Get The Number Of Drives Present
    Check The Count Of Server Hardwares Present
    CREATE FIRST SERVER PROFILE WITH LJBOD
    Backup the appliance
    CONVERSION OF SAS LIG FROM DUAL DOMAIN TO SINGLE DOMAIN
    UPDATE FROM GROUP LE
    ADD LJBODS TO FIRST SERVER PROFILE
    ${AlertCntBefRestore}=      Get Alerts Count
    Restore the Appliance
    Sleep                       600s
    Check If Restore Appliance Completed
    Sleep                       10s
    ${listofActalertAfterRestore}=      Getting all the active alerts   ${AlertCntBefRestore}
    validation of test alerts   ${listofActalertAfterRestore}           ${ExpetedSPMisMatchRestoreAlert}
    Clear Off List
    REAPPLY CONFIG ON LOGICAL INTERCONNECT
    CONVERSION OF SAS LIG FROM SINGLE DOMAIN TO DUAL DOMAIN
    UPDATE FROM GROUP LE
    ValidationoflLISPLJBODstatus
    Sleep                       30s

DFRM CREATE SP WITH RAID LJBOD AND DRIVE ERASE ENABLED
    [Documentation]             DFRM test to validate SP Creation with RAID-1 and drive erase enabled
    ...                         Rally ID - OVTC30524, OVTC30491, OVTC42024, OVTC42021
    [Tags]                      SP_RAID_ERASE_ENABLE
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATION OF ENCLOSURE GROUP
    CREATION OF LOGICAL ENCLOSURE AND LOGICAL INTERCONNECT
    Get The Number Of Drives Present
    Check The Count Of Server Hardwares Present
    Create Server Profile With Logical Drives   1   0
    ${Alert_Cnt_start}=         Get Alerts Count
    #Logger                     ${Alert_Cnt_start}
    Delete All ServerProfile
    ValidateSanitizationStart   ${Alert_Cnt_start}
    Sleep                       60s
    ${Alert_Cnt_end}=           Get Alerts Count
    Validation for sanitization                 ${Alert_Cnt_end}

DFRM REFRESH ICM DURING DRIVE ERASE
    [Documentation]             DFRM Test to Validate Refresh of SAS Interconnect during drive erase (Sanitization)
    ...                         Rally ID - OVTC30526
    [Tags]                      ICMREFRESHWDRIVEERASE
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATION OF ENCLOSURE GROUP
    CREATION OF LOGICAL ENCLOSURE AND LOGICAL INTERCONNECT
    Get The Number Of Drives Present
    Check The Count Of Server Hardwares Present
    CREATE FIRST SERVER PROFILE WITH LJBOD And Drive Erase Enabled
    ${Alert_Cnt_start}=         Get Alerts Count
    Delete All ServerProfile
    ValidateSanitizationStart   ${Alert_Cnt_start}
    Refresh Of Sas Interconnect     ${bay_1}
    ValidationoflLISPLJBODstatus
    Refresh Of Sas Interconnect     ${bay_4}
    ${Alert_Cnt_end}=           Get Alerts Count
    Validation for sanitization     ${Alert_Cnt_end}
    ValidationoflLISPLJBODstatus
    sleep                       30s

DFRM HARD AND SOFT RESET OF ICM DURING DRIVE ERASE
    [Documentation]             DFRM Test to Validate Hard & Soft Reset of SAS Interconnect during drive erase (Sanitization)
    ...                         Rally ID - OVTC30528
    [Tags]                      HARDSOFTRESETWDRIVEERASE
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATION OF ENCLOSURE GROUP
    CREATION OF LOGICAL ENCLOSURE AND LOGICAL INTERCONNECT
    Check The Count Of Server Hardwares Present
    CREATE FIRST SERVER PROFILE WITH LJBOD And Drive Erase Enabled
    ${Alert_Cnt_start}=         Get Alerts Count
    Delete All ServerProfile
    ${Alert_Cnt_start}=         Get Alerts Count
    ValidateSanitizationStart   ${Alert_Cnt_start}
    ${uri}=                     Soft Reset Of Interconnect      ${bay_1}
    Validation Of Soft Reset    ${uri}
    ${uri}=                     Soft Reset Of Interconnect      ${bay_4}
    Validation Of Soft Reset    ${uri}
    ${uri}=                     Hard Reset Of Interconnect      ${bay_1}
    Validation Of Hard Reset    ${uri}
    ${urii}=                    Hard Reset Of Interconnect      ${bay_4}
    Validation Of Hard Reset    ${urii}
    ${Alert_Cnt_end}=           Get Alerts Count
    Validation for sanitization     ${Alert_Cnt_end}

DFRM REFRESH DRIVE ENCLOSURE DURING DRIVE ERASE
    [Documentation]             DFRM Test to Validate Refresh of Drive Enclosure(Big Bird) during drive erase (Sanitization)
    ...                         Rally ID - OVTC30527
    [Tags]                      DRIVEREFRESHWDRIVEERASE
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATION OF ENCLOSURE GROUP
    CREATION OF LOGICAL ENCLOSURE AND LOGICAL INTERCONNECT
    Check The Count Of Server Hardwares Present
    CREATE FIRST SERVER PROFILE WITH LJBOD And Drive Erase Enabled
    ${Alert_Cnt_start}=         Get Alerts Count
    Delete All ServerProfile
    ValidateSanitizationStart   ${Alert_Cnt_start}
    Refresh of drive enclosure
    ${Alert_Cnt_end}=           Get Alerts Count
    Validation for sanitization     ${Alert_Cnt_end}
    ValidationoflLISPLJBODstatus
    Sleep                       30s

DFRM EFUSE ON DURING DRIVE ERASE IN PROGRESS
    [Documentation]             DFRM Test to Validate Refresh of Drive Enclosure(Big Bird) during drive erase (Sanitization)
    ...                         Rally ID - OVTC30376
    [Tags]                      EFUSEICMWDRIVEERASE
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATION OF ENCLOSURE GROUP
    CREATION OF LOGICAL ENCLOSURE AND LOGICAL INTERCONNECT
    Check The Count Of Server Hardwares Present
    CREATE FIRST SERVER PROFILE WITH LJBOD And Drive Erase Enabled
    ${Alert_Cnt_start}=         Get Alerts Count
    Delete All ServerProfile
    ValidateSanitizationStart   ${Alert_Cnt_start}
    Efuse Interconnect          EFuseOn         ${bay_1}
    Sleep                       10s
    ${Alert_Cnt_end}=           Get Alerts Count
    Validation for sanitization                 ${Alert_Cnt_end}
    ${Alert_Cnt_Ef_Off_bay1}=   Get Alerts Count
    Efuse Interconnect          EFuseOff        ${bay_1}
    Sleep                       300s
    ${Act_alert_Post_EfuseOff}=                 Getting All The Active Alerts   ${Alert_Cnt_Ef_Off_bay1}
    ${Act_Alert_Length}=        Get Length      ${Act_alert_Post_EfuseOff}
    Run Keyword If              '${Act_Alert_Length}' != '0'                    Fail
    ...                         msg=Some Alerts are still active after Efuse OFF of SASIC-01
    Clear Off List
    ValidationoflLISPLJBODstatus
    Sleep                       30s

DFRM SANITIZATION OPERATION
    [Documentation]             this is to test the sanitize operation
    ...                         Rally ID - OVTC30490,OVTC31188
    [Tags]                      DRVSANITIZE
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATION OF ENCLOSURE GROUP
    CREATION OF LOGICAL ENCLOSURE AND LOGICAL INTERCONNECT
    Get The Number Of Drives Present
    Check The Count Of Server Hardwares Present
    CREATION OF INDEPENDENT LJBODS
    ${Alert_Cnt_start}=         Get Alerts Count
    Deletion OF INDEPENDENT LJBODS
    ValidateSanitizationStart   ${Alert_Cnt_start}
    ${Alert_Cnt_end}=           Get Alerts Count
    Validation for sanitization     ${Alert_Cnt_end}
    Sleep                       30s

DFRM PROFILE MOBILITY WITH LJBOD
    [Documentation]     DFRM Test to test Profile Mobility from one server hardware to another server hardware
    ...                 with simple LJBOD ( Non RAID )
    ...                 Rally ID - OVTC00000
    [Tags]              PROFILE_MOB_CASE_1
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATION OF ENCLOSURE GROUP
    CREATION OF LOGICAL ENCLOSURE AND LOGICAL INTERCONNECT
    Get The Number Of Drives Present
    Check The Count Of Server Hardwares Present
    CREATE FIRST SERVER PROFILE WITH LJBOD          # Create SP1 with Server Hardware -1 and LJBOD
    CREATE SECOND SERVER PROFILE WITH LJBOD         # Create SP2 with Server Hardware -2 and LJBOD
    UNASSIGN HARDWARE FROM SERVER HARDWARE          ${sp1_index}    # Edit SP-1 and Unassign SP from Server Hardware-1
    # Edit SP-2         and assign Server Hardware -1
    ASSIGN ANOTHER HARDWARE TO THE SERVER PROFILE   ${sp2_index}    ${sw_hw_1_index}
    # Edit SP-1 and assign Server Hardware -2
    ASSIGN ANOTHER HARDWARE TO THE SERVER PROFILE   ${sp1_index}    ${sw_hw_2_index}
    Sleep               30s
    ValidationoflLISPLJBODstatus

DFRM CREATE SP LJBOD WITH SATA DISK AND DRIVE ERASE ENABLED
    [Documentation]             DFRM test to validate SP Creation using SATA disk and drive erase enabled
    ...                         Rally ID - OVTC30523, OVTC30479
    [Tags]                      SATALJBODERASEON
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATION OF ENCLOSURE GROUP
    CREATION OF LOGICAL ENCLOSURE AND LOGICAL INTERCONNECT
    Check The Count Of Server Hardwares Present
    CREATE FIRST SERVER PROFILE WITH SATA LJBOD And Drive Erase Enabled
    Delete All ServerProfile
    ${Alert_Cnt_start}=         Get Alerts Count
    ValidateSanitizationStart   ${Alert_Cnt_start}
    Sleep                       60s
    ${Alert_Cnt_end}=           Get Alerts Count
    Validation for sanitization     ${Alert_Cnt_end}

DFRM POWER OFF ICM WHILE EDITING LJBOD
    [Documentation]             DFRM test to validate Power off of SAS Interconnect while editing LJBOD
    ...                         Rally ID - OVTC37218
    [Tags]                      PWROFFICMEDITLJBOD
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATION OF ENCLOSURE GROUP
    CREATION OF LOGICAL ENCLOSURE AND LOGICAL INTERCONNECT
    Get The Number Of Drives Present
    Check The Count Of Server Hardwares Present
    CREATE FIRST SERVER PROFILE WITH LJBOD
    CREATE SECOND SERVER PROFILE WITH LJBOD
    POWER OFF INTERCONNECT      ${bay_1}
    ADD LJBODS TO FIRST SERVER PROFILE
    Power On interconnect       ${bay_1}
    Power Off Interconnect      ${bay_4}
    ADD LJBODS TO SECOND SERVER PROFILE
    Power On Interconnect       ${bay_1}
    ValidationoflLISPLJBODstatus

DFRM VALIDATE ICM REMOVE ADD ALERT VALIDATION IN DUAL DOMAIN
    [Documentation]             DFRM Test to validate alerts in DUAL Domain configuration when SAS Interconnects (1 and 4)
    ...                         is Removed and added.
    [Tags]                      ICMADDREMOVE
    Pre Conditions Check
    Clear Off List
    CREATION OF DUAL DOMAIN SAS LIG
    CREATION OF ENCLOSURE GROUP
    CREATION OF LOGICAL ENCLOSURE AND LOGICAL INTERCONNECT
    ${Alert_Cnt_Rem_bay1}=      Get Alerts Count
    Efuse Interconnect          EFuseOn                 ${bay_1}
    Sleep                       180s
    ${listofalertvalues}=       Getting All The Active Alerts   ${Alert_Cnt_Rem_bay1}
    Validation of test alerts   ${listofalertvalues}    ${ExpectedDualDomainICMRemovalAlerts}
    Clear Off List
    ${Alert_Cnt_Add_bay1}=      Get Alerts Count
    Efuse Interconnect          EFuseOff                ${bay_1}
    Sleep                       300s
    ${Act_alert_Post_Add_bay1}=                         Getting all the active alerts   ${Alert_Cnt_Add_bay1}
    ${Act_Alert_Length}=        Get Length              ${Act_alert_Post_Add_bay1}
    Run Keyword If              '${Act_Alert_Length}' != '0'    Fail
    ...                         msg= Active Alerts present after Adding Bay 1
    ValidationoflLISPLJBODstatus
    Clear Off List
    ${Alert_Cnt_Rem_bay4}=      Get Alerts Count
    Efuse Interconnect          EFuseOn                 ${bay_4}
    Sleep                       180s
    ${listofalertvalues}=       Getting All The Active Alerts   ${Alert_Cnt_Rem_bay4}
    Validation of test alerts   ${listofalertvalues}    ${ExpectedDualDomainICMRemovalAlerts}
    Clear Off List
    ${Alert_Cnt_Add_bay4}=      Get Alerts Count
    Efuse Interconnect          EFuseOff                ${bay_4}
    Sleep                       300s
    ${Act_alert_Post_Add_bay4}=                         Getting all the active alerts   ${Alert_Cnt_Add_bay4}
    ${Act_Alert_Length}=        Get Length              ${Act_alert_Post_Add_bay4}
    Run Keyword If              '${Act_Alert_Length}' != '0'    Fail
    ...                         msg= Active Alerts present after Adding Bay 1
    ValidationoflLISPLJBODstatus
    Clear Off List
    Sleep                       10s

DFRM COMMON CONFIGURATION
    [Documentation]     Keyword to Configure commaon test steps Viz. Dual Domain LIG, EG, LE-LI and SP with LJBOD's
    Pre Conditions Check
    Clear Off List
    CREATION OF DUAL DOMAIN SAS LIG
    CREATION OF ENCLOSURE GROUP
    CREATION OF LOGICAL ENCLOSURE AND LOGICAL INTERCONNECT
    Get The Number Of Drives Present
    Check The Count Of Server Hardwares Present
    CREATE FIRST SERVER PROFILE WITH LJBOD

DFRM DRIVE ENCLOSURE RESET
    [Documentation]     this is to hard reset the drive enclosure associated with ljbod
    ...                 Rally ID - OVTC35905
    [Tags]              BBIRDRESET
    Clear Off List
    Drive Enclosure Reset
    sleep               20s
    Validation after performing hard reset on drive enclosure
    Sleep               30s

DFRM SAS ICM REFRESH
    [Documentation]     this is to refresh the sas icm
    ...                 Rally ID - OVTC30526
    [Tags]              ICMREFRESH
    Clear Off List
    Refresh Of Sas Interconnect     1
    sleep               10s
    ValidationoflLISPLJBODstatus
    Refresh Of Sas Interconnect     4
    Sleep               10s
    ValidationoflLISPLJBODstatus
    Sleep               30s

DFRM SAS DRIVE ENCLOSURE REFRESH
    [Documentation]     this is to refresh all the drive enclosure
    ...                 Rally ID - OVTC30527
    [Tags]              BBIRDREFRESH
    Clear Off List
    Refresh of drive enclosure
    Sleep               30s
    ValidationoflLISPLJBODstatus
    Sleep               30s

DFRM Power On And Off Drive Enclosure
    [Documentation]             This is to power on and off the drive enclosure
    ...                         Rally ID - OVTC45239, OVTC37217
    [Tags]                      DEPONPOFF
    Clear Off List
    ${driveuri}=                To Extract The Drive Enclosure Used For Creation Of LJBOD
    ${AlertCntBefPoff}=         Get Alerts Count
    Drive Enclosure Power off   ${driveuri}
    Sleep                       60s
    ${listofDEalertvalues}=     Getting all the active alerts                   ${AlertCntBefPoff}
    validation of test alerts   ${listofDEalertvalues}                          ${predefinedalertforpoweroffdriveenclosure}
    Clear Off List
    ${AlertCntBefPon}=          Get Alerts Count
    Drive Enclosure Power on    ${driveuri}
    Sleep                       30s
    ${Act_alert_Post_PowerOn}=                  Getting all the active alerts   ${AlertCntBefPon}
    ${Act_Alert_Length}=        Get Length      ${Act_alert_Post_PowerOn}
    Run Keyword If              '${Act_Alert_Length}' != '0'                    Fail
    ...                         msg=Some Alerts are still active after Drive Enclosure Power on
    ValidationoflLISPLJBODstatus
    Sleep                       30s

DFRM Soft Reset Of Interconnect
    [Documentation]             Soft Reset Of Interconnect
    ...                         Rally ID - OVTC36930
    [Tags]                      SOFTRESETICM
    Clear Off List
    ${uri}=                     Soft Reset Of Interconnect      ${bay_1}
    Validation Of Soft Reset    ${uri}
    ${urii}=                    Soft Reset Of Interconnect      ${bay_4}
    Validation Of Soft Reset    ${urii}
    Sleep                       30s

DFRM Hard Reset Of Interconnect
    [Documentation]             Hard Reset Of Interconnect
    ...                         Rally ID - OVTC36930
    [Tags]                      HARDRESETICM
    Clear Off List
    ${uri}=                     Hard Reset Of Interconnect      ${bay_1}
    Validation Of Hard Reset    ${uri}
    ${urii}=                    Hard Reset Of Interconnect      ${bay_4}
    Validation Of Hard Reset    ${urii}
    Sleep                       30s

DFRM POWER ON AND POWER OFF SAS INTERCONNECT
    [Documentation]             Power ON and Power Off of SAS ICM
    ...                         Rally ID - OVTC35092, OVTC30882, OVTC30880, OVTC45238
    [Tags]                      ICMPWRONPOFF
    Clear Off List
    ${Alert_Cnt_Poff_bay1}=     Get Alerts Count
    POWER OFF INTERCONNECT      ${bay_1}
    Sleep                       60s
    ${listofPoffB1Alertvalues}=                 Getting all the active alerts   ${Alert_Cnt_Poff_bay1}
    validation of test alerts   ${listofPoffB1Alertvalues}                      ${predefinedalertafterpoweringoffbay1}
    Clear Off List
    ${Alert_Cnt_Poff_bay4}=     Get Alerts Count
    POWER OFF INTERCONNECT      ${bay_4}
    Sleep                       60s
    ${listofPoffB4Alertvalues}=                 Getting all the active alerts   ${Alert_Cnt_Poff_bay4}
    validation of test alerts   ${listofPoffB4Alertvalues}                      ${predefinedalertafterpoweringoffbay1andbay4}
    Clear Off List
    ${Alert_Cnt_Pon_bay1}=      Get Alerts Count
    POWER ON INTERCONNECT       ${bay_1}
    Sleep                       60s
    ${listofPonB1Alertvalues}=                  Getting all the active alerts   ${Alert_Cnt_Pon_bay1}
    validation of test alerts   ${listofPonB1Alertvalues}                       ${predefinedalertafterpoweringonbay1}
    Clear Off List
    ${Alert_Cnt_Pon_bay4}=      Get Alerts Count
    POWER ON INTERCONNECT       ${bay_4}
    ${Act_alert_Post_Pon_bay4}=                 Getting all the active alerts   ${Alert_Cnt_Pon_bay4}
    ${Act_Alert_Length}=        Get Length      ${Act_alert_Post_Pon_bay4}
    Run Keyword If              '${Act_Alert_Length}' != '0'                    Fail
    ...                         msg= Active Alerts present after Power On of
    ...                         Bay 4
    ValidationoflLISPLJBODstatus
    Clear Off List
    Sleep                       20s

DFRM Efuse SAS Interconnect
    [Documentation]             this is to perform efuse operations on sas interconnect
    ...                         Rally ID - OVTC35091
    [Tags]                      EFUSEICM
    Clear Off List
    ${Alert_Cnt_Ef_On_bay1}=    Get Alerts Count
    Efuse Interconnect          EFuseOn                 ${bay_1}
    Sleep                       10s
    ${listofalertvalues}=       Getting All The Active Alerts   ${Alert_Cnt_Ef_On_bay1}
    Validation of test alerts   ${listofalertvalues}    ${predefinedalertwhileefuseonbay1}
    Clear Off List
    Deletion Of Alert
    ${Alert_Cnt_Ef_On_bay4}=    Get Alerts Count
    Efuse Interconnect          EFuseOn                 ${bay_4}
    Sleep                       50s
    ${listofalertvalues}=       Getting All The Active Alerts   ${Alert_Cnt_Ef_On_bay4}
    Validation of test alerts   ${listofalertvalues}    ${predefinedalertwhileefuseonbay4andbay1}
    Clear Off List
    ${Alert_Cnt_Ef_Off_bay1}=   Get Alerts Count
    Efuse Interconnect          EFuseOff                ${bay_1}
    Sleep                       300s
    ${listofalertvalues}=       Getting All The Active Alerts   ${Alert_Cnt_Ef_Off_bay1}
    Validation of test alerts   ${listofalertvalues}    ${predefinedalertwhileefuseoffbay1}
    Clear Off List
    ${Alert_Cnt_Ef_Off_bay4}=   Get Alerts Count
    Efuse Interconnect          EFuseOff                ${bay_4}
    Sleep                       300s
    ${Act_alert_Post_Ef_off_bay4}=                      Getting all the active alerts   ${Alert_Cnt_Ef_Off_bay4}
    ${Act_Alert_Length}=        Get Length              ${Act_alert_Post_Ef_off_bay4}
    Run Keyword If              '${Act_Alert_Length}' != '0'    Fail
    ...                         msg= Active Alerts present after Efuse Off Bay 4
    ValidationoflLISPLJBODstatus
    Clear Off List
    Sleep                       30s

