*** Settings ***
Documentation       Running the customer flows for changing the lig configuration
Suite Setup         Login to Fusion Via REST
Suite Teardown      Teardown
Resource            ../../DCS/Resources/resources.txt
Resource            ../../DCS/Resources/resources_MultiEnclsoure_ring.txt
Resource            ../../DCS/Resources/resources_Manual_Drive_Bay_Sel.txt
Variables           ../../DCS/UserInputs/variables.py


*** Test Cases ***
DFRM MANUAL DRIVE SELECTION SINGLE DE ALL BAYS
    [Documentation]     DFRM test to Validate Independent LJBOD creation for all drive types, Using drives from
    ...                 single drive enclosure, regardless of DE Bay position in TBIRD
    [TAGS]              MANUALDB_01
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATE ENCLOSURE GROUGP FOR 3 ENCLSOURE RING
    CREATE ONE LOGICAL ENCLOSURE FOR EACH RING TOPOLOGY
    ${drLen}=           get length          ${DriveTypeList}
    :FOR                ${drType}           IN RANGE        0                   ${drLen}
    \                   ${drive_type}=      Get from List   ${DriveTypeList}    ${drType}
    \                   CREATE IND_LJBOD WITH MANUAL DRIVE BAYS SEL ALL BAYS    2   ${drive_type}   ${SingleDE}

DFRM MANUAL DRIVE SELECTION MULTIPLE DE ALL BAYS
    [Documentation]     DFRM test to Validate Independent LJBOD creation for all drive types, Using drives from
    ...                 Multiple drive enclosure, regardless of DE Bay position in TBIRD
    [TAGS]              MANUALDB_02
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATE ENCLOSURE GROUGP FOR 3 ENCLSOURE RING
    CREATE ONE LOGICAL ENCLOSURE FOR EACH RING TOPOLOGY
    ${drLen}=           get length          ${DriveTypeList}
    :FOR                ${drType}           IN RANGE        0                   ${drLen}
    \                   ${drive_type}=      Get from List   ${DriveTypeList}    ${drType}
    \                   CREATE IND_LJBOD WITH MANUAL DRIVE BAYS SEL ALL BAYS    2   ${drive_type}   ${MultipleDE}

DFRM MANUAL DRIVE SELECTION SINGLE DE UPPER BAYS
    [Documentation]     DFRM test to Validate Independent LJBOD creation for all drive types, Using drives from
    ...                 Single drive enclosure positioned in Upper Bays [1-6] of TBIRD
    ...                 RALLY ID : OVTC61557
    [TAGS]              MANUALDB_03
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATE ENCLOSURE GROUGP FOR 3 ENCLSOURE RING
    CREATE ONE LOGICAL ENCLOSURE FOR EACH RING TOPOLOGY
    ${drLen}=           get length          ${DriveTypeList}
    :FOR                ${drType}           IN RANGE        0                   ${drLen}
    \                   ${drive_type}=      Get from List   ${DriveTypeList}    ${drType}
    \                   CREATE IND_LJBOD WITH MANUAL DRIVE SEL IN UPPER BAYS    1   ${drive_type}   ${SingleDE}     false

DFRM MANUAL DRIVE SELECTION SINGLE DE LOWER BAYS
    [Documentation]     DFRM test to Validate Independent LJBOD creation for all drive types, Using drives from
    ...                 Single drive enclosure positioned in Lower Bays [7-12] of TBIRD
    ...                 RALLY ID : OVTC63969
    [TAGS]              MANUALDB_04
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATE ENCLOSURE GROUGP FOR 3 ENCLSOURE RING
    CREATE ONE LOGICAL ENCLOSURE FOR EACH RING TOPOLOGY
    ${drLen}=           get length          ${DriveTypeList}
    :FOR                ${drType}           IN RANGE        0                   ${drLen}
    \                   ${drive_type}=      Get from List   ${DriveTypeList}    ${drType}
    \                   CREATE IND_LJBOD WITH MANUAL DRIVE SEL IN LOWER BAYS    1   ${drive_type}   ${SingleDE}

DFRM MANUAL DRIVE SELECTION DE FROM UPPER AND LOWER BAYS
    [Documentation]     DFRM test to Validate Independent LJBOD creation for all drive types, Using drives from
    ...                 Multiple drive enclosure, positioned in Both Upper [Bay, 1-6] & Lower [ Bay, 7-12] in TBIRD
    ...                 RALLY ID : OVTC64014
    [TAGS]              MANUALDB_05
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATE ENCLOSURE GROUGP FOR 3 ENCLSOURE RING
    CREATE ONE LOGICAL ENCLOSURE FOR EACH RING TOPOLOGY
    ${drLen}=           get length          ${DriveTypeList}
    :FOR                ${drType}           IN RANGE        0                   ${drLen}
    \                   ${drive_type}=      Get from List   ${DriveTypeList}    ${drType}
    \                   CREATE IND_LJBOD WITH MANUAL DRIVE SEL IN UPPER AND LOWER BAYS      1   ${drive_type}   ${MultipleDE}

DFRM MANUAL DRIVE SELECTION MULTIPLE DE UPPER BAYS
    [Documentation]     DFRM test to Validate Independent LJBOD creation for all drive types, Using drives from
    ...                 Multiple drive enclosure, positioned in Upper Bays [1-6] of TBIRD
    ...                 RALLY ID : OVTC63970
    [TAGS]              MANUALDB_06
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATE ENCLOSURE GROUGP FOR 3 ENCLSOURE RING
    CREATE ONE LOGICAL ENCLOSURE FOR EACH RING TOPOLOGY
    ${drLen}=           get length          ${DriveTypeList}
    :FOR                ${drType}           IN RANGE        0                   ${drLen}
    \                   ${drive_type}=      Get from List   ${DriveTypeList}    ${drType}
    \                   CREATE IND_LJBOD WITH MANUAL DRIVE SEL IN UPPER BAYS    1   ${drive_type}   ${MultipleDE}   false

DFRM MANUAL DRIVE SELECTION MULTIPLE DE LOWER BAYS
    [Documentation]     DFRM test to Validate Independent LJBOD creation for all drive types, Using drives from
    ...                 Multiple drive enclosure, positioned in Lower Bays [7-12] of TBIRD
    ...                 RALLY ID : OVTC63971
    [TAGS]              MANUALDB_07
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATE ENCLOSURE GROUGP FOR 3 ENCLSOURE RING
    CREATE ONE LOGICAL ENCLOSURE FOR EACH RING TOPOLOGY
    ${drLen}=           get length          ${DriveTypeList}
    :FOR                ${drType}           IN RANGE        0                   ${drLen}
    \                   ${drive_type}=      Get from List   ${DriveTypeList}    ${drType}
    \                   CREATE IND_LJBOD WITH MANUAL DRIVE SEL IN LOWER BAYS    1   ${drive_type}   ${MultipleDE}

DFRM MANUAL DRIVE SELECTION ATTACH LJBOD TO SERVER PROFILE
    [Documentation]     DFRM test to Validate Independent LJBOD creation for all drive types, Using drives from
    ...                 single drive enclosure, regardless of DE Bay position in TBIRD
    [TAGS]              MANUALDB_08
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATE ENCLOSURE GROUGP FOR 3 ENCLSOURE RING
    CREATE ONE LOGICAL ENCLOSURE FOR EACH RING TOPOLOGY
    ${drLen}=           get length          ${DriveTypeList}
    :FOR                ${drType}           IN RANGE                    0                   ${drLen}
    \                   ${drive_type}=      Get from List               ${DriveTypeList}    ${drType}
    #\                  CREATE IND_LJBOD WITH MANUAL DRIVE BAYS SEL ALL BAYS                2                   ${drive_type}
    ...                 ${SingleDE}
    \                   CREATE IND_LJBOD WITH MANUAL DRIVE BAYS SEL ALL BAYS                2                   ${drive_type}
    \                   ...                 ${MultipleDE}
    ${LJBOD_Count}=     Set Variable        1
    ${ServerHWDict}=    Create Dictionary
    ${ServerHWDict}=    GET SERVER HARDWARE LIST PER ENCLSOURE          ${ServerHWDict}
    CREATE MULTI ENCLOSURE SERVER PROFILE USING EXISTING LOGICAL JBOD   ${ServerHWDict}     ${LJBOD_Count}      False

DFRM MANUAL DRIVE SELECTION SATA DRIVES AND SINGLE PATH VALIDATION
    [Documentation]     DFRM test to Validate Independent LJBOD creation for SATA drive types across upper and lower
    ...                 Bays of TBIRD and to validate single path functionality of SATA drives.
    [TAGS]              MANUALDB_09
    Pre Conditions Check
    ${drive_type}=      Set variable                        ${DiskSATAHDD}
    CREATION OF DUAL DOMAIN SAS LIG
    CREATE ENCLOSURE GROUGP FOR 3 ENCLSOURE RING
    CREATE ONE LOGICAL ENCLOSURE FOR EACH RING TOPOLOGY
    CREATE IND_LJBOD WITH MANUAL DRIVE BAYS SEL ALL BAYS    2           ${drive_type}       ${MultipleDE}
    ${LJBOD_Count}=     Set Variable                        1
    ${ServerHWDict}=    Create Dictionary
    ${ServerHWDict}=    GET SERVER HARDWARE LIST PER ENCLSOURE          ${ServerHWDict}
    CREATE MULTI ENCLOSURE SERVER PROFILE USING EXISTING LOGICAL JBOD   ${ServerHWDict}     ${LJBOD_Count}      False
    MULTI ENCLOSURE EFUSE SAS INTERCONNECT                  EFuseOff    ${bay_4}

DFRM MANUAL DRIVE SELECTION CONTINOUS DRIVE FROM ALL BAYS
    [Documentation]     DFRM test to Validate Independent LJBOD creation for all drive types, Using drives
    ...                 Drive bay selection with continuous drive bays with same type of drives
    ...                 RALLY ID: OVTC64452
    [TAGS]              MANUALDB_10
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATE ENCLOSURE GROUGP FOR 3 ENCLSOURE RING
    CREATE ONE LOGICAL ENCLOSURE FOR EACH RING TOPOLOGY
    ${drLen}=           get length          ${DriveTypeList}
    :FOR                ${drType}           IN RANGE        0                   ${drLen}
    \                   ${drive_type}=      Get from List   ${DriveTypeList}    ${drType}
    \                   CREATE IND_LJBOD WITH MANUAL DRIVE BAYS SEL ALL BAYS    2   ${drive_type}   ${MultipleDE}

DFRM MANUAL DRIVE SELECTION MULTIPLE DE WITH ERASE ENABLED
    [Documentation]             DFRM test to Validate Independent LJBOD creation for all drive types, Using drives from
    ...                         Multiple drive enclosure, positioned in Upper Bays [1-6] of TBIRD and chosen Drive bays have
    ...                         marked for drive erase
    ...                         RALLY ID : OVTC64451
    [TAGS]                      MANUALDB_11
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATE ENCLOSURE GROUGP FOR 3 ENCLSOURE RING
    CREATE ONE LOGICAL ENCLOSURE FOR EACH RING TOPOLOGY
    CREATE IND_LJBOD WITH MANUAL DRIVE SEL IN UPPER BAYS    1   SASHDD      ${MultipleDE}   ${ERASE_ENABLE}
    ${Alert_Cnt_start}=         Get Alerts Count
    Deletion OF INDEPENDENT LJBODS
    ValidateSanitizationStart   ${Alert_Cnt_start}
    ${Alert_Cnt_end}=           Get Alerts Count
    Validation for sanitization     ${Alert_Cnt_end}

DFRM MANUAL DRIVE SELECTION SINGLE DE RANDOM BAYS
    [Documentation]     DFRM test to Validate Independent LJBOD creation for all drive types, Using drives from
    ...                 Single drive enclosure, positioned in Upper Bays [1-6] of TBIRD and Selecting random drives bays
    ...                 RALLY ID : OVTC64449
    [TAGS]              MANUALDB_12
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATE ENCLOSURE GROUGP FOR 3 ENCLSOURE RING
    CREATE ONE LOGICAL ENCLOSURE FOR EACH RING TOPOLOGY
    ${drLen}=           get length          ${DriveTypeList}
    :FOR                ${drType}           IN RANGE        0                   ${drLen}
    \                   ${drive_type}=      Get from List   ${DriveTypeList}    ${drType}
    \                   CREATE IND_LJBOD WITH MANUAL DRIVE SEL IN UPPER BAYS    2   ${drive_type}   ${RANDOM_BAY_SEL}   false

DFRM MANUAL DRIVE SELECTION ATTACH LJBOD TO SERVER PROFILE PERSIST ENABLED
    [Documentation]     DFRM test to Validate Independent LJBOD creation for all drive types, Using drives from
    ...                 single drive enclosure, regardless of DE Bay position in TBIRD and creating server profile using
    ...                 LJBODS created with persistent flag enabled.
    ...                 RALLY ID: OVTC64450
    [TAGS]              MANUALDB_13
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATE ENCLOSURE GROUGP FOR 3 ENCLSOURE RING
    CREATE ONE LOGICAL ENCLOSURE FOR EACH RING TOPOLOGY
    ${drLen}=           get length                  ${DriveTypeList}
    :FOR                ${drType}                   IN RANGE                    0                   ${drLen}
    \                   ${drive_type}=              Get from List               ${DriveTypeList}    ${drType}
    \                   CREATE IND_LJBOD WITH MANUAL DRIVE BAYS SEL ALL BAYS    2                   ${drive_type}
    \                   ...                         ${MultipleDE}
    ${LJBOD_Count}=     Set Variable                1
    ${ServerHWDict}=    Create Dictionary
    ${ServerHWDict}=    GET SERVER HARDWARE LIST PER ENCLSOURE                  ${ServerHWDict}
    CREATE MULTI ENCLOSURE SERVER PROFILE USING EXISTING LOGICAL JBOD           ${ServerHWDict}     ${LJBOD_Count}
    ...                 ${PERSIST_ENABLE}
    Delete All ServerProfile
    ${ljbodresponse}=   Fusion Api Get Resource     uri=/rest/sas-logical-jbods
    ${LJBOD_Length}=    Get length                  ${ljbodresponse['members']}
    Run Keyword if      '${LJBOD_Length}'!='12'
    ...                 FAIL                        msg="LJBOD count doesn't match with existing LJBOD count after server profile deletion with persist enabled"

DFRM MANUAL DRIVE SELECTION DIFF SIZE LJBOD ATTACH TO SERVER PROFILE
    [Documentation]     DFRM test to Validate Independent LJBOD creation for all drive types, Using drives from
    ...                 single drive enclosure with different sizes, regardless of DE Bay position in TBIRD
    ...                 RALLY ID: OVTC64447
    [TAGS]              MANUALDB_14
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATE ENCLOSURE GROUGP FOR 3 ENCLSOURE RING
    CREATE ONE LOGICAL ENCLOSURE FOR EACH RING TOPOLOGY
    ${drLen}=           get length          ${DriveTypeList}
    :FOR                ${drType}           IN RANGE                    0                   ${drLen}
    \                   ${drive_type}=      Get from List               ${DriveTypeList}    ${drType}
    \                   CREATE IND_LJBOD WITH MANUAL DRIVE BAYS SEL ALL BAYS                2                   ${drive_type}
    \                   ...                 ${MultipleDE}
    ${LJBOD_Count}=     Set Variable        1
    ${ServerHWDict}=    Create Dictionary
    ${ServerHWDict}=    GET SERVER HARDWARE LIST PER ENCLSOURE          ${ServerHWDict}
    CREATE MULTI ENCLOSURE SERVER PROFILE USING EXISTING LOGICAL JBOD   ${ServerHWDict}     ${LJBOD_Count}      false

