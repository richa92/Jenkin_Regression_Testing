*** Settings ***
Documentation       DFRM Feature automation test suite for Firmware Update OVF-178
Suite Setup         Login to Fusion Via REST
Suite Teardown      Teardown
Resource            ../../DCS/Resources/resources.txt
Resource            ../../DCS/Resources/resources_MultiEnclsoure_ring.txt
Resource            ../../DCS/Resources/resources_Manual_Drive_Bay_Sel.txt
Resource            ../../../../Resources/api/fusion_api_resource.txt
Resource            ../../DCS/Resources/resources_firmware.txt
Variables           ../../DCS/UserInputs/variables.py


*** Test Cases ***
DFRM LI FIRMWARE UPDATE PRETEST SETUP
    [Documentation]     DFRM li firmware update pre test encvironment setup.
    Pre Conditions Check
    CREATION OF DUAL DOMAIN SAS LIG
    CREATE ENCLOSURE GROUGP FOR 3 ENCLSOURE RING
    CREATE ONE LOGICAL ENCLOSURE FOR EACH RING TOPOLOGY

DFRM LI PARALLEL FIRMWARE UPDATE STAGE ONLY WITH FORCE
    [Documentation]     DFRM Test to Update and Validate Prallel LI firmware (Stage only) with Force option.
    [Tags]              FWPARSTGFRC
    DFRM ADD FIMWARE REPOSITORY
    wait until keyword succeeds                 300s                    120s            DFRM FIRMWARE BUNDLES ADDED
    Refresh Repository By Name                  ${FW_REPO_NAME}
    DFRM UPDATE LOGICAL INTERCONNECT FIRMWARE FOR EACH LI               ${FW_LATEST_ISO_NAME}     ${FW_PARALLEL_UPDT}
    ...                 ${FW_UPDT_FORCE_TRUE}   ${FW_UPDT_STAGE}        ${FW_STAGE_WAIT_TIME}

DFRM LI PARALLEL FIRMWARE UPDATE ACTIVATE ONLY WITH FORCE
    [Documentation]     DFRM Test to Update and Validate
    ...     Parallel LI firmware (Activate only) with Force option.
    [Tags]              FWPARACTFRCE
    DFRM ADD FIMWARE REPOSITORY
    wait until keyword succeeds                     300s                    120s         DFRM FIRMWARE BUNDLES ADDED
    Refresh Repository By Name                      ${FW_REPO_NAME}

    DFRM UPDATE LOGICAL INTERCONNECT FIRMWARE FOR EACH LI       ${FW_LATEST_ISO_NAME}         ${FW_PARALLEL_UPDT}
    ...     ${FW_UPDT_FORCE_TRUE}   ${FW_UPDT_ACTIVATE}         ${FW_ACTIVATE_WAIT_TIME}

DFRM LI PARALLEL FIRMWARE UPDATE STAGE AND ACTIVATE WITH FORCE
       [Documentation]     DFRM Test to Update and Validate Parallel LI firmware (Activate only) with Force option.
       [Tags]              FWPARSTAGEACTFRCE
       DFRM ADD FIMWARE REPOSITORY
       wait until keyword succeeds                     300s                    120s         DFRM FIRMWARE BUNDLES ADDED
       Refresh Repository By Name                      ${FW_REPO_NAME}
       DFRM UPDATE LOGICAL INTERCONNECT FIRMWARE FOR EACH LI       ${FW_LATEST_ISO_NAME}         ${FW_PARALLEL_UPDT}
       ...     ${FW_UPDT_FORCE_TRUE}   ${FW_UPDT_STAGE_ACTIVATE}   ${FW_STAGE_ACT_WAIT_TIME}

DFRM LI PARALLEL FIRMWARE DOWNGRADE STAGE AND ACTIVATE WITH FORCE
       [Documentation]     DFRM Test to downgrade and Validate Parallel LI firmware (Activate only) with Force option.
       [Tags]              FWPARD0WNGRADE
       DFRM ADD FIMWARE REPOSITORY
       wait until keyword succeeds                     300s                    120s         DFRM FIRMWARE BUNDLES ADDED
       Refresh Repository By Name                      ${FW_REPO_NAME}
       DFRM UPDATE LOGICAL INTERCONNECT FIRMWARE FOR EACH LI        ${FW_OLD_ISO_NAME}         ${FW_PARALLEL_UPDT}
       ...      ${FW_UPDT_FORCE_TRUE}   ${FW_UPDT_STAGE_ACTIVATE}   ${FW_STAGE_ACT_WAIT_TIME}

DFRM LI PARALLEL FIRMWARE UPGRADE STAGE AND ACTIVATE WITHOUT FORCE
       [Documentation]     DFRM Test to downgrade and Validate Parallel LI firmware (Activate only) with Force option.
       [Tags]              FWPARUPGRADE
       DFRM ADD FIMWARE REPOSITORY
       wait until keyword succeeds                     300s                    120s         DFRM FIRMWARE BUNDLES ADDED
       Refresh Repository By Name                      ${FW_REPO_NAME}
       DFRM UPDATE LOGICAL INTERCONNECT FIRMWARE FOR EACH LI       ${FW_LATEST_ISO_NAME}         ${FW_PARALLEL_UPDT}
       ...     ${FW_UPDT_FORCE_TRUE}   ${FW_UPDT_STAGE_ACTIVATE}   ${FW_STAGE_ACT_WAIT_TIME}

DFRM LI ORCHESTRATED FIRMWARE UPDATE STAGE ONLY WITH FORCE
       [Documentation]     DFRM Test to Update and Validate Orchestrated LI firmware (Stage only) with Force option.
       [Tags]              FWORCHSTGFRC
       DFRM ADD FIMWARE REPOSITORY
       wait until keyword succeeds                     300s                    120s         DFRM FIRMWARE BUNDLES ADDED
       Refresh Repository By Name                      ${FW_REPO_NAME}
       DFRM UPDATE LOGICAL INTERCONNECT FIRMWARE FOR EACH LI         ${FW_LATEST_ISO_NAME}        ${FW_ORCHESTRATE_UPDT}
       ...                 ${FW_UPDT_FORCE_TRUE}       ${FW_UPDT_STAGE}        ${FW_STAGE_WAIT_TIME}

DFRM LI ORCHESTRATED FIRMWARE UPDATE ACTIVATE ONLY WITH FORCE
       [Documentation]     DFRM Test to Update and Validate Orchestrated LI firmware (Activate only) with Force option.
       [Tags]              FWACTFRCE
       DFRM ADD FIMWARE REPOSITORY
       wait until keyword succeeds                     300s                    120s         DFRM FIRMWARE BUNDLES ADDED
       Refresh Repository By Name                      ${FW_REPO_NAME}
       DFRM UPDATE LOGICAL INTERCONNECT FIRMWARE FOR EACH LI         ${FW_LATEST_ISO_NAME}        ${FW_ORCHESTRATE_UPDT}
       ...                 ${FW_UPDT_FORCE_TRUE}       ${FW_UPDT_ACTIVATE}     ${FW_ACTIVATE_WAIT_TIME}

DFRM LI ORCHESTRATED FIRMWARE UPDATE STAGE AND ACTIVATE WITH FORCE
       [Documentation]     DFRM Test to Update and Validate  Orchestrated LI firmware (Stage+Activate) with Force option.
       [Tags]              FW0RCHSTAGEACTFRCE
       DFRM ADD FIMWARE REPOSITORY
       wait until keyword succeeds                     300s                    120s         DFRM FIRMWARE BUNDLES ADDED
       Refresh Repository By Name                      ${FW_REPO_NAME}
       DFRM UPDATE LOGICAL INTERCONNECT FIRMWARE FOR EACH LI       ${FW_LATEST_ISO_NAME}        ${FW_ORCHESTRATE_UPDT}
       ...     ${FW_UPDT_FORCE_TRUE}   ${FW_UPDT_STAGE_ACTIVATE}   ${FW_STAGE_ACT_WAIT_TIME}

DFRM LI FIRMWARE POST TEST SETUP
       [Documentation]     Test to clear off all LI firmnware test setup.
       Pre Conditions Check
       DFRM REMOVE FIRMWARE REPOSITORY
       log                 "Cleared all test environment after LI firmware test is completed."     console=true

