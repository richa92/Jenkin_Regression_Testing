*** Settings ***
Documentation   SYSTEM INFO          keywords
...             = Usage =
...             | Resource | ../resources/system_info.txt |
Library         Collections
Library         String
Library         SSHLibrary
Library         OperatingSystem
Library         RoboGalaxyLibrary   # DVTs Robot Framework extensions
Library         FusionLibrary       # DVTs Robot Framework extensions
Resource          ../resources/hal_webapp.txt


*** Variables ***

*** Keywords ***
Select Random Element from List
	[Documentation]    Returns a random element from a given list.
	[Arguments]    ${Element List}	

    ${size}=              Get Length    ${Element List}
    ${Random Index}=      Evaluate    random.randint(0, ${size}-1)    random
    ${Random Element}=    Get From List    ${Element List}    ${Random Index}
    [Return]    ${Random Element}

#-----------------------------------------------------------------------
# ENCLOSURE BLADE KEYWORDS
#-----------------------------------------------------------------------
Select Random Populated Blade Bay
    [Documentation]     Selects a random Blade Bay # which contains a blade 
    ...    based on Enclosure BLADE_DATA (variables.py).
    
    # Get Populated Blade Bays as specified in variables.py
    @{Populated Bays}=    Get Dictionary Keys     ${Blade Data}
    # Select Random Bay
    ${Random Populated Bay}=    Select Random Element from List   ${Populated Bays}
    [Return]    ${Random Populated Bay}

Select Random Empty Blade Bay
    [Documentation]     Selects a random Blade Bay # which doesn't contains a blade 
    ...                 based on Enclosure BLADE_DATA (variables.py).

    ${Empty Bays}=      Create List
    # Determine Empty Blade Bays putting them into an Empty Bay list
    @{populated bays}=    Get Dictionary Keys     ${Blade Data}
    :FOR    ${bay}    IN RANGE    1    12
    \    ${bay}      Convert To String    ${bay}
    \    ${found}    Run Keyword and Return Status
    \    ...    List Should Contain Value    ${populated bays}    ${bay} 
    \    Run Keyword If    '${found}'=='${True}'    Continue For Loop
    \    Append To List    ${Empty Bays}    ${bay}
    # Select Random Empty Bay
    ${Random Empty Bay}=    Select Random Element from List   ${Empty Bays}
    [Return]    ${Random Empty Bay}
   
#-----------------------------------------------------------------------
# ENCLOSURE INTERCONNECT KEYWORDS
#-----------------------------------------------------------------------
Select Random Populated Interconnect Bay
    [Documentation]     Selects a random Interconnect Bay # which contains an interconnect
    ...                 based on Enclosure INTERCONNECT_DATA (variables.py).

    # Get Populated Interconnect Bays as specified in variables.py
    @{Populated bays}=    Get Dictionary Keys     ${Interconnect Data}
    # Select Random Bay
    ${Random Populated Bay}=    Select Random Element from List   ${Populated Bays}
    [Return]    ${Random Populated Bay}

Select Random Empty Interconnect Bay
    [Documentation]    Selects a random Interconnect Bay # which doesn't contains an
    ...                interconnect based on Enclosure INTERCONNECT_DATA (variables.py).

    ${Empty Bays}=      Create List
    # Determine Empty Interconnect Bays putting them into an Empty Bay list
    @{populated bays}    Get Dictionary Keys     ${Interconnect Data}
    :FOR    ${bay}    IN RANGE    1    6
    \    ${bay}      Convert To String    ${bay}
    \    ${found}    Run Keyword and Return Status
    \    ...    List Should Contain Value    ${populated bays}    ${bay} 
    \    Run Keyword If    '${found}'=='${True}'    Continue For Loop
    \    Append To List    ${Empty Bays}    ${bay}
    # Select Random Empty Bay
    ${Random Empty Bay}=    Select Random Element from List   ${Empty Bays}
    [Return]    ${Random Empty Bay}


Find Filled Bays
    [Documentation]    Find filled and unfilled bays
    [Arguments]    ${RIS}   ${BayStart}=1	${BayStop}=0
    ${BayStop}=	   Run Keyword If 	    ${BayStop} == 0
    ...		Find Bay Count 		    ${RIS}
    ${BayStop}=    Set Variable   ${BayStop} + 1
    ${Filled} 	   Create List
    ${Unfilled}	   Create List
    ${protocol}=    Set Variable If    ${DCS}    https   http
    : For    ${BayNo}    In Range    ${BayStart}   ${BayStop}
    \ 	 ${Response}=    HAL API Get EM RIS   ${FUSION_IP}   ${EM_IP}    ${RIS}/${BayNo}
    \    ${Resource}=    Get Resource from Response    ${Response}
    \	 ${Empty}=    Get From Dictionary    ${Resource}    Empty
    \	 Run Keyword If    '${Empty}'=='True'
    \	 ... 	     Append to List   ${Unfilled}     ${BayNo}
    \    Run Keyword If    '${Empty}'=='False'
    \	 ... 	     Append to List   ${Filled}     ${BayNo}
    [Return]    ${Filled}	    ${Unfilled}


Find Bay Count
    [Documentation]    Find Bay Count
    [Arguments]    ${RIS}
    ${Response}=    HAL API Get EM RIS   ${FUSION_IP}   ${EM_IP}    ${RIS}
    ${Resource}=    Get Resource from Response    ${Response}
    ${links}=    Get From Dictionary    ${Resource}   links
    ${Member}=    Get From Dictionary    ${links}    Member
    ${Count} =	  Get Length		 ${Member}
    [Return]	${Count}


Get ProductInfo
    [Arguments]    ${RIS}
    Log    ${RIS}
    ${Response}=    HAL API Get EM RIS   ${FUSION_IP}   ${EM_IP}    ${RIS}
    ${Resource}=    Get Resource from Response    ${Response}
    ${Parsed}=      Get From Dictionary    ${Resource}    Parsed
    ${ProductInfo}    Get From Dictionary    ${Parsed}    ProductInfo
    [Return]    ${ProductInfo}
