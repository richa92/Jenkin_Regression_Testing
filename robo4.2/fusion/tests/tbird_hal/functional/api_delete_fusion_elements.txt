*** Settings ***
Documentation
...    = Usage =
...    | pybot | -L DEBUG | api_delete_fusion_elements.txt |
...    = Variables =
...    | ENCLOSURE | Required. Dictionary key from variables.py representing the desired enclosure. |
...    | SP_NAME | Optional. Server Profile name. |
...    | ENC_NAME | Optional. Logical Enclosure name. |
...    | ENC_GROUP_NAME | Optional. Enclosure Group name. |
...    | LIG_NAME | Optional. Logical Interconnect Group name. |

Library           Collections
Library           RoboGalaxyLibrary            # DVTs Robot Framework extensions
Library           FusionLibrary                # DVTs Robot Framework extensions
Variables         ../resources/variables.py    ${ENCLOSURE}
Resource          ../resources/defaults.txt
Resource          ../resources/fusion_api.txt  # DVT fusion API extensions
Resource          ../resources/system_info.txt
Force Tags      API    HW

Suite Setup    Login To Fusion Via REST
Suite Teardown    Logout Of Fusion Via REST

*** Variables ***

*** Test Cases ***
Delete Server Profiles
    [Tags]    SP
    ${Response}=    Fusion API Get Server Profiles
    Should be Equal As Integers    ${Response['status_code']}    200    msg=Failed to get Server Profiles.
    ${members}=    Get From Dictionary   ${Response}    members
    Run Keyword If    "${Response['count']}"=="0"
    ...    Log    No Server Profiles found.    level=WARN
    :FOR    ${index}    IN RANGE    0    ${Response['count']}
    \    Log    ${index}
    \    ${member}=    Get From List    ${members}    ${index}
    \    ${rest}    ${serverHardwareUuid}=    Split String From Right    ${member['serverHardwareUri']}    /    1
    \    Power Off Server Hardware ${serverHardwareUuid}
    \    Delete Server Profile    ${member['name']}

Delete Locigal Enclosures
    [Tags]    LE
    ${Response}=    Fusion API Get Logical Enclosure
    Should be Equal As Integers    ${Response['status_code']}    200    msg=Failed to get Logical Enclosures.
    ${members}=    Get From Dictionary   ${Response}    members
    Run Keyword If    "${Response['count']}"=="0"
    ...    Log    No Logical Enclosures found.    level=WARN
    :FOR    ${index}    IN RANGE    0    ${Response['count']}
    \    Log    ${index}
    \    ${member}=    Get From List    ${members}    ${index}
    \    Delete Logical Enclosure    ${member['name']}

Delete Enclosure Groups
    [Tags]    EG
    ${Response}=    Fusion API Get Enclosure Groups
    Should be Equal As Integers    ${Response['status_code']}    200    msg=Failed to get Enclosure Groups.
    ${members}=    Get From Dictionary   ${Response}    members
    :FOR    ${index}    IN RANGE    0    ${Response['count']}
    \    Log    ${index}
    \    ${member}=    Get From List    ${members}    ${index}
    \    Delete Enclosure Group    ${member['name']}

Delete Logical Enclosure Groups
    [Tags]    LIG
    ${Response}=    Fusion API Get LIG
    Should be Equal As Integers    ${Response['status_code']}    200    msg=Failed to get Logical Enclosure Groups.
    ${members}=    Get From Dictionary   ${Response}    members
    :FOR    ${index}    IN RANGE    0    ${Response['count']}
    \    Log    ${index}
    \    ${member}=    Get From List    ${members}    ${index}
    \    Delete LIG    ${member['name']}

Delete Ethernet Networks
    [Tags]    Network
    ${Networks}=    Get Ethernet Networks
    :FOR    ${network}    IN    @{Networks}
    \    Delete Ethernet Network    ${network['name']}

Verify Enclosure in Monitored State
    [Tags]    LE  EG  LIG
    Verify Enclosure in Monitored State
