*** Settings ***
Documentation     Add Server Profile with an Empty Bay
...    = Usage =
...    | pybot | -L DEBUG | add_server_profile_empty_bay.txt | 
...    = Variables =
...    | Fusion IP           | Required; IP address of the FusionVM to use | 
...    | Server HW Type Name | Required; Server Hardware Type Name |
...    | Enc Bay Number      | Required; Enclosure Bay Number |
...    | Server Profile Name | Optional; Server Profile Name; default *Profile 1* |
...    | Enc Name            | Optional; Enclosure Name; default *Encl1* |
...    | Enc Group Name      | Optional; Enclosure Group Name; default *Encl-Grp1* |
...    = Preconditions =
...    None

Library           RoboGalaxyLibrary            # DVTs Robot Framework extensions
Library           FusionLibrary                # DVTs Robot Framework extensions

Library           String
Library           Collections
Resource          ../resources/fusion_api.txt  # Comet-DVT fusion API extensions
Resource          ../resources/defaults.txt    # Comet-DVT default variables
Suite Setup       Login to Fusion Via REST
Suite Teardown    Logout of Fusion Via REST

*** Variables ***

*** Test Cases ***
Verify Enclosure Bay is Empty
	${DeviceBay}=    Get Enclosure Bay     ${ENC_BAY_NUMBER}    ${ENC_NAME}
	Log Dictionary     ${DeviceBay}
	${DevicePresence}    Get From Dictionary    ${DeviceBay}	devicePresence
	${status}=    Run Keyword and Return Status    Should be Equal as Strings    ${DevicePresence}    absent
	Run Keyword If    '${status}'=='False'    Fatal Error    msg=Bay ${ENC_BAY_NUMBER} in Enclosure ${ENC_NAME} is not empty.

Create Server Profile with an Empty Bay
    ${SP Payload}=     Build Server Profile with empty bay    ${Server Profile Name}    ${Server Hw Type Name}    ${Enc Group Name}    ${Enc Name}    ${Enc Bay Number}
    Create Server Profile    ${SP Payload}

Verify Server Profile with Empty Bay
    ${profile}=    Get Server Profile    ${Server Profile Name}
    Log Dictionary     ${profile}
    # Verify Name
    ${name}=       Get From Dictionary    ${profile}      name
    Should Be Equal as Strings    ${name}    ${Server Profile Name}          msg=Enclosure Group Name did not match ${Enc Group Name}.
    # Verify State
    ${state}=       Get From Dictionary    ${profile}     state
    Should Be Equal as Strings    ${state}    Normal         msg=State did not match ${state}.
    # Verify Status
    ${status}=       Get From Dictionary    ${profile}    status
    Should Be Equal as Strings    ${status}    OK                msg=Status did not match ${status}.