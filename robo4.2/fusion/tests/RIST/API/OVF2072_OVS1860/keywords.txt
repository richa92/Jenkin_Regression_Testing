*** Settings ***
Library            RoboGalaxyLibrary
Library            FusionLibrary
Library            OperatingSystem
Library            BuiltIn
Library            String
Library            robot.libraries.String
Library            Dialogs
Library            SSHLibrary
Library            Collections
Resource           ../global_variables.robot
Resource           ./../../../../Resources/api/fusion_api_resource.txt
Variables          ${DATA_FILE}

*** Keywords ***
Fetching generated CRL files from ssh server
    [Documentation]    Fetching generated CRL files from ssh server
    [Arguments]    ${SSH_SERVER}    ${SSH_USERNAME}    ${SSH_PASSWD}   
    Open Connection    ${SSH_SERVER}
    Login    ${SSH_USERNAME}    ${SSH_PASSWD}
    SSHLibrary.Get File    ${generate_appliance_cert_commands['part1']}    ${CURDIR}/${CA1_ORIG_PEM_CRL_FILE}
    SSHLibrary.Get File    ${generate_appliance_cert_commands['part2']}    ${CURDIR}/${CA1_NEW_DER_CRL_FILE}
    SSHLibrary.Get File    ${generate_appliance_cert_commands['part3']}    ${CURDIR}/${CA1_NEW_PEM_CRL_FILE}
    SSHLibrary.Get File    ${generate_appliance_cert_commands['part4']}    ${CURDIR}/${CA1_MAL_CRL_FILE}
    SSHLibrary.Get File    ${generate_appliance_cert_commands['part5']}    ${CURDIR}/${CA2_ORIG_DER_CRL_FILE}
    SSHLibrary.Get File    ${generate_appliance_cert_commands['part6']}    ${CURDIR}/${CA2_NEW_DER_CRL_FILE}

Delete rootca certificate
    [Documentation]    Deleting revoked rootca certificate
    [Arguments]    ${rootca}
    ${resp} =  Fusion Api Remove External CA Certificates    ${rootca}
    Should Be Equal    '${resp['status_code']}'    '202'    msg=Fail to remove root CA cert
    Wait For Task2    ${resp}    2min    5
    
Import rootca certificate
    [Documentation]    Importing valid rootca certificate
    [Arguments]    ${ca_cert_body}    ${rootca_uri}
    ${add_rootca} =  Fusion Api Import External Ca Certificates    ${ca_cert_body}
    Wait For Task2    ${add_rootca}    300    5
    ${retrieve_rootca} =  Run Keyword And Return Status    Fusion Api Get CA Certificate    ${rootca_uri}
    Should Be Equal    '${retrieve_rootca}'    '${True}'    msg=Cannot find the root CA certificate