*** Settings ***
Library              FusionLibrary
Library              RoboGalaxyLibrary
Library              OperatingSystem
Library              BuiltIn
Library              copy
Library              Collections
Library              String
Library              json
*** Variables ***
${APPLIANCE_IP}             unknown

*** Keywords ***
Fusion Api Compliance Valiator2
    [Documentation]   enhance the fusion api compliance validator
    [Arguments]    ${host}  ${port}  ${mode}
    ${body} =    Evaluate  {"host":"${host}","port":"${port}","securityMode":"${mode}","trustBy":"CERTIFICATE"}
    Run Keyword And Return    fusion api compliance validator  ${body}

Apache Server Is Compliant For Mode:
    [Documentation]   Validate the Apache Servier is compliant for the target mode
    [Arguments]    ${mode}
    ${response} =    Fusion Api Compliance Valiator2  ${APPLIANCE_IP}  443  ${mode}
    ${result} =    Get From Dictionary  ${response}  compliant
    Should Be Equal As Strings  ${result}  ${True}

RabbitMQ Server Is Compliant For Mode:
    [Documentation]   Validate the RabbitMQ Servier is compliant for the target mode
    [Arguments]    ${mode}  ${cert}
    Certificate Is Compliant For Mode:  ${mode}  ${cert}

Certificate Is Compliant For Mode:
    [Documentation]   Validate the given certificate is compliant for the target mode
    [Arguments]    ${mode}  ${cert}
    ${body}=    Create Dictionary  securityMode=${mode}  certificate=${cert}
    ${response}=    fusion api compliance validator  ${body}
    ${compliant} =    Run Keyword And Ignore Error    Get From Dictionary  ${response}  compliant
    ${stat}=    Set Variable If  ${compliant}==('PASS', True)  ${True}  ${False}
    Should Be Equal As Strings  ${stat}  ${True}

Compliance Validator: Validate Apache Server Of Appliance For Mode:
    [Documentation]   Validate Apache Server Of Appliance, return true or false if compliant
    [Arguments]    ${mode}
    ${response} =    Fusion Api Compliance Valiator2  ${APPLIANCE_IP}  443  ${mode}
    ${compliant} =    Run Keyword And Ignore Error    Get From Dictionary  ${response}  compliant
    ${stat}=    Set Variable If  ${compliant}==('PASS', True)  ${True}  ${False}
    [Return]  ${stat}

Compliance Validator: Validate RabbitMQ Server Of Appliance For Mode:
    [Documentation]   Validate RabbitMQ Server Of Appliance, return true or false if compliant
    [Arguments]    ${mode}  ${cert}
    ${stat}=    Compliance Validator: Validate Certificate For Mode:  ${mode}  ${cert}
    ${response} =    Fusion Api Compliance Valiator2  ${APPLIANCE_IP}  5671  ${mode}
    ${compliant} =    Run Keyword And Ignore Error    Get From Dictionary  ${response}  compliant
    ${stat}=    Set Variable If  ${compliant}==('PASS', True)  ${True}  ${False}
    [Return]  ${stat}

Compliance Validator: Validate Certificate For Mode:
    [Documentation]   Compliance Validator: Validate Certificate For Mode:
    [Arguments]    ${mode}  ${cert}
    ${body}=    Create Dictionary  securityMode=${mode}  certificate=${cert}
    ${response}=    fusion api compliance validator  ${body}
    ${compliant} =    Run Keyword And Ignore Error    Get From Dictionary  ${response}  compliant
    ${stat}=    Set Variable If  ${compliant}==('PASS', True)  ${True}  ${False}
    [Return]  ${stat}

