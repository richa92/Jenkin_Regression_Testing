*** Settings ***
Variables   ./Regression_Data.py
Resource    ./../../../../Resources/api/fusion_api_resource.txt
Resource    ../global_variables.robot

*** Keywords ***
Validate Hardware Power Utilization
    [Arguments]    ${hadrwares}
    [Documentation]    Validate if show power utilization right
    :FOR    ${hadrware}    IN    @{hadrwares}
    \    ${iloIP} =   Get from Dictionary    ${hadrware}    hostname
    \    Log to console and logfile  get iloIP ${iloIP}
    \    ${uri} =   Get Server Hardware URI By ILO IP     ${iloIP}
    \    Log to console and logfile  prepare to validate power utilization for ${uri}
    \    Wait Until Keyword Succeeds    100s    15s    Server Hardware Power Environmentalconfig Correct    ${uri}
    \    Log to console and logfile  show power utilization right!

Server Hardware Power Environmentalconfig Correct
    [Arguments]    ${hardware}
    [Documentation]    Check if Hardware Power Environmentalconfig data is right
    Set Log Level    TRACE
    ${environmentalconfig} =    Fusion Api Get Server Hardware Environmental Config        ${hardware}
    Log to console and logfile  Get enviornmentalconfig:\n${environmentalconfig}

    ${idleMaxPower} =        Get from Dictionary    ${environmentalconfig}  idleMaxPower
    convert to integer          ${idleMaxPower}
    ${calibratedMaxPower} =  Get from Dictionary    ${environmentalconfig}  calibratedMaxPower
    convert to integer          ${calibratedMaxPower}
    ${powerHistorySupported} =  Get from Dictionary     ${environmentalconfig}  powerHistorySupported
    Should Be True              ${powerHistorySupported}
    ${utilizationHistorySupported} =  Get from Dictionary   ${environmentalconfig}  utilizationHistorySupported
    Should Be True              ${utilizationHistorySupported}