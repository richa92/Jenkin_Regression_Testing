*** Settings ***
Library             RoboGalaxyLibrary
Library             FusionLibrary
Library             OperatingSystem
Library             BuiltIn
Library             Collections
Library             XML
Library             SSHLibrary
Library             String
Library             Dialogs
Resource            ../../../../Resources/api/fusion_api_resource.txt
Resource            ../global_variables.robot
Variables           ${DATA_FILE}

*** Keywords ***
Generate Logindomain Payload
    [Documentation]   Generate Logindomain Payload
    [Arguments]       ${directoryName}
    ${body} =    Copy Dictionary    ${DIRECTORY_BODY}
    Set To Dictionary    ${body}    name    ${directoryName}
    Set To Dictionary    ${body['credential']}  userName    ${BASE_SA_USERNAME}
    Set To Dictionary    ${body['credential']}  password    ${BASE_SA_PASSWORD}
    Set To Dictionary    ${body}    baseDN    ${BASE_BASE_DN}
    Set To Dictionary    ${body['directoryServers'][0]}  directoryServerCertificateBase64Data    ${BASE_CERTIFICATE}
    Set To Dictionary    ${body['directoryServers'][0]}  directoryServerIpAddress    ${BASE_AD_IP_ADDRESS}
    Log    \n-body:${directoryName} ${body} ...    console=true
    [Return]    ${body}

Generate Post Grouptorolemapping Payload
    [Documentation]   Generate Post Grouptorolemapping Payload
    [Arguments]       ${roleName}
    ${body} =    Copy Dictionary    ${G2R_POST_BODY}
    Set To Dictionary    ${body['credentials']}  userName    ${BASE_SA_USERNAME}
    Set To Dictionary    ${body['credentials']}  password    ${BASE_SA_PASSWORD}
    Set To Dictionary    ${body['group2PermissionPerGroup']}  egroup    ${BASE_EGROUP}
    Set To Dictionary    ${body['group2PermissionPerGroup']}  loginDomain    ${LOGINDOMAIN}
    Set To Dictionary    ${body['group2PermissionPerGroup']['permissions'][0]}  roleName    ${roleName}
    [Return]    ${body}

Generate Put Grouptorolemapping Payload
    [Documentation]   Generate Put Grouptorolemapping Payload
    ${body} =    Copy Dictionary    ${G2R_PUT_BODY}
    Set To Dictionary    ${body['credentials']}  userName    ${BASE_SA_USERNAME}
    Set To Dictionary    ${body['credentials']}  password    ${BASE_SA_PASSWORD}
    Set To Dictionary    ${body['group2PermissionPerGroup']}  egroup    ${BASE_EGROUP}
    Set To Dictionary    ${body['group2PermissionPerGroup']}  loginDomain    ${LOGINDOMAIN}
    [Return]    ${body}

Verify Group Info
    [Documentation]  Verify group to role mapping information
    [Arguments]       ${roleName}
    ${name}=  Get Directoy Logindomain Id By Name    ${LOGINDOMAIN}
    ${resp}=  fusion api get group role assignment  param=/${name}
    ${permissions}=  Get From Dictionary    ${resp['members'][0]}    permissions
    :FOR                          ${permission}    IN    @{permissions}
    \                             Return From Keyword If    '${permission['roleName']}' == '${roleName}'     Expected
    [Return]    ${False}

