*** Settings ***
Library             RoboGalaxyLibrary
Library             FusionLibrary
Library             SSHLibrary
Library             OperatingSystem
Library             XML
Library             String
Library				Dialogs

*** Variables ***
${DataFile}         DCS-TBird-OVA-Qual-data.xml
${ADMIN_USER}       Administrator
${ADMIN_PASSWORD}   wpsthpvse1
${APPLIANCE_IP}     16.114.213.88
${ApplianceUrl}     https://${APPLIANCE_IP}
${Browser}          firefox
${SeleniumSpeed}    0.1
${ILO_PROMPT}       </>hpiLO->
${CONSOLE_TIMEOUT}  10 min
${RIBCL_XML}        ilo_ribcl_request_embedded_health.xml
${PauseWhenFailed}	False
# Mail notification related
${SendMailWhenPaused}   False
${Sender}       wpst-jenkins@hp.com
${Receiver}     wayne.landini@hp.com
${BUILD_URL}    Jenkins built-in variable
${NODE_NAME}    Jenkins slave node name
${Subject}      Error encounter when running test
${Content}

*** Keywords ***

Login to OneView via REST
    Should Not Be Equal    ${APPLIANCE_IP}    'unknown'    msg=Please specify a valid OnevView IP address or hostname
    ${credentials_dict}     Create Dictionary   userName=${ADMIN_USER}
    ...                                         password=${ADMIN_PASSWORD}
    ${AUTHTOKEN}    Fusion Api Login Appliance      ${APPLIANCE_IP}     ${credentials_dict}

Load Test Data and Open Browser
    Set Log Level    TRACE
    Load Test Data  ${DataFile}
    Log Variables
    Open Browser  ${ApplianceUrl}  ${Browser}
    Maximize Browser Window
    Run Keyword If  "${Browser}" == "ie"   Go To  javascript:document.getElementById('overridelink').click()
    Set Selenium Speed  ${SeleniumSpeed}

Logout and Close All Browsers
    Fusion UI Logout of Appliance
    Set Global Variable     ${UiLoggedIn}    ${False}
    Close All Browsers

Log into Fusion appliance as Administrator
    ${user} =  Get Data By Property  ${TestData.users}  name  Administrator
    Set Global Variable     ${UiLoggedIn}    ${False}
    Fusion UI Login to Appliance   ${user[0].name}

Pause And Close Browser
	[Documentation]    Popup a dialog to pause the execution if \${PauseWhenFailed} is set to True. Finally close the browser
	Run Keyword If Test Failed		Pause Test Execution
	Logout and close all browsers

Pause Test Execution
	[Documentation]    Pause test execution
    Return From Keyword If   '${PauseWhenFailed.lower()}'=='false'

	LOG     Encounter failure, pausing test execution, if job is launch from jenkins, please log on jenkins slave server to get job continue       level=WARN
	Send Mail Notification
	Pause Execution

Send Mail Notification
    Return From Keyword If   '${SendMailWhenPaused.lower()}'=='false'    Skipped Send Mail Notification (\${SendMailWhenPaused}=${SendMailWhenPaused})

    LOG     Sending mail notification   level=WARN
    @{receiver_lst}=    Split String	${Receiver}     ,

    Run Keyword If  '${Content}' == ''  Set Suite Variable
    ...             ${Content}
    ...             Build URL: \n${BUILD_URL}\n\nSlave Node: \n${NODE_NAME}\n\nTest case file: \n${SUITE SOURCE}\n\nTest case name: \n${TEST NAME}\n

    Connect To SMTP Server          smtp.hp.com  True
    Send Email      ${Sender}    ${receiver_lst}      ${Subject}      ${Content}
    Disconnect From SMTP Server
