*** Settings ***
Documentation   SEHWp0054 - Refresh can fix DL G6 which was force downgraded to 2.09 through iLO
Library         robot.api.logger
Resource        ../resource.txt
Test Setup      Load Test Data and Open Browser
Test Teardown	Pause And Close Browser


*** Variables ***
${user}         Administrator


*** Test Cases ***
As an Administrator I want to Refresh a server when FW is downgraded and upgraded out-of-band
    Fusion UI Login To Appliance    ${user}

    # remove server hardware if exists, to make sure it's been added as 'Monitored'
    Fusion UI Remove Server Hardware           @{TestData.DLG6ForMonitoring}

    ${rc}=                              Fusion UI Add Server Hardware           @{TestData.DLG6ForMonitoring}
    Should be True                      ${rc}   msg=Failed to add Server Hardware for monitoring
    :FOR    ${SERVER}   IN  @{TestData.DLG6ForMonitoring}
    \   Fusion SRM iLO API Init             ${SERVER.iloIP}    ${SERVER.iloUserName}   ${SERVER.iloPassword}
    \   Fusion SRM iLO Update Firmware      ftp://wpstwork4.vse.rdlabs.hpecorp.net/firmware/ilo/ilo2/ilo2_209.bin
    \   sleep   3 minutes

    # \   Fusion SRM iLO API Init             ${SERVER.iloIP}    ${SERVER.iloUserName}   ${SERVER.iloPassword}
    # \   Fusion SRM Reset Rib
    # \   sleep   2 minutes

    # The first time refresh should detect that FW does not meet minimum requirement
    Fusion UI Force Refresh Server  @{TestData.DLG6ForMonitoring}
    :FOR    ${SERVER}   IN  @{TestData.DLG6ForMonitoring}
    \   Fusion SRM iLO API Init             ${SERVER.iloIP}    ${SERVER.iloUserName}   ${SERVER.iloPassword}
    \   Fusion SRM iLO Update Firmware      ftp://wpstwork4.vse.rdlabs.hpecorp.net/firmware/ilo/ilo2/ilo2_227.bin
    \   sleep   3 minutes

    # The second time refresh should bring it back to monitoring
    Fusion UI Force Refresh Server  @{TestData.DLG6ForMonitoring}