*** Settings ***
Documentation   SPBLp0003 - Create and Edit Profile with connections atleast one per LOM -as a SA

Library     robot.api.logger
Resource    ../resource.txt

Test Setup      Load Multi Test Data and Open Browser
Test Teardown   Pause And Close Browser

*** Variables ***
${admin_user}      Administrator
${na_user}         NA
${sa_user}         SA

*** Test Cases ***
As an Network Administrator I want to create and edit server profile with connections atleast one per LOM - as a SA
    # Add enclosure for running test cases
    As an Administrator I want to add Enclosure for running Server Profile cases

    # Log in using network administrator
    Fusion UI Login To Appliance    ${na_user}

    # Create new network using account Login Name NA
    ${data}=                        Get Data By Xpath                        //SPBLp0003/Networks/Create
    ${Status}=                      Fusion UI Create Ethernet Network    @{data.Create}
#    Should Be True                  ${Status}   msg=Failed to create network
    Console                         <Result of Create Ethernet Network is: [ ${Status} ]>

    # Add new uplink set for the added network
    ${data}=                        Get Data By Xpath                        //SPBLp0003/Uplink/Add/lig
    ${Status}=                      Fusion UI Edit Logical Interconnect Group    @{data.lig}
    Should Be True                  ${Status}   msg=Failed to add ligs

    # Update logical interconnect from group
    ${data}=                        Get Data By Xpath                       //SPBLp0003/Uplink/Add/li
    ${Status}=                      Fusion UI Update Logical Interconnect From Group     @{data.li}
    Should Be True                  ${Status}  msg=Failed to update li from group

    # Logout and login using server administrator
    Fusion UI Logout Of Appliance
    Sleep                           3
    Fusion UI Login To Appliance    ${sa_user}

    # Create server profile
    ${data}=                        Get Data By Xpath                       //SPBLp0003/ServerProfile/Create
    ${Status}=                      Fusion UI Create Server Profile     @{data.Create}
    Should Be True                  ${Status}  msg=Failed to create server profile

    # Verify server profile connections info
    ${data}=                        Get Data By Xpath                       //SPBLp0003/ServerProfile/Create
    ${Status}=                      Fusion UI Verify Server Profile Connections Info     @{data.Create}
    Should Be True                  ${Status}  msg=Failed to verify the connectionss info of server profile

    # Verify server profile advanced info
    ${data}=                        Get Data By Xpath                       //SPBLp0003/ServerProfile/Create
    ${Status}=                      Fusion UI Verify Server Profile Advanced Info     @{data.Create}
    Should Be True                  ${Status}  msg=Failed to verify the advanced info of server profile

    # Edit server profile
    ${data}=                        Get Data By Xpath                       //SPBLp0003/ServerProfile/Edit
    ${Status}=                      Fusion UI Edit Server Profile       @{data.Edit}

    # Verify server profile connections info
    ${data}=                        Get Data By Xpath                       //SPBLp0003/ServerProfile/Edit
    ${Status}=                      Fusion UI Verify Server Profile Connections Info     @{data.Edit}
    Should Be True                  ${Status}  msg=Failed to create server profile

    # Remove server profile
    ${data}=                        Get Data By Xpath                       //SPBLp0003/ServerProfile/Delete
    ${Status}=                      Fusion UI Delete Server Profile     @{data.Delete}
    Should Be True                  ${Status}  msg=Failed to remove server profile

    Fusion UI Logout Of Appliance
    Sleep                           3
    Fusion UI Login To Appliance    ${na_user}

    # Remove uplink set from LIG
    ${data}=                        Get Data By Xpath                        //SPBLp0003/Uplink/Remove/lig
    ${Status}=                      Fusion UI Edit Logical Interconnect Group    @{data.lig}
    Should Be True                 ${Status}  msg=Failed to edit server profile

    # Update logical interconnect from group
    ${data}=                        Get Data By Xpath                       //SPBLp0003/Uplink/Remove/li
    ${Status}=                      Fusion UI Update Logical Interconnect From Group     @{data.li}
    Should Be True                  ${Status}  msg=Failed to update li from group

    # Remove network
    ${data}=                        Get Data By Xpath                       //SPBLp0003/Networks/Delete
    ${Status}=                      Fusion UI Delete Ethernet Network     @{data.Delete}
    Should Be True                  ${Status}  msg=Failed to remove network


*** Keywords ***

As an Administrator I want to add Enclosure for running Server Profile cases
    Fusion UI Login To Appliance    ${admin_user}

    ${data}=                            Get Data By Xpath              //ENCLp0017/enclosure
    Remove All SSO Hp Sim Certificates and Snmp Trap Receivers For OA   @{data.enclosure}
    ${rc}=                              Fusion UI Add Enclosure    @{data.enclosure}
    Console                             <Result of Add Enclosure is: [ ${rc} ]>
#    Should Be True                      ${rc}   msg=Failed to add enclosure

    # Logout
    Fusion UI Logout Of Appliance
