*** Settings ***
Documentation   SPBLp0011 - Create Profile with FC Connections

Library     robot.api.logger
Resource    ../resource.txt

Test Setup      Load Multi Test Data and Open Browser
Test Teardown   Pause And Close Browser

*** Variables ***
${na_user}         NA
${sa_user}         SA

*** Test Cases ***
As an Administrator I want to create profile wit FC connections
    # Log in using network administrator
    Fusion UI Login To Appliance    ${na_user}

    ${data}=                        Get Data By Xpath                   //SPBLp0011/fcnetworks/Create1
    ${Status}=                      Fusion UI create fc network     @{data.Create1}
#    Should Be True                  ${Status}   msg=Failed to add FC network
    Console                         <Result of Create Ethernet Network is: [ ${Status} ]>

    ${data}=                        Get Data By Xpath                   //SPBLp0011/fcnetworks/Edit
    ${Status}=                      Fusion UI Edit FC Network     @{data.Edit}
    Should Be True                  ${Status}   msg=Failed to edit FC network

    # Verify the allocated number in Address and Indentifers
    ${data}=                        Get Data By Xpath                       //SPBLp0011/AddressIdentifier/Verify1
    ${Status}=                      Fusion UI Verify Address And Identifier Used Number   @{data.Verify1}
    Should Be True                  ${Status}  msg=Failed to verify the allocated number and indentifers

    # Logout and login using server administrator
    Fusion UI Logout Of Appliance
    Sleep                           3
    Fusion UI Login To Appliance    ${sa_user}

    # Create server profile
    ${data}=                        Get Data By Xpath                       //SPBLp0011/ServerProfile/Create
    ${Status}=                      Fusion UI Create Server Profile     @{data.Create}
    Should Be True                  ${Status}  msg=Failed to create server profile

    # Verify the allocated number in Address and Indentifers
    ${data}=                        Get Data By Xpath                       //SPBLp0011/AddressIdentifier/Verify2
    ${Status}=                      Fusion UI Verify Address And Identifier Used Number   @{data.Verify2}
    Should Be True                  ${Status}  msg=Failed to verify the allocated number and indentifers

    Fusion UI Logout Of Appliance
    Sleep                           3
    Fusion UI Login To Appliance    ${na_user}

    # Delete FC network
    ${data}=                        Get Data By Xpath                       //SPBLp0011/fcnetworks/Delete
    ${Status}=                      Fusion UI Delete FC Network     @{data.Delete}
    Should Be True                  ${Status}  msg=Failed to remove network

    # Validate server profile  status
    ${data}=                        Get Data By Xpath                       //SPBLp0011/ServerProfile/View
    ${Status}=                       Fusion UI Validate Server Connections Error State    @{data.View}
    Should Be True                  ${Status}  msg=Failed to validate the connections status

    # Remove uplink set from LIG
    ${data}=                        Get Data By Xpath                        //SPBLp0011/Uplink/Remove/lig
    ${Status}=                      Fusion UI Edit Logical Interconnect Group    @{data.lig}
    Should Be True                 ${Status}  msg=Failed to remove uplink set

    # Update logical interconnect from group
    ${data}=                        Get Data By Xpath                       //SPBLp0011/Uplink/Remove/li
    ${Status}=                      Fusion UI Update Logical Interconnect From Group     @{data.li}
    Should Be True                  ${Status}  msg=Failed to update li from group

    Fusion UI Logout Of Appliance
    Sleep                           3
    Fusion UI Login To Appliance    ${sa_user}

    # Remove server profile
    ${data}=                        Get Data By Xpath                       //SPBLp0011/ServerProfile/Delete
    ${Status}=                      Fusion UI Delete Server Profile     @{data.Delete}
    Should Be True                  ${Status}  msg=Failed to remove server profile

    # Verify the allocated number in Address and Indentifers
    ${data}=                        Get Data By Xpath                       //SPBLp0011/AddressIdentifier/Verify1
    ${Status}=                      Fusion UI Verify Address And Identifier Used Number   @{data.Verify1}
    Should Be True                  ${Status}  msg=Failed to verify the allocated number and indentifers

    Fusion UI Logout Of Appliance
    Sleep                           3
    Fusion UI Login To Appliance    ${na_user}

    # Create FC network
    ${data}=                        Get Data By Xpath                       //SPBLp0011/fcnetworks/Create2
    ${Status}=                      Fusion UI Create FC Network     @{data.Create2}
    Should Be True                  ${Status}  msg=Failed to Create network

    # Add uplink set from LIG
    ${data}=                        Get Data By Xpath                        //SPBLp0011/Uplink/Add/lig
    ${Status}=                      Fusion UI Edit Logical Interconnect Group    @{data.lig}
    Should Be True                 ${Status}  msg=Failed to Add uplink set

    # Update logical interconnect from group
    ${data}=                        Get Data By Xpath                       //SPBLp0011/Uplink/Add/li
    ${Status}=                      Fusion UI Update Logical Interconnect From Group     @{data.li}
    Should Be True                  ${Status}  msg=Failed to update li from group
