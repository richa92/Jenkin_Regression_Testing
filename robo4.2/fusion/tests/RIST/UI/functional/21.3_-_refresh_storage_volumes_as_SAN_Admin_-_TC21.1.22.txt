*** Settings ***
Documentation		Refresh storage volumes from the Fusion Appliance

Resource          	../resource.txt
Test Setup		Load Test Data and Open Browser
Test Teardown		Pause And Close Browser

*** Variables ***
${StA}      StA

*** Test Cases ***
As an Storage Admin I want refresh storage volumes
	Fusion UI Log into Appliance    ${StA}
	:For    ${volume}    in    @{TestData.storagevolumes}
	\		${wwn}=	Run Keyword If	${volume.has_property('wwn')} == ${True}
     		...		Set Variable	${volume.get_property('wwn')}
     		...	ELSE
     		...		Set Variable	${EMPTY}
	\		Run Keyword If	'${wwn}' == ''
     		...		Refresh A Newly Created Storage Volume	${volume.name}
     		...	ELSE
     		...		Refresh A Imported Storage Volume	${volume.name}

     
*** Keywords ***
Refresh A Newly Created Storage Volume
	[Arguments]		${vol_name}
	LOG	Start refreshing newly created storage volume	console=True
	${rc}=	Fusion UI refresh storage volumes    ${vol_name}
	Should Be True   ${rc}    msg=Failed to refresh storage volume
	Sleep	5
	
Refresh A Imported Storage Volume
	[Arguments]		${vol_name}
	LOG		Start refreshing imported storage volume	console=True
	${ret}=	Wait For Element Visible	xpath=//div[@class='dataTables_scrollBody']/table/tbody/tr/td[.='${vol_name}']
	${rc}=	Run Keyword If	${ret} == ${True}
	...		Fusion UI refresh storage volumes	${vol_name}
	...	ELSE
	...		Output No Need To Refresh Storage Volume
	Should Be True   ${rc}    msg=Failed to refresh storage volume
	Sleep	5
	
Output No Need To Refresh Storage Volume
	LOG	No need to refresh since imported storage volume ${vol_name} not exists	WARN
	Return From Keyword	${True}
	