*** Settings ***
Resource    ../resource.txt
Variables   ./Regression_Data.py
Resource    ./../../../../Resources/api/fusion_api_resource.txt

*** Keywords ***
Load Test Data and Open Browser Then Login
    [Arguments]	            ${Firmware_Bundle}=Snap6
    Log To Console And Logfile      \nFirmware Bundle is ${Firmware_Bundle}
    Run Keyword And Ignore Error    Wait For ALL Enclosures In OK Status
    Load Test Data and Open Browser
    Log into Fusion appliance as Administrator
    Run Keyword If          '${Firmware_Bundle}'=='Snap6'
    ...                     Upload SPP And Remove Another
    Run Keyword If          '${Firmware_Bundle}'=='OldSnap6'
    ...                     Upload SPP And Remove Another   ${OldSnap6}    ${OldSnap6SPP}  ${Snap6SPP}
    Run Keyword If          '${Firmware_Bundle}'=='Snap5'
    ...                     Upload Snap5 SPP

Load Test Data and Open Browser Then Login and Remove SPP
    [Arguments]	            ${Firmware_Bundle}=Snap6
    Log To Console And Logfile      \nFirmware Bundle that pending remove is ${Firmware_Bundle}
    Run Keyword And Ignore Error    Wait For ALL Enclosures In OK Status
    Run Keyword If          '${Firmware_Bundle}'=='Snap6'
    ...                     Remove Gen9 Snap6 SPP
    Load Test Data and Open Browser
    Log into Fusion appliance as Administrator

Upload SPP And Remove Another
    [Arguments]	            ${uploadSPP}=${Snap6}     ${uploadURI}=${Snap6SPP}     ${removeSPP}=${OldSnap6SPP}
    Log To Console And Logfile      Start to upload SPP ${uploadURI} and remove ${removeSPP}
    ${resp}  ${sessionID}=  Fusion Api Login Appliance
    ...                     ${APPLIANCE_IP}         ${admin_credentials}
    ${firmware}=    Get Firmware Bundle     ${uploadURI}
    Run Keyword If          '${firmware}'=='Firmware Not Found'
    ...                     Remove Firmware Bundle
    ...                     ${removeSPP}
#    Cannot used CLI keyword on NoSHH appliance
#    Upload Firmware Bundle  ${sessionID}    ${uploadSPP}
    ${data}=    Get Data By Xpath    //spps/spp[@uri='${uploadURI}']
    Fusion UI Add Firmware Bundle    @{data.spp}

Upload Snap5 SPP
    Log To Console And Logfile      Start to upload SPP ${SNAP5SPP}
    ${resp}  ${sessionID}=  Fusion Api Login Appliance
    ...                     ${APPLIANCE_IP}         ${admin_credentials}
#    Run Keyword If          ${Snap5}!=${None}
#    ...                     Fusion CLI Add Firmware Bundle
#    ...                     ${APPLIANCE_IP}
#    ...                     ${ssh_credentials}
#    ...                     ${sessionID}
#    ...                     ${Snap5}
#    ...                     ${False}
    ${data}=    Get Data By Xpath    //spps/spp[@uri='${SNAP5SPP}']
    Run Keyword And Ignore Error     Fusion UI Add Firmware Bundle    @{data.spp}

Upload Firmware Bundle
    [Arguments]	            ${sessionID}=${None}     ${Firmware_Bundles}=${None}
    Log To Console And Logfile      Firmware Bunlde is ${Firmware_Bundles}
    Pass Execution If       ${Firmware_Bundles}==${None}        Skipped adding firmware bundle as Firmware_Bundles == None
    Run Keyword If          ${Firmware_Bundles}!=${None}
    ...                     Fusion CLI Add Firmware Bundle
    ...                     ${APPLIANCE_IP}
    ...                     ${ssh_credentials}
    ...                     ${sessionID}
    ...                     ${Firmware_Bundles}
