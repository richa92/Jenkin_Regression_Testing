*** Settings ***
Documentation   License can be assigned to server automatically
Resource        ../resource.txt
Suite Teardown   Remove Server Hardware
Test Teardown    Pause Test Execution and Relogin Appliance On Failure


*** Variables ***
${user}      Administrator

*** Test Cases ***
ASLIp0005 - License can be assigned to server automatically
    # add dl server
    ${data}=        Get Data By Xpath                           //servers/DLServers/server[@mgmtType="Managed" and contains(@model, "Gen8")]
    ${rc}=          Fusion UI Add Server Hardware               @{data.server}
    # check license
    ${rc}=          Fusion UI Verify Required Server Oneview wo iLo License         1
    Should Be True  ${rc}                                       Failed to verify number of licensed server oneview license

    # add license
    ${data}=        Get Data By Xpath                           //licenses/license[@type='HPE OneView w/o iLO']
    ${rc}=          Fusion UI Add License                       @{data.license}

    Sleep       60
    # Verify License & Remove Server Hardware
    # check license
    ${rc}=          Fusion UI Verify Licensed Server Oneview wo iLo License         1
    Should Be True  ${rc}                                       Failed to verify number of licensed server oneview license

*** Keyword ***
Remove Server Hardware
    # remove dl server
    ${data}=        Get Data By Xpath                           //servers/DLServers/server[@mgmtType="Managed" and contains(@model, "Gen8")]
    ${result}=      Fusion UI Remove Server Hardware            @{data.server}
    Convert to String   ${result}
    Run Keyword If      '${result}' == 'False'      Close Browser and Re Login Appliance
    Convert to Boolean  ${result}
    Should Be True                      ${result}   Failed to remove server hardware