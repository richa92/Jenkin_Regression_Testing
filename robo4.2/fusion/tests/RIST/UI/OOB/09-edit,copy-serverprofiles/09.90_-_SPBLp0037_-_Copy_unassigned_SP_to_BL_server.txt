*** Settings ***
Documentation   Copy unassigned SP to BL server
Resource         ../resource.txt
Test Teardown   Pause Test Execution and Relogin Appliance On Failure


*** Test Cases ***
SPBLp0037 - Copy unassigned SP to BL server
    ${data}=                        Get Data By Xpath                   //BLServerProfiles/Edit/profile[contains(@desc, "Copy unassigned server profile to BL server as server administrator")]
    ${n}=	Evaluate	0
    Convert To Integer	${n}
    :FOR    ${profile}    IN    @{data.profile}
    \       ${ret_bay}=     Get Lines Matching Regexp     ${profile.hardwareType}     \\$\\{.*\\}
    \       ${blade_name}=   Get Substring   ${profile.hardwareType}     2   -1
    \       Set Global Variable             ${blade_name}       ${blade_name}
    \       Run Keyword If  "${ret_bay}" != ""      Get Server Hardware Type By Blade Name
    \       Run Keyword If  "${ret_bay}" != ""      Set Value For Property      ${data.profile[${n}]}   hardwareType    ${global_server_type}
    \       ${n}=	Evaluate    ${n}+1
    ${result}=                      Fusion UI Edit Server Profile       @{data.profile}
    Should Be True                  ${result}                           Failed to create server profile due to error.

    ${data}=                        Get Data By Xpath                   //BLServerProfiles/Copy/profile[contains(@desc, "Copy unassigned server profile to BL server as server administrator")]
    ${result}=                      Fusion UI copy Server Profile       @{data.profile}
    Should Be True                  ${result}                           Failed to create server profile due to error.


*** Keywords ***
Get Server Hardware Type By Blade Name
    ${server_type}=                 Fusion UI Get Type Of Server Hardware               ${blade_name}
    Set Global Variable             ${global_server_type}                               ${server_type}