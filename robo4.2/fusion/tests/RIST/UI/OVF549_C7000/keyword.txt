*** Settings ***
Resource    ../resource.txt
Variables   ./Regression_Data.py
Resource    ./../../../../Resources/api/fusion_api_resource.txt

*** Keywords ***
Load Test Data and Open Browser then Login
    Run Keyword And Ignore Error    Wait For ALL Enclosures In OK Status
    Run Keyword And Ignore Error    Wait For ALL Enclosures Complete Refresh
    Load Test Data and Open Browser
    Log into Fusion appliance as Administrator

Load Test Data and Open Browser then Remove All Hardwares
    Load Test Data and Open Browser then Login
    ${resp}  ${sessionID}=  Fusion Api Login Appliance
    ...                     ${APPLIANCE_IP}         ${admin_credentials}
    Run Keyword And Ignore Error       Remove All Enclosures   param=?force=true
    Run Keyword And Ignore Error       Remove All DL Server Hardware Async     ServerTypes=DL

Remove SPP and Close Browser
    Log To Console And Logfile      Start to remove ${Snap1SPP}
    ${resp}  ${sessionID}=  Fusion Api Login Appliance
    ...                     ${APPLIANCE_IP}         ${admin_credentials}
    Remove Firmware Bundle  ${Snap1SPP}
    Pause And Close Browser

Upload Gen10 Snap1 SPP
    Log To Console And Logfile      Start to upload Gen9 Snap6 SPP
    ${resp}  ${sessionID}=  Fusion Api Login Appliance
    ...                     ${APPLIANCE_IP}         ${admin_credentials}
    ${firmware}=    Get Firmware Bundle     ${Snap6SPP}
    Run Keyword If          '${firmware}'=='Firmware Not Found'
    ...                     Remove Firmware Bundle
    ...                     ${OldSnap6SPP}
    Upload Firmware Bundle  ${sessionID}    ${Snap6}

Upload Firmware Bundle
    [Arguments]	            ${sessionID}=${None}     ${Firmware_Bundles}=${None}
    Log To Console And Logfile      Firmware Bunlde is ${Firmware_Bundles}
    Pass Execution If       ${Firmware_Bundles}==${None}        Skipped adding firmware bundle as Firmware_Bundles == None
    Run Keyword If          ${Firmware_Bundles}!=${None}
    ...                     Fusion CLI Add Firmware Bundle
    ...                     ${APPLIANCE_IP}
    ...                     ${ssh_credentials}
    ...                     ${sessionID}
    ...                     ${Firmware_Bundles}

Reset iLO and Update Server ILO Firmware
    [Arguments]	            ${servers}
    :FOR    ${SERVER}   IN  @{servers}
    \   Log To Console And Logfile      Reset iLO for ${SERVER['iloIP']}
	\   Run Keyword And Ignore Error    Run cpqlocfg and Reset iLO      ${SERVER['iloIP']}
    Sleep  60
    Run Keyword And Ignore Error    Update Server ILO Firmware      ${servers}