*** Settings ***
Documentation    Keywords Required for Running Prerequisites for CLRM
Resource        ../support_files/Deployment_Utils.robot


*** Keywords ***

Login to the Appliance
    [Documentation]    Logins in the the appliance before starting on OV Operations
    Set Log Level    Trace
    Fusion Api Login Appliance    ${Fusion_IP}    ${Fusion_credentials}


Filter out non healthy hardwares
    [Documentation]        Filter out Server Hardware that have health status as OK
    [Tags]    SP CREATE
    [Arguments]        ${data}
    ${hw_members}=    Copy List  ${data}
    ${healthy_hw}=    Create List
    ${non_healthy_hw}=    Create List
    :FOR    ${hw_member}    IN    @{hw_members}
    \        ${hw_status} =  Get From Dictionary    ${hw_member}     status
    \        Run Keyword If    '${hw_status}' in ['OK', 'Warning']
             ...    Append to List     ${healthy_hw}   ${hw_member}
    \        Run Keyword If    '${hw_status}' in ['Critical', 'Disabled', 'Monitored']
             ...    Append to List     ${non_healthy_hw}   ${hw_member}
    [Return]   ${healthy_hw}    ${non_healthy_hw}


Get Dict of SHTs with SH
    [Documentation]    Returns the Dictionary with all the SHTs and Corresponding SH list
    [Arguments]     ${Filter_healthy}=True
    ${SHT_DICT}=    Create Dictionary
    ${servers}=    Fusion Api Get Server Hardware
    ${server_list}=        Get From Dictionary     ${servers}    members
    ${healthy_hw}    ${non_healthy_hw}=     Run Keyword if    ${Filter_healthy} is not False        Filter out non healthy hardwares    ${server_list}
    ...    ELSE    create list    ${server_list}    ${Empty}
    :FOR    ${server}    IN    @{healthy_hw}
    \       ${server_name}=    Set Variable    ${server["name"]}
    \       ${server_type}=    Set Variable    ${server["serverHardwareTypeUri"]}
    \       ${keys}=    Get Dictionary Keys    ${SHT_DICT}
    \       ${index}=    Get Index from list    ${keys}    ${server_type}
    \       ${value}=    Run Keyword if    '${index}' != '-1'     Get from Dictionary    ${SHT_DICT}    ${server_type}
    \       ...    ELSE    Set Variable    ${None}
    \       ${temp_list} =    create list    ${server_name}
    \       Run Keyword if    ${value} is ${None}    Set to Dictionary    ${SHT_DICT}    ${server_type}=${temp_list}
    \       ...    ELSE    Append to list    ${value}    ${server_name}
    [Return]    ${SHT_DICT}

Get SHT with more than 2 SH
    [Documentation]    Returns SHT which has more than 2 Server Hardwares
    ${SHT_DICT}=    Get Dict of SHTs with SH        True
    ${keys}=    Get Dictionary Keys    ${SHT_DICT}
    :For     ${key}    IN    @{keys}
    \     ${SH_List}=    Get from Dictionary    ${SHT_DICT}    ${key}
    \     ${total_SH}=   Get length    ${SH_List}
    \     ${SHT_URI}=    set variable if    ${total_SH} >= 2    ${key}
    \     Run Keyword if    '${SHT_URI}' is not '${None}'    Exit for loop
    [Return]    ${SHT_URI}


