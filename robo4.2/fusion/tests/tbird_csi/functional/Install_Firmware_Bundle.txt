*** Settings ***
Documentation	Installing Firmware
...
...	This file completes the exact same tasks as the api_create_fusion_elements.txt
...	file, except instead of using REST interface, it uses the Selenium library.
...	*Not Usable Except for Testing*
...
...	= Usage =
...	= Install =
...	pybot -v ENCLOSURE:<Enclosure Name> -i install Install_Firmware_Bundle.txt
...
...    = Variables =
...    | ENCLOSURE | Required. Dictionary key from variables.py representing the desired enclosure. |

Library		RoboGalaxyLibrary
Library		FusionLibrary
Library		OperatingSystem
Library		robot.api.logger
Variables	../resources/variables.py    ${ENCLOSURE}
Resource	../../tbird_hal/resources/fusion_cli.txt
Resource	../resources/defaults.txt

*** Variables ***
${username}		${FUSION_USERNAME}
${password}		${FUSION_FACTORY_PASSWORD}

*** Keywords ***
Install Firmware Bundle With OneView
  Login To OneView
  Add Network
  Sleep				10
  Add Logical Interconnect Group
  Sleep				20
  Add Enclosure Group
  Sleep				10
  Add Logical Enclosure
  Sleep				10
  Make Server Profile
  Sleep					10
  Close Browser

Remove Firmware Parts
  Login To OneView
  Remove Enclosure Group
  Sleep					10
  Remove Logical Interconnect Group
  Sleep					10
  Remove Network
  Sleep					10
  Remove Server Profile
  Sleep						10
  Close Browser

Add Network
  Fusion Ui Navigate To Networks Page
  Click Link				link=Create network
  Wait Until Element Is Visible		cic-network-name
  Input Text				cic-network-name			network1
  Click Element				cic-network-add-ethernet-type
  Input Text				cic-network-vlan-id			1
  Click Element				cic-network-add

Add Logical Interconnect Group
  Fusion Ui Navigate To Logical Interconnect Groups Page
  Wait Until Element Is Visible		link=Create logical interconnect group
  Click Link				link=Create logical interconnect group
  Sleep					5
  Wait Until Element Is Visible		cic-switchtemplate-add-name
  Input Text				cic-switchtemplate-add-name		LIG 1
  Click Element				xpath=//li[@id='cic-switchtemplate-add-enclosure-count']/div/div[@class='hp-select']
  Click Element				xpath=//li[@id='cic-switchtemplate-add-enclosure-count']/div/div/ol/li[1]
  Click Element				xpath=//li[@id='cic-switchtemplate-add-interconnect-bay-set']/div/div/div[@class='hp-select']
  Click Element				xpath=//li[@id='cic-switchtemplate-add-interconnect-bay-set']/div/div/div/ol/li[3]
  Click Element				cic-switchtemplate-add-select-interconnects
  Wait Until Element Is Visible		cic-switch-template-add-device-1-6
  Focus					xpath=//li[@id='cic-switch-template-add-device-1-6']/div/fieldset/ol/li/div/div/div[@class='hp-select']
  Click Element				xpath=//li[@id='cic-switch-template-add-device-1-6']/div/fieldset/ol/li/div/div/div[@class='hp-select']
  Wait Until Element Is Visible		xpath=//li[@id='cic-switch-template-add-device-1-6']/div/fieldset/ol/li/div/div/div/ol/li[4]
  Click Element				xpath=//li[@id='cic-switch-template-add-device-1-6']/div/fieldset/ol/li/div/div/div/ol/li[4]
  Click Element				cic-switchtemplate-add-name
  Add Uplink Set

Add Uplink Set
  Click Element				cic-add-uplink-li
  Input Text				cic-switchtemplate-dialog-name		us 1.
  Click Element				xpath=//li[@id='cic-switchtemplate-dialog-type-add']/div/div/div[@class='hp-select']
  Wait Until Element Is Visible		xpath=//li[@id='cic-switchtemplate-dialog-type-add']/div/div/div/ol/li[2]
  Click Element				xpath=//li[@id='cic-switchtemplate-dialog-type-add']/div/div/div/ol/li[2]
  Wait Until Element Is Visible		id=cic-switchtemplate-dialog-networks-addNetworks
  Click Element				id=cic-switchtemplate-dialog-networks-addNetworks
  Input Text				xpath=//div[@class='hp-filters']/input[@class='hp-search']		network1
  Click Element				xpath=//td[text()='network1']
  Click Element				xpath=//div[@class='hp-footer']/div/button[@class='hp-add hp-primary']
  Focus					id=cic-switchtemplate-dialog-uplinks-addUplinks
  Click Element				id=cic-switchtemplate-dialog-uplinks-addUplinks
  Input Text				xpath=//div[@class='hp-filters']/input[@class='hp-search']		Q2:1
  Sleep					2
  Focus					xpath=//div[@class='hp-footer']/div/button[@class='hp-add-again']
  Click Element				xpath=//div[@class='hp-footer']/div/button[@class='hp-add-again']
  Input Text				xpath=//div[@class='hp-filters']/input[@class='hp-search']		Q2:1
  Sleep					2
  Focus					xpath=//div[@class='hp-footer']/div/button[@class='hp-add']
  Click Element				xpath=//div[@class='hp-footer']/div/button[@class='hp-add']
  Focus					id=cic-switchtemplate-dialog-add
  Click Element				id=cic-switchtemplate-dialog-add
  Sleep					2
  Focus					id=cic-switchtemplate-add
  Click Element				id=cic-switchtemplate-add
  Sleep					2

Add Enclosure Group
  Fusion Ui Navigate To Enclosure Groups Page
  Sleep 				2
  Wait Until Element Is Visible		link=Create enclosure group
  Click Link				link=Create enclosure group
  Wait Until Element Is Visible		cic-encgroups-name
  Input Text 				cic-encgroups-name			EncGrp1
  Click Element				cic-encgroups-external
  Click Element				xpath=//li[@id='cic-enclosuregroups-panel-add-lig']/fieldset/div/div/div/ol[2]/li[5]/ol/li/div/div/div/div/div[@class='hp-search-combo-control']
  Sleep					1
  Click Element				xpath=//li[@id='cic-enclosuregroups-panel-add-lig']/fieldset/div/div/div/ol[2]/li[5]/ol/li/div/div/div/div/div[3]/ol[2]/li/span[text()='LIG 1']
  Focus					cic-encgroups-submit
  Click Element				cic-encgroups-submit

Add Logical Enclosure
  Fusion Ui Navigate Logical Enclosure Page
  Sleep					1
  Wait Until Element Is Visible		link=Create logical enclosure
  Click Link				link=Create logical enclosure
  Wait Until Element Is Visible		cic-logical-enclosure-name
  Sleep					1
  Input Text				cic-logical-enclosure-name		Enc1
  Focus					xpath=//li[@id='logicalenclosures-add-enclosure-block']/div/div/div[@class='hp-search-combo-control']
  Click Element				xpath=//li[@id='logicalenclosures-add-enclosure-block']/div/div/div[@class='hp-search-combo-control']
  Sleep					1
  Wait Until Element Is Visible		xpath=//li[@id='logicalenclosures-add-enclosure-block']/div/div/div/ol/li[1]
  Click Element				xpath=//li[@id='logicalenclosures-add-enclosure-block']/div/div/div/ol/li[1]
  Wait Until Element Is Visible		xpath=//li[@id='logicalenclosures-add-enclosure-group-block']/div/div/div[@class='hp-search-combo-control']
  Click Element				xpath=//li[@id='logicalenclosures-add-enclosure-group-block']/div/div/div[@class='hp-search-combo-control']
  Wait Until Element Is Visible		xpath=//li[@id='logicalenclosures-add-enclosure-group-block']/div/div/div/ol/li/span[text()='EncGrp1']
  Click Element				xpath=//li[@id='logicalenclosures-add-enclosure-group-block']/div/div/div/ol/li/span[text()='EncGrp1']
  Focus					cic-logical-enclosure-add
  Click Element				cic-logical-enclosure-add

Make Server Profile
  Fusion Ui Navigate To Server Profiles Page
  Sleep					1
  Wait Until Element Is Visible		link=Create profile
  Click Link				link=Create profile
  Sleep					1
  Wait Until Element Is Visible		cic-profile-add-name
  Sleep					1
  Input Text				cic-profile-add-name			SP 1
  Sleep					1
  Focus					cic-profile-add-server-input
  Input Text				cic-profile-add-server-input		bay 10
  Sleep					1
  Wait Until Element Is Visible		xpath=//li[@id='cic-profile-panel-add-basic']/fieldset/ol/li/div/div/div/ol/li[1]
  Click Element				xpath=//li[@id='cic-profile-panel-add-basic']/fieldset/ol/li/div/div/div/ol/li[1]
  Sleep					2

  ${HWStatus}	Get Text		xpath=//li[@id='cic-profile-panel-add-basic']/fieldset/ol/li/div/label[last()]
  Run Keyword If			'${HWStatus}'=='Server hardware is on. Power off the server.'
  ...		Click Element		cic-profile-server-power-validator-link
  Sleep					2
  Run Keyword If			'${HWStatus}'=='Server hardware is on. Power off the server.'
  ...		Click Button		cic-server-press-and-hold
  

  Wait Until Element Is Visible		xpath=//div[@id='cic-profile-add-firmware-div']/ol/li/div/a
  Click Element				xpath=//div[@id='cic-profile-add-firmware-div']/ol/li/div/a
  Sleep					1
  Wait Until Element Is Visible		xpath=//a[contains(@rel,'SPPGen9Snap4')]
  Click Element				xpath=//a[contains(@rel,'SPPGen9Snap4')]
  Wait Until Element Is Visible		cic-profile-add-firmware-offlinemode-select
  Focus					cic-profile-add-firmware-offlinemode-select
  Click Element				cic-profile-add-firmware-offlinemode-select
  Focus					cic-profile-add-manage-boot-mode
  Click Element				cic-profile-add-manage-boot-mode
  Sleep					2
  Focus					cic-profile-create
  Click Element				cic-profile-create

Remove Network
  Fusion Ui Navigate To Networks Page
  Wait Until Element Is Visible		xpath=//tbody/tr/td[@class='hp-identifier'][text()='network1']
  Click Element				xpath=//tbody/tr/td[@class='hp-identifier'][text()='network1']	
  Wait Until Element Is Visible		cic-network-actions
  Click Element				cic-network-actions
  Wait Until Element Is Visible		cic-network-delete-action
  Click Element				cic-network-delete-action
  Wait Until Element Is Visible		cic-delete-dialog-yes
  Click Element				cic-delete-dialog-yes

Remove Logical Interconnect Group
  Fusion Ui Navigate To Logical Interconnect Groups Page
  Wait Until Element Is Visible		xpath=//table[@id='cic-switchtemplate-master-table']/tbody/tr/td[text()='LIG 1']
  Click Element				xpath=//table[@id='cic-switchtemplate-master-table']/tbody/tr/td[text()='LIG 1']
  Wait Until Element Is Visible		cic-switchtemplate-actions
  Click Element				cic-switchtemplate-actions
  Sleep					2
  Wait Until Element Is Visible		cic-switchtemplate-delete-action
  Click Element				cic-switchtemplate-delete-action
  Sleep					2
  Wait Until Element Is Visible		cic-delete-dialog-yes
  Click Element				cic-delete-dialog-yes

Remove Enclosure Group
  Fusion Ui Navigate To Enclosure Groups Page
  Wait Until Element Is Visible		xpath=//div[@id='cic-encgroups-page']/div/div/div/div/div/table/tbody/tr/td[text()='EncGrp1']
  Click Element				xpath=//div[@id='cic-encgroups-page']/div/div/div/div/div/table/tbody/tr/td[text()='EncGrp1']
  Wait Until Element Is Visible		cic-encgroups-actions
  Click Element				cic-encgroups-actions
  Sleep					1
  Wait Until Element Is Visible		cic-encgroups-delete-action
  Click Element				cic-encgroups-delete-action
  Sleep					1
  Click Button				Yes, delete

Remove Server Profile
  Fusion Ui Navigate To Server Profiles Page
  Wait Until Element Is Visible		xpath=//div[@id='cic-profile-page']/div/div/div/div/div/table/tbody/tr/td[text()='SP 1']
  Click Element				xpath=//div[@id='cic-profile-page']/div/div/div/div/div/table/tbody/tr/td[text()='SP 1']
  Wait Until Element Is Visible		cic-profile-actions
  Click Element				cic-profile-actions
  Sleep					1
  Wait Until Element Is Visible		cic-profile-delete-action
  Click Element				cic-profile-delete-action
  Sleep					1
  Click Button				Yes, delete

Login To OneView
  Open Browser To Login Page
  Wait Until Element Is Visible			xpath=//div[@class='hp-form-content']/input[@id='hp-login-user']
  ...						timeout=10
  ...						error=Not at Login page
  Input Text    				hp-login-user		${username}
  Input Text    				hp-login-password	${password}
  Click Element    				xpath=//div/button[@id='hp-login-button' and text()='Login']

Open Browser To Login Page
  Open Browser		https://${FUSION_IP}/#/login	firefox

*** Test Cases ***
Test1
  [Tags]	test
  Install Firmware Bundle With OneView
  Remove Firmware Parts
  Install Firmware Bundle With OneView
  Remove Firmware Parts
  Install Firmware Bundle With OneView
  Remove Firmware Parts
  Install Firmware Bundle With OneView
  Remove Firmware Parts

Install
  [Tags]	install
  Install Firmware Bundle With OneView

Remove
  [Tags]	remove
  Remove Firmware Parts
