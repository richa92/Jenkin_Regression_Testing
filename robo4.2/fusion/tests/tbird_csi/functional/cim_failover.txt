*** Settings ***
Documentation     CIM Failover
...    = Usage =
...    pybot -L TRACE
...
...    = Variables =
...	| BAY | Composer bay to failover | ENCLOSURE | Enclosure to use |
...    = Preconditions =
...    None

Library  	  json
Library           RoboGalaxyLibrary
Library           FusionLibrary
Library           robot.api.logger
Variables         ../resources/variables.py	${ENCLOSURE}
Resource          ../resources/fusion_cli.txt
Resource          ../resources/fusion_ssh.txt
Resource          ../resources/fusion_api.txt
Resource          ../resources/em_api.txt
Resource          ../resources/defaults.txt
Resource          ../resources/enclosure_info.txt

Force Tags        # All test cases get these tags
#Test Template		Failover CIM	

*** Test Case ***
Failover CIM 
	Login to Fusion via REST
	Login to Fusion via SSH	
	
	Reset CIM Bay ${BAY}
	Sleep 15
*** Key Words ***
Reset CIM Bay ${BayNumber}
	${EM_IP}	${EMSessionID}	EM Api Create Session
	${Auth_Header}	Set Variable 	x-auth-token:${EMSessionID}
	${Output} 	Execute Command	curl -g -x "" -k -X POST -d '{"Action":"EFuseReset","Duration":600}' -H '${Auth_Header}' https://${EM_IP}%bond0/rest/v1/CIManagerBays/${Baynumber}
	Should Contain	${Output}	{ "Action": "EFuseReset" }
