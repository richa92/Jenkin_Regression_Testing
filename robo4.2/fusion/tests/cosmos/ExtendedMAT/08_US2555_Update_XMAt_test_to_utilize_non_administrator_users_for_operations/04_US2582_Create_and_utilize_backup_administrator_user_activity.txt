*** Settings ***
Documentation       Add users to Fusion as Backup Administrator
Resource            ../resource.txt
Test Setup          Load Test Data and Open Browser
Test Teardown       Logout and close all browsers
Force Tags          dcs  users  backup

***Variables***
${user}                 cosmosuser
${adminrole}            Infrastructure administrator
${multiroleuser}        Backup administrator
${cosmosusers}          BackupAdminUser
${backupdirectory}      C:\\BackupDownloadFolder

*** Test Cases ***
As an Administrator I want to add Backup Admin user to Fusion
    Log into Fusion appliance as Administrator
    ${blnLoggedInUser}=    Verify user logged in    Administrator    ${adminrole}
    Run Keyword Unless    '${blnLoggedInUser}' == '${blnExpected}'    Fail    Failed to verify logged in User and user role

    Log    create Backup users
    ${blnCreateUser}=    Create user by Name    ${cosmosusers}
    Set Suite Variable    ${blnCreateUser}
    Run Keyword If    '${blnCreateUser}' == '${blnExpected}'    Log    User created successfully
    Run Keyword Unless    '${blnCreateUser}' == '${blnExpected}'    Fail    Fail to created User

Page validation for all the users, verify user data by Name
    Run Keyword Unless    '${blnCreateUser}' == '${blnExpected}'    Fail    Fail to created User
    Log into Fusion appliance as Administrator
    ${blnVerifyUserData}=    Verify user data by Name    ${cosmosusers}
    Run Keyword If    '${blnVerifyUserData}' == '${blnExpected}'    Log    User data validation was successfully
    Run Keyword Unless    '${blnVerifyUserData}' == '${blnExpected}'    Fail    Failed to validate user data

Verify Backup Admin user and roles
    Run Keyword Unless    '${blnCreateUser}' == '${blnExpected}'    Fail    Fail to created User
    Fusion UI login to appliance   ${cosmosusers}
    ${blnVerifyUserLogged}=    Verify user logged in    ${cosmosusers}    ${multiroleuser}
    Run Keyword If    '${blnVerifyUserLogged}' == '${blnExpected}'    Log    logged in user was verified Successfully
    Run Keyword Unless    '${blnVerifyUserLogged}' == '${blnExpected}'    Fail    Failed to verify logged in User and user role

As an backup Administrator I want to Create backup for fusion appliance as an Administrator
    Fusion UI login to appliance   ${cosmosusers}
    Fusion UI create backup

As an backup Administrator I want to Download backup for fusion appliance as an Administrator
    Fusion UI login to appliance   ${cosmosusers}
    Fusion UI download_backup  ${backupdirectory}

As an backup Administrator I want to create support dump for the appliance
    Fusion UI login to appliance   ${cosmosusers}
    Fusion UI create support dump   @{TestData.createsupportdump}
