*** Settings ***
Library             RoboGalaxyLibrary
Library             FusionLibrary
Library             SSHLibrary
Library             OperatingSystem
Library             XML
Library             String
Library             Dialogs

*** Variables ***
${DataFile}         C:\\RoboGalaxyCode\\3.1TbirdXmat-Jan12\\fusion\\tests\\cosmos\\ExtendedMAT_Tbird\\tbird_xmat_data_houston.xml
${ADMIN_USER}       administrator
${ADMIN_PASSWORD}   Cosmos123
${APPLIANCE_IP}     10.87.1.17
${ApplianceUrl}     https://${APPLIANCE_IP}
${Browser}          firefox
${SeleniumSpeed}    0.40
${PauseWhenFailed}  False
${SendMailWhenPaused}   False

*** Keywords ***
Load Test Data and Open Browser
    Set Log Level    TRACE
    Load Test Data  ${DataFile}
    Log Variables
    Open Browser  ${ApplianceUrl}  ${Browser}
    Maximize Browser Window
    Run Keyword If  "${Browser}" == "ie"   Go To  javascript:document.getElementById('overridelink').click()
    Set Selenium Speed  ${SeleniumSpeed}

Logout and Close All Browsers
    Fusion UI Logout of Appliance
    Set Global Variable     ${UiLoggedIn}    ${False}
    Close All Browsers

Log into Fusion appliance as Administrator
    ${user} =  Get Data By Property  ${TestData.users}  name  Administrator
    Set Global Variable     ${UiLoggedIn}    ${False}
    Fusion UI Login to Appliance   ${user[0].name}

Pause And Close Browser
    [Documentation]    Popup a dialog to pause the execution if \${PauseWhenFailed} is set to True. Finally close the browser
    Run Keyword If Test Failed        Pause Test Execution
    Logout and close all browsers

Pause Test Execution
    [Documentation]    Pause test execution
    Return From Keyword If   '${PauseWhenFailed.lower()}'=='false'

    LOG     Encounter failure, pausing test execution, if job is launch from jenkins, please log on jenkins slave server to get job continue       level=WARN
    Send Mail Notification
    Pause Execution

Send Mail Notification
    Return From Keyword If   '${SendMailWhenPaused.lower()}'=='false'    Skipped Send Mail Notification (\${SendMailWhenPaused}=${SendMailWhenPaused})

    LOG     Sending mail notification   level=WARN
    @{receiver_lst}=    Split String    ${Receiver}     ,

    Run Keyword If  '${Content}' == ''  Set Suite Variable
    ...             ${Content}
    ...             Build URL: \n${BUILD_URL}\n\nSlave Node: \n${NODE_NAME}\n\nTest case file: \n${SUITE SOURCE}\n\nTest case name: \n${TEST NAME}\n

    Connect To SMTP Server          smtp.hp.com  True
    Send Email      ${Sender}    ${receiver_lst}      ${Subject}      ${Content}
    Disconnect From SMTP Server
