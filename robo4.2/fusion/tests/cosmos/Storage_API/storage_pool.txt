*** Settings ***
Documentation       Configures an appliance with resources found in supplied data file. Pass in specific tags with pybot -i <tag(s)> to limit processing
...  TAGS:          CONFIGURE, LOGIN, ADD STORAGE POOL, REMOVE STORAGE POOL
...  FTS:           Performs FTS on the appliance.
...  CONFIGURE:     Run all tags except FTS

Resource    ../resource/api/storage.txt
Library     Collections

*** Variables ***
${APPLIANCE_IP}     10.32.12.4

*** Test Cases ***

Login
    [Tags]  CONFIGURE  LOGIN
    ${resp} =   Fusion Api Login Appliance    ${APPLIANCE_IP}    ${admin_credentials}

Add Storage Pool
    [Tags]  ADD
    ${storage_pool} =    Get Variable Value    ${storage_pool}
    :FOR    ${storage_pool}  IN  @{storage_pool}
    \   ${resp_ss} =   Storage System Does Exist   ${storage_pool['storageSystemUri']}
    \   Run Keyword and Continue on Failure     Run Keyword If  '${resp_ss}'=='0'     Fail     msg=STORAGE SYSTEM ${storage_pool['storageSystemUri']} does not exists in the appliance
    \   Run Keyword If  '${resp_ss}'=='0'     Continue For Loop
    \   ${resp_sp} =   Storage Pool Does Exist     ${storage_pool['poolName']}
    \   Run Keyword and Continue on Failure     Run Keyword If  '${resp_sp}'=='1'   Fail    msg=STORAGE POOL ${storage_pool['poolName']} is already present in the appliance
    \   Run Keyword If  '${resp_sp}'=='1'   Continue For Loop
    \   Fusion Api Add Storage Pool     ${storage_pool}

Remove Storage Pool
    [Tags]  REMOVE
    ${storage_pool} =     Get Variable Value  ${storage_pool}
    :FOR    ${storage_pool}   IN  @{storage_pool}
    \   ${resp_sp} =   Storage Pool Does Exist     ${storage_pool['poolName']}
    \   Run Keyword and Continue on Failure     Run Keyword If  '${resp_sp}' == '0'   Fail     msg=Storage Pool ${storage_pool['poolName']} is not present in the appliance
    \   Run Keyword If  '${resp_sp}' == '0'   Continue For Loop
    \   Fusion Api Remove Storage Pool    ${storage_pool}
