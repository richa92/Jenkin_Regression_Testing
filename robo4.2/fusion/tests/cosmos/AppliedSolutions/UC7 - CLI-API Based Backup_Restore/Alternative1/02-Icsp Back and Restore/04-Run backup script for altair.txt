*** Settings ***
Documentation		Execute Backup script as a backup administrator
Resource			../resource.txt
Test Setup			Load Test Data		${DataFile}
Test Teardown		Logout and close all browsers
Library				RoboGalaxyLibrary
Library				OperatingSystem
Variables			../../../../../../../altair/AltairLibrary/ui/objectrepo/altair_elements_settings_page.py


*** Variables ***
${page}				settings
${window_name}		cmd.exe


*** Test Cases ***
Run backup script for altair
	Log into Altair appliance as Administrator
	Maximize Browser Window
	Altair UI Go To Settings Page
	Wait For Element visible	${AltairSettingsPage.ID_APPLIANCE_HOSTNAME}
	${host_name} =	Get Text	${AltairSettingsPage.ID_APPLIANCE_HOSTNAME}
	Log	${host_name}
	${filepath} =	Run		echo %USERPROFILE%
	set	Global variable		${filepath}
	${date} =	Get date
	start process	start	${window_name}
	find native window		${window_name}
	sleep	2
	send keys to native window		${window_name}		set NO_PROXY=${TestData.altairappliances[0].hostname}{Enter}
	send keys to native window		${window_name}		powershell ${TestData.altair_script[0].downloadbackupfile}{Enter}
	send keys to native window		${window_name}		${TestData.altairappliances[0].AltairApplianceUrl}{Enter}
	send keys to native window		${window_name}		${TestData.users[0].name}{Enter}
	send keys to native window		${window_name}		${TestData.users[0].password}{Enter}
	send keys to native window		${window_name}		${TestData.users[0].domainName}{Enter}
	send keys to native window		${window_name}		n{Enter}
	sleep	3
	${host_name} =	Convert to lower case		${host_name}
	${status} =		Wait Until Created		${filepath.strip()}\\Documents\\${host_name}_backup_${date}_*.bkp		timeout=60 minute
	Log		${status}
	${file_name1} =		OperatingSystem.List Files In Directory		${filepath.strip()}\\Documents\\		${host_name}_backup_${date}_*.bkp
	Set Global variable		${file_name1}
	${file} =	Set Variable		${filepath.strip()}\\Documents\\${file_name1[0]}
	wait until keyword succeeds		20 min		5 sec	Compare File Size	${file}
	find native window		${window_name}
	send keys to native window		${window_name}		exit{Enter}

*** Keywords ***
Compare File size
	[arguments]		${file}
	${file_size} =		get file size	${file}
	Sleep	60
	${file_size_new} =		get file size	${file}
	should be equal as integers		${file_size}	${file_size_new}
