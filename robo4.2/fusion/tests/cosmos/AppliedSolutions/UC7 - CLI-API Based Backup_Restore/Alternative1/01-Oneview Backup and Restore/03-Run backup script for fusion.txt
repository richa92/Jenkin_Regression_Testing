*** Settings ***
Documentation		Execute Backup script as a backup administrator
Resource			../resource.txt
Test Setup			Load Test Data and open browser
Test Teardown		Logout and close all browsers
Library				RoboGalaxyLibrary
Library				OperatingSystem
Variables			../../../../../../FusionLibrary/ui/facilities/settings_elements.py


*** Variables ***
${page}				settings
${window_name}		cmd.exe


*** Test Cases ***
Run backup script for fusion
	Log into Fusion appliance as Administrator
	Fusion UI navigate to page	${page}
	Wait For Element visible	${FusionSettingsPage.ID_SETTINGS_HOST_NAME}
	${host_name} =	Get Text	${FusionSettingsPage.ID_SETTINGS_HOST_NAME}
	Log	${host_name}
	${filepath} =	Run		echo %USERPROFILE%
	Set	Global variable		${filepath}
	${date} =	Get date
	start process	start	${window_name}
	find native window		${window_name}
	sleep	2
	send keys to native window		${window_name}		set NO_PROXY=${ApplianceIP}{Enter}
	send keys to native window		${window_name}		powershell ${TestData.fusion_script[0].downloadbackupfile}{Enter}
	send keys to native window		${window_name}		${ApplianceUrl}{Enter}
	send keys to native window		${window_name}		${TestData.users[0].name}{Enter}
	send keys to native window		${window_name}		${TestData.users[0].password}{Enter}
	send keys to native window		${window_name}		${TestData.users[0].domainName}{Enter}
	send keys to native window		${window_name}		n{Enter}
	sleep	3
	${host_name} =	Convert to lower case		${host_name}
	${status} =		Wait Until Created		${filepath.strip()}\\Documents\\${host_name}_backup_${date}_*.bkp		timeout=40 minute
	Log		${status}
	${file_name} =		OperatingSystem.List Files In Directory		${filepath.strip()}\\Documents\\		${host_name}_backup_${date}_*.bkp
	Set Global variable		${file_name}
	${file} =	Set Variable		${filepath.strip()}\\Documents\\${file_name[0]}
	wait until keyword succeeds		20 min		5 sec	Compare File Size	${file}
	find native window		${window_name}
	send keys to native window		${window_name}		exit{Enter}

*** Keywords ***
Compare File size
	[arguments]		${file}
	${file_size} =		get file size	${file}
	Sleep	60
	${file_size_new} =		get file size	${file}
	should be equal as integers		${file_size}	${file_size_new}
