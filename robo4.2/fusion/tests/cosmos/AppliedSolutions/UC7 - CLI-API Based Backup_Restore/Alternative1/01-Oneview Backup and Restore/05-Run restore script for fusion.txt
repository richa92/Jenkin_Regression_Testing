*** Settings ***
Documentation		Execute Restore script
Resource			../resource.txt
Test Setup			Load Test Data and open browser
Test Teardown		Logout and close all browsers
Library				RoboGalaxyLibrary
Library				OperatingSystem
Variables			../../../../../../FusionLibrary/ui/facilities/settings_elements.py
Variables			../../../../../../FusionLibrary/ui/general/login_elements.py


*** Variables ***
${page}				settings
${window_name}		cmd.exe
${blnExpected}		True


*** Test Cases ***
Run Restore script for fusion
	Log into Fusion appliance as Administrator
	Fusion UI navigate to page	${page}
	Wait For Element visible	${FusionSettingsPage.ID_BACKUP_FILE_NAME}
	${file_name} =		Get Text	${FusionSettingsPage.ID_BACKUP_FILE_NAME}
	Log		${file_name}
	${filepath} =	Run		echo %USERPROFILE%
	start process	start	${window_name}
	focus native window		${window_name}
	sleep	2
	find native window		${window_name}
	send keys to native window		${window_name}		set NO_PROXY=${ApplianceIP}{Enter}
	send keys to native window		${window_name}		powershell ${TestData.fusion_script[0].downloadrestorefile}{Enter}
	send keys to native window		${window_name}		y{Enter}
	send keys to native window		${window_name}		${filepath.strip()}\\Documents\\{Enter}
	send keys to native window		${window_name}		${file_name}{Enter}
	send keys to native window		${window_name}		${ApplianceUrl}{Enter}
	send keys to native window		${window_name}		${TestData.users[1].name}{Enter}
	send keys to native window		${window_name}		${TestData.users[1].password}{Enter}
	send keys to native window		${window_name}		{Enter}

Check Restore Status
	wait until keyword succeeds		20 min		3 min	Wait For Restore Page
	Load test data and Open Browser
	${vis1} =	wait for element notvisible	${FusionSettingsPage.ID_RESTORE_STATUS}	3600
	${vis2} =	wait for element visible	${FusionLoginPage.ID_BTN_LOGIN_BUTTON}	300
	Close All Browsers

Close cmd prompt
	find native window		${window_name}
	send keys to native window		${window_name}		exit{Enter}

*** keywords ***
Wait For Restore Page
	Load test data and Open Browser
	Sleep	5
	${item} =		wait for element notvisible	${FusionLoginPage.ID_BTN_LOGIN_BUTTON}
	Log		${item}
	Close All Browsers
	Run Keyword Unless		'${item}' == '${blnExpected}'		Fail	Restore not Found
