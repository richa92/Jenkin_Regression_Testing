*** Settings ***
Documentation		Copy File And Access Shared Folder
Resource			../resource.txt
Test Setup			Load Test Data	${DataFile}
Library				OperatingSystem
Library				SSHLibrary


*** Test Cases ***
Copy files to VM
	: For	${item}		in	@{list_ip}
	\	Run		powershell Enable-PSRemoting -Force
	\	Inititate File transfer		${item}

*** Keywords ***
Inititate File transfer
	[Arguments]		${item}
	: FOR	${vn}	In	@{TestData.copy_file}
	\	${username} =	set variable	${vn.username}
	\	${password} =	set Variable	${vn.password}
	\	${sourcepath} =	set variable	${vn.sourcepath}
	\	${destpath} =	set variable	${vn.destpath}
	\	${driverpath} =	set variable	${vn.DriverName}
	\	${filename} =	set variable	${vn.filename}
	\	${hostname} =	set variable	\\\\${item}
	\	${dest_path} =	set variable	${vn.dest}
	\	${dest} =		set variable	${hostname}${dest_path}
	\	${source} =	set variable	${vn.source}
	\	${target} =	set variable	${vn.target}
	\	${Command_etd} =	Set Variable	$Username = '${username}'; $Password = '${password}'; $DriverName = '${driverpath}'; $HostName = '${hostname}'; $dest = '${dest}'; $source = '${source}'; $target = '${target}'; Set-Item -force wsman:\\localhost\\client\\trustedhosts * -Force; Restart-Service WinRM; $Pswd = ConvertTo-SecureString -String $Password -AsPlaintext -Force; $credentials = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList $UserName,$Pswd; New-PSDrive -Persist -Name $DriverName -PSProvider FileSystem -Root $dest -credential $credentials; copy-item $source -destination $target
	\	Run		powershell ${Command_etd}
	\	${rc} =	Run and Return RC	${driverpath}:
	\	Should Be True	-1 < ${rc} < 42
	\	Run		powershell net use * /del /yes
