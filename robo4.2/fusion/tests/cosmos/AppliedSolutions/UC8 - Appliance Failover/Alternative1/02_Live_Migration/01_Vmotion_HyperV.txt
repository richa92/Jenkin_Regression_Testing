*** Settings ***
Documentation		Live migration of VM's from one node to another node
Resource			../resource.txt
Test Setup			Load Test Data	${DataFile}
Library				OperatingSystem


*** Test Cases ***
Initial commands to enable interaction with HyperV server 
	Run		powershell Enable-PSRemoting -Force	
	Run		powershell Set-Item wsman:\\localhost\\client\\trustedhosts * -Force
	Run		powershell Restart-Service WinRM

HyperV Live Migration
	: FOR	${VM}	In	@{TestData.vmotion}	
	\	${vm_name} =	set variable	${VM.vmname}
	\	${username} =	set variable	${VM.username}
	\	${password} =	set variable	${VM.password}
	\	${host_name} =	set variable	${VM.hostname}
	\	${cluster_ip} =	set variable	${VM.vcenter}
	\	Run		powershell $Username = '${username}'; $Password = '${password}'; $pass = ConvertTo-SecureString -AsPlainText $Password -Force; $Cred = New-Object System.Management.Automation.PSCredential -ArgumentList $Username,$pass; Invoke-Command -ComputerName ${cluster_ip} -ScriptBlock { Move-ClusterVirtualMachineRole ${vm_name} -Node ${host_name} } -credential $Cred
