*** Settings ***
Documentation		Validate Interconnect UplinkPort ServerProfile Status
Resource			../resource.txt
Library				RoboGalaxyLibrary
Test Setup			Load Test Data and Open Browser
Test Teardown		Logout and close all browsers
Variables			../../../../../../FusionLibrary/ui/networking/interconnects_elements.py
Variables			../../../../../../FusionLibrary/ui/servers/serverprofiles_elements.py
Variables			../../../../../../FusionLibrary/ui/networking/logicalinterconnects_elements.py

*** Variables ***
${length}	0
${count}	0

*** Test Cases ***
Validate Interconnect and UplinkPort 1 Status
	Log into Fusion appliance as Administrator
	${blnactual} =	Set Variable	False
	Fusion UI Navigate To Interconnects Page
	Fusion UI Select Interconnect	${TestData.interconnect[0].interconnect}
	Sleep	300
	:For	${inter}	IN	@{TestData.poweron_interconnect}
	\	${power} =	Get Ui Object		${FusionInterconnectPage.ID_INTERCONNECT_POWER}	${inter.power}
	\	${power_status} =	wait for element visible	${power}
	\	${status} =	Get Ui Object		${FusionInterconnectPage.ID_OVERALL_INTERCONNECT_STATUS}
	\	${interconnect_status} =	wait for element visible		${status}
	\	${count} =	Run keyword if	'${interconnect_status}'=='${power_status}' 	evaluate	${count}+1
	\	${length} =		Evaluate	${length}+1
	:For	${port}	IN	@{TestData.uplinkports}
	\	${uplink_type} =	Get Ui Object		${FusionInterconnectPage.ID_UPLINK_PORT_STATE}	${port.portname}	${port.type}
	\	wait for element and click		${FusionInterconnectPage.ID_UPLINK_PORT_LINK}
	\	Sleep	4
	\	${uplink_state} =	wait for element visible		${uplink_type}
	\	${count} =	Run keyword if	${uplink_state}==True 	evaluate	${count}+1
	\	${length} =		Evaluate	${length}+1
	Run Keyword If		${count} == ${length}    Log		Valid Interconnect states
	Run Keyword Unless		${count} == ${length}    Fail		Invalid Interconnect States

Reapply Configuration
	Log into Fusion appliance as Administrator
	${blnactual} =	Set Variable	False
	Fusion UI Navigate To Logical Interconnects Page
	Fusion UI Select Logical Interconnect	${TestData.logical_interconnect[0].name}
	wait for element and click	${FusionLogicalInterconnectsPage.ID_ACTION_MAIN_BTN}
	wait for element and click	${FusionLogicalInterconnectsPage.ID_REAPPLY_CONFIGURATION}
	wait for element visible	${FusionLogicalInterconnectsPage.ID_REAPPLY_CONFIGURATION_POPUP}
	wait for element and click	${FusionLogicalInterconnectsPage.ID_YES_REAPPLY_LIC}
	${status} =	wait for element visible	${FusionLogicalInterconnectsPage.ID_OK_STATUS_BAR}	120
	Run Keyword If		${status}==${blnExpected}    Log		Rapply Configuration completed
	Run Keyword Unless		${status}==${blnExpected}    Fail		Failed to do Reapply Configuration

Verify Server Profile 1 Status
	Log into Fusion appliance as Administrator
	${blnactual} =	Set Variable	False
	Fusion UI Navigate To Server Profiles Page
	Fusion UI Select Server Profiles	${TestData.profile1[0].name}
	${server_profile__status} =	wait for element visible	${FusionServerProfilesPage.ID_SERVER_STATUS_OK}
	Run Keyword If		${server_profile__status}==${blnExpected}    Log		Server Profile Status is 'OK' as expected
	Run Keyword Unless		${server_profile__status}==${blnExpected}    Fail		Server Profile Status is not as expected

