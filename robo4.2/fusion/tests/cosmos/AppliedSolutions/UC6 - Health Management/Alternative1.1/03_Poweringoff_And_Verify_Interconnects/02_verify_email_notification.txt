*** Settings ***
Documentation		Verify email notification for high temperature alert
Resource            ../resource.txt
Test Setup			Load Test Data		${DataFile}
Force Tags			critical


*** Test Cases ***
Configure Email Messages
    [Documentation]    Configures email message to be searched.
    Connect To Smtp Server      ${SmtpServer}
    Connect To POP Mail Server      ${PopServer}    ${PopUser}    ${PopPassword}    use_ssl=True
    ${StartMessageCount}=    Get Mail Message Count
    Set Suite Variable    ${StartMessageCount}              # used for validation
    Log    Current Message Count = ${StartMessageCount}
    ${StartMessage}=    Evaluate    ${StartMessageCount} + 1
    ${LastMessage}=     Evaluate    ${StartMessageCount} + ${TotalMessages}
    Set Suite Variable    ${StartMessage}
    Set Suite Variable    ${LastMessage}
    @{Messages}=        Create List
	${Subject}=    Set Variable		HP OneView VM - VMware vSphere - Alert
    ${Body}=       Set Variable		A storage
    ${Message}=     Create Dictionary   index=${LastMessage}    subject=${Subject}    body=${Body}
    Append To List  ${Messages}    ${Message}
    Sleep    1     # sleep so the messages arrive in order
    Set Suite Variable    ${Messages}
    Set Suite Variable    ${Subject}
	Set Suite Variable    ${Body}

Validate Email Messages
    [Documentation]    Verifies the subject and body lines of the previously sent emails
    Connect To POP Mail Server      ${PopServer}    ${PopUser}    ${PopPassword}    use_ssl=True
    :FOR   ${Message}    in     @{Messages}
    \    Log    Validating Message ${Message['index']}
    \    Mail Message Subject Should Match    ${StartMessageCount}	${Subject}
    \    Mail Message Body Should Match    ${StartMessageCount}	${Body}