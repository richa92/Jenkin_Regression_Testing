*** Settings ***
Documentation		Create new server profile with build spp and check Force spp installation for different Servers
Resource 			../resource.txt
Test Setup         Load Test Data 	${DataFile}
Test Teardown      Logout and close all browsers
Library             OperatingSystem

*** Variables ***
${blnExpected}			True
${ilo}					_ILO
${rom}					_ROM
${ilo_name}				ILO_Version
${rom_name}				ILO_Version

*** Test Cases ***
Get Hardware Details before update
	Load Test Data and Open Browser
	Log into Fusion appliance as Administrator
	Fusion UI Power Off Server		${Testdata.profile_gen8_force[0].server}
	Fusion UI Power Off Server		${Testdata.profile_g7_force[0].server}
	Fusion UI Power Off Server		${Testdata.profile_dl_force[0].server}
	${dict1} =	Fusion UI Get Server Firmware Version		${Testdata.profile_gen8_force[0].server}				
	${ilo_value1} =	Get From Dictionary		${dict1}		${ilo_name}
	${rom_value1} =	Get From Dictionary		${dict1}		${rom_name}
	${dict3} =	Fusion UI Get Server Firmware Version		${Testdata.profile_g7_force[0].server}
	${ilo_value3} =	Get From Dictionary		${dict3}		${ilo_name}
	${rom_value3} =	Get From Dictionary		${dict3}		${rom_name}
	${dict5} =	Fusion UI Get Server Firmware Version		${Testdata.profile_dl_force[0].server}
	${ilo_value5} =	Get From Dictionary		${dict5}		${ilo_name}
	${rom_value5} =	Get From Dictionary		${dict5}		${rom_name}

	Set Global Variable		${ilo_value1}
	Set Global Variable		${rom_value1}
	Set Global Variable		${ilo_value3}
	Set Global Variable		${rom_value3}
	Set Global Variable		${ilo_value5}
	Set Global Variable		${rom_value5}

Create Profile for Gen8
	Load Test Data and Open Browser
	Log into Fusion appliance as Administrator
	${blnCreateProf} =  Fusion UI create Server Profile     @{TestData.profile_gen8_force}
	Run Keyword If		'${blnCreateProf}' == '${blnExpected}'    Log		profile_gen8_force Profile is created successfully.
	Run Keyword Unless		'${blnCreateProf}' == '${blnExpected}'    Fail	Failed to create profile_gen8_force Profile mentioned in data file.	
	
Create Profile for G7
	Load Test Data and Open Browser
	Log into Fusion appliance as Administrator
	${blnCreateProf} =  Fusion UI create Server Profile     @{TestData.profile_g7_force}
 	Run Keyword If		'${blnCreateProf}' == '${blnExpected}'    Log		profile_g7_force Profile is created successfully.
	Run Keyword Unless		'${blnCreateProf}' == '${blnExpected}'    Fail	Failed to create profile_g7_force Profile mentioned in data file.	
	
Create Profile for DL
	Load Test Data and Open Browser
	Log into Fusion appliance as Administrator
	${blnCreateProf} =  Fusion UI create Server Profile     @{TestData.profile_dl_force}
 	Run Keyword If		'${blnCreateProf}' == '${blnExpected}'    Log		profile_dl_force Profile is created successfully.
	Run Keyword Unless		'${blnCreateProf}' == '${blnExpected}'    Fail	Failed to create profile_dl_force Profile mentioned in data file.	

Get Hardware Details after update
	Load Test Data and Open Browser
	Log into Fusion appliance as Administrator
	${dict2} =	Fusion UI Get Server Firmware Version		${Testdata.profile_gen8_force[0].server}				
	${ilo_value2} =	Get From Dictionary		${dict2}		${ilo_name}
	${rom_value2} =	Get From Dictionary		${dict2}		${rom_name}
	${dict4} =	Fusion UI Get Server Firmware Version		${Testdata.profile_g7_force[0].server}
	${ilo_value4} =	Get From Dictionary		${dict4}		${ilo_name}
	${rom_value4} =	Get From Dictionary		${dict4}		${rom_name}
	${dict6} =	Fusion UI Get Server Firmware Version		${Testdata.profile_dl_force[0].server}
	${ilo_value6} =	Get From Dictionary		${dict6}		${ilo_name}
	${rom_value6} =	Get From Dictionary		${dict6}		${rom_name}

	Run keyword and continue on failure		Compare Values		${ilo_value1}	${ilo_value2}	${Testdata.profile_gen8[0].hardwaretype}
	Run keyword and continue on failure		Compare Values		${ilo_value3}	${ilo_value4}	${Testdata.profile_g7[0].hardwaretype}
	Run keyword and continue on failure		Compare Values		${ilo_value5}	${ilo_value6}	${Testdata.profile_dl[0].hardwaretype}

Capture Deployment IP
	Log into Altair appliance as Administrator
	${server_data} =	Set Variable	${Testdata.profile_dl[0]}
	${ilo_ip} =		Set Variable	${server_data.ip}
	${server} =		Set Variable	${server_data.server}
	${dep_ip} =		Get Deployment IP		${ilo_ip}
	Log		${dep_ip}
	set global variable		${dep_ip}
	set global variable		${server}

Ping OS Deployment
	Load Test Data and Open Browser
	Log into Fusion appliance as Administrator
	Fusion UI Power On Server		${server}
	${output} =    Run    ping ${dep_ip} -4 -n 1
	Should Contain  ${output}       Lost = 0 (0% loss)
	Log		OS is up and the machine is pinging
	Logout and close all browsers

*** Keywords ***
Compare Values
	[arguments]		${value1}	${value2}	${hardware_type}
	${value1[0]} =	Split String	${value1}	 
	${value2[0]} =	Split String	${value2}	 
	${blnActual} =	Evaluate	${value1[0]} > ${value2[0]}
	Run Keyword If		${blnExpected} == ${blnActual}    Fail		Failed to update Firmware on server hardware type ${hardware_type}.
	Run Keyword Unless		${blnExpected} == ${blnActual}    Log	Updated Firmware successfully on server hardware type ${hardware_type}.
