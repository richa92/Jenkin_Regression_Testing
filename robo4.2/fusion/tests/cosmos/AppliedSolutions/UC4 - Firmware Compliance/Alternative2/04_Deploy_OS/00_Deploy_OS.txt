*** Settings ***
Documentation		Deploy OS on managed server Gen8
Resource 			../resource.txt
Library             OperatingSystem
Test Setup         Load Test Data	${DataFile}
Test Teardown      Logout and close all browsers

*** Variables ***
${JOB WAIT TIME IN MINUTES}		20
${DEPLOYMENT JOB WAIT TIME IN MINUTES}	40
${blnExpected}			True

*** Test Cases ***
Create Profile for Gen8
	Load Test Data and Open Browser
	Log into Fusion appliance as Administrator
	Fusion UI Power Off Server		${Testdata.profile_gen8[0].server}
	${blnCreateProf} =  Fusion UI create Server Profile     @{TestData.profile_gen8}
	Run Keyword If		'${blnCreateProf}' == '${blnExpected}'    Log		profile_gen8 Profile is created successfully.
	Run Keyword Unless		'${blnCreateProf}' == '${blnExpected}'    Fail	Failed to create profile_gen8 Profile mentioned in data file.	

Load Test Data and Open Browser
	Log into Altair appliance as Administrator
	maximize browser window
	${date} = 	Get Job Time
	${altairappldata} =  Get data by property  ${TestData.altairappliances}  	name		altair
	Set Global Variable		${altairappldata}
	Set Global Variable		${date}

Add Servers
	Log into Altair appliance as Administrator
	Altair UI_Go_To Servers Page
	Altair_ui_add_server		@{TestData.osbp_Gen8}
	Altair UI Go To Jobs Page
	: FOR   ${ilo}   IN      @{TestData.osbp_Gen8}
	\	Log     Checking ${ilo.ip}
	\	Sleep	10
	\	${job_status}=		Altair UI Get Job Status		${ilo.ip}		Add Server		${date}		${JOB WAIT TIME IN MINUTES}
	\	Log		${job_status}
	\	Should Be Equal As Strings		${job_status}		Success

Run OS Build Plan
	Log into Altair appliance as Administrator
	Altair UI Go To OS Build Plans Page
	: FOR   ${deploy}   IN      @{TestData.osbp_Gen8}
	\	Altair UI Run OS Buildplan From OS Buildplans Page		${deploy.altairOs}		${deploy.servername}
	\	Sleep	10
  	\	${osbp_job_status}=		Altair UI Get Job Status		none		${deploy.altairOs}			${date}		${DEPLOYMENT JOB WAIT TIME IN MINUTES}
	\	Log		${osbp_job_status}
	\	Should Be Equal As Strings		${osbp_job_status}		Success

Capture Deployment IP
	Log into Altair appliance as Administrator
	${server_data} =	Set Variable	${Testdata.osbp_Gen8[0]}
	${ilo_ip} =		Set Variable	${server_data.ip}
	${servername} =		Set Variable	${server_data.servername}
	${dep_ip}=	Get Deployment IP		${ilo_ip}
	Log		${dep_ip}
	set global variable		${dep_ip}
	set global variable		${servername}	
	Logout and close all browsers

Ping OS Deployement
	Load Test Data and Open Browser
	Log into Fusion appliance as Administrator
	maximize browser window
	Fusion UI Power On Server		${servername}
	${output} =    Run    ping ${dep_ip} -4 -n 1
	Should Contain  ${output}       Lost = 0 (0% loss)
	Log		OS is up and the machine is pinging
	Logout and close all browsers
