*** Settings ***
Documentation		Update DL firmware through altair
Resource 			../resource.txt
Test Setup         Load Test Data	${DataFile}
Test Teardown      Logout and close all browsers
Library             OperatingSystem

*** Variables ***
${JOB WAIT TIME IN MINUTES}		20
${DEPLOYMENT JOB WAIT TIME IN MINUTES}	40
${blnExpected}			True
${ilo}					_ILO
${rom}					_ROM
${ilo_name}				ILO_Version
${rom_name}				ROM version

*** Test Cases ***
Server FW details in fusion before update
	Load Test Data and Open Browser
	Log into Fusion appliance as Administrator
	Fusion UI Power Off Server		${Testdata.profile_dl[0].server}
	${dict1} =	Fusion UI Get Server Firmware Version		${Testdata.profile_dl[0].server}
	${ilo_value1} =	Get From Dictionary		${dict1}		${ilo_name}
	${rom_value1} =	Get From Dictionary		${dict1}		${rom_name}
	
	Set Global Variable		${ilo_value1}
	Set Global Variable		${rom_value1}

Altair Appliance Data
	Log into Altair appliance as Administrator
	${date} = 	Get Job Time
	${altairappldata} =  Get data by property  ${TestData.altairappliances}  	name		altair
	Set Global Variable             ${altairappldata}
	Set Global Variable				${date}

Run OS Build Plan
	Log into Altair appliance as Administrator
	Altair UI Go To OS Build Plans Page
	: FOR   ${deploy}   IN      @{TestData.osbp_dl}
	\	Altair UI Run OS Buildplan From OS Buildplans Page		${deploy.altairOs}		${deploy.servername}
	\	Sleep	10
  	\	${osbp_job_status}=		Altair UI Get Job Status		none		${deploy.altairOs}			${date}		${DEPLOYMENT JOB WAIT TIME IN MINUTES}
	\	Log		${osbp_job_status}
	\	Should Be Equal As Strings		${osbp_job_status}		Success

Verify FW details in fusion after fw update at altair
	Load Test Data and Open Browser
	Log into Fusion appliance as Administrator
	Fusion UI Power Off Server		${Testdata.profile_dl[0].server}
	${dict2} =	Fusion UI Get Server Firmware Version		${Testdata.profile_dl[0].server}
	${ilo_value2} =	Get From Dictionary		${dict2}		${ilo_name}
	${rom_value2} =	Get From Dictionary		${dict2}		${rom_name}

	Run keyword and continue on failure		Compare Values		${ilo_value1}	${ilo_value2}	${Testdata.profile_dl[0].hardwaretype}

*** Keywords ***
Compare Values
	[arguments]		${value1}	${value2}	${hardware_type}
	${value1[0]} =	Split String	${value1}	 
	${value2[0]} =	Split String	${value2}	 
	${blnActual} =	Evaluate	${value1[0]} > ${value2[0]}
	Run Keyword If		${blnExpected} == ${blnActual}    Fail		Failed to update Firmware on server hardware type ${hardware_type}.
	Run Keyword Unless		${blnExpected} == ${blnActual}    Log	Updated Firmware successfully on server hardware type ${hardware_type}.
