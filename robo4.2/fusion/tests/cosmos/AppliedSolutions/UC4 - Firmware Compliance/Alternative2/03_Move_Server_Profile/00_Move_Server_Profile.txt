*** Settings ***
Documentation		Create new server profile with build spp and Uncheck Force installation for different Servers
Resource 			../resource.txt
Test Setup         Load Test Data 	${DataFile}
Test Teardown      Logout and close all browsers
Library             OperatingSystem

*** Variables ***
${blnExpected}			True
${ilo}					_ILO
${rom}					_ROM
${ilo_name}				ILO_Version
${rom_name}				ROM version

*** Test Cases ***
Get Hardware Details before update server with firmware not upto date
	Load Test Data and Open Browser
	Log into Fusion appliance as Administrator
	Fusion UI Power Off Server		${Testdata.move_profile_fw_notuptodate[0].server}
	Fusion UI Power On Server		${Testdata.move_profile_fw_notuptodate[0].serverfrom}
	${dict1} =	Fusion UI Get Server Firmware Version		${Testdata.move_profile_fw_notuptodate[0].server}				
	${ilo_value1} =	Get From Dictionary		${dict1}		${ilo_name}
	${rom_value1} =	Get From Dictionary		${dict1}		${rom_name}

	Set Global Variable		${ilo_value1}
	Set Global Variable		${rom_value1}

Move server Profile to the server with firmware not upto date
	Load Test Data and Open Browser
	Log into Fusion appliance as Administrator
	${blnCreateProf} =  Fusion UI Move Server Profile		@{TestData.move_profile_fw_notuptodate}
 	Run Keyword If		'${blnCreateProf}' == '${blnExpected}'    Log		SerProf_gen8 Profile is moved successfully to server fw not upto date.
	Run Keyword Unless		'${blnCreateProf}' == '${blnExpected}'    Fail	Failed to move SerProf_gen8 Profile to server fw not upto date.	
	
Get Hardware Details after moving the profile to server with firmware not upto date
	Load Test Data and Open Browser
	Log into Fusion appliance as Administrator
	${dict2} =	Fusion UI Get Server Firmware Version		${Testdata.move_profile_fw_notuptodate[0].server}				
	${ilo_value2} =	Get From Dictionary		${dict2}		${ilo_name}
	${rom_value2} =	Get From Dictionary		${dict2}		${rom_name}
	
	Run keyword and continue on failure		Compare Values		${ilo_value1}	${ilo_value2}	${Testdata.move_profile_fw_notuptodate[0].hardwaretype}

Get Hardware Details before update server with firmware upto date
	Load Test Data and Open Browser
	Log into Fusion appliance as Administrator
	Fusion UI Power Off Server		${Testdata.move_profile_fw_uptodate[0].server}
	Fusion UI Power On Server		${Testdata.move_profile_fw_uptodate[0].serverfrom}
	${dict3} =	Fusion UI Get Server Firmware Version		${Testdata.move_profile_fw_uptodate[0].server}
	${ilo_value3} =	Get From Dictionary		${dict3}		${ilo_name}
	${rom_value3} =	Get From Dictionary		${dict3}		${rom_name}

	Set Global Variable		${ilo_value3}
	Set Global Variable		${rom_value3}

Move server Profile to the server with firmware upto date
	Load Test Data and Open Browser
	Log into Fusion appliance as Administrator
	${blnCreateProf} =  Fusion UI Move Server Profile		@{TestData.move_profile_fw_uptodate}
 	Run Keyword If		'${blnCreateProf}' == '${blnExpected}'    Log		SerProf_gen8 Profile is moved successfully to server fw upto date.
	Run Keyword Unless		'${blnCreateProf}' == '${blnExpected}'    Fail	Failed to move SerProf_gen8 Profile to server fw upto date.	
	
Get Hardware Details after moving the profile to server with firmware upto date
	Load Test Data and Open Browser
	Log into Fusion appliance as Administrator
	${dict4} =	Fusion UI Get Server Firmware Version		${Testdata.move_profile_fw_uptodate[0].server}
	${ilo_value4} =	Get From Dictionary		${dict4}		${ilo_name}
	${rom_value4} =	Get From Dictionary		${dict4}		${rom_name}

	Run keyword and continue on failure		Compare Values		${ilo_value3}	${ilo_value4}	${Testdata.move_profile_fw_notuptodate[0].hardwaretype}

Delete server profiles created in order to create a new server profile in the future if needed
	Load Test Data and Open Browser
	Log into Fusion appliance as Administrator
	Fusion UI Delete Server Profile     @{TestData.profile_gen8}
	Logout and close all browsers

*** Keywords ***
Compare Values
	[arguments]		${value1}	${value2}	${hardware_type}
	${value1[0]} =	Split String	${value1}	 
	${value2[0]} =	Split String	${value2}	 
	${blnActual} =	Evaluate	${value1[0]} > ${value2[0]}
	Run Keyword If		${blnExpected} == ${blnActual}    Fail		Failed to update Firmware on server hardware type ${hardware_type}.
	Run Keyword Unless		${blnExpected} == ${blnActual}    Log	Updated Firmware successfully on server hardware type ${hardware_type}.
