*** Settings ***
Resource        ../resource.txt
Test Setup		Load Test Data and open browser
#Test Teardown  	Logout and close all browsers
Force Tags      critical
Variables       ../../../../FusionLibrary/ui/servers/serverprofiles_elements.py
Library			OperatingSystem

*** Variables ***
${notification}		xpath=.//*[@id='hp-page-notifications']/div[1]/header/div[4]

*** Test Cases ***
Edit profiles to servers
 	Log into Fusion appliance as Administrator
 	Update server profile firmware		@{TestData.editprofiles}
 	: For	${item}		in	@{list_ip}
	\	Run		powershell Enable-PSRemoting -Force
	\	Inititate File transfer		${item}
	Track Update status		${TestData.editprofiles.servername}
		
	
*** Keywords ***
Update server profile firmware
	[Arguments]   @{data}
	: For   ${item}   in    @{data}
	\	Fusion UI Navigate to Server profiles page
	\	Fusion UI select server profiles	${item.name}
	\	wait for element and click		${FusionServerProfilesPage.ID_MENU_MAIN_ACTION}
	\	wait for element and click		${FusionServerProfilesPage.ID_MENU_ACTION_EDIT}
	\	wait for element and click		${FusionServerProfilesPage.ID_EDIT_OVERVIEW}
	\	wait for element and click		${FusionServerProfilesPage.ID_LINK_FIRMWARE}
	\	wait for element and click		${FusionServerProfilesPage.ID_FIRMWARE_BASELINE_DROP_DOWN}
	\	wait for element and click		//*[@class='selectBox-dropdown-menu selectBox-options']/li/a[text()='HP Service Pack for ProLiant version 2015.06.0']
	\	Run keyword if   '${item.installationMethod}' == 'Firmware and OS Drivers using HP Smart Update Tools'	wait for element and click	${FusionServerProfilesPage.ID_RADIO_BTN_FIRMWARE_OS_DRIVERS}
	\	Run keyword if   '${item.installationMethod}' == 'Firmware only using HP Smart Update Tools'	wait for element and click	${FusionServerProfilesPage.ID_RADIO_BTN_FIRMWARE_HP_SMART_UPDATE_TOOLS}
	\	Run keyword if   '${item.installationMethod}' == 'Firmware only'	wait for element and click	${FusionServerProfilesPage.ID_RADIO_BTN_FIRMWARE_ONLY}
	\	Run keyword if   '${item.forceInstall}' == 'true'	wait for element and click	${FusionServerProfilesPage.ID_CHECKBOX_FIRMWARE_FORCE_INSTALL}
	\	wait for element and click		${FusionServerProfilesPage.ID_BTN_CONFIRM_UPDATE_FIRMWARE}
	\	wait for element visible		${FusionServerProfilesPage.ID_PAGE_LABEL}


Track Update status
	[Arguments]		${servername}
	Fusion UI Navigate to server profiles page
	Fusion Ui select server profiles	${servername}
	wait for element notvisible		.//*[@class='hp-progress']
	${status}	get text		id=hp-page-notifications
	Log		${status}
	Should contain		${status}	Completed

Inititate File transfer
	[Arguments]		${item}
	Run		powershell Enable-PSRemoting -Force
	: FOR	${vn}	In	@{TestData.copy_file}
	\	${username} =	set variable	${vn.username}
	\	${password} =	set Variable	${vn.password}
	\	${sourcehost} =	set variable	\\\\${vn.sourcehost}
	\	${targethost} =	set variable	\\\\${vn.targethost}
	\	${filename} =	set variable	${vn.filename}
	\	${Command_etd} =	Set Variable	Set-Item -force wsman:localhost\client\trustedhosts *; Restart-Service WinRM; $net = new-object -ComObject WScript.Network; $net.MapNetworkDrive("'U:'", "'${sourcehost}\\C$\\Users\\Administrator\\Desktop'", $false, "'${username}'", "'${password}'"); $net.MapNetworkDrive("'V:'", "'${targethost}\\C$\\Users\\Administrator\\Desktop'", $false, "'${username}'", "'${password}'"); copy-item -Path U:\\${filename} -destination V:\\${filename}
	\	Run		powershell ${Command_etd}
	\	Run		powershell net use * /del /yes

