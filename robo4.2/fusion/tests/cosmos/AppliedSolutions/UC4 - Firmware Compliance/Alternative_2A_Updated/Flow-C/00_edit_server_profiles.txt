*** Settings ***
Documentation	Edit Server Profiles
Resource		../resource.txt
Test Setup		Load Test Data and open browser
Test Teardown		Logout and close all browsers
Variables		../../../../../../FusionLibrary/ui/servers/serverprofiles_elements.py
Library			OperatingSystem


*** Variables ***
${progress}				xpath=.//div[@class='hp-progress']
${notification}			xpath=.//div[@class='hp-state']
${firmware_install_status}	xpath=//*[@id='cic-profile-show-firmwareInstallState']


*** Test Cases ***
Edit profiles to servers
	Log into Fusion appliance as Administrator
	: For	${item}	in	@{TestData.edit_server_profile2}
	\	Update server profile firmware	${item}
	\	Run keyword if	'${item.installationMethod}' == 'Firmware only'		Track Update status		${item.name}
	\	Run keyword Unless	'${item.installationMethod}' == 'Firmware only'	Track Update status1	${item.name}
	Logout and close all browsers


*** Keywords ***
Update server profile firmware
	[Arguments]		${item}
	Fusion UI Navigate to Server profiles page
	Fusion UI select server profiles	${item.name}
	wait for element and click		${FusionServerProfilesPage.ID_MENU_MAIN_ACTION}
	wait for element and click		${FusionServerProfilesPage.ID_MENU_ACTION_EDIT}
	wait for element and click		${FusionServerProfilesPage.ID_EDIT_OVERVIEW}
	wait for element and click		${FusionServerProfilesPage.ID_LINK_FIRMWARE}
	wait for element and click		${FusionServerProfilesPage.ID_EDIT_FIRMWARE_BASELINE_DROP_DOWN}
	${select_firmware} =	Get UI object	${FusionServerProfilesPage.ID_SELECT_FIRMWARE_BASELINE}	${item.firmware}
	wait for element and click	${select_firmware}
	Sleep	5
	Run keyword if   '${item.installationMethod}' == 'Firmware and OS Drivers using HP Smart Update Tools'	wait for element and click	xpath=.//*[@id='cic-profile-edit-firmware-osdriver-select']
	Run keyword if   '${item.installationMethod}' == 'Firmware only using HP Smart Update Tools'	wait for element and click	xpath=.//*[@id='cic-profile-edit-firmware-select']
	Run keyword if   '${item.installationMethod}' == 'Firmware only'	wait for element and click	xpath=.//*[@id='cic-profile-edit-firmware-offlinemode-select']
	Run keyword if   '${item.forceInstall}' == 'true'	wait for element and click	xpath=.//*[@id='cic-profile-edit-firmware-force']
	wait for element and click		${FusionServerProfilesPage.ID_BTN_CONFIRM_UPDATE_FIRMWARE}
	wait for element visible		${FusionServerProfilesPage.ID_PAGE_LABEL}

Track Update status
	[Arguments]		${profilename}
	Fusion UI Navigate to server profiles page
	Fusion Ui select server profiles	${profilename}
	wait for element visible	${progress}	20
	wait for element notvisible	${progress}	1800
	wait for element	${notification}
	${status} =	get text	${notification}
	${status} =	Convert To Lowercase	${status}
	Should contain	${status}	completed
	Log to console	UpdateCompleted

Track Update status1
	[Arguments]		${profilename}
	Fusion UI Navigate to server profiles page
	Fusion Ui select server profiles	${profilename}
	wait for element visible	${firmware_install_status}	
	Wait Until Keyword Succeeds	120 min	1 min	Firmware Install status

Firmware Install status
	${status} =	get text	${firmware_install_status}
	${status} =	Convert To Lowercase	${status}
	Should contain	${status}	installed
