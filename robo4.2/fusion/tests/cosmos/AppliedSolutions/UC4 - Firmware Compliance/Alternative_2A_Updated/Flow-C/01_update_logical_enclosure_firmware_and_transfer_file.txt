*** Settings ***
Documentation	Transfer file between servers while upgrading logical enclosure firmware
Resource		../resource.txt
Test Setup		Load Test Data and Open Browser
Test Teardown	Logout and close all browsers
Library			OperatingSystem
Variables		../../../../../../FusionLibrary/ui/servers/logicalenclosures_elements.py


*** Test Cases ***
Update Logical Enclosure Firmware for Enclosure1
	Log into Fusion appliance as Administrator
	${blnupdatefirmware} =	Fusion UI Update Logical Enclosure Firmware		@{TestData.update_le_firmware4}
	Run Keyword If		'${blnupdatefirmware}' == '${blnExpected}'		Log		Update firmware is successfully completed.
	Run Keyword Unless		'${blnupdatefirmware}' == '${blnExpected}'	Fail	Update Firmware got failed.

Update Logical Enclosure Firmware for Enclosure2
	Log into Fusion appliance as Administrator
	Fusion ui navigate to logical enclosure page
	${select_le} =	Get UI Object	${FusionLogicalEnclosuresPage.ID_LE_NAME}	${TestData.update_le_firmware3[0].enclosurename}
	wait for element and click	${select_le}
	wait for element and click	${FusionLogicalEnclosuresPage.ID_MENU_ACTION_MAIN_BTN}
	wait for element and click	${FusionLogicalEnclosuresPage.ID_MENU_ACTION_UPDATE_FIRMWARE}
	wait for element visible	${FusionLogicalEnclosuresPage.ID_UPDATE_FIRMWARE}
	wait for element and click	${FusionLogicalEnclosuresPage.ID_FIRMWARE_BASELINE}
	${select_firmware} =	Get UI Object	${FusionLogicalEnclosuresPage.ID_SELECT_FIRMWARE_BASELINE}	${TestData.update_le_firmware3[0].firmware}
	wait for element visible	${select_firmware}	15
	wait for element and click	${select_firmware}
	wait for element and click	${FusionLogicalEnclosuresPage.ID_UPDATE_FIRMWARE_FOR}
	${select_update_for} =	Get UI Object	${FusionLogicalEnclosuresPage.ID_SELECT_UPDATE_FIRMWARE_FOR}	${TestData.update_le_firmware3[0].updatefor}
	wait for element visible	${select_update_for}	15
	wait for element and click	${select_update_for}	15
	wait for element and click	${FusionLogicalEnclosuresPage.ID_UPDATE_FIRMWARE_OK_BUTTON}
	Copy files to VM
	wait for element visible	${FusionLogicalEnclosuresPage.ID_UPDATE_FIRMWARE_STATUS}	1200
	${action_status} =	Get Text	${FusionLogicalEnclosuresPage.ID_STATUS_BAR}
	${action_status} =	Convert To Lowercase	${action_status}
	Log to console	${action_status}
	Should Contain	${action_status}	completed


*** keywords ***
Copy files to VM
	Run		powershell Enable-PSRemoting -Force
	: FOR	${vn}	In	@{TestData.copy_file}
	\	${username} =	set variable	${vn.username}
	\	${password} =	set Variable	${vn.password}
	\	${sourcehost} =	set variable	\\\\${vn.sourcehost}
	\	${targethost} =	set variable	\\\\${vn.targethost}
	\	${filename} =	set variable	${vn.filename}
	\	${Command_etd} =	Set Variable	Set-Item -force wsman:localhost\client\trustedhosts *; Restart-Service WinRM; $net = new-object -ComObject WScript.Network; $net.MapNetworkDrive("'U:'", "'${sourcehost}\\C$\\Users\\Administrator\\Desktop'", $false, "'${username}'", "'${password}'"); $net.MapNetworkDrive("'V:'", "'${targethost}\\C$\\Users\\Administrator\\Desktop'", $false, "'${username}'", "'${password}'"); copy-item -Path U:\\${filename} -destination V:\\${filename}
	\	Run		powershell ${Command_etd}
	\	Run		powershell net use * /del /yes
