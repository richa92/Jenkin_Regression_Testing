*** Settings ***
Library			BuiltIn
Library		        SSHLibrary

*** Keywords ***
# -----------------------------------------------------------------------------
#   FUSION BASH SHELL INTERFACE KEYWORDS
# -----------------------------------------------------------------------------
Login to Fusion via SSH
    [Documentation]             Connect to Fusion VM Bash via SSH
    ...                         Example:\n| Login to Fusion Via SSH | 10.0.12.106 | Administrator | hpvse123 |
    [Arguments]                 ${IP}=${FUSION_IP}      ${USERNAME}=${FUSION_SSH_USERNAME}
    ...                         ${PASSWORD}=${FUSION_SSH_PASSWORD}    ${PROMPT}=${FUSION_PROMPT}
    ...                         ${TIMEOUT}=${FUSION_TIMEOUT}    ${ALIAS}=Fusion_SSH   ${iface}=eth0
    ${sanitizedIP} =   Get Variable Value   ${IP}
    ${sanitizedIP} =   Remove String Using Regexp   ${sanitizedIP}   (\\[|\\])
    Log Many                    ${sanitizedIP}                   ${USERNAME}     ${PASSWORD}     ${PROMPT}   ${TIMEOUT}
    Set Default Configuration   prompt=${PROMPT}        timeout=${TIMEOUT}
    ${llAddr} =   Get Lines Matching Regexp   ${sanitizedIP}   ^fe80:   partial_match=true
    ${Id} =   Run Keyword If   '${llAddr}' == '${EMPTY}'   Open Connection  ${sanitizedIP}   alias=${ALIAS}
    ...       ELSE   Open Connection  ${sanitizedIP}%${iface}   alias=${ALIAS}
    ${Output}=                  Login                   ${USERNAME}     ${PASSWORD}
    [Return]                    ${Id}

Logout of Fusion Via SSH
    [Documentation]     Exits the current Bash SSH session
    ...                 Example:\n| Logout Of Fusion Via SSH |
    Close Connection

Execute SSH Command
    [Documentation]     Executes given command on the Fusion SSH shell
    ...                 Example:\n| Execute CLI Command | show enclosure list |
    [Arguments]         ${Command}      ${PROMPT}=${FUSION PROMPT}   ${iface}=eth0
    #fusion_api_appliance_setup.Log to console and logfile   WARNING: PROMPT argument is deprecated. It is there only to preserve argument compatibility but it is no longer being used.
    fusion_api_appliance_ssh.Login to Fusion via SSH   iface=${iface}
    ${stdout}    ${stderr}    ${rc}=    Execute Command    ${Command}    return_stderr=True    return_rc=True
    fusion_api_appliance_ssh.Logout of Fusion Via SSH
    [Return]            ${stdout}
