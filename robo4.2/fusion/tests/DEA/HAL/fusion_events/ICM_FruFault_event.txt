*** Settings ***
Documentation    Test suite to validate Interconnect Fru related events on OneView and FLM
...    = GENERIC USAGE =
...    | pybot | -v ENC_SERIAL_NO:[enclosure serial #] | -v APPLIANCE_IP:<ipv4> | -v CIM_Linux_IP:<ipv4> |-v GIT_REPO_ROOT: | ICM_Frufault_event.txt |
...    = Variables =
...    | GIT_REPO_ROOT |      Required: Repo root path if NOT defined in environment variable this is mgmtfw root location|
...    | ENC_SERIAL_NO |      Optional: If omitted, will use the 1st enclosure detected in OV |
...    | APPLIANCE_IP |       Required: OneView IPv4 address |
...    | CIM_Linux_IP |       Required:CI Manager ipv4 under test |

Variables         ${GIT_REPO_ROOT}/fusion/tests/DEA/variables/dea_variables.py
Variables         ${GIT_REPO_ROOT}/mgmtfw/tests/thunderbird/variables/tBird_variables.py
Resource          ${GIT_REPO_ROOT}${RESOURCE_ROOT}/resource_all.txt
Resource          ${GIT_REPO_ROOT}${EM_RESOURCE_ROOT}/thunderbird_all.txt
Library           RoboGalaxyLibrary
Library           MgmtFWLibrary
Library           json

Suite Setup       Configure Events Test Environment
Suite Teardown    Run Keywords  Logout of EM RIS   AND    Logout of Fusion Via REST


*** Test Case ***
TC 01: Interconnect Insert/Remove events show up in OV UI
    [Documentation]    This test is to verify events while interconnect removed and inserted
    ...                InterconnectInserted
    ...                InterconnectRemoved
    [Tags]    ICM    Alert    Events    FLM2.00    FLM1.01    OV3.10    Automated
    ${icm_list}=    Get ICM Bay List
    Should Not Be Empty    ${icm_list}    msg=No Interconnect present in the enlcosure
    :FOR    ${bay}   IN   @{icm_list}
    \    Log    message=Removing Interconnect from bay:${bay} and verify resource removed event in diags audit log    console=True
    \    ${last_fusion_event_id}=    get last fusion event ID
    \    RIS EM Efuse On Interconnect    ${bay}
    \    Sleep    10
    \    #Verifying resource removed event in diags audit log with 50 recent entries
    \    ${diags_50}    ${diags_auditlog_file_path}=    Get Diags Audit Log 50 Recent Entries
    \    Set Test Variable    ${EM_Event_Logger}    ${diags_auditlog_file_path}
    \    Verify Audit Log Resource Removed Event    ${ICM_Device}    ${EL_Interconnect_Removed}    ${bay}    90
    \    # Verify Fusion Event including event description and resolution
    \    Verify Fusion Event Sent By EM    ${EL_Interconnect_Removed}    ${last_fusion_event_id}
    \    Log    message=Inserting Interconnect at bay:${bay} and verify resource added event in diags audit log    console=True
    \    RIS EM Efuse Off Interconnect    ${bay}
    \    Sleep   20
    \    #Verifying resource added event in diags audit log with 50 recent entries
    \    ${diags_50}    ${diags_auditlog_file_path}=    Get Diags Audit Log 50 Recent Entries
    \    Set Test Variable    ${EM_Event_Logger}    ${diags_auditlog_file_path}
    \    Verify Audit Log Resource Added Event    ${ICM_Device}    ${EL_Interconnect_Inserted}    ${bay}    250
    \    Verify Fusion Event Sent By EM    ${EL_Interconnect_Inserted}    ${last_fusion_event_id}
    \    Validate Interconnect Availability in Fusion    ${bay}
    [Teardown]    Run Keyword If Test Failed    Run Keywords    RIS EM Efuse Off Interconnect    ${bay}    AND   Validate Interconnect Availability in Fusion    ${bay}

TC 02: Manufactured for Invalid/Power Denied Due to FRU event
    [Documentation]    This test is to verify  Manufactured for Invalid/Power Denied event for Interconnect Using Flashing up FRU
    ...                InterconnectFruManufacturedForInvalidFault
    ...                InterconnectPowerDeniedDueToFru    
    [Tags]    ICM    Alert    Events    FLM2.00    FLM1.01    OV3.10    Automated
    ${occupied_icm_list}=    Get List of Occupied Interconnect Bays
    Should Not Be Empty    ${occupied_icm_list}    msg=No Interconnects present in the enclosure
    : FOR    ${bay}    IN    @{occupied_icm_list}
    \    ${last_fusion_event_id}=    get last fusion event ID
    \    #Flash InCompatible Fru
    \    ${icm_type}=    Get ICM Type By ModelNo    ${bay}    
    \    Run Keyword If    '${icm_type}' == 'Chloride10'    Flash Interconnect Fru    ${bay}    ${GIT_REPO_ROOT}${TESTDATA_ROOT}\\${Customized_FRU_Path}\\${chloride10fru_foo}
    \    ...   ELSE IF    '${icm_type}' == 'Chloride20'    Flash Interconnect Fru    ${bay}    ${GIT_REPO_ROOT}${TESTDATA_ROOT}\\${Customized_FRU_Path}\\${chloride20fru_foo}
    \    ...   ELSE IF    '${icm_type}' == 'Chloride40'    Flash Interconnect Fru    ${bay}    ${GIT_REPO_ROOT}${TESTDATA_ROOT}\\${Customized_FRU_Path}\\${chloride40fru_foo}
    \    ...   ELSE IF    '${icm_type}' == 'Potassium'    Flash Interconnect Fru    ${bay}    ${GIT_REPO_ROOT}${TESTDATA_ROOT}\\${Customized_FRU_Path}\\${potassiumfru_foo}
    \    ...   ELSE IF    '${icm_type}' == 'Potash'    Flash Interconnect Fru    ${bay}    ${GIT_REPO_ROOT}${TESTDATA_ROOT}\\${Customized_FRU_Path}\\${potashfru_foo}
    \    ...   ELSE IF    '${icm_type}' == 'Natasha'    Flash Interconnect Fru    ${bay}    ${GIT_REPO_ROOT}${TESTDATA_ROOT}\\${Customized_FRU_Path}\\${natashafru_foo}
    \    ...   ELSE IF    '${icm_type}' == 'Sylvite'    Flash Interconnect Fru    ${bay}    ${GIT_REPO_ROOT}${TESTDATA_ROOT}\\${Customized_FRU_Path}\\${sylvitefru_foo}
    \    ...   ELSE IF    '${icm_type}' == 'Carbon'    Flash Interconnect Fru    ${bay}    ${GIT_REPO_ROOT}${TESTDATA_ROOT}\\${Customized_FRU_Path}\\${carbonfru_foo}
    \    ...   ELSE    Log To Console    'Flashing not supported for Device'
    \    RIS EM Efuse Interconnect    ${bay}    10
    \    ${status}=    Wait for Device Critical    ${ICM_Device}    ${bay}
    \    Should Be True      ${status}   ${ICM_Device} Critical Status not detected
    \    ${diags_50}    ${diags_auditlog_file_path}=    Get Diags Audit Log 50 Recent Entries
    \    Set Test Variable    ${EM_Event_Logger}    ${diags_auditlog_file_path}
    \    Verify Audit Log Status Change MessageID Event    ${EL_ICM_Critical}    ${ICM_Device}    ${bay}    250
    \    Verify Audit Log Alert Event    ${EL_ICM_FruManufacturedForInvalidFault}    ${ICM_Device}    ${bay}    250
    \    Verify Audit Log Alert Event    ${EL_ICM_PowerDeniedDueToFru}    ${ICM_Device}    ${bay}    250
    \    Sleep    360
    \    Verify Fusion Event Sent By EM    ${EL_ICM_FruManufacturedForInvalidFault}    ${last_fusion_event_id}
    \    Verify Fusion Event Sent By EM    ${EL_ICM_PowerDeniedDueToFru}    ${last_fusion_event_id}
    \    Flash Interconnect Fru    ${bay}    ${GIT_REPO_ROOT}${TESTDATA_ROOT}\\Fru_Files\\${CAT}\\Good_Fru\\INTERCONNECT\\${bay}\\fru.bin
    \    RIS EM Efuse On Interconnect    ${bay}
    \    Sleep    10
    \    RIS EM Efuse Off Interconnect    ${bay}
    \    Validate Interconnect Availability in Fusion    ${bay}
    [Teardown]    Run Keyword If Test Failed    Run Keywords    Flash Interconnect Fru    ${bay}    ${GIT_REPO_ROOT}${TESTDATA_ROOT}\\Fru_Files\\${CAT}\\Good_Fru\\INTERCONNECT\\${bay}\\fru.bin
    ...    AND   RIS EM Efuse On Interconnect    ${bay}   AND     RIS EM Efuse Off Interconnect    ${bay}   AND   Validate Interconnect Availability in Fusion    ${bay}

 TC 03: Manufactured for Mismatach/Power Denied Due to FRU event
    [Documentation]    This test is to verify  Manufactured for Mismatch/Power Denied event for Interconnect Using Flashing up FRU
    ...                InterconnectFruManufacturedForMismatchFault
    ...                InterconnectPowerDeniedDueToFru
    [Tags]    ICM    Alert    Events    FLM2.00    FLM1.01    OV3.10    Automated
    ${occupied_icm_list}=    Get List of Occupied Interconnect Bays
    Should Not Be Empty    ${occupied_icm_list}    msg=No Interconnects present in the enclosure
    : FOR    ${bay}    IN    @{occupied_icm_list}
    \    ${last_fusion_event_id}=    get last fusion event ID
    \    #Flash InCompatible Fru
    \    ${icm_type}=    Get ICM Type By ModelNo    ${bay}    
    \    Run Keyword If    '${icm_type}' == 'Chloride10'    Flash Interconnect Fru    ${bay}    ${GIT_REPO_ROOT}${TESTDATA_ROOT}\\${Customized_FRU_Path}\\${chloride10fru_nec}
    \    ...   ELSE IF    '${icm_type}' == 'Chloride20'    Flash Interconnect Fru    ${bay}    ${GIT_REPO_ROOT}${TESTDATA_ROOT}\\${Customized_FRU_Path}\\${chloride20fru_nec}
    \    ...   ELSE IF    '${icm_type}' == 'Chloride40'    Flash Interconnect Fru    ${bay}    ${GIT_REPO_ROOT}${TESTDATA_ROOT}\\${Customized_FRU_Path}\\${chloride40fru_nec}
    \    ...   ELSE IF    '${icm_type}' == 'Potassium'    Flash Interconnect Fru    ${bay}    ${GIT_REPO_ROOT}${TESTDATA_ROOT}\\${Customized_FRU_Path}\\${potassiumfru_nec}
    \    ...   ELSE IF    '${icm_type}' == 'Potash'    Flash Interconnect Fru    ${bay}    ${GIT_REPO_ROOT}${TESTDATA_ROOT}\\${Customized_FRU_Path}\\${potashfru_nec}
    \    ...   ELSE IF    '${icm_type}' == 'Natasha'    Flash Interconnect Fru    ${bay}    ${GIT_REPO_ROOT}${TESTDATA_ROOT}\\${Customized_FRU_Path}\\${natashafru_nec}
    \    ...   ELSE IF    '${icm_type}' == 'Sylvite'    Flash Interconnect Fru    ${bay}    ${GIT_REPO_ROOT}${TESTDATA_ROOT}\\${Customized_FRU_Path}\\${sylvitefru_nec}
    \    ...   ELSE IF    '${icm_type}' == 'Carbon'    Flash Interconnect Fru    ${bay}    ${GIT_REPO_ROOT}${TESTDATA_ROOT}\\${Customized_FRU_Path}\\${carbonfru_nec}
    \    ...   ELSE    Log To Console    'Flashing not supported for Device'
    \    RIS EM Efuse Interconnect    ${bay}    10
    \    ${status}=    Wait for Device Critical    ${ICM_Device}    ${bay}
    \    Should Be True      ${status}   ${ICM_Device} Critical Status not detected
    \    ${diags_50}    ${diags_auditlog_file_path}=    Get Diags Audit Log 50 Recent Entries
    \    Set Test Variable    ${EM_Event_Logger}    ${diags_auditlog_file_path}
    \    Verify Audit Log Status Change MessageID Event    ${EL_ICM_Critical}    ${ICM_Device}    ${bay}    250
    \    Verify Audit Log Alert Event    ${EL_ICM_FruManufacturedForMismatchFault}    ${ICM_Device}    ${bay}    250
    \    Verify Audit Log Alert Event    ${EL_ICM_PowerDeniedDueToFru}    ${ICM_Device}    ${bay}    250
    \    Sleep    360
    \    Verify Fusion Event Sent By EM    ${EL_ICM_FruManufacturedForMismatchFault}    ${last_fusion_event_id}
    \    Verify Fusion Event Sent By EM    ${EL_ICM_PowerDeniedDueToFru}    ${last_fusion_event_id}
    \    Flash Interconnect Fru    ${bay}    ${GIT_REPO_ROOT}${TESTDATA_ROOT}\\Fru_Files\\${CAT}\\Good_Fru\\INTERCONNECT\\${bay}\\fru.bin
    \    RIS EM Efuse On Interconnect    ${bay}
    \    Sleep    10
    \    RIS EM Efuse Off Interconnect    ${bay}
    \    Validate Interconnect Availability in Fusion    ${bay}
    [Teardown]    Run Keyword If Test Failed    Run Keywords    Flash Interconnect Fru    ${bay}    ${GIT_REPO_ROOT}${TESTDATA_ROOT}\\Fru_Files\\${CAT}\\Good_Fru\\INTERCONNECT\\${bay}\\fru.bin
    ...    AND   RIS EM Efuse On Interconnect    ${bay}   AND     RIS EM Efuse Off Interconnect    ${bay}   AND   Validate Interconnect Availability in Fusion    ${bay}

TC 04: Interconnect FruContent Events
    [Documentation]    This test is to verify  Frucontenterror event for Interconnect Using Flashing up FRU
    ...                InterconnectFruContentFault
    ...                InterconnectPowerDeniedDueToFru
    [Tags]    ICM    Alert    Events    FLM2.00    FLM1.01    OV3.10    Automated
    ${icm_list}=    Get ICM Bay List
    Should Not Be Empty    ${icm_list}    msg=No Interconnect present in the enlcosure
    :FOR    ${bay}   IN   @{icm_list}
    \    ${last_fusion_event_id}=    get last fusion event ID
    \    #Flash InCompatible Fru
    \    ${icm_type}=    Get ICM Type By ModelNo    ${bay}    
    \    Run Keyword If    '${icm_type}' == 'Chloride10'    Flash Interconnect Fru    ${bay}    ${GIT_REPO_ROOT}${TESTDATA_ROOT}\\${Customized_FRU_Path}\\${chloride10fru_contenterror}
    \    ...   ELSE IF    '${icm_type}' == 'Chloride20'    Flash Interconnect Fru    ${bay}    ${GIT_REPO_ROOT}${TESTDATA_ROOT}\\${Customized_FRU_Path}\\${chloride20fru_contenterror}
    \    ...   ELSE IF    '${icm_type}' == 'Chloride40'    Flash Interconnect Fru    ${bay}    ${GIT_REPO_ROOT}${TESTDATA_ROOT}\\${Customized_FRU_Path}\\${chloride40fru_contenterror}
    \    ...   ELSE IF    '${icm_type}' == 'Potassium'    Flash Interconnect Fru    ${bay}    ${GIT_REPO_ROOT}${TESTDATA_ROOT}\\${Customized_FRU_Path}\\${potassiumfru_contenterror}
    \    ...   ELSE IF    '${icm_type}' == 'Potash'    Flash Interconnect Fru    ${bay}    ${GIT_REPO_ROOT}${TESTDATA_ROOT}\\${Customized_FRU_Path}\\${potashfru_contenterror}
    \    ...   ELSE IF    '${icm_type}' == 'Natasha'    Flash Interconnect Fru    ${bay}    ${GIT_REPO_ROOT}${TESTDATA_ROOT}\\${Customized_FRU_Path}\\${natashafru_contenterror}
    \    ...   ELSE IF    '${icm_type}' == 'Sylvite'    Flash Interconnect Fru    ${bay}    ${GIT_REPO_ROOT}${TESTDATA_ROOT}\\${Customized_FRU_Path}\\${sylvitefru_contenterror}
    \    ...   ELSE IF    '${icm_type}' == 'Carbon'    Flash Interconnect Fru    ${bay}    ${GIT_REPO_ROOT}${TESTDATA_ROOT}\\${Customized_FRU_Path}\\${carbonfru_contenterror}
    \    ...   ELSE    Log To Console    'Flashing not supported for Device'
    \    RIS EM Efuse Interconnect    ${bay}    10
    \    ${status}=    Wait for Device Critical    ${ICM_Device}    ${bay}
    \    Should Be True      ${status}   ${ICM_Device} Critical Status not detected
    \    #sleep    200
    \    #Verifying alert event in diags audit log with 50 recent entries
    \    ${diags_50}    ${diags_auditlog_file_path}=    Get Diags Audit Log 50 Recent Entries
    \    Set Test Variable    ${EM_Event_Logger}    ${diags_auditlog_file_path}
    \    Verify Audit Log Status Change MessageID Event    ${EL_ICM_Critical}    ${ICM_Device}    ${bay}    250
    \    Verify Audit Log Alert Event    ${EL_ICM_FruContentFault}    ${ICM_Device}    ${bay}    250
    \    Verify Audit Log Alert Event    ${EL_ICM_PowerDeniedDueToFru}    ${ICM_Device}    ${bay}    250
    \    Sleep    240
    \    Verify Fusion Event Sent By EM    ${EL_ICM_FruContentFault}    ${last_fusion_event_id}
    \    Verify Fusion Event Sent By EM    ${EL_ICM_PowerDeniedDueToFru}    ${last_fusion_event_id}
    \    Flash Interconnect Fru    ${bay}    ${GIT_REPO_ROOT}${TESTDATA_ROOT}\\Fru_Files\\${CAT}\\Good_Fru\\INTERCONNECT\\${bay}\\fru.bin
    \    RIS EM Efuse On Interconnect    ${bay}
    \    Sleep    10
    \    RIS EM Efuse Off Interconnect    ${bay}
    \    Validate Interconnect Availability in Fusion    ${bay}
    [Teardown]    Run Keyword If Test Failed    Run Keywords    Flash Interconnect Fru    ${bay}    ${GIT_REPO_ROOT}${TESTDATA_ROOT}\\Fru_Files\\${CAT}\\Good_Fru\\INTERCONNECT\\${bay}\\fru.bin
    ...    AND   RIS EM Efuse On Interconnect    ${bay}   AND     RIS EM Efuse Off Interconnect    ${bay}   AND   Validate Interconnect Availability in Fusion    ${bay}               

TC 05: InterconnectPowerDeniedDueToMidplane events
    [Documentation]    This test will verify the InterconnectPowerDeniedDueToMidplane events
    ...                InterconnectPowerDeniedDueToMidplane
    ...                InterconnectPowerDeniedCleared
    [Tags]    ICM    Alert    Events    FLM2.00    FLM1.01    OV3.10    Automated
    ${present_list}=    Get List of Occupied Interconnect Bays
    Should Not Be Empty    ${present_list}    msg=No Interconnect present in the enclosure  
    : FOR    ${bay}    IN    @{present_list}
    \    ${last_fusion_event_id}=    get last fusion event ID
    \    Set EM RIS Faults    FruFaultInjection   Midplane    True
    \    Sleep    100
    \    ${diags_50}    ${diags_auditlog_file_path}=    Get Diags Audit Log 50 Recent Entries
    \    Set Test Variable    ${EM_Event_Logger}    ${diags_auditlog_file_path}
    \    Verify Audit Log Resource Updated Event    ${ICM_Device}    ${EL_Interconnect_DiscoveryComplete}    ${bay}    250
    \    ${fusion_event}=    Verify Fusion Event Sent By EM without desc   ${EL_Interconnect_DiscoveryComplete}    ${last_fusion_event_id}
    \    ${fusion_event_desc}=    Get Description From Fusion Event    ${fusion_event}
    \    Should Be Equal As Strings    ${fusion_event_desc}    Interconnect discovery is complete
    \    ${last_fusion_event_id}=    get last fusion event ID
    \    ${powerstate_status}=    Set Interconnect Powerstate    ${bay}    Off
    \    Sleep    10
    \    ${powerstate_status}=    Set Interconnect Powerstate    ${bay}    On
    \    Sleep    10
    \    ${diags_50}    ${diags_auditlog_file_path}=    Get Diags Audit Log 50 Recent Entries
    \    Set Test Variable    ${EM_Event_Logger}    ${diags_auditlog_file_path}
    \    Verify Audit Log Alert Event    ${EL_ICM_PowerDeniedDueToMidplane}    ${ICM_Device}    ${bay}    250
    \    Sleep    120
    \    Verify Fusion Event Sent By EM    ${EL_ICM_PowerDeniedDueToMidplane}    ${last_fusion_event_id}
    \    ${last_fusion_event_id}=    get last fusion event ID
    \    Sleep    100
    \    Set EM RIS Faults    FruFaultInjection   Midplane    False
    \    Sleep    100
    \    ${diags_50}    ${diags_auditlog_file_path}=    Get Diags Audit Log 50 Recent Entries
    \    Set Test Variable    ${EM_Event_Logger}    ${diags_auditlog_file_path}
    \    Verify Audit Log Resource Updated Event    ${ICM_Device}    ${EL_Interconnect_DiscoveryComplete}    ${bay}    250
    \    ${fusion_event}=    Verify Fusion Event Sent By EM without desc   ${EL_Interconnect_DiscoveryComplete}    ${last_fusion_event_id}
    \    ${fusion_event_desc}=    Get Description From Fusion Event    ${fusion_event}
    \    Should Be Equal As Strings    ${fusion_event_desc}    Interconnect discovery is complete
    \    ${powerstate_status}=    Set Interconnect Powerstate    ${bay}    On
    \    Sleep    10
    [Teardown]    Run Keyword If Test Failed    Run Keywords    Set EM RIS Faults    FruFaultInjection   Midplane    False     AND   sleep   30
    ...    AND    Set Interconnect Powerstate    ${bay}    On   AND   Sleep   10
    
TC 06: Interconnect thermalcritical/ok events
    [Documentation]    This test is to verify  thermalcritical/ok for Interconnect Using Flashing up FRU
    ...                InterconnectThermalCritical
    ...                InterconnectThermalOk
    [Tags]    ICM    Alert    Events    FLM2.00    FLM1.01    OV3.10    Automated
    ${occupied_icm_list}=    Get List of Occupied Chloride Bays
    Should Not Be Empty    ${occupied_icm_list}    msg=No Chloride present in the enclosure
    : FOR    ${bay}    IN    @{occupied_icm_list}
    \    ${last_fusion_event_id}=    get last fusion event ID
    \    Flash Interconnect Fru    ${bay}    ${GIT_REPO_ROOT}${TESTDATA_ROOT}\\${Customized_FRU_Path}\\${Custom_Chloride_Critical_Fru_Path}
    \    RIS EM Efuse Interconnect    ${bay}    10
    \    ${status}=    Wait for Device Critical    ${ICM_Device}    ${bay}
    \    Should Be True      ${status}   ${ICM_Device} Critical Status not detected
    \    sleep    100
    \    ${diags_50}    ${diags_auditlog_file_path}=    Get Diags Audit Log 50 Recent Entries
    \    Set Test Variable    ${EM_Event_Logger}    ${diags_auditlog_file_path}
    \    Verify Audit Log Status Change MessageID Event    ${EL_ICM_Critical}    ${ICM_Device}    ${bay}    250
    \    Verify Audit Log Alert Event    ${EL_ICM_Thermal_Critical}    ${ICM_Device}    ${bay}    250
    \    Verify Fusion Event Sent By EM    ${EL_ICM_Thermal_Critical}    ${last_fusion_event_id}
    \    ${last_fusion_event_id}=    get last fusion event ID
    \    Flash Good Fru For ICM Device    ${bay}
    \    RIS EM Efuse On Interconnect    ${bay}
    \    Sleep    10
    \    RIS EM Efuse Off Interconnect    ${bay}
    \    sleep    100
    \    Validate Interconnect Availability in Fusion    ${bay}
    \    ${diags_50}    ${diags_auditlog_file_path}=    Get Diags Audit Log 50 Recent Entries
    \    Set Test Variable    ${EM_Event_Logger}    ${diags_auditlog_file_path}
    \    Verify Audit Log Status Change MessageID Event    ${EL_ICM_OK}    ${ICM_Device}    ${bay}    250
    [Teardown]    Run Keyword If Test Failed    Run Keywords    Flash Good Fru For ICM Device    ${bay}    AND   RIS EM Efuse On Interconnect    ${bay}   AND
    ...     RIS EM Efuse Off Interconnect    ${bay}   AND   Validate Interconnect Availability in Fusion    ${bay}

TC 07: Interconnect FruFaultInjection Events show up in OV UI
    [Documentation]    This test is to verify events for Interconnect status change using FruFaultInjection
    ...                InterconnectFruFault
    [Tags]    ICM    Alert    Events    FLM2.00    OV3.10    Automated
    ${icm_list}=    Get ICM Bay List
    Should Not Be Empty    ${icm_list}    msg=No Interconnect present in the enlcosure
    :FOR    ${bay}   IN   @{icm_list}
    \    Log    message=Failing the Interconnect for bay:${bay} and verify failed status/alert event in diags audit log    console=True
    \    ${last_fusion_event_id}=    get last fusion event ID
    \    ${Interconnect_Fault_Status}=    Set EM RIS Faults    FruFaultInjection    ${ICM_Device}    true
    \    Should Be Equal As Strings    ${Interconnect_Fault_Status}    <Response [200]>
    \    RIS EM Efuse On Interconnect    ${bay}
    \    Sleep    8
    \    RIS EM Efuse Off Interconnect without Healthcheck      ${bay}
    \    Wait for Device Critical    ${ICM_Device}    ${bay}
    \    #Verifying alert event in diags audit log with 50 recent entries
    \    ${diags_50}    ${diags_auditlog_file_path}=    Get Diags Audit Log 50 Recent Entries
    \    Set Test Variable    ${EM_Event_Logger}    ${diags_auditlog_file_path}
    \    Verify Audit Log Alert Event    ${EL_ICM_FruFault}    ${ICM_Device}    ${bay}    450
    \    Sleep    300
    \    Verify Fusion Event Sent By EM    ${EL_ICM_FruFault}    ${last_fusion_event_id}
    \    ${Interconnect_Fault_Status}=    Set EM RIS Faults    FruFaultInjection    ${ICM_Device}    false
    \    Should Be Equal As Strings    ${Interconnect_Fault_Status}    <Response [200]>
    \    RIS EM Efuse On Interconnect    ${bay}
    \    Sleep    8
    \    RIS EM Efuse Off Interconnect    ${bay}
    \    Validate Interconnect Availability in Fusion    ${bay}
    [Teardown]    Run Keyword If Test Failed    Run Keywords    Set EM RIS Faults    FruFaultInjection    ${ICM_Device}   false   AND
    ...    EM Clear Interconnect Status    ${bay}   AND    Validate Interconnect Availability in Fusion    ${bay}                       