*** Settings ***
Documentation     iLO CLI keywords 
...               = Usage =
...               | Library | ../resources/ilo_cli.txt |
Library           Collections
Library           String
Library           SSHLibrary
Library           RoboGalaxyLibrary            # DVTs Robot Framework extensions
Library           FusionLibrary                # DVTs Robot Framework extensions


*** Variables ***

*** Keywords ***
Login to Server iLO Via SSH
    [Documentation]    Connect to Server (defaults to iLO) via SSH
    ...    Example:\n| Login to Server ILO Via SSH | 10.0.12.106 | Administrator | hpvse123 |
    [Arguments]    ${IP}=${ILO_IP}
    ...            ${USERNAME}=${ILO_USERNAME}    
    ...            ${PASSWORD}=${ILO_PASSWORD}
    ...            ${PROMPT}=${ILO_PROMPT}
    ...            ${TIMEOUT}=${ILO_TIMEOUT}
    Log Many    ${IP}    ${USERNAME}    ${PASSWORD}    ${PROMPT}    ${TIMEOUT}
    Set Default Configuration    prompt=${PROMPT}    timeout=${TIMEOUT}
    ${Id}=    Open Connection    ${IP}
    ${Output}=    Login    ${USERNAME}    ${PASSWORD}
    Log    ${Output}
    [Return]    ${Id}

Logout of Server iLO Via SSH
    [Documentation]    Exits the current SSH session
    ...    Example:\n| Logout Of Server Via SSH |
    #Write    Exit
    Close Connection

Execute iLO command
    [Documentation]    Return a buffer containing (raw) output from an iLO SMASH command.
    [Arguments]    ${Command}
    Write    ${Command}
    ${Output}=    Read Until Prompt
    # Check command status
    ${Match}    Should Match Regexp    ${Output}    status=0
    [Return]    ${Output}

Get ILO Version Information
    [Documentation]    Return a buffer containing (raw) output from a 'show /system1/firmware' command.
    ${Output}=    Execute iLO Command    show /system1/firmware1
    # Extract version string
    ${Match}    ${Version}    Should Match Regexp    ${Output}    version=(.*)\\r
    ${Match}    ${Date}    Should Match Regexp    ${Output}    date=(.*)\\r
    [Return]    ${Version}    ${Date}
