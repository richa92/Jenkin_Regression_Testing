*** Settings ***
Documentation     Generic keywords used in multiple Enclosure UI tests
...    = USAGE =
...    | Resource | ../resources/enclosure_generic_ui_keywords.txt |

Library     OperatingSystem
Library     RoboGalaxyLibrary
Library     FusionLibrary
Library     json
Library     String
Resource    ../resources/fusion_api.txt
Resource    ../resources/defaults.txt

*** Variables ***


*** Keywords ***

Actions Menu Items Are Present
    [Documentation]    Validates that all of the items in the top right "Actions" menu are present,
    [Documentation]    and that no extras are showing.
    ${Actions Menu}    Set Variable    //div[@id="cic-enclosure-actions"]
    Focus    xpath=${Actions Menu}
    Click Element    xpath=${Actions Menu}
    Wait Until Element Is Visible    xpath=${Actions Menu}//a[@id="cic-enclosure-edit-action"]
    # If the enclosure is Monitored, the menu item "Reapply configuration" should be available
    ${Is Monitored}    Get From Dictionary    ${Enc Object}    state
    ${Is Monitored}    Convert To Lowercase    ${Is Monitored}
    ${Action Size}    Set Variable If    '${Is Monitored}' == 'monitored'    ${3}    ${3}

    # Make sure only the expected menu options are present
    # MRB - Joseph says this check seems unnecessary
    #Run Keyword And Continue On Failure
    #...    Xpath Should Match X Times    ${Actions Menu}/div/ol/li    ${Action Size}
    #...    msg=Violation of Piano UI spec F56 020: There should only be ${Action Size} items in the "Actions" list: Edit, Reapply, Refresh, and (only for a monitored enclosure) Reapply configuration.

    # Now test for the presence of all expected menu options
    Run Keyword And Continue On Failure
    ...    Element Should Be Visible    xpath=${Actions Menu}//li[@id="cic-enclosure-edit-action-element"]
    ...    msg=QXCR1001392311, AM55: "Edit [Enclosure]" did not appear in the Actions menu
    Run Keyword If    '${Is Monitored}' == 'monitored'
    ...    Run Keyword And Continue On Failure
    ...    Element Should Be Visible    xpath=${Actions Menu}//a[@id="cic-enclosure-reconfigure-action"]
    ...    msg=QXCR1001392311, AM55: "Reapply configuration" did not appear in the Actions menu
    Run Keyword And Continue On Failure
    ...    Element Should Be Visible    xpath=${Actions Menu}//a[@id="cic-enclosure-refresh-action"]
    ...    msg="Refresh" did not appear in the Actions menu

    # MRB - Remove is no longer an option
    #Run Keyword And Continue On Failure
    #...    Element Should Be Visible    xpath=${Actions Menu}//a[contains(text(),"Remove")]
    #...    msg="Remove [Enclosure]" did not appear in the Actions menu
    # MRB - Add is no longer an option
    #Run Keyword And Continue On Failure
    #...    Element Should Not Be Visible    xpath=${Actions Menu}//a[contains(text(),"Add")]
    #...    msg="Add [Enclosure]" should not appear in the Actions menu
    # Make the menu go away
    Click Element    id=cic-enclosure-actions

Edit Enclosure General Settings Allows Changing Correct Properties
    [Documentation]    Calls the "Edit Enclosure" panel to make sure only the correct
    [Documentation]    settings can be changed.
    [Documentation]    ${Edit Enclosure Button} - a resource path (e.g. XPath) to the Edit Enclosure button
    [Arguments]    ${Edit Enclosure Button}
    Focus    ${Edit Enclosure Button}
    ${Status}    ${Message}    Run Keyword And Ignore Error
    ...    Click Element    ${Edit Enclosure Button}
    Run Keyword Unless    '${Status}' == 'PASS'
    ...    Fail    msg=QXCR1001392311, AM55: The "Edit" link next to the General label did not appear or does not exist.
    Wait Until Element Is Visible    id=cic-enclosure-edit-panels
    Sleep    1
    
    # Make sure only the Enclosure Name setting is available
    Run Keyword And Continue On Failure
    ...    Xpath Should Match X Times    //ol[@id="cic-enclosure-edit-panels"]/li[1]/fieldset/ol/li    1
    ...    msg=There should be only one option in General Edit: Enclosure Name.
    Run Keyword And Continue On Failure
    ...    Element Should Not Be Visible    xpath=//ol[@id="cic-enclosure-edit-panels"]//li[2]/fieldset/ol/li
    ...    msg=More things than necessary are appearing on the General Edit page.

    # MRB - there isn't any more hardware name on the edit page
    ## Test Presence
    #Run Keyword And Continue On Failure
    #...    Element Should Be Visible    xpath=//ol[@id="cic-enclosure-edit-panels"]//input[@id="cic-enclosure-name"]
    #...    msg="Enclosure name" field should exist in the "General" Edit page
    #
    ## Test Contents
    #${Edit Enc Name}    Get Value    id=cic-enclosure-name
    #${Serial_Number}    Get From Dictionary    ${Enc Object}    serialNumber
    #Run Keyword And Continue On Failure
    #...    Should Be Equal As Strings    ${Edit Enc Name}    ${Serial_Number}
    #...    msg=Enclosure name in the "General" Edit page should be "${Serial_Number}"
    # Click "Cancel"
    Sleep    1
    Click Element    id=cic-enclosure-edit-cancel

Test General Fields
    [Documentation]    Tests the fields in the "General" section of the Enclosure page
    [Documentation]    for presence, adherence to spec, & content.
    [Documentation]    Arguments:
    [Documentation]    ${Section} - part of the DOM ID for each field; either "more" or "details" depending on page
    [Arguments]    ${Section}
    # If '${Section}' == 'details', use the 1st XPath; otherwise use the second one
    ${General Xpath}    Set Variable If    '${Section}' == 'details'
    ...    //div[2]/form/fieldset/ol
    ...    //li[@id="cic-enclosure-more-general"]/form/div/fieldset/ol
    Wait Until Element Is Visible    xpath=${General Xpath}

    ## Four fields are present, but the "Server licensing policy" line is hidden in the Tbird UI.
    #Run Keyword And Continue On Failure
    #...    Xpath Should Match X Times    ${General Xpath}/li    4
    #...    msg=There should be 3 items in General, including: State, Model, Logical Enclosure.

    # Test Presence
    Run Keyword And Continue On Failure
    ...    Element Should Be Visible    xpath=${General Xpath}//div[@id="cic-enclosure-${Section}-state"]
    ...    msg="State" field should exist in the "General" section
    Run Keyword And Continue On Failure
    ...    Element Should Be Visible    xpath=${General Xpath}//div[@id="cic-enclosure-${Section}-model"]
    ...    msg="Model" field should exist in the "General" section
    Run Keyword And Continue On Failure
    ...    Element Should Be Visible    xpath=${General Xpath}//div[@id="cic-enclosure-${Section}-logical-enclosure"]
    ...    msg="Logical enclosure" field should exist in the "General" section
    Run Keyword And Continue On Failure
    ...    Element Should Not Be Visible    xpath=${General Xpath}/li[6]
    ...    msg=Licensing policy should not be visible

    # Test Contents
    #Run Keyword And Continue On Failure
    #...    Element Text Should Be    id=cic-enclosure-more-state    Monitored
    #...    msg=Enclosure "State" in the "General" section should be "Monitored"

    Run Keyword And Continue On Failure
    ...    Element Text Should Be    xpath=${General Xpath}//div[@id="cic-enclosure-${Section}-state"]    Monitored
    ...    msg=zzzEnclosure "State" in the "General" section should be "Monitored"
    Run Keyword And Continue On Failure
    ...    Element Text Should Be    xpath=${General Xpath}//div[@id="cic-enclosure-${Section}-model"]    Next Generation Modular Infrastructure
    ...    msg=Enclosure "Model" name in the "General" section should be "Next Generation Modular Infrastructure"
    Run Keyword And Continue On Failure
    ...    Element Text Should Be    id=cic-enclosure-${Section}-logical-enclosure    Create logical enclosure
    ...    msg="Logical enclosure" name in the "General" section should be "Create logical enclosure"

