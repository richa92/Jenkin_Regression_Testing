*** Settings ***
Documentation     Get Fusion CI Debug Logs
...    = Usage =
...    | pybot | -L DEBUG | -v ENCLOSURE:<name> | -v FUSION_IP:n.n.n.n | get_debug_log.txt |
...    = Variables =
...    | ENCLOSURE | Required; Enclosure to use |
...    | FUSION IP | Required when enclosure is DCS; IP address of the FusionVM to use |
...    | LOG_DIR | Optional; Where to place logs. Default CWD. |

Library           robot.api.logger
Library           FusionLibrary
Variables         ../resources/variables.py    ${ENCLOSURE}
Resource          ../resources/defaults.txt
Resource          ../resources/fusion_ssh.txt
Suite Setup       Login to Fusion via SSH
Suite Teardown    Logout of Fusion via SSH
Force Tags        DCS  HW

*** Variables ***
${Log_Dir}        ${CURDIR}

*** Test Case ***
Get CI Debug Logs
    Run Keyword And Ignore Error    SSHLibrary.Get File    /ci/logs/ciDebug.*
    ${Count}=    OperatingSystem.Count Files In Directory    path=.    pattern=ciDebug.*
    Run Keyword If    ${Count}==0    Warn    Did not find any ciDebug logs
    Pass Execution If    ${Count}==0    Did not find any ciDebug logs

    @{Files}    OperatingSystem.List Files In Directory    path=.    pattern=ciDebug.*
    Should Not Be Empty    ${Files}
    ...    msg=Did not find any ciDebug logs
    # Prefix files with date/time stamp
    ${yyyy}    ${mmon}    ${dd}    ${hh}    ${mmin}    ${ss}    Get Time    year,month,day,hour,min,sec
    ${Prefix}    Set Variable    ${yyyy}${mmon}${dd}-${hh}${mmin}${ss}-
    : For    ${File}    in    @{Files}
    \    Move File    ${File}    ${Log_Dir}\\${Prefix}${File}
    \    Set Suite Metadata    ciDebug Logs    ${Prefix}${File}    top=True
