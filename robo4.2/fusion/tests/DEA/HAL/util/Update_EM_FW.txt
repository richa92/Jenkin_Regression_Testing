*** Settings ***
Documentation    This Test will validate EM firmware update process via RIS
...    = USAGE =
...    | pybot | -v EM_IP:<ip> | -v FW_URL:<url> | Update_EM_FW.txt
...    = Variables =
...    | EM_IP | Required: IP address of the Enclosure Manager
...    | FW_URL | Required: URL of firwmare image
Variables        ${MGMTFW_ROOT}/tests/thunderbird/variables/tBird_variables.py
Resource         ${MGMTFW_ROOT}/tests/thunderbird/resources/common_all.txt
Library	         MgmtFWLibrary
Library          Collections
Library          SSHLibrary
Library          Operating System
Resource         ../resources/em_cli.txt
Test Setup       EM API Set Appliance Config    ${EM_IP}    ${true}
Suite TearDown

*** Variables ***

*** Test Cases ***

EM FW Update And Validate Update via RIS
    # Initiate firmware update via RIS here
    ${init_em_update_resp} =   Update EM Firmware    ${FW_URI}
    Dictionary Should Contain Value    ${init_em_update_resp}    ${EM_Accept_Request}
    # Polling the progress status for update completion which is at 100%
    ${update_prog_result} =  EM Fw Update Progress Status
    Should Be True    ${update_prog_result}
    # validate EM update result
    ${em_update_result} =    Get EM Firmware Update Success
    Should Be True    ${em_update_result} == True
    Enable IPv4 on EM  # Disable when Fusion supports IPv6
