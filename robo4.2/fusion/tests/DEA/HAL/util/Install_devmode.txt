*** Settings ***
Documentation     Install Fusion devmode package
...    = USAGE =
...    | pybot | -v BUILD:<BUILD_NO> -v FUSION_IP:<IP> | Install_devmode.txt |
...    = Variables =
...    | BUILD     | Fusion build number 2.00.00-00XXXXX |
...    | FUSION_IP | Fusion IP Address |
...    | REPOS | (optional) Filespec for the zip file.  Defaults to ./repos.tz |

Library           Collections
Library           String
Library           RoboGalaxyLibrary            # DVTs Robot Framework extensions
Library           FusionLibrary                # DVTs Fusion extensions
Resource          ../resources/fusion_cli.txt
Resource          ../resources/defaults.txt

*** Variables ***
${Repos}    repos.tz

*** Keywords ***
# -----------------------------------------------------------------------------
# NONE
# -----------------------------------------------------------------------------

*** Test Cases ***
Install devmode 
    [Tags]    DCS  HW
    [Documentation]    Install the Fusion devmode package
    Login to Fusion via SSH
    Set Client Configuration    timeout=1200

    Put File    ${repos}    /tmp/repos.tz
    ${stdout}    ${stderr}    ${rc}=    Execute Command    /bin/tar xzf /tmp/repos.tz -C /etc   return_stderr=True    return_rc=True
    Log    ${stdout}
    Log    ${stderr}

    ${stdout}    ${stderr}    ${rc}=    Execute Command    /etc/yum.repos.d/install_devmode.sh ${BUILD}   return_stderr=True    return_rc=True
    Should Be Equal As Integers    ${rc}    0
    Log    ${stdout}
    Log    ${stderr}

    # Validate DCS Status
    #${stdout}    ${stderr}    ${rc}=    Execute Command    
    #Log    ${stdout}
    #Log    ${stderr}
    #Should Be Equal As Integers    ${rc}    0
    #Should Match Regexp    ${stdout}    ${TBIRD_SCHEMATIC}

    Logout of Fusion Via SSH

Take VM Snapshot
    [Tags]    DCS  SNAPSHOT
    Connect to VI Server    ${vSphere HostName}     ${vSphere Username}     ${vSphere Password}
    ${VM Name}=    Get VM Name by IP    ${FUSION IP}
    Create VM Snapshot      ${VM Name}      DevMode_Installed
    Disconnect from VI Server
