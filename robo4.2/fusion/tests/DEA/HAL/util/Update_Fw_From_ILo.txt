*** Settings ***
Documentation   This test will update firmware via hpilo (RIBCL)
...             = USAGE =
...             | pybot | -v ENCLOSURE:<enc> | -v FW_URL:<url> | Update_FW_From_ILo.txt |
...             | pybot | -v iLO_IP:<ip> | -v iLO_USERNAME:<user> | -v iLO_PASSWORD:<password> | -v FW_URL:<url> | Update_FW_From_ILo.txt |
...             = Variables =
...             | ENCLOSURE | Optional. Dictionary key from variables.py representing the desired enclosure. |
...             | FW_URL | Required: FW URL for firmware. |
...             | ILO_IP | Optional: IP address of iLO to update. |
...             | ILO_USERNAME | Optional: Username for iLO. |
...             | ILO_PASSWORD | Optional: Password for iLO. |

Variables       ${CURDIR}/../resources/variables.py     ${ENCLOSURE}
Resource        ../resources/system_info.txt
Library         Collections
Library         RoboGalaxyLibrary
Library         String
Force Tags      HW      RIS     FWU


*** Variables ***

*** Test Cases ***
FW Update via hpiLO
    ILO Connect     ${iLO IP}       ${iLO USERNAME}         ${iLO PASSWORD}

    Log     Updating via iLO (${iLO IP}) to ${FW URL}

    # Only returns iLO Version (2.20). No pass build number.
    ${version}=     iLO Get FW Version

    # Perform Update. Ilo is reset at the end of each update.
    ${rc}=              iLO Update Firmware     ${FW URL}
    Should Be True      ${rc}                   msg=Failed to update via iLO.

    # Currently iLO Update Firmware function returns even if update has not completed.
    # Waiting for 3 minutes to allow iLO Update to complete and reset.
    Sleep   60 seconds

    ${version}=     Wait Until Keyword Succeeds     5 minutes   1 minute    iLO Get FW Version
