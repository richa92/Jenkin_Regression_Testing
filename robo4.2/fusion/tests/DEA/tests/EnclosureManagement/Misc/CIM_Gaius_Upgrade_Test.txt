*** Settings ***
Documentation    Test suite to update the Gaius firmware 
...    = GENERIC USAGE =
...    pybot -v APPLIANCE_IP:<ipv4> -v GIT_REPO_ROOT: | Gaius_Update.txt
...    = Variables =
...    | GIT_REPO_ROOT |      Required: Repo root path if NOT defined in environment variable this is mgmtfw root location|
...    | APPLIANCE_IP |       Required: OneView IPv4 address |


Variables         ${GIT_REPO_ROOT}/fusion/tests/DEA/variables/dea_variables.py
Resource          ${GIT_REPO_ROOT}${RESOURCE_ROOT}/resource_all.txt
Library           RoboGalaxyLibrary
Library           MgmtFWLibrary
Library           json

*** Variables ***
${gaius_version_170}    1.63.170
${gaius_version_192}    1.63.192
${cim_reboot_wait_time}      900
${gaius_rpm_170}    hp-firmware-intelligentprovisioning-ip-1.63-1.1.x86_64_170.rpm
${gaius_rpm_192}    hp-firmware-intelligentprovisioning-ip-1.63-1.1.x86_64_192.rpm

*** Test Case ***
TC 01: Update the CIM Gaius
    [Documentation]    Update the CIM Gaius
    [Tags]    PE    CIM Gaius OV3.10    Automated1
    Set Test Variable    ${FUSION_TIMEOUT}  600
    Set Test Variable    ${FUSION_PROMPT}    root@
    :FOR   ${iteration}   IN RANGE    1  50
    \    Login to Fusion via SSH
    \    Log    Iteration-${iteration}    console=True
    \    ${uninstallGuias}=   Execute SSH Command    rpm -e --nodeps hp-firmware-intelligentprovisioning-ip-1.63-1.1.x86_64
    \    ${installGuiasRPM}=     Execute SSH Command    rpm -ivh ${gaius_rpm_170}
    \    Log    Updating the Gaius to ${gaius_version_170}    console=True
    \    ${installGuias}=    Execute SSH Command    /ci/bin/update_cimgr_hpip_firmware.sh -f -L 1
    \    Should Contain    ${installGuias}     update has completed successfully
    \    ${rebootCIM}=    Execute SSH Command    reboot
    \    Log    CIM rebooting wait for ${cim_reboot_wait_time} sec     console=True
    \    Sleep    ${cim_reboot_wait_time}
    \    Login to Fusion via SSH
    \    ${firmwareInfo}=    Execute SSH Command    /ci/bin/ilo_get_health.sh -t FIRMWARE_INFORMATION
    \    Should Contain   ${firmwareInfo}  ${gaius_version_170}
    \    ${uninstallGuias}=   Execute SSH Command    rpm -e --nodeps hp-firmware-intelligentprovisioning-ip-1.63-1.1.x86_64
    \    ${installGuiasRPM}=     Execute SSH Command    rpm -ivh ${gaius_rpm_192}
    \    Log    Updating the Gaius to ${gaius_version_192}    console=True
    \    ${installGuias}=    Execute SSH Command    /ci/bin/update_cimgr_hpip_firmware.sh -f -L 1
    \    Should Contain    ${installGuias}     update has completed successfully
    \    ${rebootCIM}=    Execute SSH Command    reboot
    \    Log    CIM rebooting wait for ${cim_reboot_wait_time} sec     console=True
    \    Sleep    ${cim_reboot_wait_time}
    \    Login to Fusion via SSH
    \    ${firmwareInfo}=    Execute SSH Command    /ci/bin/ilo_get_health.sh -t FIRMWARE_INFORMATION
    \    Should Contain   ${firmwareInfo}  ${gaius_version_192} 
    \    Logout of Fusion Via SSH  
    