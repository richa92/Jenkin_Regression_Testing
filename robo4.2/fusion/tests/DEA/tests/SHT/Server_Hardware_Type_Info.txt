*** Settings ***
Documentation     Test Suite to verify the Server Hardware Type data of a specific adapter
...    = Usage =
...    | pybot | -L DEBUG | GIT_REPO_ROOT:<path> | APPLIANCE_IP:<fusion_ipv4> | server_bay:<server_bay> | adapter_mezz_slot:<adapter_slot_number> | adapter_name:<adapter_name> |  Server_Hardware_type_Info.txt |
...    = Variables =
...    | GIT_REPO_ROOT | Required; Repo root path if NOT defined in environment variable|
...    | APPLIANCE IP | Required; OneView IP address under test |
...    | server_bay | server blade bay number under test |
...    | adapter_mezz_slot | adapter slot number under test |
...    | adapter_name | adapter name under test |

Variables         ${GIT_REPO_ROOT}/fusion/tests/DEA/variables/dea_variables.py
Variables         ${GIT_REPO_ROOT}/fusion/tests/DEA/variables/data_variables.py
Resource          ${GIT_REPO_ROOT}${RESOURCE_ROOT}/resource_all.txt
Resource          ${GIT_REPO_ROOT}${EM_RESOURCE_ROOT}/thunderbird_all.txt

Library           RoboGalaxyLibrary
Library           FusionLibrary
Library           Collections

Suite Setup       Run Keywords    Login to Fusion Via REST    AND    Validate User Inputs
Suite Teardown    Logout of Fusion Via REST


***Test Cases***

TC01: Verify The Adapter Model Name In The SHT Information Displayed In OneView Is Correct
    [Documentation]    This test case verifies that the adapter model name in the SHT information displayed in OneView
    ...    matches the model name specified by the vendor
    [Tags]    CNA    HBA    SHT
    Log to Console    Verifying the model name of ${Adapter_Name} in mezz slot ${Adapter_Mezz_Slot} of server bay ${Server_Bay}
    ${field_value}=    Get Adapter Field Information    ${Server_Bay}    ${Adapter_Mezz_Slot}    model
    Should Be Equal    ${field_value}    ${Tbird_Adapters[0]['${Adapter_Name}']['model']}    msg= Invalid adapter model name
    [Teardown]    Run Keyword If Test Failed        Send Email Notify
    
TC02: Verify The Adapter Device Type In The SHT Information Displayed In OneView Is Correct
    [Documentation]    This test case verifies that the adapter device type in the SHT information displayed in OneView
    ...    matches the device type specified by the vendor
    [Tags]    CNA    HBA    SHT
    Log to Console    Verifying the device type of ${Adapter_Name} in mezz slot ${Adapter_Mezz_Slot} of server bay ${Server_Bay}
    ${field_value}=    Get Adapter Field Information    ${Server_Bay}    ${Adapter_Mezz_Slot}    deviceType
    Should Be Equal    ${field_value}    ${Tbird_Adapters[0]['${Adapter_Name}']['deviceType']}    msg= Invalid adapter device type
    [Teardown]    Run Keyword If Test Failed        Send Email Notify
    
TC03: Verify The Adapter Max Port Speed In The SHT Information Displayed In OneView Is Correct
    [Documentation]    This test case verifies that the max port speed of adapter in the SHT information displayed in OneView
    ...    matches the max port speed specified by the vendor
    [Tags]    CNA    HBA    SHT
    Log to Console    Verifying the max port speed of ${Adapter_Name} in mezz slot ${Adapter_Mezz_Slot} of server bay ${Server_Bay}
    ${field_value}=    Get Adapter Field Information    ${Server_Bay}    ${Adapter_Mezz_Slot}    ports
    ${max_port_speed1}=    Get From Dictionary    ${field_value[0]}    maxSpeedMbps
    ${max_port_speed2}=    Get From Dictionary    ${field_value[1]}    maxSpeedMbps
    ${max_port_speed}=    Run Keyword If    ${max_port_speed1} == ${max_port_speed2}    Set Variable    ${max_port_speed1}
           ...    ELSE    Set Variable    0
    Should Be Equal    ${max_port_speed}    ${Tbird_Adapters[0]['${Adapter_Name}']['maxPortSpeed']}    msg= Invalid adapter max port speed
    [Teardown]    Run Keyword If Test Failed        Send Email Notify
    
TC04: Verify The Adapter Physical Ports In The SHT Information Displayed In OneView Is Correct
    [Documentation]    This test case verifies that the physical ports of adapter in the SHT information displayed in OneView
    ...    matches the physical ports specified by the vendor
    [Tags]    CNA    HBA    SHT
    Log to Console    Verifying the physical ports of ${Adapter_Name} in mezz slot ${Adapter_Mezz_Slot} of server bay ${Server_Bay}
    ${field_value}=    Get Adapter Field Information    ${Server_Bay}    ${Adapter_Mezz_Slot}    ports
    ${port_count}=    Get Length    ${field_value}
    Should Be Equal    ${port_count}    ${Tbird_Adapters[0]['${Adapter_Name}']['physicalPorts']}    msg= Invalid adapter physical ports
    [Teardown]    Run Keyword If Test Failed        Send Email Notify
    
TC05: Verify The Adapter Virtual Ports In The SHT Information Displayed In OneView Is Correct
    [Documentation]    This test case verifies that the virtual ports of adapter in the SHT information displayed in OneView
    ...    matches the adapter virtual ports specified by the vendor
    [Tags]    CNA    HBA    SHT
    Log to Console    Verifying the virtual ports of ${Adapter_Name} in mezz slot ${Adapter_Mezz_Slot} of server bay ${Server_Bay}
    ${field_value}=    Get Adapter Field Information    ${Server_Bay}    ${Adapter_Mezz_Slot}    ports
    ${virtual_ports1}=    Get Length    ${field_value[0]['virtualPorts']}
    ${virtual_ports2}=    Get Length    ${field_value[1]['virtualPorts']}
    ${virtual_ports}=    Evaluate    ${virtual_ports1}+${virtual_ports2}
    Should Be Equal    ${virtual_ports}    ${Tbird_Adapters[0]['${Adapter_Name}']['virtualPorts']}    msg= Invalid adapter virtual ports
    [Teardown]    Run Keyword If Test Failed        Send Email Notify  
    
TC06: Verify The Virtual Functions Available In The SHT Information Displayed In OneView Is Correct
    [Documentation]    This test case verifies that the available virtual functions of adapter in the SHT information displayed in OneView
    ...    matches the available virtual functions specified by the vendor
    [Tags]    CNA    HBA    SHT
    Log to Console    Verifying the available virtual functions of ${Adapter_Name} in mezz slot ${Adapter_Mezz_Slot} of server bay ${Server_Bay}
    ${field_value}=    Get Adapter Field Information    ${Server_Bay}    ${Adapter_Mezz_Slot}    maxVFsSupported
    Should Be Equal    ${field_value}    ${Tbird_Adapters[0]['${Adapter_Name}']['availableVF']}    msg= Invalid adapter virtual functions
    [Teardown]    Run Keyword If Test Failed        Send Email Notify
    
TC07: Verify The Virtual Function Allocation Increment In The SHT Information Displayed In OneView Is Correct
    [Documentation]    This test case verifies that the virtual function allocation increment in the SHT information displayed in OneView
    ...    matches the virtual function allocation increment specified by the vendor
    [Tags]    CNA    HBA    SHT
    Log to Console    Verifying the virtual function allocation increment of ${Adapter_Name} in mezz slot ${Adapter_Mezz_Slot} of server bay ${Server_Bay}
    ${field_value}=    Get Adapter Field Information    ${Server_Bay}    ${Adapter_Mezz_Slot}    minVFsIncrement
    Should Be Equal    ${field_value}    ${Tbird_Adapters[0]['${Adapter_Name}']['vfIncrement']}    msg= Invalid adapter virtual function alloaction increment
    [Teardown]    Run Keyword If Test Failed        Send Email Notify

TC08: Verify The Adapter Capabilities In The SHT Information Displayed In OneView Is Correct
    [Documentation]    This test case verifies the capabilities of adapter in the SHT information displayed in OneView
    ...    matches the capabilities specified by the vendor
    [Tags]    CNA    HBA    SHT
    Log to Console    Verifying the capabilities of ${Adapter_Name} in mezz slot ${Adapter_Mezz_Slot} of server bay ${Server_Bay}
    ${field_value}=    Get Adapter Field Information    ${Server_Bay}    ${Adapter_Mezz_Slot}    capabilities
    List Should Contain Sub List    ${field_value}    ${Tbird_Adapters[0]['${Adapter_Name}']['capabilities']}    msg= Invalid adapter capabilities
    [Teardown]    Run Keyword If Test Failed        Send Email Notify
    
***Keywords***
Validate User Inputs
    [Documentation]    This keyword validates the user's inputs - server bay and adapter mezz slot
    ${server_bay_list}=    Get Adapter Server Bay List    ${Adapter_Name}
    Run Keyword And Ignore Error    List Should Contain Value     ${server_bay_list}    ${Server_Bay}    msg= Invalid input server bay ${Server_Bay}
    ${mezz_bay_list}=    Get Adapter Mezz Bay List    ${Server_Bay}    ${Adapter_Name}
    ${Adapter_Mezz_Slot}=    Convert To Integer    ${Adapter_Mezz_Slot}
    List Should Contain Value    ${mezz_bay_list}    ${Adapter_Mezz_Slot}    msg= Invalid input mezz bay ${Adapter_Mezz_Slot}
