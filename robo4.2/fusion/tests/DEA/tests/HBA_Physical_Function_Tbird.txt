*** Settings ***

Documentation     pybot -L Trace -v APPLIANCE_IP:<APP_IPv4-IPv6> -v OA_IP:<OA_IPv4-IPv6> -v Adapter_Name:<Adapter_Name> -v Server_Bay:<Bay_Number>
...               -v Enclosures:<Encl_Name> -v GIT_REPO_ROOT:<ROOT_DIR> HBA_Physical_Function_Tbird.txt
...               Fill in command required field for APPLIANCE_IP, Adapter_Name, Server_Bay, and Enclosures.
Variables         ${GIT_REPO_ROOT}/fusion/tests/DEA/variables/dea_variables.py
Variables         ${GIT_REPO_ROOT}${VARIABLE_ROOT}/data_variables.py
Variables         ${GIT_REPO_ROOT}${EM_VARIABLES_ROOT}/tBird_variables.py
Resource          ${GIT_REPO_ROOT}${RESOURCE_ROOT}/resource_all.txt
Resource          ${GIT_REPO_ROOT}${RESOURCE_ROOT}/Altair_Resource.txt
Resource          ${GIT_REPO_ROOT}${EM_RESOURCE_ROOT}/thunderbird_all.txt

Library           RoboGalaxyLibrary
Library           FusionLibrary
Library           Collections
Library           OperatingSystem
Library           AltairLibrary

#Uncomment line in Suite Setup to run inital setup of enclosure
Suite Setup       Run Keywords    Login to Fusion Via REST    #AND    Clean UP Environment    AND    Setup Ethernet Appliance
Suite Teardown    Logout of Fusion Via REST
*** Test Cases ***

TC 1: Verify Adapter is Present
    [Documentation]    Verify adapter is present before running suite of test.
    [Tags]    HBA    Discovery
    ${adapter_model} =  Get Adapter Name from List    ${Adapter_Name}  ${Tbird_Adapters}
    ${server_list} =  Get Server Bay List
    Should Not Be Empty    ${server_list}    msg=No server present in the enclosure
    ${bay_list} =  Get Adapter Bay List    ${server_list}  ${adapter_model}
    Should Not Be Empty    ${bay_list}    msg=No server with ${Adapter_Name} adapter present in the enclosure
    List Should Contain Value    ${bay_list}    ${Server_Bay}    msg=Bay ${Server_Bay} does not contain ${Adapter_Name} adapter
    [Teardown]    Run Keyword if test failed    Run Keywords       Fatal Error    msg=Bay ${Server_Bay} does not contain ${Adapter_Name} adapter    AND    Send Email Notify

TC 2: Validate FC Primary Boot on Port 1 for Tbird Server in Legacy Mode
    [Documentation]    Apply server profile with Primary Boot FC on Port 1 and Legacy mode. Power on server and validate it successfully boot with all active ports for ${Adapter_Name}
    [Tags]    HBA    Legacy   FC   Primary
    ${bay_list} =  Create List    ${Server_Bay}
    ${connections} =  Change Connection Values for ID 1 and 2  ${enet_fc_connection}  FibreChannel  FC:${FC_Name}  FC:${FC_Name2}  ${FC_connection_target_primary_legacy_tbird}  ${NONE}
    Delete Server Profile    ${bay_list}
    #    fusion api set default api version    api=500
    Create Server Profile with Connections Bootmode and BootOrder  ${bay_list}  ${server_profiles_eth[0]}  ${connections}  ${Legacy_bootmode}  ${Gen9_boot_HardDisk}
    Verify Network Connection by Pinging to OS IP    ${bay_list}
    [Teardown]    Run Keyword If Test Failed        Send Email Notify
    
TC 3: Validate FC Primary Boot on Port 2 for Tbird Server in Legacy Mode
    [Documentation]    Apply server profile with Secondary Boot FC on Port 2 and Legacy mode. Power on server and validate it successfully boot with all active ports for ${Adapter_Name}
    [Tags]    HBA    Legacy   FC   Secondary
    ${bay_list} =  Create List    ${Server_Bay}
    ${connections} =  Change Connection Values for ID 1 and 2  ${enet_fc_connection}  FibreChannel  FC:${FC_Name}  FC:${FC_Name2}  ${NONE}  ${FC_connection_target_primary_legacy_tbird}
    Delete Server Profile    ${bay_list}
    #    fusion api set default api version    api=500
    Create Server Profile with Connections Bootmode and BootOrder  ${bay_list}  ${server_profiles_eth[0]}  ${connections}  ${Legacy_bootmode}  ${Gen9_boot_HardDisk}
    Verify Network Connection by Pinging to OS IP    ${bay_list}
    [Teardown]    Run Keyword If Test Failed        Send Email Notify
    
TC 4: Validate FC Primary Boot on Port 1 for Tbird Server in UEFI Mode
    [Documentation]    Apply server profile with Primary Boot FC on Port 1 and Verify Connection with Bandwidth Changes Online in UEFI mode. Power on server and validate it successfully boot with all active ports for ${Adapter_Name}
    [Tags]    HBA    UEFI    FC    Primary
    ${bay_list} =  Create List    ${Server_Bay}
    ${connections} =  Change Connection Values for ID 1 and 2  ${enet_fc_connection}  FibreChannel  FC:${FC_Name}  FC:${FC_Name2}  ${FC_connection_target_primary_tbird}  ${NONE}
    Delete Server Profile    ${bay_list}
    #    fusion api set default api version    api=500
    Create Server Profile with Connections Bootmode and BootOrder  ${bay_list}  ${server_profiles_eth[0]}  ${connections}  ${UEFI_bootmode}  ${Gen9_boot_HardDisk}
    Verify Network Connection by Pinging to OS IP    ${bay_list}

TC 5: Validate FC Primary Boot on Port 2 for Tbird Server in UEFI Mode
    [Documentation]    Apply server profile with Secondary Boot FC on Port 2 and Verify Connection with Bandwidth Changes Online in UEFI mode. Power on server and validate it successfully boot with all active ports for ${Adapter_Name}
    [Tags]    HBA    UEFI    FC    Secondary
    ${bay_list} =  Create List    ${Server_Bay}
    ${connections} =  Change Connection Values for ID 1 and 2  ${enet_fc_connection}  FibreChannel  FC:${FC_Name}  FC:${FC_Name2}  ${NONE}  ${FC_connection_target_primary_tbird}
    Delete Server Profile    ${bay_list}
    #    fusion api set default api version    api=500
    Create Server Profile with Connections Bootmode and BootOrder  ${bay_list}  ${server_profiles_eth[0]}  ${connections}  ${UEFI_bootmode}  ${Gen9_boot_HardDisk}
    Verify Network Connection by Pinging to OS IP    ${bay_list}
    [Teardown]    Run Keyword If Test Failed        Send Email Notify
    
TC 6: Validate FC Primary Boot on Port 1 for Tbird Server in UEFIOptimized Mode
    [Documentation]    Apply server profile with Primary Boot FC on Port 1 and Verify Connection with Bandwidth Changes Online in UEFIOptimized mode. Power on server and validate it successfully boot with all active ports for ${Adapter_Name}
    [Tags]    HBA    UEFIOptimized    FC    Primary
    ${bay_list} =  Create List    ${Server_Bay}
    ${connections} =  Change Connection Values for ID 1 and 2  ${enet_fc_connection}  FibreChannel  FC:${FC_Name}  FC:${FC_Name2}  ${FC_connection_target_primary_tbird}  ${NONE}
    Delete Server Profile    ${bay_list}
    #    fusion api set default api version    api=500
    Create Server Profile with Connections Bootmode and BootOrder  ${bay_list}  ${server_profiles_eth[0]}  ${connections}  ${UEFIOptimized_boot_mode}  ${Gen9_boot_HardDisk}
    Verify Network Connection by Pinging to OS IP    ${bay_list}
    [Teardown]    Run Keyword If Test Failed        Send Email Notify

TC 7: Validate FC Secondary Boot on Port 2 for Tbird Server in UEFIOptimized Mode
    [Documentation]    Apply server profile with Secondary Boot FC on Port 2 and Verify Connection with Bandwidth Changes Online in UEFIOptimized mode. Power on server and validate it successfully boot with all active ports for ${Adapter_Name}
    [Tags]    HBA    UEFIOptimized    FC    Secondary
    ${bay_list} =  Create List    ${Server_Bay}
    ${connections} =  Change Connection Values for ID 1 and 2  ${enet_fc_connection}  FibreChannel  FC:${FC_Name}  FC:${FC_Name2}  ${NONE}  ${FC_connection_target_primary_tbird}
    Delete Server Profile    ${bay_list}
    #    fusion api set default api version    api=500
    Create Server Profile with Connections Bootmode and BootOrder  ${bay_list}  ${server_profiles_eth[0]}  ${connections}  ${UEFIOptimized_boot_mode}  ${Gen9_boot_HardDisk}
    Verify Network Connection by Pinging to OS IP    ${bay_list}
    Delete Server Profile    ${bay_list}
    [Teardown]    Run Keyword If Test Failed     Run Keywords        Delete Server Profile    ${bay_list}    AND    Send Email Notify    
    
