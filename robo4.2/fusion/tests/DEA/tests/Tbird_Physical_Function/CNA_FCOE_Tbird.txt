*** Settings ***

Documentation     pybot -L Trace -v APPLIANCE_IP:<APP_IPv4-IPv6> -v Adapter_Name:<Adapter_Name> -v Server_Bay:<Bay_Number>
...               -v Enclosures:<Encl_Name> -v Adapter_Mezz_Slot:<Mezz_Slot> -v port_assignment:<Manual or Auto> -v iLO_Adapter_Directory:<NetworkAdapters or BaseNetworkAdapters> 
...               iLO_Adapter_Position:<1-12> -v GIT_REPO_ROOT:<ROOT_DIR> CNA_FCOE_Tbird.txt
...               Fill in command required field for APPLIANCE_IP, Adapter_Test, and Enclosures.
Variables         ${GIT_REPO_ROOT}/fusion/tests/DEA/variables/dea_variables.py
Variables         ${GIT_REPO_ROOT}${VARIABLE_ROOT}/data_variables.py
Variables         ${GIT_REPO_ROOT}${EM_VARIABLES_ROOT}/tBird_variables.py
Resource          ${GIT_REPO_ROOT}${RESOURCE_ROOT}/resource_all.txt
Resource          ${GIT_REPO_ROOT}${RESOURCE_ROOT}/Altair_Resource.txt
Resource          ${GIT_REPO_ROOT}${EM_RESOURCE_ROOT}/thunderbird_all.txt

Library           RoboGalaxyLibrary
Library           FusionLibrary
Library           Collections
Library           OperatingSystem
Library           AltairLibrary

#Uncomment line in Suite Setup to run inital setup of enclosure
Suite Setup       Run Keywords    Login to Fusion Via REST    #AND    Clean UP Environment    AND    Setup Ethernet Appliance
Suite Teardown    Logout of Fusion Via REST
*** Test Cases ***

    
TC 131: Validate FCoE Primary Boot on Port 1 for Tbird Server in UEFI Mode
    [Documentation]    Apply server profile with Primary Boot FCoE on Port 1 and Verify Connection with Bandwidth Changes Online in UEFI mode. Power on server and validate it successfully boot with all active ports for ${Adapter_Name}
    [Tags]    CNA    UEFI    FCOE    Primary
    ${bay_list} =  Create List    ${Server_Bay}
    ${connectionSettings} =  Set Connection for Primary or Secondary Boot  ${enet_connection_primary_4pf}    ${enet_connection_primary_8pf}
    ${id_primary} =  Set Variable  3
    ${id_secondary} =  Set Variable  4
    ${connectionSettings} =  Change Single Connection Value  ${connectionSettings}  1  ETH:Test_Enet  boot
    ${connectionSettings} =  Change Connection Values for a Pair of Connection  ${id_primary}  ${id_secondary}  ${connectionSettings}  FibreChannel  FCOE:${FCoE_Name}  FCOE:${FCoE_Name3}  ${fcoe_connection_target_primary}  ${NONE}
    Run Keyword If    '${port_assignment}'!= 'Auto'    Update Connection Port ID   ${connectionSettings}  ${portId_list}
    Delete Server Profile    ${bay_list}
#        fusion api set default api version    api=600
    Create Server Profile with Connections Bootmode and BootOrder  ${bay_list}  ${server_profiles_eth[0]}  ${connectionSettings}  ${UEFI_bootmode}  ${Gen9_boot_HardDisk}
    Get Profile Connections and Verify Ports are Active  ${bay_list}
    Power On Server and Verify IP Addresses from OS    ${bay_list}  FCOE
    
    #Update Server Profile and Verify Connection with Bandwidth Changes Online
    Change BW Values    ${bay_list}    ${server_profiles_eth[0]}    ${connectionSettings}    ${UEFI_bootmode}    ${Gen9_boot_HardDisk}    1000
    Verify Requested Bandwidth    ${bay_list}    1000
    Verify IP Addresses from List of Servers  ${bay_list}
    [Teardown]    Run Keyword If Test Failed        Send Email Notify    
    
TC 132: Validate FCoE Secondary Boot on Port 2 for Tbird Server in UEFI Mode
    [Documentation]    Apply server profile with Secondary Boot FCoE on Port 2 and Verify Connection with Bandwidth Changes Online in UEFI mode. Power on server and validate it successfully boot with all active ports for ${Adapter_Name}
    [Tags]    CNA    UEFI    FCOE    Secondary
    ${bay_list} =  Create List    ${Server_Bay}
    ${connectionSettings} =  Set Connection for Primary or Secondary Boot  ${enet_connection_primary_4pf}    ${enet_connection_primary_8pf}
    ${id_primary} =  Set Variable  3
    ${id_secondary} =  Set Variable  4
    ${connectionSettings} =  Change Single Connection Value  ${connectionSettings}  1  ETH:Test_Enet  boot
    ${connectionSettings} =  Change Connection Values for a Pair of Connection  ${id_primary}  ${id_secondary}  ${connectionSettings}  FibreChannel  FCOE:${FCoE_Name}  FCOE:${FCoE_Name2}  ${fcoe_connection_target_primary}  ${fcoe_connection_target_secondary}
    Run Keyword If    '${port_assignment}'!= 'Auto'    Update Connection Port ID   ${connectionSettings}  ${portId_list}
    Delete Server Profile    ${bay_list}
#        fusion api set default api version    api=600
    Create Server Profile with Connections Bootmode and BootOrder  ${bay_list}  ${server_profiles_eth[0]}  ${connectionSettings}  ${UEFI_bootmode}  ${Gen9_boot_HardDisk}
    Get Profile Connections and Verify Ports are Active  ${bay_list}
    [Teardown]    Run Keyword If Test Failed        Send Email Notify    
    
TC 133: Validate FCoE Primary Boot on Port 1 for Tbird Server in UEFIOptimized Mode
    [Documentation]    Apply server profile with Primary Boot FCoE on Port 1 and Verify Connection with Bandwidth Changes Online in UEFIOptimized mode. Power on server and validate it successfully boot with all active ports for ${Adapter_Name}
    [Tags]    CNA    UEFIOptimized    FCOE    Primary
    ${bay_list} =  Create List    ${Server_Bay}
    ${connectionSettings} =  Set Connection for Primary or Secondary Boot  ${enet_connection_primary_4pf}    ${enet_connection_primary_8pf}
    ${id_primary} =  Set Variable  3
    ${id_secondary} =  Set Variable  4
    ${connectionSettings} =  Change Single Connection Value  ${connectionSettings}  1  ETH:Test_Enet  boot
    ${connectionSettings} =  Change Connection Values for a Pair of Connection  ${id_primary}  ${id_secondary}  ${connectionSettings}  FibreChannel  FCOE:${FCoE_Name}  FCOE:${FCoE_Name3}  ${fcoe_connection_target_primary}  ${NONE}
    Run Keyword If    '${port_assignment}'!= 'Auto'    Update Connection Port ID   ${connectionSettings}  ${portId_list}
    Delete Server Profile    ${bay_list}
#    fusion api set default api version    api=600
    Create Server Profile with Connections Bootmode and BootOrder  ${bay_list}  ${server_profiles_eth[0]}  ${connectionSettings}  ${UEFIOptimized_boot_mode}  ${Gen9_boot_HardDisk}
    Get Profile Connections and Verify Ports are Active  ${bay_list}
    Power On Server and Verify IP Addresses from OS    ${bay_list}  FCOE
    
    #Update Server Profile and Verify Connection with Bandwidth Changes Online
    Change BW Values    ${bay_list}    ${server_profiles_eth[0]}    ${connectionSettings}    ${UEFIOptimized_boot_mode}    ${Gen9_boot_HardDisk}    1000
    Verify Requested Bandwidth    ${bay_list}    1000
    Verify IP Addresses from List of Servers  ${bay_list}
    [Teardown]    Run Keyword If Test Failed        Send Email Notify
    
TC 134: Validate FCoE Secondary Boot on Port 2 for Tbird Server in UEFIOptimized Mode
    [Documentation]    Apply server profile with Secondary Boot FCoE on Port 2 and Verify Connection with Bandwidth Changes Online in UEFIOptimized mode. Power on server and validate it successfully boot with all active ports for ${Adapter_Name}
    [Tags]    CNA    UEFIOptimized    FCOE    Secondary
    ${bay_list} =  Create List    ${Server_Bay}
    ${connectionSettings} =  Set Connection for Primary or Secondary Boot  ${enet_connection_primary_4pf}    ${enet_connection_primary_8pf}
    ${id_primary} =  Set Variable  3
    ${id_secondary} =  Set Variable  4
    ${connectionSettings} =  Change Single Connection Value  ${connectionSettings}  1  ETH:Test_Enet  boot
    ${connectionSettings} =  Change Connection Values for a Pair of Connection  ${id_primary}  ${id_secondary}  ${connectionSettings}  FibreChannel  FCOE:${FCoE_Name}  FCOE:${FCoE_Name2}  ${fcoe_connection_target_primary}  ${fcoe_connection_target_secondary}
    Run Keyword If    '${port_assignment}'!= 'Auto'    Update Connection Port ID   ${connectionSettings}  ${portId_list}
    Delete Server Profile    ${bay_list}
#    fusion api set default api version    api=600
    Create Server Profile with Connections Bootmode and BootOrder  ${bay_list}  ${server_profiles_eth[0]}  ${connectionSettings}  ${UEFIOptimized_boot_mode}  ${Gen9_boot_HardDisk}
    Get Profile Connections and Verify Ports are Active  ${bay_list}
    Delete Server Profile    ${bay_list}
    [Teardown]    Run Keyword If Test Failed     Run Keyword    Send Email Notify    
