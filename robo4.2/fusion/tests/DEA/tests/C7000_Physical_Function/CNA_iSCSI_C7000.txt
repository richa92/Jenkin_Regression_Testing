*** Settings ***

Documentation     pybot -L Trace -v APPLIANCE_IP:<APP_IPv4-IPv6> -v OA_IP:<OA_IPv4-IPv6> -v Adapter_Test:<Adapter_Name> 
...               -v Enclosures:<Encl_Name> -v GIT_REPO_ROOT:<ROOT_DIR> CNA_iSCSI_C7000.txt
...               Fill in command required field for APPLIANCE_IP, Adapter_Test, and Enclosures.
Variables         ${GIT_REPO_ROOT}/fusion/tests/DEA/variables/dea_variables.py
Variables         ${GIT_REPO_ROOT}${VARIABLE_ROOT}/data_variables.py
Variables         ${GIT_REPO_ROOT}${EM_VARIABLES_ROOT}/tBird_variables.py
Resource          ${GIT_REPO_ROOT}${RESOURCE_ROOT}/resource_all.txt
Resource          ${GIT_REPO_ROOT}${RESOURCE_ROOT}/Altair_Resource.txt
Resource          ${GIT_REPO_ROOT}${EM_RESOURCE_ROOT}/thunderbird_all.txt
Library           ${GIT_REPO_ROOT}/fusion/Resources/api/Uris.py

Library           RoboGalaxyLibrary
Library           FusionLibrary
Library           Collections
Library           OperatingSystem
Library           AltairLibrary

# Uncomment line in Suite Setup to run inital setup of enclosure
Suite Setup       Run Keywords    Login to Fusion Via REST    #AND    Clean UP C7000 Environment    AND    Setup C7000 8PF Appliance
Suite Teardown    Logout of Fusion Via REST

*** Test Cases ***

TC 137: Verify ISCSI Primary Boot in UEFI Mode with CHAP on Port 1B for C7000 Server
    [Documentation]    Apply server profile with iSCSI Primary Boot on Port 1 with CHAP in UEFI Mode. Power on server and validate it successfully boot with 16 active ports for ${Adapter_Test}
    [Tags]    CNA    Primary    UEFI    ISCSI    CHAP    QXCR1001569119
    ${bay_list} =  Create List  ${Adapter_Bay}
    ${connections} =  Set Connection for Primary or Secondary Boot  ${enet_connection_primary_4pf}    ${enet_connection_primary_8pf}
    ${boot_target} =  Get Boot Target    ${iscsi_emulex_target_primary_uefi}  ${iscsi_broadcom_target_primary_uefi}
    ${connections} =  Change Connection Values for ID 1 and 2  ${connections}  iSCSI  ETH:2019  ETH:VLAN85  ${boot_target}  ${NONE}
    ${connections} =  Add IPv4 Address  ${connections}  ${iscsi_id2_ipv4}  ${NONE}
    Delete Server Profile    ${bay_list}
    fusion api set default api version    api=1000
    Create Server Profile with Connections Bootmode and BootOrder  ${bay_list}  ${server_profiles_eth[0]}  ${connections}  ${UEFI_boot_mode}  ${Gen9_boot_HardDisk}
    Get Profile Connections and Verify Ports are Active  ${bay_list}
    Power On Server and Verify IP Addresses from OS    ${bay_list}    ISCSI
    #[Teardown]    Run Keyword if test failed    Send Email Notify

TC 138: Verify ISCSI Primary Boot in UEFI Mode on Port 2B for C7000 Server
    [Documentation]    Apply server profile with iSCSI Primary Boot on Port 2 in UEFI Mode. Power on server and validate it successfully boot with 16 active ports for ${Adapter_Test}
    [Tags]    CNA    Primary    UEFI    ISCSI    QXCR1001569119
    ${bay_list} =  Create List  ${Adapter_Bay}
    ${connections} =  Set Connection for Primary or Secondary Boot  ${enet_connection_primary_4pf}  ${enet_connection_primary_8pf}
    ${boot_target2} =  Get Boot Target    ${iscsi_emulex_target_secondary_uefi}  ${iscsi_broadcom_target_primary_uefi}
    ${connections} =  Change Connection Values for ID 1 and 2  ${connections}  iSCSI  ETH:VLAN85  ETH:2019  ${NONE}  ${boot_target2}
    ${connections} =  Add IPv4 Address  ${connections}  ${NONE}   ${iscsi_id_ipv4_dhcp}
    Delete Server Profile    ${bay_list}
    fusion api set default api version    api=1000
    Create Server Profile with Connections Bootmode and BootOrder    ${bay_list}  ${server_profiles_eth[0]}  ${connections}  ${UEFI_boot_mode}  ${Gen9_boot_HardDisk}
    Get Profile Connections and Verify Ports are Active  ${bay_list}
    Power On Server and Verify IP Addresses from OS    ${bay_list}    ISCSI
    #[Teardown]    Run Keyword if test failed    Send Email Notify

TC 139: Verify ISCSI Primary Boot in UEFIOptimized Mode with CHAP on Port 1B for C7000 Server
    [Documentation]    Apply server profile with iSCSI Primary Boot on Port 1 with CHAP in UEFIOptimized Mode. Power on server and validate it successfully boot with 16 active ports for ${Adapter_Test}
    [Tags]    CNA    Primary    UEFIOptimized    ISCSI    CHAP    QXCR1001569119
    ${bay_list} =  Create List  ${Adapter_Bay}
    ${connections} =  Set Connection for Primary or Secondary Boot  ${enet_connection_primary_4pf}  ${enet_connection_primary_8pf}

    #Test 1st Boot Target IP Address in UEFIOptimized Mode and Primary Boot
    ${boot_target} =  Get Boot Target    ${iscsi_emulex_target_primary_uefi}  ${iscsi_broadcom_target_primary_uefi}
    ${connections} =  Change Connection Values for ID 1 and 2  ${connections}  iSCSI  ETH:2019  ETH:VLAN85  ${boot_target}  ${NONE}
    ${connections} =  Add IPv4 Address  ${connections}  ${iscsi_id_ipv4_dhcp}  ${NONE}
    Delete Server Profile    ${bay_list}
    fusion api set default api version    api=1000
    Create Server Profile with Connections Bootmode and BootOrder    ${bay_list}  ${server_profiles_eth[0]}  ${connections}  ${UEFIOptimized_bootmode}  ${Gen9_boot_HardDisk}
    Get Profile Connections and Verify Ports are Active  ${bay_list}
    Power On Server and Verify IP Addresses from OS    ${bay_list}    ISCSI
    #[Teardown]    Run Keyword if test failed    Send Email Notify

TC 140: Verify ISCSI Primary Boot in UEFIOptimized Mode on Port 2B for C7000 Server
    [Documentation]    Apply server profile with iSCSI Primary Boot on Port 2 in UEFIOptimized Mode. Power on server and validate it successfully boot with 16 active ports for ${Adapter_Test}
    [Tags]    CNA    Primary    UEFIOptimized    ISCSI    QXCR1001569119
    ${bay_list} =  Create List  ${Adapter_Bay}
    ${connections} =  Set Connection for Primary or Secondary Boot  ${enet_connection_primary_4pf}  ${enet_connection_primary_8pf}
    ${boot_target2} =  Get Boot Target    ${iscsi_emulex_target_secondary_uefi}  ${iscsi_broadcom_target_secondary_uefi}
    ${connections} =  Change Connection Values for ID 1 and 2  ${connections}  iSCSI  ETH:VLAN85  ETH:2019  ${NONE}  ${boot_target2}
    ${connections} =  Add IPv4 Address  ${connections}  ${NONE}   ${iscsi_id_ipv4_dhcp}
    Delete Server Profile    ${bay_list}
    fusion api set default api version    api=1000
    Create Server Profile with Connections Bootmode and BootOrder    ${bay_list}  ${server_profiles_eth[0]}  ${connections}  ${UEFIOptimized_bootmode}  ${Gen9_boot_HardDisk}
    Get Profile Connections and Verify Ports are Active  ${bay_list}
    Power On Server and Verify IP Addresses from OS    ${bay_list}    ISCSI
    [Teardown]    Delete Server Profile    ${bay_list}
    #[Teardown]    Run Keyword if test failed    Send Email Notify