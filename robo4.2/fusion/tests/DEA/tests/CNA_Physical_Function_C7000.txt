*** Settings ***

Documentation     pybot -L Trace -v APPLIANCE_IP:<APP_IPv4-IPv6> -v OA_IP:<OA_IPv4-IPv6> -v Adapter_Test:<Adapter_Name> 
...               -v Enclosures:<Encl_Name> -v GIT_REPO_ROOT:<ROOT_DIR> CNA_Physical_Function_C7000.txt
...               Fill in command required field for APPLIANCE_IP, Adapter_Test, and Enclosures.
Variables         ${GIT_REPO_ROOT}/fusion/tests/DEA/variables/dea_variables.py
Variables         ${GIT_REPO_ROOT}${VARIABLE_ROOT}/data_variables.py
Variables         ${GIT_REPO_ROOT}${EM_VARIABLES_ROOT}/tBird_variables.py
Resource          ${GIT_REPO_ROOT}${RESOURCE_ROOT}/resource_all.txt
Resource          ${GIT_REPO_ROOT}${RESOURCE_ROOT}/Altair_Resource.txt
Resource          ${GIT_REPO_ROOT}${EM_RESOURCE_ROOT}/thunderbird_all.txt

Library           RoboGalaxyLibrary
Library           FusionLibrary
Library           Collections
Library           OperatingSystem
Library           AltairLibrary

#Uncomment line in Suite Setup to run inital setup of enclosure
Suite Setup       Run Keywords    Login to Fusion Via REST    #AND    Clean UP C7000 Environment    AND    Setup C7000 8PF Appliance
Suite Teardown    Logout of Fusion Via REST

*** Test Cases ***

TC 116: Verify Adapter is Present
    [Documentation]    Validate ${Adapter_Test} has 4/8 physical functions per port for a total of 8/16 virtual ports
    [Tags]    DEA    API    Automated    CNA    PXE    ENET    FCOE    ISCSI
    ${adapter_model} =  Get Adapter Name from List    ${Adapter_Test}  ${C7000_Adapter_Models}
    ${adapter_pf_type} =  Get Adapter Physical Function Type from List
    ${server_list} =  Get Server Bay List
    Should Not Be Empty    ${server_list}    msg=No server present in the enclosure
    ${bay_list} =  Get Adapter Bay List    ${server_list}  ${adapter_model}
    Should Not Be Empty    ${bay_list}    msg=No server with ${Adapter_Test} adapter present in the enclosure
    [Teardown]    Run Keyword if test failed    Fatal Error    msg=No server with ${Adapter_Test} adapter present in the enclosure

TC 120: Verify PXE Primary Boot in Legacy Mode and Port 1A for C7000 Server
    [Documentation]    Apply server profile with Primary Boot PXE and Legacy mode. Power on server and validate it successfully PXE with all active ports for ${Adapter_Test}
    [Tags]    DEA    API    Automated    CNA    PXE    Primary    Legacy    QXCR1001532437
    ${bay_list} =  Get Server Bay Based on Server Type  ${Adapter_Test}  ${C7000_Adapter_Models}  ${Server_Gen}
    ${connections} =  Set Connection for Primary or Secondary Boot    ${enet_connection_primary_4pf}    ${enet_connection_primary_8pf}
    Delete Server Profile    ${bay_list}
    Create Server Profile with Connections Bootmode and BootOrder  ${bay_list}  ${server_profiles_eth[0]}  ${connections}  ${Legacy_bootmode}  ${Gen9_boot}
    Log into Altair and Verify Server PXE  ${bay_list}
    Get Profile Connections and Verify Ports are Active  ${bay_list}

TC 121: Verify PXE Secondary Boot in Legacy Mode and Port 2A for C7000 Server
    [Documentation]    Apply server profile with Secondary Boot PXE and Legacy mode. Power on server and validate it successfully PXE with all active ports for ${Adapter_Test}
    [Tags]    DEA    API    Automated    CNA    PXE    Secondary    Legacy    QXCR1001532437
    ${bay_list} =  Get Server Bay Based on Server Type  ${Adapter_Test}  ${C7000_Adapter_Models}  ${Server_Gen}
    ${connections} =  Set Connection for Primary or Secondary Boot  ${enet_connection_secondary_4pf}    ${enet_connection_secondary_8pf}
    Delete Server Profile    ${bay_list}
    Create Server Profile with Connections Bootmode and BootOrder  ${bay_list}  ${server_profiles_eth[0]}  ${connections}  ${Legacy_bootmode}  ${Gen9_boot}
    Log into Altair and Verify Server PXE  ${bay_list}
    Get Profile Connections and Verify Ports are Active  ${bay_list}

TC 122: Verify PXE Primary Boot in UEFI Mode and Port 1A for C7000 Server
    [Documentation]    Apply server profile with Primary Boot PXE and UEFI mode. Power on server and validate it successfully PXE with all active ports for ${Adapter_Test}
    [Tags]    DEA    API    Automated    CNA    PXE    Primary    UEFI    QXCR1001532437
    ${bay_list} =  Get Server Bay Based on Server Type  ${Adapter_Test}  ${C7000_Adapter_Models}  ${Server_Gen}
    ${connections} =  Set Connection for Primary or Secondary Boot    ${enet_connection_primary_4pf}    ${enet_connection_primary_8pf}
    Delete Server Profile    ${bay_list}
    Create Server Profile with Connections Bootmode and BootOrder  ${bay_list}  ${server_profiles_eth[0]}  ${connections}  ${UEFI_bootmode}  ${Gen9_boot}
    Log into Altair and Verify Server PXE  ${bay_list}
    Get Profile Connections and Verify Ports are Active  ${bay_list}

TC 123: Verify PXE Secondary Boot in UEFI Mode and Port 2A for C7000 Server
    [Documentation]    Apply server profile with Secondary Boot PXE and UEFI mode. Power on server and validate it successfully PXE with all active ports for ${Adapter_Test}
    [Tags]    DEA    API    Automated    CNA    PXE    Secondary    UEFI    QXCR1001532437
    ${bay_list} =  Get Server Bay Based on Server Type  ${Adapter_Test}  ${C7000_Adapter_Models}  ${Server_Gen}
    ${connections} =  Set Connection for Primary or Secondary Boot   ${enet_connection_secondary_4pf}    ${enet_connection_secondary_8pf}
    Delete Server Profile    ${bay_list}
    Create Server Profile with Connections Bootmode and BootOrder  ${bay_list}  ${server_profiles_eth[0]}  ${connections}  ${UEFI_bootmode}  ${Gen9_boot}
    Log into Altair and Verify Server PXE  ${bay_list}
    Get Profile Connections and Verify Ports are Active  ${bay_list}

TC 124: Verify PXE Primary Boot in UEFIOptimized Mode and Port 1A for C7000 Server
    [Documentation]    Apply server profile with Primary Boot PXE and UEFIOptimized mode. Power on server and validate it successfully PXE with all active ports for ${Adapter_Test}
    [Tags]    DEA    API    Automated    CNA    PXE    Primary    UEFIOptimized    QXCR1001532437
    ${bay_list} =  Get Server Bay Based on Server Type  ${Adapter_Test}  ${C7000_Adapter_Models}  ${Server_Gen}
    ${connections} =  Set Connection for Primary or Secondary Boot   ${enet_connection_primary_4pf}    ${enet_connection_primary_8pf}
    Delete Server Profile    ${bay_list}
    Create Server Profile with Connections Bootmode and BootOrder  ${bay_list}  ${server_profiles_eth[0]}  ${connections}  ${UEFIOptimized_bootmode}  ${Gen9_boot}
    Log into Altair and Verify Server PXE  ${bay_list}
    Get Profile Connections and Verify Ports are Active  ${bay_list}

TC 125: Verify PXE Secondary Boot in UEFIOptimized Mode and Port 2A for C7000 Server
    [Documentation]    Apply server profile with Secondary Boot PXE and UEFIOptimized mode. Power on server and validate it successfully PXE with all active ports for ${Adapter_Test}
    [Tags]    DEA    API    Automated    CNA    PXE    Secondary    UEFIOptimized   QXCR1001532437
    ${bay_list} =  Get Server Bay Based on Server Type  ${Adapter_Test}  ${C7000_Adapter_Models}  ${Server_Gen}
    ${connections} =  Set Connection for Primary or Secondary Boot  ${enet_connection_secondary_4pf}    ${enet_connection_secondary_8pf}
    Delete Server Profile    ${bay_list}
    Create Server Profile with Connections Bootmode and BootOrder  ${bay_list}  ${server_profiles_eth[0]}  ${connections}  ${UEFIOptimized_bootmode}  ${Gen9_boot}
    Log into Altair and Verify Server PXE  ${bay_list}
    Get Profile Connections and Verify Ports are Active  ${bay_list}

TC 126: Verify Enet Connections in Legacy Mode and Ports A-D or A-H for C7000 Server
    [Documentation]    Apply server profile with all Ethernet Ports in Legacy Mode. Validate all ports are active for ${Adapter_Test}
    [Tags]    DEA    API    Automated    CNA    ENET    Legacy
    ${bay_list} =  Get Server Bay Based on Server Type  ${Adapter_Test}  ${C7000_Adapter_Models}  ${Server_Gen}
    ${connections} =  Set Connection for Primary or Secondary Boot   ${enet_connection_primary_4pf}    ${enet_connection_primary_8pf}
    ${connections} =  Change Single Connection Value  ${connections}  1  ETH:2019  boot
    
    #Create Server Profile with Physical Mac Address and ENET connections in Legacy Mode and Primary Boot
    Delete Server Profile    ${bay_list}
    Create Server Profile with Connections Bootmode and BootOrder  ${bay_list}  ${server_profiles_eth[0]}  ${connections}  ${Legacy_bootmode}  ${Gen9_boot_HardDisk}
    Get Profile Connections and Verify Ports are Active  ${bay_list}
    Power On Server and Verify IP Addresses from OS    ${bay_list}    ENET
    ${physical_mac_addresses} =  Compare Mac Addresses from Fusion and iLO     ${bay_list}

    #Create Server Profile with Virtual Mac Address
    Delete Server Profile    ${bay_list}
    Create Server Profile with Connections Bootmode and BootOrder  ${bay_list}  ${server_profiles[0]}  ${connections}  ${Legacy_bootmode}  ${Gen9_boot_HardDisk}  1000
    Power On Server and Verify IP Addresses from OS    ${bay_list}    ENET
    ${virtual_mac_addresses} =  Compare Mac Addresses from Fusion and iLO     ${bay_list}

    #Verify Virtual Mac Address is different from Physical Mac Address
    ${duplicate_mac_addresses} =  Compare Lists Value     ${virtual_mac_addresses}  ${physical_mac_addresses}
    Should Be Empty   ${duplicate_mac_addresses}    msg=Physical and Virtual Mac Addresses should not match

TC 127: Verify Enet Connections in UEFI Mode and Ports A-D or A-H for C7000 Server
    [Documentation]    Apply server profile with all Ethernet Ports in UEFI MOde. Validate all ports are active for ${Adapter_Test}
    [Tags]    DEA    API    Automated    CNA    UEFI    ENET
    ${bay_list} =  Get Server Bay Based on Server Type  ${Adapter_Test}  ${C7000_Adapter_Models}  ${Server_Gen}
    ${connections} =  Set Connection for Primary or Secondary Boot   ${enet_connection_primary_4pf}    ${enet_connection_primary_8pf}
    ${connections} =  Change Single Connection Value  ${connections}  1  ETH:2019  boot
    Delete Server Profile    ${bay_list}
    Create Server Profile with Connections Bootmode and BootOrder  ${bay_list}  ${server_profiles_eth[0]}  ${connections}  ${UEFI_bootmode}  ${Gen9_boot_HardDisk}
    Get Profile Connections and Verify Ports are Active  ${bay_list}

TC 128: Verify Enet Connections in UEFIOptimized Mode and Ports A-D or A-H for C7000 Server
    [Documentation]    Apply server profile with all Ethernet Ports in UEFIOptimized MOde. Validate all pallts are active for ${Adapter_Test}
    [Tags]    DEA    API    Automated    CNA    UEFIOptimized    ENET
    ${bay_list} =  Get Server Bay Based on Server Type  ${Adapter_Test}  ${C7000_Adapter_Models}  ${Server_Gen}
    ${connections} =  Set Connection for Primary or Secondary Boot   ${enet_connection_primary_4pf}    ${enet_connection_primary_8pf}
    ${connections} =  Change Single Connection Value  ${connections}  1  ETH:2019  boot
    Delete Server Profile    ${bay_list}
    Create Server Profile with Connections Bootmode and BootOrder  ${bay_list}  ${server_profiles_eth[0]}  ${connections}  ${UEFIOptimized_bootmode}  ${Gen9_boot_HardDisk}
    Get Profile Connections and Verify Ports are Active  ${bay_list}

TC 129: Verify FCoE Primary Boot in Legacy Mode on Port 1B for C7000 Server
    [Documentation]    Apply server profile with Primary Boot FCoE on Port 1 and Legacy mode. Power on server and validate it successfully boot with all active ports for ${Adapter_Test}
    [Tags]    DEA    API    Automated    CNA    Primary    Legacy    FCOE
    ${bay_list} =  Get Server Bay Based on Server Type  ${Adapter_Test}  ${C7000_Adapter_Models}  ${Server_Gen}
    ${connections} =  Set Connection for Primary or Secondary Boot   ${enet_connection_primary_4pf}    ${enet_connection_primary_8pf}
    ${connections} =  Change Connection Values for ID 1 and 2  ${connections}  FibreChannel  FC:${FC_Name}  FC:${FC_Name2}  ${fc_connection_target_primary}  ${NONE}
    Delete Server Profile    ${bay_list}
    Create Server Profile with Connections Bootmode and BootOrder  ${bay_list}  ${server_profiles_eth[0]}  ${connections}  ${Legacy_bootmode}  ${Gen9_boot_HardDisk}
    Get Profile Connections and Verify Ports are Active  ${bay_list}

TC 130: Verify FCoE Secondary Boot in Legacy Mode on Port 2B for C7000 Server
    [Documentation]    Apply server profile with Secondary Boot FCoE on Port 2 and Legacy mode. Power on server and validate it successfully boot with all active ports for ${Adapter_Test}
    [Tags]    DEA    API    Automated    CNA    Secondary    Legacy    FCOE
    ${bay_list} =  Get Server Bay Based on Server Type  ${Adapter_Test}  ${C7000_Adapter_Models}  ${Server_Gen}
    ${connections} =  Set Connection for Primary or Secondary Boot  ${enet_connection_primary_4pf}    ${enet_connection_primary_8pf}
    ${connections} =  Change Connection Values for ID 1 and 2  ${connections}  FibreChannel  FC:${FC_Name3}  FC:${FC_Name2}  ${fc_connection_target_primary}  ${fc_connection_target_secondary}
    Delete Server Profile    ${bay_list}
    Create Server Profile with Connections Bootmode and BootOrder  ${bay_list}  ${server_profiles_eth[0]}  ${connections}  ${Legacy_bootmode}  ${Gen9_boot_HardDisk}
    Get Profile Connections and Verify Ports are Active  ${bay_list}
    Power On Server and Verify IP Addresses from OS    ${bay_list}  FCOE
    
    #Update Server Profile and Verify Connection with Bandwidth Changes Online
    Change BW Values    ${bay_list}    ${server_profiles_eth[0]}    ${connections}    ${Legacy_bootmode}    ${Gen9_boot_HardDisk}    1000
    Verify Requested Bandwidth    ${bay_list}    1000
    Verify IP Addresses from List of Servers  ${bay_list}

TC 131: Verify FCoE Primary Boot in UEFI Mode on Port 1B for C7000 Server
    [Documentation]    Apply server profile with Primary Boot FCoE on Port 1 and UEFIOptimized mode. Power on server and validate it successfully boot with all active ports for ${Adapter_Test}
    [Tags]    DEA    API    Automated    CNA    Primary    UEFI    FCOE    QXCR1001537197
    ${bay_list} =  Get Server Bay Based on Server Type  ${Adapter_Test}  ${C7000_Adapter_Models}  ${Server_Gen}
    ${connections} =  Set Connection for Primary or Secondary Boot  ${enet_connection_primary_4pf}    ${enet_connection_primary_8pf}
    ${connections} =  Change Connection Values for ID 1 and 2  ${connections}  FibreChannel  FC:${FC_Name}  FC:${FC_Name2}  ${fc_connection_target_primary}  ${None}
    Delete Server Profile    ${bay_list}
    Create Server Profile with Connections Bootmode and BootOrder  ${bay_list}  ${server_profiles_eth[0]}  ${connections}  ${UEFI_bootmode}  ${Gen9_boot_HardDisk}
    Get Profile Connections and Verify Ports are Active  ${bay_list}
    Power On Server and Verify IP Addresses from OS    ${bay_list}  FCOE
    
    #Update Server Profile and Verify Connection with Bandwidth Changes Online
    Change BW Values    ${bay_list}    ${server_profiles_eth[0]}    ${connections}    ${UEFI_boot_mode}    ${Gen9_boot_HardDisk}    1000
    Verify Requested Bandwidth    ${bay_list}    1000
    Verify IP Addresses from List of Servers  ${bay_list}

TC 132: Verify FCoE Secondary Boot in UEFI Mode on Port 2B for C7000 Server
    [Documentation]    Apply server profile with Secondary Boot FCoE on Port 2 and UEFI mode. Power on server and validate it successfully boot with all active ports for ${Adapter_Test}
    [Tags]    DEA    API    Automated    CNA    Secondary    UEFI    FCOE
    ${bay_list} =  Get Server Bay Based on Server Type  ${Adapter_Test}  ${C7000_Adapter_Models}  ${Server_Gen}
    ${connections} =  Set Connection for Primary or Secondary Boot  ${enet_connection_primary_4pf}    ${enet_connection_primary_8pf}
    ${connections} =  Change Connection Values for ID 1 and 2  ${connections}  FibreChannel  FC:${FC_Name3}  FC:${FC_Name2}  ${fc_connection_target_primary}  ${fc_connection_target_secondary}
    Delete Server Profile    ${bay_list}
    Create Server Profile with Connections Bootmode and BootOrder  ${bay_list}  ${server_profiles_eth[0]}  ${connections}  ${UEFI_bootmode}  ${Gen9_boot_HardDisk}
    Get Profile Connections and Verify Ports are Active  ${bay_list}
    
TC 133: Verify FCoE Primary Boot in UEFIOptimized Mode on Port 1B for C7000 Server
    [Documentation]    Apply server profile with Primary Boot FCoE on Port 1 and UEFIOptimized mode. Power on server and validate it successfully boot with all active ports for ${Adapter_Test}
    [Tags]    DEA    API    Automated    CNA    Primary    UEFIOptimized    FCOE    QXCR1001537197
    ${bay_list} =  Get Server Bay Based on Server Type  ${Adapter_Test}  ${C7000_Adapter_Models}  ${Server_Gen}
    ${connections} =  Set Connection for Primary or Secondary Boot  ${enet_connection_primary_4pf}    ${enet_connection_primary_8pf}
    ${connections} =  Change Connection Values for ID 1 and 2  ${connections}  FibreChannel  FC:${FC_Name}  FC:${FC_Name2}  ${fc_connection_target_primary}  ${None}
    Delete Server Profile    ${bay_list}
    Create Server Profile with Connections Bootmode and BootOrder  ${bay_list}  ${server_profiles_eth[0]}  ${connections}  ${UEFIOptimized_bootmode}  ${Gen9_boot_HardDisk}
    Get Profile Connections and Verify Ports are Active  ${bay_list}
    Power On Server and Verify IP Addresses from OS    ${bay_list}  FCOE
    
    #Update Server Profile and Verify Connection with Bandwidth Changes Online
    Change BW Values    ${bay_list}    ${server_profiles_eth[0]}    ${connections}    ${UEFIOptimized_bootmode}    ${Gen9_boot_HardDisk}    1000
    Verify Requested Bandwidth    ${bay_list}    1000
    Verify IP Addresses from List of Servers  ${bay_list}

TC 134: Verify FCoE Secondary Boot in UEFIOptimized Mode on Port 2B for C7000 Server
    [Documentation]    Apply server profile with Secondary Boot FCoE on Port 2 and UEFIOptimized mode. Power on server and validate it successfully boot with all active ports for ${Adapter_Test}
    [Tags]    DEA    API    Automated    CNA    Secondary    UEFIOptimized    FCOE
    ${bay_list} =  Get Server Bay Based on Server Type  ${Adapter_Test}  ${C7000_Adapter_Models}  ${Server_Gen}
    ${connections} =  Set Connection for Primary or Secondary Boot  ${enet_connection_primary_4pf}    ${enet_connection_primary_8pf}
    ${connections} =  Change Connection Values for ID 1 and 2  ${connections}  FibreChannel  FC:${FC_Name3}  FC:${FC_Name2}  ${fc_connection_target_primary}  ${fc_connection_target_secondary}
    Delete Server Profile    ${bay_list}
    Create Server Profile with Connections Bootmode and BootOrder  ${bay_list}  ${server_profiles_eth[0]}  ${connections}  ${UEFIOptimized_bootmode}  ${Gen9_boot_HardDisk}
    Get Profile Connections and Verify Ports are Active  ${bay_list}
    
TC 135: Verify ISCSI Primary Boot in Legacy Mode on Port 1B with Mutual CHAP for C7000 Server
    [Documentation]    Apply server profile with iSCSI Primary Boot on Port 1 and test Gateway in Legacy Mode. Power on server and validate it successfully boot with 16 active ports for ${Adapter_Test}
    [Tags]    DEA    API    Automated    CNA    Primary    Legacy    ISCSI    CHAPM
    ${bay_list} =  Get Server Bay Based on Server Type  ${Adapter_Test}  ${C7000_Adapter_Models}  ${Server_Gen}
    ${connections} =  Set Connection for Primary or Secondary Boot  ${enet_connection_primary_4pf}  ${enet_connection_primary_8pf}

    #Create Server Profile with Physical Mac Address and Test 1st Boot Target IP Address in Legacy Mode and Primary Boot
    ${boot_target} =  Get Boot Target    ${iscsi_emulex_target_primary_legacy}  ${iscsi_broadcom_target_primary_legacy}
    ${connections} =  Change Connection Values for ID 1 and 2  ${connections}  iSCSI  ETH:2019  ETH:VLAN85  ${boot_target}  ${NONE}
    ${connections} =  Add IPv4 Address  ${connections}  ${iscsi_id1_ipv4}  ${NONE}
    Delete Server Profile    ${bay_list}
    Create Server Profile with Connections Bootmode and BootOrder    ${bay_list}  ${server_profiles_eth[0]}  ${connections}  ${Legacy_bootmode}  ${Gen9_boot_HardDisk}
    Get Profile Connections and Verify Ports are Active  ${bay_list}
    Power On Server and Verify IP Addresses from OS    ${bay_list}    ISCSI
    ${physical_mac_addresses} =  Compare Mac Addresses from Fusion and iLO     ${bay_list}

    #Negative Test - Remove gateway IP address and verify that profile cannot be created
    ${ipv4}=  Get From Dictionary    ${connections[0]}    ipv4
    Remove from Dictionary    ${ipv4}    gateway
    Update Server Profile for Negative Test Expecting Error State    ${bay_list}    ${server_profiles_eth[0]}    ${connections}    ${Legacy_bootmode}    ${Gen9_boot_HardDisk}    1000

    #Create Server Profile with Virtual Mac Address, initiator IP, and Target IP address of same subnet and verify that it can boot without gateway.
    Set to Dictionary  ${ipv4}  ipAddress  ${iSCSI_ipv4_1015}
    ${connections} =  Change Connection Values for ID 1 and 2  ${connections}  iSCSI  ETH:Test_Enet  ETH:VLAN85  ${boot_target}  ${NONE}
    Delete Server Profile    ${bay_list}
    Create Server Profile with Connections Bootmode and BootOrder   ${bay_list}  ${server_profiles[0]}  ${connections}  ${Legacy_bootmode}  ${Gen9_boot_HardDisk}  1000
    Power On Server and Verify IP Addresses from OS    ${bay_list}    ISCSI
    ${virtual_mac_addresses} =  Compare Mac Addresses from Fusion and iLO     ${bay_list}

    #Verify Virtual Mac Address is different from Physical Mac Address
    ${duplicate_mac_addresses} =  Compare Lists Value     ${virtual_mac_addresses}  ${physical_mac_addresses}
    Should Be Empty   ${duplicate_mac_addresses}    msg=Physical and Virtual Mac Addresses should not match

TC 136: Verify ISCSI Secondary Boot in Legacy Mode on Port 2B for C7000 Server
    [Documentation]    Apply server profile with iSCSI Secondary Boot on Port 2 in Legacy Mode. Power on server and validate it successfully boot with 16 active ports for ${Adapter_Test}
    [Tags]    DEA    API    Automated    CNA    Secondary    Legacy    ISCSI    QXCR1001532166    OVD7650
    ${bay_list} =  Get Server Bay Based on Server Type  ${Adapter_Test}  ${C7000_Adapter_Models}  ${Server_Gen}
    ${connections} =  Set Connection for Primary or Secondary Boot  ${enet_connection_primary_4pf}  ${enet_connection_primary_8pf}
    ${boot_target1} =  Get Boot Target    ${iscsi_emulex_target_primary_legacy}  ${iscsi_broadcom_target_primary_legacy}
    ${boot_target2} =  Get Boot Target    ${iscsi_emulex_target_secondary_legacy}  ${iscsi_broadcom_target_secondary_legacy}

    #Test 2nd Boot Target IP Address in Legacy Mode and Secondary Boot
    ${iscsi_boot_target2}=  Get from Dictionary    ${boot_target2}    iscsi
    Set to Dictionary  ${iscsi_boot_target2}    firstBootTargetIp    ${iSCSI_Boot_Target_IP_NULL}
    Set to Dictionary  ${iscsi_boot_target2}    secondBootTargetIp   ${iSCSI_Boot_Target_IP}
    ${connections} =  Change Connection Values for ID 1 and 2  ${connections}  iSCSI  ETH:VLAN85  ETH:2019  ${boot_target1}  ${boot_target2}
    ${connections} =  Add IPv4 Address  ${connections}  ${iscsi_id2_ipv4}   ${iscsi_id_ipv4_dhcp}
    Delete Server Profile    ${bay_list}
    Create Server Profile with Connections Bootmode and BootOrder    ${bay_list}  ${server_profiles_eth[0]}  ${connections}  ${Legacy_bootmode}  ${Gen9_boot_HardDisk}
    Get Profile Connections and Verify Ports are Active  ${bay_list}
    Power On Server and Verify IP Addresses from OS    ${bay_list}    ISCSI

    #Update Server Profile and Verify Connection with Bandwidth Changes Online
    Change BW Values    ${bay_list}    ${server_profiles_eth[0]}    ${connections}    ${Legacy_bootmode}    ${Gen9_boot_HardDisk}    1000
    Verify IP Addresses from List of Servers  ${bay_list}

TC 137: Verify ISCSI Primary Boot in UEFI Mode with CHAP on Port 1B for C7000 Server
    [Documentation]    Apply server profile with iSCSI Primary Boot on Port 1 with CHAP in UEFI Mode. Power on server and validate it successfully boot with 16 active ports for ${Adapter_Test}
    [Tags]    DEA    API    Automated    CNA    Primary    UEFI    ISCSI    CHAP
    ${bay_list} =  Get Server Bay Based on Server Type  ${Adapter_Test}  ${C7000_Adapter_Models}  ${Server_Gen}
    ${connections} =  Set Connection for Primary or Secondary Boot  ${enet_connection_primary_4pf}    ${enet_connection_primary_8pf}

    #Create Server Profile with Physical Mac Address and Test 1st Boot Target IP Address in UEFI Mode and Primary Boot
    ${boot_target} =  Get Boot Target    ${iscsi_emulex_target_primary_uefi}  ${iscsi_broadcom_target_primary_uefi}
    ${connections} =  Change Connection Values for ID 1 and 2  ${connections}  iSCSI  ETH:2019  ETH:VLAN85  ${boot_target}  ${NONE}
    ${connections} =  Add IPv4 Address  ${connections}  ${iscsi_id2_ipv4}  ${NONE}
    Delete Server Profile    ${bay_list}
    Create Server Profile with Connections Bootmode and BootOrder  ${bay_list}  ${server_profiles_eth[0]}  ${connections}  ${UEFI_boot_mode}  ${Gen9_boot_HardDisk}
    Get Profile Connections and Verify Ports are Active  ${bay_list}
    Power On Server and Verify IP Addresses from OS    ${bay_list}    ISCSI
    ${physical_mac_addresses} =  Compare Mac Addresses from Fusion and iLO     ${bay_list}

    #Negative Test - Remove gateway IP address and verify that profile cannot be created
    ${ipv4}=  Get From Dictionary    ${connections[0]}    ipv4
    Remove from Dictionary    ${ipv4}    gateway
    Update Server Profile for Negative Test Expecting Error State    ${bay_list}    ${server_profiles_eth[0]}    ${connections}    ${UEFI_boot_mode}    ${Gen9_boot_HardDisk}    1000

    #Create Server Profile with Virtual Mac Address, initiator IP, and Target IP address of same subnet and verify that it can boot without gateway.
    Set to Dictionary  ${ipv4}  ipAddress  ${iSCSI_ipv4_1015}
    ${connections} =  Change Connection Values for ID 1 and 2  ${connections}  iSCSI  ETH:Test_Enet  ETH:VLAN85  ${boot_target}  ${NONE}
    Delete Server Profile    ${bay_list}
    Create Server Profile with Connections Bootmode and BootOrder   ${bay_list}  ${server_profiles[0]}  ${connections}  ${UEFI_boot_mode}  ${Gen9_boot_HardDisk}  1000
    Power On Server and Verify IP Addresses from OS    ${bay_list}    ISCSI
    ${virtual_mac_addresses} =  Compare Mac Addresses from Fusion and iLO     ${bay_list}

    #Verify Virtual Mac Address is different from Physical Mac Address
    ${duplicate_mac_addresses} =  Compare Lists Value     ${virtual_mac_addresses}  ${physical_mac_addresses}
    Should Be Empty   ${duplicate_mac_addresses}    msg=Physical and Virtual Mac Addresses should not match

TC 138: Verify ISCSI Secondary Boot in UEFI Mode on Port 2B and BW Updates for C7000 Server
    [Documentation]    Apply server profile with iSCSI Secondary Boot on Port 2 in UEFI Mode. Power on server and validate it successfully boot with 16 active ports for ${Adapter_Test}
    [Tags]    DEA    API    Automated    CNA    Secondary    UEFI    ISCSI    QXCR1001532166    OVD7650
    ${bay_list} =  Get Server Bay Based on Server Type  ${Adapter_Test}  ${C7000_Adapter_Models}  ${Server_Gen}
    ${connections} =  Set Connection for Primary or Secondary Boot  ${enet_connection_primary_4pf}  ${enet_connection_primary_8pf}
    ${boot_target1} =  Get Boot Target    ${iscsi_emulex_target_primary_uefi}  ${iscsi_broadcom_target_primary_uefi}
    ${boot_target2} =  Get Boot Target    ${iscsi_emulex_target_secondary_uefi}  ${iscsi_broadcom_target_secondary_uefi}

    #Test 2nd Boot Target IP Address in UEFI Mode and Secondary Boot
    ${iscsi_boot_target2}=  Get from Dictionary    ${boot_target2}    iscsi
    Set to Dictionary  ${iscsi_boot_target2}    firstBootTargetIp    ${iSCSI_Boot_Target_IP_NULL}
    Set to Dictionary  ${iscsi_boot_target2}    secondBootTargetIp   ${iSCSI_Boot_Target_IP}
    ${connections} =  Change Connection Values for ID 1 and 2  ${connections}  iSCSI  ETH:VLAN85  ETH:2019  ${boot_target1}  ${boot_target2}
    ${connections} =  Add IPv4 Address  ${connections}  ${iscsi_id2_ipv4}   ${iscsi_id_ipv4_dhcp}
    Delete Server Profile    ${bay_list}
    Create Server Profile with Connections Bootmode and BootOrder    ${bay_list}  ${server_profiles_eth[0]}  ${connections}  ${UEFI_boot_mode}  ${Gen9_boot_HardDisk}
    Get Profile Connections and Verify Ports are Active  ${bay_list}
    Power On Server and Verify IP Addresses from OS    ${bay_list}    ISCSI
    
    #Update Server Profile and Verify Connection with Bandwidth Changes Online
    Change BW Values    ${bay_list}    ${server_profiles_eth[0]}    ${connections}    ${UEFI_boot_mode}    ${Gen9_boot_HardDisk}    1000
    Verify IP Addresses from List of Servers  ${bay_list}

TC 139: Verify ISCSI Primary Boot in UEFI Mode with CHAP on Port 1B for C7000 Server
    [Documentation]    Apply server profile with iSCSI Primary Boot on Port 1 with CHAP in UEFIOptimized Mode. Power on server and validate it successfully boot with 16 active ports for ${Adapter_Test}
    [Tags]    DEA    API    Automated    CNA    Primary    UEFI    ISCSI    CHAP
    ${bay_list} =  Get Server Bay Based on Server Type  ${Adapter_Test}  ${C7000_Adapter_Models}  ${Server_Gen}
    ${connections} =  Set Connection for Primary or Secondary Boot  ${enet_connection_primary_4pf}  ${enet_connection_primary_8pf}

    #Test 1st Boot Target IP Address in UEFIOptimized Mode and Primary Boot
    ${boot_target} =  Get Boot Target    ${iscsi_emulex_target_primary_uefi}  ${iscsi_broadcom_target_primary_uefi}
    ${connections} =  Change Connection Values for ID 1 and 2  ${connections}  iSCSI  ETH:2019  ETH:VLAN85  ${boot_target}  ${NONE}
    ${connections} =  Add IPv4 Address  ${connections}  ${iscsi_id3_ipv4}  ${NONE}
    Delete Server Profile    ${bay_list}
    Create Server Profile with Connections Bootmode and BootOrder    ${bay_list}  ${server_profiles_eth[0]}  ${connections}  ${UEFIOptimized_bootmode}  ${Gen9_boot_HardDisk}
    Get Profile Connections and Verify Ports are Active  ${bay_list}
    Power On Server and Verify IP Addresses from OS    ${bay_list}    ISCSI
    ${physical_mac_addresses} =  Compare Mac Addresses from Fusion and iLO     ${bay_list}

    #Negative Test - Remove gateway IP address and verify that profile cannot be created
    ${ipv4}=  Get From Dictionary    ${connections[0]}    ipv4
    Remove from Dictionary    ${ipv4}    gateway
    Update Server Profile for Negative Test Expecting Error State    ${bay_list}    ${server_profiles_eth[0]}    ${connections}    ${UEFIOptimized_bootmode}    ${Gen9_boot_HardDisk}    1000

    #Create Server Profile with Virtual Mac Address, initiator IP, and Target IP address of same subnet and verify that it can boot without gateway.
    Set to Dictionary  ${ipv4}  ipAddress  ${iSCSI_ipv4_1015}
    ${connections} =  Change Connection Values for ID 1 and 2  ${connections}  iSCSI  ETH:Test_Enet  ETH:VLAN85  ${boot_target}  ${NONE}
    Delete Server Profile    ${bay_list}
    Create Server Profile with Connections Bootmode and BootOrder   ${bay_list}  ${server_profiles[0]}  ${connections}  ${UEFIOptimized_bootmode}  ${Gen9_boot_HardDisk}  1000
    Power On Server and Verify IP Addresses from OS    ${bay_list}    ISCSI
    ${virtual_mac_addresses} =  Compare Mac Addresses from Fusion and iLO     ${bay_list}

    #Verify Virtual Mac Address is different from Physical Mac Address
    ${duplicate_mac_addresses} =  Compare Lists Value     ${virtual_mac_addresses}  ${physical_mac_addresses}
    Should Be Empty   ${duplicate_mac_addresses}    msg=Physical and Virtual Mac Addresses should not match

TC 140: Verify ISCSI Secondary Boot in UEFIOptimized Mode on Port 2B and BW Updates for C7000 Server
    [Documentation]    Apply server profile with iSCSI Secondary Boot on Port 2 in UEFIOptimized Mode. Power on server and validate it successfully boot with 16 active ports for ${Adapter_Test}
    [Tags]    DEA    API    Automated    CNA    Secondary    UEFIOptimized    ISCSI    QXCR1001532166    OVD7650
    ${bay_list} =  Get Server Bay Based on Server Type  ${Adapter_Test}  ${C7000_Adapter_Models}  ${Server_Gen}
    ${connections} =  Set Connection for Primary or Secondary Boot  ${enet_connection_primary_4pf}  ${enet_connection_primary_8pf}
    ${boot_target1} =  Get Boot Target    ${iscsi_emulex_target_primary_uefi}  ${iscsi_broadcom_target_primary_uefi}
    ${boot_target2} =  Get Boot Target    ${iscsi_emulex_target_secondary_uefi}  ${iscsi_broadcom_target_secondary_uefi}

    #Test 2nd Boot Target IP Address in UEFIOptimized Mode and Secondary Boot
    ${iscsi_boot_target2}=  Get from Dictionary    ${boot_target2}    iscsi
    Set to Dictionary  ${iscsi_boot_target2}    firstBootTargetIp    ${iSCSI_Boot_Target_IP_NULL}
    Set to Dictionary  ${iscsi_boot_target2}    secondBootTargetIp   ${iSCSI_Boot_Target_IP}
    ${connections} =  Change Connection Values for ID 1 and 2  ${connections}  iSCSI  ETH:VLAN85  ETH:2019  ${boot_target1}  ${boot_target2}
    ${connections} =  Add IPv4 Address  ${connections}  ${iscsi_id2_ipv4}   ${iscsi_id_ipv4_dhcp}
    Delete Server Profile    ${bay_list}
    Create Server Profile with Connections Bootmode and BootOrder    ${bay_list}  ${server_profiles_eth[0]}  ${connections}  ${UEFIOptimized_bootmode}  ${Gen9_boot_HardDisk}
    Get Profile Connections and Verify Ports are Active  ${bay_list}
    Power On Server and Verify IP Addresses from OS    ${bay_list}    ISCSI
    
    #Update Server Profile and Verify Connection with Bandwidth Changes Online
    Change BW Values    ${bay_list}    ${server_profiles_eth[0]}    ${connections}    ${UEFIOptimized_bootmode}    ${Gen9_boot_HardDisk}    1000
    Verify IP Addresses from List of Servers  ${bay_list}
