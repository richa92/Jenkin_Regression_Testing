*** Settings ***
Documentation    Test suite to validate RisTestEvent on OneView and FLM
...    It covers testing of:
...      RisTestEvent

...    = GENERIC USAGE =
...    | pybot | -v ENC_SERIAL_NO:[enclosure serial #] | -v APPLIANCE_IP:<ipv4> | -v CIM_Linux_IP:<ipv4> |-v GIT_REPO_ROOT: | RIS_test_event.txt |
...    = Variables =
...    | GIT_REPO_ROOT |      Required: Repo root path if NOT defined in environment variable this is mgmtfw root location|
...    | ENC_SERIAL_NO |      Optional: If omitted, will use the 1st enclosure detected in OV |
...    | APPLIANCE_IP |       Required: OneView IPv4 address |
...    | CIM_Linux_IP |       Required:CI Manager ipv4 under test |

Variables         ${GIT_REPO_ROOT}/fusion/tests/DEA/variables/dea_variables.py
Variables         ${GIT_REPO_ROOT}/mgmtfw/tests/thunderbird/variables/tBird_variables.py
Resource          ${GIT_REPO_ROOT}${RESOURCE_ROOT}/resource_all.txt
Resource          ${GIT_REPO_ROOT}${EM_RESOURCE_ROOT}/thunderbird_all.txt
Library           RoboGalaxyLibrary
Library           MgmtFWLibrary
Library           json

Suite Setup       Configure Events Test Environment
Suite Teardown    Run Keywords  Logout of EM RIS   AND    Logout of Fusion Via REST

*** Test Case ***
TC 01: verify RisTestEvent show up in OV UI
    [Documentation]    This test will verify RisTestEvent
    [Tags]    RisTestEvent    FLM2.00   Automated
    ${last_fusion_event_id}=    get last fusion event ID
    ${claim_ip}=    Get EM Claim Information
    ${event_id}=    Get Event Subscription Eventid    ${All_Event_Types}    ${claim_ip}
    Build RIS Object Model at Root Level
    Sleep    10
    ${send_test_event}    ${resp_body}=    EM Send Test Event To Single Subscription    ${event_id}    ${Alert_Test_Event}
    Dictionary Should Contain Value    ${send_test_event}    ${EM_Accept_Request}
    Sleep    5
    #Verifying resource updated event in diags audit log with 50 recent entries
    ${diags_50}    ${diags_auditlog_file_path}=    Get Diags Audit Log 50 Recent Entries
    Set Test Variable    ${EM_Event_Logger}    ${diags_auditlog_file_path}
    Verify Audit Log for RisTestEvent    250
    Verify Fusion RisTestEvent Sent By EM    ${Test_RIS_Event_Message_ID}    ${last_fusion_event_id}
