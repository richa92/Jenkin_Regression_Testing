*** Settings ***
Documentation    Chassis_Fault_Event.txt - Validate Chassis Alerts on OneView
...    = GENERIC USAGE =
...    | pybot | -v GIT_REPO_ROOT:<repo root path> | -v APPLIANCE_IP:<ipv4> | Chassis_Fault_Event.txt |
...    = Variables =
...    | GIT_REPO_ROOT |      Required: Repo root path if NOT defined in environment variable|
...    | APPLIANCE_IP |       Required: OneView IPv4 address |

Library           MgmtFWLibrary
Library           json
Library           robot.api.logger
Variables         ${GIT_REPO_ROOT}/fusion/tests/DEA/variables/dea_variables.py
Variables         ${GIT_REPO_ROOT}/mgmtfw/tests/thunderbird/variables/tBird_variables.py
Resource          ${GIT_REPO_ROOT}${RESOURCE_ROOT}/resource_all.txt
Resource          ${GIT_REPO_ROOT}${EM_RESOURCE_ROOT}/thunderbird_all.txt
Suite Setup       Configure Events Test Environment
Suite Teardown    Run Keywords    Logout of Fusion Via REST    AND    Logout of EM RIS

*** Test Case ***
TC 01: Validate ChassisRedundantCommFault And ChassisRedundantCommFaultCleared
    [Documentation]    Verify ChassisRedundantCommFault and ChassisRedundantCommFaultCleared with Dual EM
    [Tags]    Chassis    FLM2.02    Automated
    ${last_fusion_event_id}=    Get Last Fusion Event Id
    ${response} =   Set Diags CanRedFake Value    ALL   A   A   ChassisRedundantCommFault
    Sleep    20
    Run Keywords    Login to Fusion via SSH    AND    Login to EM And Create Session
    ${diags_50}    ${diags_auditlog_file_path}=    Get Diags Audit Log 50 Recent Entries
    Set Test Variable    ${EM_Event_Logger}    ${diags_auditlog_file_path}
    Verify Audit Log Alert Event    ${Chassis_Redundant_CommFault}    ${Chassis_Device}    1    240
    Verify Fusion Event Sent By EM    ${Chassis_Redundant_CommFault}    ${last_fusion_event_id}
    ${response} =   Set Diags CanRedFake Value    ALL   NORMAL   NORMAL
    Sleep    20
    ${diags_50}    ${diags_auditlog_file_path}=    Get Diags Audit Log 50 Recent Entries
    Set Test Variable    ${EM_Event_Logger}    ${diags_auditlog_file_path}
    Verify Audit Log Alert Event    ${Chassis_Redundant_CommFault_Cleared}    ${Chassis_Device}    1    240
    Verify Fusion Event Sent By EM    ${Chassis_Redundant_CommFault_Cleared}    ${last_fusion_event_id}
    [Teardown]    Run Keyword if Test Failed    Run Keywords
    ...   Set Diags CanRedFake Value    ALL    NORMAL    NORMAL
    ...   AND   Get Diags CanRedMon