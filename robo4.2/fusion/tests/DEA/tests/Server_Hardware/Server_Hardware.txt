*** Settings ***
Documentation     Test suite to verify server hardware for a given bay.
...               pybot -L TRACE | GIT_REPO_ROOT:<path> | APPLIANCE_IP:<fusion_ipv4> | FUSION_PASSWORD:<password> | Server_Bay:<server_bay> | Server_Hardware.txt

Variables         ${GIT_REPO_ROOT}/fusion/tests/DEA/variables/dea_variables.py
Variables         ${GIT_REPO_ROOT}/fusion/tests/DEA/variables/data_variables.py
Variables         ${GIT_REPO_ROOT}/mgmtfw/tests/thunderbird/variables/tBird_variables.py
Resource          ${GIT_REPO_ROOT}${RESOURCE_ROOT}/resource_all.txt
Resource          ${GIT_REPO_ROOT}${EM_RESOURCE_ROOT}/thunderbird_all.txt

Library           RoboGalaxyLibrary
Library           MgmtFWLibrary
Library           FusionLibrary
Library           Collections

Suite Setup       Login to Fusion Via REST
Suite Teardown    Run Keywords    Logout of iLO    Logout of Fusion Via REST
*** Test Cases ***
TC01: OV Server Hardware: Verify power state with ILO power state
    [Documentation]    Verifies that the power state displayed in OneView matches what is displayed in iLO
    [Tags]    CNA    SH
    ${server_info}=    Get Server Information    ${Server_Bay}
    Should Not Be Equal    ${server_info}    False    msg=Bay ${Server_Bay} does not have a blade
    ${ilo_sh_info}=    Get Blade Server Info From iLO    ${server_info}
    Should Be Equal    ${server_info['powerState'].strip()}    ${ilo_sh_info['PowerState'].strip()}
    [Teardown]    Run Keyword If Test Failed        Send Email Notify
    
TC02: OV Server Hardware: Verify model with ILO model
    [Documentation]    Verifies that the model displayed in OneView matches what is displayed in iLO
    [Tags]    CNA    SH
    ${server_info}=    Get Server Information    ${Server_Bay}
    Should Not Be Equal    ${server_info}    False    msg=Bay ${Server_Bay} does not have a blade
    ${ilo_sh_info}=    Get Blade Server Info From iLO    ${server_info}
    Should Be Equal    ${server_info['model'].strip()}    ${ilo_sh_info['Model'].strip()}
    [Teardown]    Run Keyword If Test Failed        Send Email Notify
    
TC03: OV Server Hardware: Verify serial number with ILO serial number
    [Documentation]    Verifies that the serial number displayed in OneView matches what is displayed in iLO
    [Tags]    CNA    SH
    ${server_info}=    Get Server Information    ${Server_Bay}
    Should Not Be Equal    ${server_info}    False    msg=Bay ${Server_Bay} does not have a blade
    ${ilo_sh_info}=    Get Blade Server Info From iLO    ${server_info}
    Should Be Equal    ${server_info['serialNumber'].strip()}    ${ilo_sh_info['SerialNumber'].strip()}
    [Teardown]    Run Keyword If Test Failed        Send Email Notify
    
TC04: OV Server Hardware: Verify processor count with ILO processor count
    [Documentation]    Verifies that the processor count displayed in OneView matches what is displayed in iLO
    [Tags]    CNA    SH
    ${server_info}=    Get Server Information    ${Server_Bay}
    Should Not Be Equal    ${server_info}    False    msg=Bay ${Server_Bay} does not have a blade
    ${ilo_sh_info}=    Get Blade Server Info From iLO    ${server_info}
    Should Be Equal    ${server_info['processorCount']}    ${ilo_sh_info['ProcessorSummary.Count']}
    [Teardown]    Run Keyword If Test Failed        Send Email Notify 
    
TC05: OV Server Hardware: Verify processor type with ILO processor type
    [Documentation]    Verifies that the processor type displayed in OneView matches what is displayed in iLO
    [Tags]    CNA    SH
    ${server_info}=    Get Server Information    ${Server_Bay}
    Should Not Be Equal    ${server_info}    False    msg=Bay ${Server_Bay} does not have a blade
    ${ilo_sh_info}=    Get Blade Server Info From iLO    ${server_info}
    Should Be Equal    ${server_info['processorType'].strip()}    ${ilo_sh_info['ProcessorSummary.Model'].strip()}
    [Teardown]    Run Keyword If Test Failed        Send Email Notify
    
TC06: OV Server Hardware: Verify memory amount with ILO memory amount
    [Documentation]    Verifies that the memory amount displayed in OneView matches what is displayed in iLO
    [Tags]    CNA    SH
    ${server_info}=    Get Server Information    ${Server_Bay}
    Should Not Be Equal    ${server_info}    False    msg=Bay ${Server_Bay} does not have a blade
    ${ilo_sh_info}=    Get Blade Server Info From iLO    ${server_info}
    ${ov_memory_gb}=    Evaluate    ${server_info['memoryMb']}/1024
    Should Be Equal    ${ov_memory_gb}    ${ilo_sh_info['MemorySummary.TotalSystemMemoryGiB']}
    [Teardown]    Run Keyword If Test Failed        Send Email Notify
    
TC07: OV Server Hardware: Verify server hardware type URI is not empty
    [Documentation]    Verifies that the server hardware URI displayed in OneView is not blank
    [Tags]    CNA    SH
    ${server_info}=    Get Server Information    ${Server_Bay}
    Should Not Be Equal    ${server_info}    False    msg=Bay ${Server_Bay} does not have a blade
    ${ilo_sh_info}=    Get Blade Server Info From iLO    ${server_info}
    Should Not Be Empty    ${server_info['serverHardwareTypeUri']}
    [Teardown]    Run Keyword If Test Failed        Send Email Notify