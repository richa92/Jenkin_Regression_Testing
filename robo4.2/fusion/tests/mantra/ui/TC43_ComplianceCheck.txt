*** Settings ***
Documentation        TC43: Check if compliance and health reports the mismatch and resolution '\n' After On-Site Setup simulate a compliance failure (due to some HW/FW change)
Resource             ../resources/resources.txt
Suite Teardown        Logout and Close All Browsers
Suite Setup        PreTest Open Browser and perform Login

*** Variables ***
${SeleniumSpeed}    1.0
${ComplianceTask}    Refresh ConvergedSystem compliance results
${SystemProfileName}    myCS700Profile

*** Test Cases ***
TEST 1: Verify that System Profile is in OK status
    Check System Profiles Dashboard Status    OK
    Check System Profile Status    myCS700Profile    OK

TEST 2: Edit a profile to manually manage firmware
    ${status}=           Fusion UI Edit Server Profile    @{TestData.OnSiteMgmProfileEditComplianceError}
    Run Keyword If      '${status}' == 'False'       Fail                FAIL: Error updating server profile.

TEST 3: Wait for compliance task to run
    Wait For System Profile Task    ${ComplianceTask}

TEST 4: Verify that System Profile is in Warning status
    Check System Profile Status    myCS700Profile    Warning
    Check System Profiles Dashboard Status    Warning

TEST 5: Edit the profile to its original configuration (managing firmware)
    ${status}=           Fusion UI Edit Server Profile    @{TestData.OnSiteMgmProfileEditComplianceOK}
    Run Keyword If      '${status}' == 'False'       Fail                FAIL: Error updating server profile.

TEST 6: Wait for compliance task to run
    Wait For System Profile Task    ${ComplianceTask}

TEST 7: Verify that System Profile is in OK status
    Check System Profile Status    myCS700Profile    OK
    Check System Profiles Dashboard Status    OK

