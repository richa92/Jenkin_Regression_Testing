*** Settings ***
Documentation        Initiate and verify Full-Factory-Reset
Resource            ../Resource/CIM_CommonResource.txt
Resource            ../Resource-40/CIM_CommonResource.txt
Resource            ../Resource-40/CIM_Appliance.txt
Resource            ../Resource/CIM_Settings.txt
Test Setup            Load Test Data and Open Browser
Test Teardown        Logout and close all browsers
Variables            ../../../../FusionLibrary/ui/settings/settings_elements.py
Variables            ../../../../FusionLibrary/ui/business_logic/settings/networking_elements.py
Variables            ../../../../FusionLibrary/ui/general/login_elements.py

*** Variables ***
${HTTPS}            https://
${searchtext}        Appliance reset to factory defaults

*** Test Cases ***
As an administrator I want to initiate and verify Full Factory Reset
    [Documentation]    Perform Appliance Full Factory Reset
    Log into Fusion appliance as Administrator
    ${IP_Before_Factory_Reset} =    Get appliance ip from url

    #Initiate Full Factory Reset
    Navigate to    Settings    Appliance
    Initiate Full Factory Reset

    #Wait for appliance to be assigned a different IP address
    Run Keyword And Ignore Error    Wait until appliance is assigned a new IP    ${IP_Before_Factory_Reset}    1200     30

    #Navigate to the new appliance IP
    ${IP_After_Factory_Reset}=    Get VM IPAddress
    Log    ${IP_After_Factory_Reset}    WARN
    ${URL}=    Catenate    SEPARATOR=    ${HTTPS}    @{IP_After_Factory_Reset}
    Go To    ${URL}

    #Wait for factory reset to complete and EULA page to display
    wait for element visible    ${FusionLoginPage.ID_BTN_EULA_AGREE}    2000

    #FTS
    Fusion UI Configure First Time Wizard

As an administrator I want to verify whether the entry is present in Audit Logs
    [Documentation]    Check Factory Reset entry is present in audit log file
    Log into Fusion appliance as Administrator
    ${filepath}=    Download and unzip Audit log file    ${DownloadPath}
    ${bln_logentry_exists} =    file_contains    ${filepath}    ${searchtext}
    Should Be Equal As Strings    ${bln_logentry_exists}    ${blnExpected}    msg=Entry ${searchtext} not available in log file.
