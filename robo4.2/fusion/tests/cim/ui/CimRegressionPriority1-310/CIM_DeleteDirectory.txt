*** Settings ***
Documentation	Delete Directory server and Directory
Resource		../Resource/CIM_CommonResource.txt
Resource		../Resource/CIM_Security.txt
Test Setup		Load Test Data and Open Browser
Test Teardown	Logout and close all browsers
Variables		../../../../FusionLibrary/ui/settings/settings_elements.py
Variables		../../../../FusionLibrary/ui/business_logic/general/base_elements.py

*** Variables ***
@{available_directory}
${ID_DIRECTORY_SERVER_DELETE}	//*[@id='fs-dir-servers-table']/tbody/tr/td/div[@Class='hp-close']
${searchtext}	A login domain configuration was removed from the system

*** Test Cases ***
Delete Directory server and Directory
	#Get testdata for Ad and LDAP
	${dir} =	Get test data for 'Active Directory'

	Log into Fusion appliance as Administrator
	Navigate to page	Settings

	#Get the list of existing directories
	${dir_count} =	Get Matching Xpath Count	//*[@id='fs-settings-security-overview-directories']/li
	${avail_dir} =	Run Keyword If	'${dir_count}' > '1'	Fetch available Directories from Appliance	${dir_count}	${available_directory}

	#Delete directory server validation
	Navigate to panel	Security
	Select action	Edit
	wait for element and click	${FusionSettingsPage.ID_BTN_ADD_DIRECTORY_SETTINGS}
	wait for element and click	${FusionSettingsPage.ID_BTN_ADD_DIRECTORY}
	Add directory server	${dir}
	Delete directory server	${dir}
	wait for element and click	${FusionSettingsPage.ID_BTN_DIR_SERVER_CANCEL}

	#Delete directory validation
	Delete directory	${avail_dir}
	wait for element and click	//*[@id='hp-settings-edit-ok']

	#Verify activity page
	Navigate to page	Activity
	wait for element visible	//*[@id='hp-activities']/tbody//tr[1][//span[text()='Remove Directory'] and td/a[text()='Security'] and td/div[text()='Administrator']]	10
	${count}=	Get Matching XPath Count	//*[@id='hp-activities']/tbody//tr[1][//span[text()='Remove Directory'] and td/a[text()='Security'] and td/div[text()='Administrator']]
	Should Be Equal As Integers	${count}	${activityCount}	msg=Given alert "Remove Directory by Administrator in Completed State" is not present in the activity page

	#Verify entry in auditlog file.
	Download and verify entry in Audit log file	${DownloadPath}	${searchtext}
