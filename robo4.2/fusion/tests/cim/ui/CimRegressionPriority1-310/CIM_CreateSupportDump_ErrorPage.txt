*** Settings ***
Documentation	Run create support dump (Error Page)
Resource	../Resource/CIM_CommonResource.txt
Resource	../Resource/CIM_Appliance.txt
Resource	../Resource/CIM_SupportDump.txt
Test Setup	Load Test Data and Open Browser
Test Teardown	Logout and close all browsers

*** Test Cases ***
Run create support dump in error page
	Induce error in appliance
	Reload Page
	Create support dump in error page	${TestData.users[0].name}	${TestData.users[0].password}
	Wait Until Element Is Visible	${FusionSettingsPage.ID_LINK_RESTART_ERRORPAGE}	60
	Click Element	${FusionSettingsPage.ID_LINK_RESTART_ERRORPAGE}
	Click Element	${FusionSettingsPage.ID_LINK_RESTART_ERRORPAGE}
	Click Element	${FusionSettingsPage.ID_LINK_RESTART_ERRORPAGE}
	Reload page
	Log	Restart link clicked	WARN
	${IsApplianceStarting} =	Is Starting page displayed?	600	60
	Run Keyword If	'${IsApplianceStarting}'=='YES'	Log	Starting page displayed.	WARN
	${IsApplianceIDLE} =	Is appliance in IDLE state?	1200	120
	Run Keyword If	'${IsApplianceIDLE}'=='YES'	Log	Appliance restart completed successfully!	WARN

*** Keywords ***
Induce error in appliance
	${IP} =	Get appliance ip from url
	${command_to_induce_error_in_appliance} =	Set Variable	/ci/bin/set-controller-state --state ERROR
	${output} =	Execute Command on Remote VM	${IP}	${TestData.RootUserCredentials[0].username}	${TestData.RootUserCredentials[0].password}	${command_to_induce_error_in_appliance}
	${Is_Error_Induced_Successfully} =	Run Keyword And Return Status	Should Contain	${output}	Gracefully restarting httpd
	Run Keyword If	'${Is_Error_Induced_Successfully}'=='True'	Log	Error induced in appliance successfully!	INFO	console=yes
	...	ELSE	Fail	Failed to induce error in appliance!
