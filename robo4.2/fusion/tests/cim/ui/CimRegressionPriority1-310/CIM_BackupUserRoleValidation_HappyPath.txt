*** Settings ***
Documentation		Backup Directory users Happy path
Resource			../Resource/CIM_CommonResource.txt
Library				FusionLibrary
Suite Setup			Load Test Data and Open Browser
Suite Teardown		Logout And Close All Browsers
Variables			../../../../FusionLibrary/ui/settings/settings_elements.py
Variables			../../../../FusionLibrary/ui/general/login_elements.py
Variables			../../../../FusionLibrary/ui/business_logic/general/base_elements.py
Variables			../../../../../rg/RoboGalaxyLibrary/ui/common/PerfConstants_File.py

*** Variables ***
${activitystate}		Completed
${activityowner}		Atlas Backup

*** Test Cases ***
Login as Backup Admin Directory User
	[Documentation]	Login as Backup admin directory User
	${user} =	Get data by property	${TestData.DirectoryUsers}	role	Backupadmin
	Login as Directory User	${user[0].domainName}	${user[0].userName}	${user[0].userPswd}

	#Verify create support dump
	Navigate to page	Settings
	${status} =	Fusion UI Create Support Dump From Data File	@{TestData.supportdump}
	Should Be True	${status}	msg=Failed to create Support Dump
	wait for element visible	${FusionSettingsPage.ID_VALIDATE_SUCCESS}	${PerfConstants.LOAD_ALERT_ACTIVITY}

	#Verify Create Backup logging as Backup directory user
	Navigate to page	Settings
	Fusion UI Create Backup

	#Verify Download Backup
	Create Folder If not Exists	${DownloadPath}
	Navigate to page	Settings
	Fusion UI Download Backup	${DownloadPath}

	#Verify activity in Activity Page
	Navigate to page	Activity
	@{List}	Create List	Download backup	Create backup	Create support dump
	:FOR	${Item}	IN	@{List}
	\	${xpath} =	Set Variable	.//*[@id='hp-activities']/tbody//*[td/p/span[text()='${Item}'] and td/div[text()='${activityowner}'] and td/span[text()='${activitystate}']]
	\	${count} =	Get Matching XPath Count	${xpath}
	\	Run Keyword If	'${count}' >= '1'	Log	${Item} Activity is present in the activity page
	\	Run Keyword Unless	'${count}' >= '1'	Fail	${Item} Activity is not present in the activity page
