*** Settings ***
Library           RoboGalaxyLibrary
Library           BuiltIn
Library           String
Library           Collections
Resource          ../Resource/CIM_CommonResource.txt
Resource          ../Resource/CIM_Certificate.txt
Variables         ../../../../FusionLibrary/ui/settings/settings_elements.py

*** Variables ***
${count}          1

*** Keywords ***
Create Appliance Self-Signed Certificate
    [Documentation]    Create Appliance Self-signed Certificate
    Navigate to Security Page
    wait for element and click    ${FusionSettingsPage.ID_MENU_ACTION_MAIN_BTN}
    wait for element and click    ${FusionSettingsPage.ID_BTN_CREAT_SELF_SIGNED_CERT}
    wait for element visible    ${FusionSettingsPage.ID_INPUT_SELF_SIGN_CERT_COUNTRY}
    :FOR        ${attribute}    IN  @{TestData.attributes}
    \   Input Text      ${FusionSettingsPage.ID_INPUT_SELF_SIGN_CERT_COUNTRY}       ${attribute.country}
    \   Input Text      ${FusionSettingsPage.ID_INPUT_SELF_SIGN_CERT_STATE}     ${attribute.state}
    \   Input Text      ${FusionSettingsPage.ID_INPUT_SELF_SIGN_CERT_CITY}      ${attribute.locality}
    \   Input Text      ${FusionSettingsPage.ID_INPUT_SELF_SIGN_CERT_ORGANIZATION_NAME}     ${attribute.organization}
    wait for element visible    ${FusionSettingsPage.ID_BTN_SELF_SIGN_CERT_OK}
    wait for element and click    ${FusionSettingsPage.ID_BTN_SELF_SIGN_CERT_OK}
    Wait Until Keyword Succeeds    60 sec    2 sec    Verify Certificate Validity

Verify Certificate Validity
    [Documentation]    To verify certificate validity
    Navigate to Security Page
    ${Date}=    Get Current Date
    ${CertDate}     get text    ${FusionSettingsPage.ID_TEXT_CERT_VALID_FROM}
    Run Keyword If  '${CertDate}'=='${Date}'        Log    Date is Current Date
    ${CertDate}=   Get Substring   ${CertDate}   0   4
    ${validtilldate}    get text    ${FusionSettingsPage.ID_TEXT_CERT_VALID_TILL}
    ${validtillyear}=   Get Substring   ${validtilldate}  0    4
    ${date}=    Evaluate    ${CertDate}+${count}
    Run Keyword If  '${date}'=='${validtillyear}'        Log    Pass Certificate is valid for 1 year
    Run Keyword Unless  '${date}'=='${validtillyear}'   Fail    Failed Certificate is not valid for 1  year
