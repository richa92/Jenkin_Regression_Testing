*** Settings ***
Documentation       Create SD followed by Backup
Resource            ../Resource/CIM_CommonResource.txt
Resource            ../Resource/CIM_Settings.txt
Resource            ../Resource/CIM_Activity.txt
Library             FusionLibrary
Library             SSHLibrary
Force Tags          Buildup
Suite Setup         Load Test Data and Open Browser
Suite Teardown      Logout and close all browsers
Variables           ../../../../FusionLibrary/ui/settings/settings_elements.py
Variables         ../../../../FusionLibrary/ui/business_logic/general/base_elements.py

*** Variables ***
${COMMAND1}         cd /backup_staging/support-dumps;ls
${COMMAND2}         cd /backup_staging;ls
${supportdump}      sdmp
${backup}           bkp

*** Test Cases ***
Create SD followed by Backup
    [Documentation]    Create SD and validate Staging folder then create Backup and again validate Staging folder
    Log into Fusion appliance as Administrator
    ${ApplianceIP}=    Fetch From Right    ${ApplianceUrl}  /
    ${status} =    Fusion UI Create Support Dump From Data File    @{TestData.supportdump}
    Should Be True    ${status}    msg=Failed to create Support Dump
    wait for element visible    ${FusionSettingsPage.ID_VALIDATE_SUCCESS}

    #Verify that SD is placed in the staging folder
    Log     ${ApplianceIP}
    Validate Staging Folder    ${ApplianceIP}    ${TestData.RootUserCredentials[0].username}    ${TestData.RootUserCredentials[0].password}  ${COMMAND1}   ${supportdump}
    wait for element and click    ${FusionBasePage.ID_MENU_LINK_SETTINGS}

    #Create Backup
    Fusion UI Create Backup

    #Verify that Backup is placed in the staging folder
    Log     ${ApplianceIP}
    Validate Staging Folder    ${ApplianceIP}    ${TestData.RootUserCredentials[0].username}    ${TestData.RootUserCredentials[0].password}    ${COMMAND2}    ${backup}
