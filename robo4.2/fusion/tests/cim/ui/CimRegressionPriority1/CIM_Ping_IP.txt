*** Settings ***
Documentation        Ability to Check the status of any IP address using Ping
Resource            ../Resource/CIM_CommonResource.txt
Resource            ../Resource/CIM_Activity.txt
Test Setup            Load Test Data and Open Browser
Test Teardown        Logout and close all browsers
Variables            ../../../../FusionLibrary/ui/settings/settings_elements.py
Variables            ../../../../FusionLibrary/ui/business_logic/general/base_elements.py
Variables        ../../../../FusionLibrary/ui/business_logic/settings/networking_elements.py
Variables           ../../../../FusionLibrary/ui/business_logic/general/activity_elements.py

Library            RoboGalaxyLibrary
Library            String


*** Variables ***
${searchtext}    Ping any IP address successfully
${activityname}    Ping
${resource}    Appliance
${activitystate}    Completed
${activityowner}    Administrator
${blnPingSubString}    64 bytes


*** Test Cases ***
As an Administrator I want to Ping any IP address and validate

    #Login as Administrator
    Log into Fusion appliance as Administrator

    #Navigate to the Networking page and then onto Network edit and the Ping attribute
    Element Should Be Visible   ${FusionBasePage.ID_MAIN_MENU_CONTROL}
    Click Element   ${FusionBasePage.ID_MAIN_MENU_CONTROL}

    #Navigate to settings page
    Element Should Be Visible    ${FusionBasePage.ID_MENU_LINK_SETTINGS}
    wait for element and click    ${FusionBasePage.ID_MENU_LINK_SETTINGS}

    #Navigate to Networking link and then onto ping attribute
    wait for element and click    ${C7000_GeneralNetworingElements.ID_NETWORKING}
    wait for element and click    ${C7000_GeneralNetworingElements.ID_DROPDOWN_ACTIONS}
    wait for element and click    ${C7000_GeneralNetworingElements.ID_SELECT_ACTION_PING}

    #Input the IP address to ping
    wait for element visible    ${C7000_GeneralNetworingElements.ID_INPUT_IPADDR_TO_PING}
    Input Text    ${C7000_GeneralNetworingElements.ID_INPUT_IPADDR_TO_PING}    ${TestData.PingIP[0].ipaddress}
    wait for element and click    ${C7000_GeneralNetworingElements.ID_BUTTON_PING}
    Wait Until Element Is Visible    ${C7000_GeneralNetworingElements.ID_TEXT_PING_RESULTS}

    #Get Ping output and Parse results from Ping output    
    wait until keyword succeeds    1 min    2 sec    Wait For Text to Display
    ${ping_output}=        Get Value    ${C7000_GeneralNetworingElements.ID_TEXT_PING_RESULTS}
    ${location}=    Get Index From List    ${ping_output}    ${blnPingSubString}
    Run Keyword If    ${location} > 0    Log    ${TestData.PingIP[0].ipaddress} is pinging
    Run Keyword Unless    ${location} > 0    Fail    ${TestData.PingIP[0].ipaddress} is not pinging
    wait for element and click    ${C7000_GeneralNetworingElements.ID_BUTTON_CLOSE}

    #Validate Activity page entry
    Verify Activity Existence in Activity Page    ${activityname}    ${resource}    ${activitystate}    ${activityowner}

    #Verify entry in auditlog file - No Audit log entry


*** keywords ***
Wait For Text to Display
    ${ping_text} =    Get Value    ${C7000_GeneralNetworingElements.ID_TEXT_PING_RESULTS}
    Should Contain    ${ping_text}    icmp_seq=3
