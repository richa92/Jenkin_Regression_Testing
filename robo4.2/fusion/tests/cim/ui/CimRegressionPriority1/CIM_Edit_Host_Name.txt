*** Settings ***
Documentation		Edit Hostname for DHCP or Static Appliance.
Library				BuiltIn
Resource			../Resource/CIM_CommonResource.txt
Resource			../Resource/CIM_Activity.txt
Test Setup			Load Test Data and Open Browser
Test Teardown		Logout and close all browsers
Variables			../../../../FusionLibrary/ui/business_logic/general/base_elements.py
Variables			../../../../FusionLibrary/ui/settings/settings_elements.py
Variables			../../../../FusionLibrary/ui/business_logic/settings/networking_elements.py
Variables			../../../../FusionLibrary/ui/business_logic/networking/networks_elements.py
Variables		    ../../../../../rg/RoboGalaxyLibrary/ui/common/PerfConstants_File.py

*** Variables ***
${searchtext}		reconfigured the appliance network settings

*** Test Cases ***
Edit Hostname
	Log into Fusion appliance as Administrator
	Navigate to	Settings	Networking

	#Get the appliance type Static\DHCP
	${IPV4_addr_type} =	Get Text	//*/ol/li/label[contains(@class, 'fs-settings-appliance-value')]
	Log	Performing Edit host name on ${IPV4_addr_type} appliance.
	Select Action	Edit

	#Update the Host Name with new text
	Wait For Element And Input Text	${C7000_GeneralNetworingElements.ID_TEXT_HOST_NAME}	${TestData.EditHostName[0].hostname}
	wait for element and click	${C7000_EditNetworkingElements.ID_BUTTON_OK}

	#Wait to complete the settings
	wait for element visible	${C7000_EditNetworkingElements.ID_PROGRESS_BAR_APPLYING_NETWORK_SETTINGS}
	wait for element not visible	${C7000_EditNetworkingElements.ID_PROGRESS_BAR_APPLYING_NETWORK_SETTINGS}	${PerfConstants.CONFIGURE_NETWORK_SETTINGS_FTW}
	Sleep	5

	#Navigate to settings page and verify the Host Name
	Navigate to	Settings	Networking
	wait for element visible	${C7000_GeneralNetworingElements.ID_TEXT_HOST_NAME}
	${text} =	Get Text	${C7000_GeneralNetworingElements.ID_TEXT_HOST_NAME}
	Run Keyword If	'${text}' == '${TestData.EditHostName[0].hostname}'		Log		Hostname is updated successfully.
	Run Keyword Unless	'${text}' == '${TestData.EditHostName[0].hostname}'	Fail	Hostname is not updated.
	${Appliance} =	Fetch From Right	${ApplianceUrl}	/

	#Validating HostName-IP binding
	${HostnameAndIPResolveCorrectly} =	Does hostname resolve to IP address?	${TestData.EditHostName[0].hostname}	${Appliance}
	${Expected_Alert_Name_In_Activity_Page}=	Set Variable If	'${HostnameAndIPResolveCorrectly}'=='TRUE'	Network Configuration	${TestData.EditHostName[0].hostname} does not resolve to ${Appliance} address.
	Sleep	2

	#Activity page validation
	Navigate to page	Activity
	wait for element visible	//*[@id='hp-activities']/tbody/tr[1]/td/a[1] 10
	${count}=	Get Matching XPath Count	//*[@id='hp-activities']/tbody//tr[1][//span[text()='${Expected_Alert_Name_In_Activity_Page}']]
	Run Keyword If	${count} >= ${activityCount}	Log	Alert is present in the activity page
	Run Keyword Unless	${count} >= ${activityCount}	Fail	Alert is not present in the activity page

	#Verify entry in auditlog file
	Download and verify entry in Audit log file	${DownloadPath}	${searchtext}
