*** Settings ***
Documentation		Add AD and LDAP group
Resource			../Resource/CIM_CommonResource.txt
Resource			../Resource/CIM_Activity.txt
Resource			../Resource/CIM_UsersAndGroups.txt
Test Setup			Load Test Data and Open Browser
Test Teardown		Logout and close all browsers
Variables			../../../../FusionLibrary/ui/business_logic/general/base_elements.py
Library				XML

*** Test Cases ***
As an Administrator I want to Add AD and LDAP Groups
	Log into Fusion appliance as Administrator
	${Status}=	Fusion UI Add Directory Users	@{TestData.DomainUsers}
	Should Be True	${Status}	msg=Failed to add directory users

#Verify in Activity Page
	wait for element and click	${FusionBasePage.ID_MENU_ONE_VIEW}
	wait for element and click	${FusionBasePage.ID_MENU_LINK_ACTIVITY}
	Sleep	5
	${dataele}=	XML.Get Elements	${DATAFILE}	DomainUsers/domainuser
	${datacount}=	Get Length	${dataele}
	${count}=	Get Matching XPath Count	//*[@id='hp-activities']/tbody//tr[//span[text()='Add'] and td/a[text()='Security'] and td/div[text()='Administrator']]
	Run Keyword If	${count} >= ${datacount}	Log	Given alert "Add by Administrator in Completed State" is listed in activity page
	Run Keyword Unless	${count} >= ${datacount}	Fail	Given alert "Add by Administrator in Completed State" is not present in the activity page

#Verify entry in auditlog file.
	${filepath}=	Download and unzip Audit log file	${DownloadPath}
	:FOR	${domuser}	IN	@{TestData.DomainUsers}
	\	${searchtext} =	Set Variable	"${domuser.egroup}" was added to "${domuser.domainName}" directory
	\	${bln_logentry_exists} =	file_contains	${filepath}	${searchtext}
	\	Should Be Equal As Strings	${bln_logentry_exists}	${blnExpected}	msg=Entry ${searchtext} not available in log file.
