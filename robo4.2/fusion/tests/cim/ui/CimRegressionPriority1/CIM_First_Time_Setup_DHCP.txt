*** Settings ***

Documentation			First Time Setup
Resource				../Resource/CIM_CommonResource.txt
Resource				../Resource/CIM_Activity.txt
Resource				../Resource/CIM_Settings.txt
Resource				../Resource/CIM_Networking.txt
Test Setup				Load Test Data and Open Browser
Test Teardown			 Logout and close all browsers
Library					RoboGalaxyLibrary\\utilitylib\\file_utils.py
Variables				../../../../FusionLibrary/ui/business_logic/settings/networking_elements.py
Variables				../../../../FusionLibrary/ui/general/login_elements.py
Variables				../../../../../rg/RoboGalaxyLibrary/ui/common/PerfConstants_File.py  

*** Test Cases ***
As an Administrator I want to do First Time Setup
	#Clear EULA and Service access
	sleep	3
	${eulaPage} =		Get Text	//*[@id='hp-header-eula-type']
	Log	${eulaPage}
	Run Keyword If	'${eulaPage}' == 'License'	Log		eula page found
	Run Keyword Unless	'${eulaPage}' == 'License'	Fail	Error eula page is not found
	wait for element and click	${FusionLoginPage.ID_BTN_EULA_AGREE}
	wait for element and click	${FusionLoginPage.ID_BTN_OK_CONVERGED_INFRA_SUPPORT}

	#Change appliance default password
	wait for element visible		${FusionLoginPage.ID_INPUT_LOGIN_USER}	10
	Enter First Time Login credentials	${TestData.envconfigs[0].appliance_username}		${TestData.envconfigs[0].appliance_default_password}
	wait for element visible		${FusionLoginPage.ID_INPUT_NEW_PASSWORD}	10
	Set Initial password	${TestData.envconfigs[0].appliance_password}		${TestData.envconfigs[0].appliance_password}
	
	#Set Initial Network
	Set Initial Network to DHCP	 ${TestData.ftwizard[0].appliance_hostname}		${TestData.ftwizard[0].ipv4[0].assignments}	 ${TestData.ftwizard[0].preferred_dns}	${TestData.ftwizard[0].alternate_dns}		 ${TestData.ftwizard[0].ipv6[0].assignments}

	#Verify Create FTS activity in Activity Page
	Navigate to page	Activity
	${applianceIP} =	Get appliance ip from url
	${activityname}=	Catenate	${TestData.ftwizard[0].appliance_hostname}		does not resolve to	 ${applianceIP}	address.
	${count}=	 Get Matching XPath Count	.//*[@id='hp-activities']/tbody/tr[1]//span[text()='${activityname}']
	Run Keyword If	${count} >= 1	 Log	 Given alert "Hostname does not resolve IP address" is listed in activity page
	Run Keyword Unless		${count} >= 1	 Fail	Given alert "Hostname does not resolve IP address" is not present in the activity page

	#Verify entry in auditlog file.
	${filepath}=		Download and unzip Audit log file	${DownloadPath}
	@{searchtextlist} =	Create List	User has accepted Eula	 Successfully updated support access status	 Password changed for user: Administrator	User "Administrator" reconfigured the appliance network settings
	:FOR	${searchtext}	 IN	@{searchtextlist}
	\	 Search entry in audit log file		${filepath}	${searchtext}
