*** Settings ***
Documentation       Download BackUp
Resource            ../Resource/CIM_CommonResource.txt
Resource            ../Resource/CIM_Activity.txt
Resource            ../Resource/CIM_Settings.txt
Test Setup            Load Test Data and Open Browser
Test Teardown        Logout and close all browsers

*** Variables ***
${searchtext}        A backup download was initiated
${activityname}      Started downloading backup
${resource}          Backup
${activitystate}     Completed
${activityowner}     BackupAdminUser

*** Test Cases ***
As an BackAdmin I want to Download a Backup
    [Documentation]    Create a backup and download it as a BackupAdmin user
    #Log into Fusion appliance as BackupAdminUser
    ${user} =    Get data by property    ${TestData.users}    role    Backup administrator
    Fusion UI Login To Appliance    ${user[0].name}
    Create Folder If not Exists    ${DownloadPath}
    # Navigate to settings page and download backup
    wait for element and click    ${FusionSettingsPage.ID_SETTINGS_LABEL}
    Download BackUp    ${DownloadPath}
    Log    Download Backup is completed and check for BackUp File in tmp folder

    ${bkpfile} =    OperatingSystem.List Files In Directory    ${DownloadPath}    *.bkp
    ${downloadedbkpfile} =    Get From List    ${bkpfile}    0
    Log    ${downloadedbkpfile}
    Log        backup file is ${bkpfile}

    #Verify Download Backup activity in Activity Page
    Verify Activity Existence in Activity Page    ${activityname}    ${resource}    ${activitystate}    ${activityowner}

    #Logout and Login as Administrator to Download Audit Logs
    Logout and close all browsers
    Open Browser    ${ApplianceUrl}    ${Browser}
    Log into Fusion appliance as Administrator

    #Verify entry in Auditlog file
    Download and verify entry in Audit log file    ${DownloadPath}    ${searchtext}
