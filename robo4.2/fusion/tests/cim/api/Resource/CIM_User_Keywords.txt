*** Settings ***
Library    json
Library     RoboGalaxyLibrary
Library     FusionLibrary
Library     OperatingSystem
Library     BuiltIn
Library     Collections
Library     XML
Library     SSHLibrary
Library     String
Library    requests
Library     robot.api.logger
Resource    ../Resource/CIM_Common_Resource.txt

*** Keywords ***

Add User
    [Documentation]    Adds users to the appliance and remove them
    [Arguments]    ${users}
    Add Users from variable    ${users}

Edit User
    [Documentation]    Edit User
    [Arguments]    ${updateUsers}
    ${responses} =  create list
    Log    ${updateUser}
    :FOR    ${user}    IN    @{UpdateUsers}
    \    ${resp} =    Fusion Api Edit User    body=${user}    uri=/rest/users
    \    append to list   ${responses}  ${resp}
    \    Should Be Equal    '${resp['status_code']}'    '200'    msg=Unable to create account ${User}

Login As Specific User
    [Documentation]    Login as a specific user 
    [Arguments]    ${login_user}
    Set Log Level    TRACE
    :FOR    ${user}    IN    @{users}
    \    ${user_pass} =    Create Dictionary    userName=${user['userName']}    password=${user['password']}
    \    Run Keyword If    '${login_user}'=='${user['userName']}'    Fusion Api Login Appliance    ${APPLIANCE_IP}    ${user_pass}
    \    ...         ELSE IF     '${login_user}' != '${user['userName']}'    Log    This is not the User

Remove User
    [Documentation]    Delete User
    ${responses} =  create list
    :FOR    ${user}    IN    @{users}
    \    Log    ${user['userName']}
    \    ${res} =    Get User URI    ${user['userName']}
    \    Continue For Loop If    '${res}'== '/rest/users_${user['userName']}_not_found'
    \    ${resp} =    Fusion Api Remove User    ${None}    /rest/users/${user['userName']}
    \    Log to Console and Logfile    ${user['userName']} - user is removed
