*** Settings ***
Library         json
Library         RoboGalaxyLibrary
Library         FusionLibrary
Library         OperatingSystem
Library         BuiltIn
Library         Collections
Library         XML
Library         SSHLibrary
Library         String
Library         requests
Library         robot.api.logger
Resource        ../../../../Resources/api/fusion_api_resource.txt

*** Variables ***
${DownloadPath}    C:/tmp

*** Keywords ***

Get sessionID
    [Documentation]    To Get SessionID
    [Arguments]    ${credentials}    ${IP}=${APPLIANCE_IP}
    ${Response} =    Fusion Api Login Appliance    ${IP}    ${credentials}
    ${sessionID} =    Get From List    ${Response}     1
    [Return]    ${sessionID}

Get request
    [Documentation]    To get the requested resource
    [Arguments]    ${uri}    ${version}
    ${sessionID}=    Get sessionID    ${admin_credentials}    ${APPLIANCE_IP}
    ${includeapi}    Create Dictionary    auth=${sessionID}    X-Api-Version=${version}
    ${excludeapi}=    Create Dictionary    auth=${sessionID}
    ${Response}=    Run Keyword if    ${version} == None    requests.get    https://${APPLIANCE_IP}/${uri}    headers=${excludeapi}    verify=${False}
    ...    ELSE    requests.get    https://${APPLIANCE_IP}/${uri}   headers=${includeapi}    verify=${False}
    [Return]    ${Response}

Post Request
    [Documentation]    To post the resource to appliance
    [Arguments]    ${uri}    ${data}    ${version}
    ${sessionID}=    Get sessionID    ${admin_credentials}    ${APPLIANCE_IP}
    ${excludeapi} =    Create Dictionary    Accept=application/json    Content-Type=application/json    auth=${sessionID}
    ${includeapi} =    Create Dictionary    Accept=application/json    Content-Type=application/json    auth=${sessionID}    x-api-version=${version}
    ${Response}=   Run Keyword if    ${version} == None    requests.post    https://${APPLIANCE_IP}/rest/${uri}    ${data}    headers=${excludeapi}    verify=${False}
    ...    ELSE    requests.post    https://${APPLIANCE_IP}/rest/${uri}    ${data}    headers=${includeapi}    verify=${False}
    [Return]    ${Response}

Delete Request
    [Documentation]    To delete the resource from appliance
    [Arguments]    ${uri}    
    ${sessionID}=    Get sessionID    ${admin_credentials}    ${APPLIANCE_IP}
    ${Headers}    Create Dictionary    Accept=application/json    Content-Type=application/x-www-form-urlencoded   auth=${sessionID}
    ${Response}=    requests.delete   https://${APPLIANCE_IP}/rest/${uri}    headers=${Headers}    verify=${False}
    [Return]    ${Response}
