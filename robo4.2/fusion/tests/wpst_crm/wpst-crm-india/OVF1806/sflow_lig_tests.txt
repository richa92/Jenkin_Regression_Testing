*** Settings ***
Documentation       Feature Test: This set of test cases is to verify the sflow feature for Potash, Nitro and Manganese(Mellanox) module

Variables           data_variables_lig_mellanox.py
Resource            ../../../../Resources/api/fusion_api_resource.txt
Resource            ./sflow_resources.txt
Library             Collections
Library             json
Library             BuiltIn
Library             OperatingSystem
Library             RoboGalaxyLibrary
Library             FusionLibrary

*** Variables ***
${APPLIANCE_IP}                     192.168.145.31
${SLEEP_TIME}                       30
${LI_NAME}                          LE-LIG_BAY_SET_3

*** Test Cases ***

PRE_CONDITION_1
    [Tags]    PRE_CONDITION_1    Mellanox
    Add Ethernet Networks   ${eth_networks}

PRE_CONDITION_2- CREATE RANGE WITH ALL DATA FOR A VALID SUBNET
    [Tags]    PRE_CONDITION_2    Mellanox
      Fusion Api Login Appliance      ${APPLIANCE_IP}     ${login_details}
      ${resp} =   Fusion Api Create Ipv4 Subnet    body=${subnet}
      ${range}=   Build IPV4 Range Body         ${subnet_range}      ${subnet['networkId']}
      ${resp}=    Fusion Api Create Ipv4 Range    ${range}
      ${valDict} =      Create Dictionary    status_code=${200}
      Validate Response    ${resp}     ${valDict}

PRE_CONDITION_3-CREATE NETWORK AND ASSOCIATE A SUBNET
    [Tags]    PRE_CONDITION_3    Mellanox
      Fusion Api Login Appliance      ${APPLIANCE_IP}     ${login_details}
      ${network_body}=  Build Network Body For Create    ${eth_networks_subnet}    ${subnet['networkId']}
      ${resp} =   Fusion Api Create Ethernet Network        body=${network_body}
      ${task} =    Wait For Task     ${resp}     120s
      ${valDict} =     Create Dictionary    status_code=${200}
      ...                                 taskState=Completed
      Validate Response    ${task}    ${valDict}

OVF1734_API_TC_01_CREATE_LIG_WITH_DHCP_OPTION
    [Tags]    TC01
    Log to console    Create LIG group
    #LIG with Ethernet Modules
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${login_details}
    ${resp} =    Create LIG      ${sflow_lig_dhcp}
    Log to console and logfile    \n\nLIG Created Successfully:${resp}

OVF6733_TC_43_CREATE_LIG_WITH_DHCP_OPTION
    [Tags]    TC43    Mellanox
    Fusion Api Login Appliance      ${APPLIANCE_IP}     ${login_details}
    Log to console    Create LIG group
    #LIG with DHCP Option
    ${body}    Build LIG body    ${sflow_lig_dhcp}
    Log to console and logfile    \n-Creating LIG ${body}
    ${resp}    Fusion Api Create LIG    ${body}
    Log to console and logfile    ${resp}
    ${err_Code} =    Get Variable Value  ${resp['errorCode']}
    ${status_Code} =    Get Variable Value  ${resp['status_code']}
    ${actual_error} =    Create Dictionary   status_code=${status_Code}
    ...                                 taskState=${err_Code}
    Log to console and logfile    ${actual_error}
    ${valDict} =    Create Dictionary   status_code=${400}
    ...                                 taskState=CRM_INVALID_SFLOW_AGENT_CONFIG_MODE
    Validate Response     ${actual_error}     ${valDict}
    Log to Console  \n-LI DHCP LIG Error Validation successful

OVF1734_API_TC_02_CREATE_LIG_WITH_STATIC_OPTION
    [Tags]    TC_02    Mellanox
    Log to console    Create LIG
    #LIG with Ethernet Modules
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${login_details}
    ${resp} =    Create LIG      ${sflow_lig_static}
    Log to console and logfile    \n\nLIG Created Successfully:${resp}

OVF1734_API_TC_03_CREATE_LIG_WITH_IPPOOL_OPTION
    [Tags]    TC_03    Mellanox
    Log to console    Create LIG group
    #LIG with Ethernet Modules
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${login_details}
    ${resp} =    Create LIG      ${sflow_lig_ippool}
    Log to console and logfile    \n\nLIG Created Successfully:${resp}

OVF1734_API_TC_07_CREATE_LIG_WITH_DHCP_OPTION_3COLLECTORS
    [Tags]    TC_07    Mellanox
    Log to console    Create LIG group
    #LIG with Ethernet Modules
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${login_details}
    ${resp} =    Create LIG      ${sflow_lig_dhcp_3collectors}
    Log to console and logfile    \n\nLIG Created Successfully:${resp}

OVF1734_API_TC_47_CREATE_LIG_WITH_DHCP_STATIC_OPTION
    [Tags]    TC_47
    Log to console    Create LIG group
    #LIG with Ethernet Modules
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${login_details}
    #${resp} =    Create LIG      ${sflow_lig_dhcp_static}
    Create LIG and check status    ${sflow_lig_without_sflowagentipmode}    400

OVF1734_API_TC_48_CREATE_LIG_WITHOUT_SFLOW_AGENT_IPMODE
    [Tags]    TC_48
    Log to console    Create LIG group
    #LIG with Ethernet Modules
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${login_details}
    #${resp} =    Create LIG      ${sflow_lig_without_sflowagentipmode}
    Create LIG and check status    ${sflow_lig_without_sflowagentipmode}    400

OVF1734_API_TC_54_CREATE_LIG_WITH_WRONG_COLLECTOR_ID
    [Tags]    TC_54    Mellanox
    Log to console    Create LIG group
    #LIG with Ethernet Modules
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${login_details}
    ${body}    Build LIG body    ${sflow_lig_nonexistant_receiver}
    Log to console and logfile    \n-Creating LIG ${body}
    ${resp}    Fusion Api Create LIG    ${body}
    Log to console and logfile    ${resp}
    ${err_Code} =    Get Variable Value  ${resp['errorCode']}
    ${status_Code} =    Get Variable Value  ${resp['status_code']}
    ${actual_error} =    Create Dictionary   status_code=${status_Code}
    ...                                 taskState=${err_Code}
    Log to console and logfile    ${actual_error}
    ${valDict} =    Create Dictionary   status_code=${400}
    ...                                 taskState=CRM_INVALID_SFLOW_PORTCONFIG_COLLECTOR_ID
    Validate Response     ${actual_error}     ${valDict}
    Log to console and logfile    \n\nLIG Edit Error Validated Successfull

OVF6733_TC_44_CREATE_LIG_WITH_INVALID_STATIC_CONFIG
    [Tags]    TC_44    Mellanox
    Log to console    Create LIG group
    #LIG with Ethernet Modules
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${login_details}
    ${body}    Build LIG body    ${sflow_lig_invalid_static_config}
    Log to console and logfile    \n-Creating LIG ${body}
    ${resp}    Fusion Api Create LIG    ${body}
    Log to console and logfile    ${resp}
    ${err_Code} =    Get Variable Value  ${resp['errorCode']}
    ${status_Code} =    Get Variable Value  ${resp['status_code']}
    ${actual_error} =    Create Dictionary   status_code=${status_Code}
    ...                                 taskState=${err_Code}
    Log to console and logfile    ${actual_error}
    ${valDict} =    Create Dictionary   status_code=${400}
    ...                                 taskState=CRM_INVALID_SFLOW_MODULE_IP_LIG
    Validate Response     ${actual_error}     ${valDict}
    Log to console and logfile    \n\nLIG Edit Error Validated Successfully

OVF6733_TC_45_CREATE_LIG_WITH_NON_SUBNET_ASSOCIATED_NETWORK
    [Tags]    TC_45    Mellanox
    Log to console    Create LIG group
    #LIG with Ethernet Modules
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${login_details}
    ${body}    Build LIG body    ${sflow_lig_non_subnet_ippool}
    Log to console and logfile    \n-Creating LIG ${body}
    ${resp}    Fusion Api Create LIG    ${body}
    Log to console and logfile    ${resp}
    ${err_Code} =    Get Variable Value  ${resp['errorCode']}
    ${status_Code} =    Get Variable Value  ${resp['status_code']}
    ${actual_error} =    Create Dictionary   status_code=${status_Code}
    ...                                 taskState=${err_Code}
    Log to console and logfile    ${actual_error}
    ${valDict} =    Create Dictionary   status_code=${400}
    ...                                 taskState=CRM_INVALID_SFLOW_SUBNET_URI
    Validate Response     ${actual_error}     ${valDict}
    Log to console and logfile    \n\nLIG Edit Error Validated Successfully

#--------------START EDIT LIG TEST CASES-------------------
OVF1734_API_TC_08_AND_41_EDIT_LIG_WITH_MORE_UPLINKPORTS_SAME_COLLECTOR
    [Tags]    TC_08    Mellanox
    Log to console    Edit LIG group
    #LIG with Ethernet Modules
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${login_details}
    ${resp} =    Edit LIG    ${sflow_editlig_more_uplinkports}
    Log to console and logfile    \n\nLIG edited operation Successfully:${resp}

OVF1734_API_TC_09_EDIT_LIG_WITH_CHANGING_COLLECTOR
    [Tags]    TC_09
    Log to console    Edit LIG group
    #LIG with Ethernet Modules
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${login_details}
    ${resp} =    Edit LIG    ${sflow_edit_lig_change_collectorid}
    Log to console and logfile    \n\nLIG edited operation Successfully:${resp}

OVF1734_API_TC_10_EDIT_LIG_WITH_DISABLING_COLLECTOR
    [Tags]    TC_10
    Log to console    Edit LIG group
    #LIG with Ethernet Modules
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${login_details}
    ${resp} =    Edit LIG    ${sflow_edit_lig_disable_collector}
    Log to console and logfile    \n\nLIG edited operation Successfully:${resp}

OVF1734_API_TC_11_EDIT_LIG_WITH_CHANGING_MAX_DATAGRAM_SIZE
    [Tags]    TC_11
    Log to console    Edit LIG group
    #LIG with Ethernet Modules
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${login_details}
    ${resp} =    Edit LIG    ${sflow_edit_lig_max_datagramsize}
    Log to console and logfile    \n\nLIG edited operation Successfully:${resp}

OVF1734_API_TC_11_EDIT_LIG_WITH_CHANGING_MAX_HEADER_SIZE
    [Tags]    TC_11_01
    Log to console    Edit LIG group
    #LIG with Ethernet Modules
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${login_details}
    ${resp} =    Edit LIG    ${sflow_edit_lig_max_headersize}
    Log to console and logfile    \n\nLIG edited operation Successfully:${resp}

OVF1734_API_TC_13_EDIT_LIG_WITH_CHANGINGDISABLE_ALL_COLLECTORS
    [Tags]    TC_13
    Log to console    Edit LIG group
    #LIG with Ethernet Modules
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${login_details}
    ${resp} =    Edit LIG    ${sflow_edit_lig_disabled_collectors}
    Log to console and logfile    \n\nLIG edited operation Successfully:${resp}

OVF1734_API_TC_13_EDIT_LIG_WITH_ENABLING_ONE_COLLECTOR
    [Tags]    TC_13_01
    Log to console    Edit LIG group
    #LIG with Ethernet Modules
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${login_details}
    ${resp} =    Edit LIG    ${sflow_edit_lig_enable_one_collector}
    Log to console and logfile    \n\nLIG edited operation Successfully:${resp}

OVF1734_API_TC_14_EDIT_LIG_WITH_CONFIGURING_SAMPLING_COLLECTOR
    [Tags]    TC_14
    Log to console    Edit LIG group
    #LIG with Ethernet Modules
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${login_details}
    ${resp} =    Edit LIG    ${sflow_edit_lig_sampling_collector}
    Log to console and logfile    \n\nLIG edited operation Successfully:${resp}

OVF1734_API_TC_15_EDIT_LIG_WITH_CHANGING_SAMPLING_TO_POLLING_COLLECTOR
    [Tags]    TC_15
    Log to console    Edit LIG group
    #LIG with Ethernet Modules
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${login_details}
    ${resp} =    Edit LIG    ${sflow_edit_lig_polling_collector}
    Log to console and logfile    \n\nLIG edited operation Successfully:${resp}

OVF1734_API_TC_17_EDIT_LIG_WITH_CHANGING_SAMPLING_TO_POLLING_CHANGING_IP_OF_COLLECTOR
    [Tags]    TC_17
    Log to console    Edit LIG group
    #LIG with Ethernet Modules
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${login_details}
    ${resp} =    Edit LIG    ${sflow_edit_lig_polling_changing_ip_of_collector}
    Log to console and logfile    \n\nLIG edited operation Successfully:${resp}

OVF1734_API_TC_18_EDIT_LIG_WITH_CONFIGURING_SAMPLING_COLLECTOR
    [Tags]    TC_18
    Log to console    Edit LIG group
    #LIG with Ethernet Modules
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${login_details}
    ${resp} =    Edit LIG    ${sflow_edit_lig_sampling_collector}
    Log to console and logfile    \n\nLIG edited operation Successfully:${resp}

OVF1734_API_TC_18_01_EDIT_LIG_WITH_CONFIGURING_SAMPLING_CHANGING_IP_OF_OLLECTOR
    [Tags]    TC_18_01
    Log to console    Edit LIG group
    #LIG with Ethernet Modules
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${login_details}
    ${resp} =    Edit LIG    ${sflow_edit_lig_sampling_changing_ip_of_collector}
    Log to console and logfile    \n\nLIG edited operation Successfully:${resp}

OVF1734_API_TC_16_EDIT_LIG_WITH_CONFIGURING_SAMPLING_CHANGING_PORT_OF_OLLECTOR
    [Tags]    TC_16
    Log to console    Edit LIG group
    #LIG with Ethernet Modules
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${login_details}
    ${resp} =    Edit LIG    ${sflow_edit_lig_sampling_changing_port_of_collector}
    Log to console and logfile    \n\nLIG edited operation Successfully:${resp}

#--------------END EDIT LIG TEST CASES-------------------

#--------------START EDIT LIG NEGATIVE TEST CASES-------------------

OVF1734_API_TC_39_EDIT_LIG_WITH_CONFIGURING_SAMPLING_CHANGING_INVALIDPORT_OF_OLLECTOR
    [Tags]    TC_39
    Log to console    Edit LIG group
    #LIG with Ethernet Modules
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${login_details}
    ${valDict} =    Create Dictionary   status_code=${400}
    ...                                 taskState=CRM_INVALID_SFLOW_COLLECTOR_PORT_RANGE
    ${resp} =    Edit LIG FOR NEGATIVE CASES    ${sflow_edit_lig_sampling_changing_invalidport_of_collector}    ${valDict}
    Log to console and logfile    \n\nLIG edited operation Successfully:${resp}

OVF1734_API_TC_26_EDIT_LIG_WITH_REMOVING_COLLECTOR
    [Tags]    TC_26
    Log to console    Edit LIG group
    #LIG with Ethernet Modules
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${login_details}
    ${valDict} =    Create Dictionary   status_code=${400}
    ...                                 taskState=CRM_INVALID_SFLOW_PORTCONFIG_COLLECTOR_ID
    ${resp} =    Edit LIG FOR NEGATIVE CASES    ${sflow_edit_lig_removing_collector}    ${valDict}
    Log to console and logfile    \n\nLIG edited operation Successfully:${resp}

OVF1734_API_TC_36_EDIT_LIG_WITH_CHANGING_INVALID_MAX_DATAGRAM_SIZE
    [Tags]    TC_36
    Log to console    Edit LIG group
    #LIG with Ethernet Modules
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${login_details}
    ${valDict} =    Create Dictionary   status_code=${400}
    ...                                 taskState=CRM_INVALID_SFLOW_COLLECTOR_DATAGRAM_SIZE
    ${resp} =    Edit LIG FOR NEGATIVE CASES    ${sflow_edit_lig_invalid_max_datagramsize}    ${valDict}
    Log to console and logfile    \n\nLIG edited operation Successfully:${resp}

OVF1734_API_TC_34_EDIT_LIG_WITH_CHANGING_INVALID_MAX_HEADER_SIZE
    [Tags]    TC_34
    Log to console    Edit LIG group
    #LIG with Ethernet Modules
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${login_details}
    ${valDict} =    Create Dictionary   status_code=${400}
    ...                                 taskState=CRM_INVALID_SFLOW_COLLECTOR_HEADER_SIZE
    ${resp} =    Edit LIG FOR NEGATIVE CASES    ${sflow_edit_lig_invalid_max_headersize}    ${valDict}
    Log to console and logfile    \n\nLIG edited operation Successfully:${resp}

OVF1734_API_TC_30_EDIT_LIG_WITH_DUPLICATE_COLLECTOR_NAME
    [Tags]    TC_30
    Log to console    Edit LIG group
    #LIG with Ethernet Modules
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${login_details}
    ${valDict} =    Create Dictionary   status_code=${400}
    ...                                 taskState=CRM_INVALID_SFLOW_COLLECTOR_DUPLICATE
    ${resp} =    Edit LIG FOR NEGATIVE CASES    ${sflow_edit_lig_duplicate_collectorname}    ${valDict}
    Log to console and logfile    \n\nLIG edited operation Successfully:${resp}

OVF1734_API_TC_40_EDIT_LIG_WITH_INVALID_COLLECTOR_ID_FOR_PORT
    [Tags]    TC_40
    Log to console    Edit LIG group
    #LIG with Ethernet Modules
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${login_details}
    ${valDict} =    Create Dictionary   status_code=${400}
    ...                                 taskState=CRM_INVALID_SFLOW_PORTCONFIG_COLLECTOR_ID
    ${resp} =    Edit LIG FOR NEGATIVE CASES    ${sflow_edit_lig_wrong_collectorid_for_port}    ${valDict}
    Log to console and logfile    \n\nLIG edited operation Successfully:${resp}

OVF1734_API_TC_11_EDIT_LIG_WITH_CHANGING_INVALID_COLLECTOR_ID
    [Tags]    TC11    Mellanox
    Log to console    Edit LIG group
    #LIG with Ethernet Modules
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${login_details}
    ${valDict} =    Create Dictionary   status_code=${400}
    ...                                 taskState=CRM_INVALID_SFLOW_COLLECTOR_ID
    ${resp} =    Edit LIG FOR NEGATIVE CASES    ${sflow_edit_lig_wrong_collectorid}    ${valDict}
    Log to console and logfile    \n\nLIG edited operation Successfully:${resp}

OVF1734_API_TC_55_EDIT_LIG_WITHOUT_SAMPLING_INTERVAL_VALUES
    [Tags]    TC55    Mellanox
    Log to console    Edit LIG group
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${login_details}
    ${valDict} =    Create Dictionary   status_code=${400}
    ...                                 taskState=CRM_INVALID_SFLOW_CONFIGMODE_SAMPLING
    ${resp} =    Edit LIG FOR NEGATIVE CASES    ${sflow_edit_lig_without_sampling_interval}    ${valDict}
    Log to console and logfile    \n\nLIG edited operation Successfully:${resp}

OVF1734_API_TC_55_01_EDIT_LIG_WITHOUT_POLLING_INTERVAL_VALUES
    [Tags]    TC55_01    Mellanox
    Log to console    Edit LIG group
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${login_details}
    ${valDict} =    Create Dictionary   status_code=${400}
    ...                                 taskState=CRM_INVALID_SFLOW_CONFIGMODE_POLLING
    ${resp} =    Edit LIG FOR NEGATIVE CASES    ${sflow_edit_lig_without_polling_interval}    ${valDict}
    Log to console and logfile    \n\nLIG edited operation Successfully:${resp}

OVF1734_API_TC_44_01_EDIT_LIG_INVALID_POLLING_INTERVAL_VALUES
    [Tags]    TC_44_01
    Log to console    Edit LIG group
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${login_details}
    ${valDict} =    Create Dictionary   status_code=${400}
    ...                                 taskState=CRM_INVALID_SFLOW_CONFIGMODE_POLLING
    ${resp} =    Edit LIG FOR NEGATIVE CASES    ${sflow_edit_lig_invalid_polling_rate}    ${valDict}
    Log to console and logfile    \n\nLIG edited operation Successfully:${resp}

OVF1734_API_TC_44_EDIT_LIG_INVALID_SAMPLING_INTERVAL_VALUES
    [Tags]    TC_44
    Log to console    Edit LIG group
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${login_details}
    ${valDict} =    Create Dictionary   status_code=${400}
    ...                                 taskState=CRM_INVALID_SFLOW_CONFIGMODE_SAMPLING
    ${resp} =    Edit LIG FOR NEGATIVE CASES    ${sflow_edit_lig_invalid_sampling_rate}    ${valDict}
    Log to console and logfile    \n\nLIG edited operation Successfully:${resp}

#--------------END EDIT LIG NEGATIVE TEST CASES-------------------
