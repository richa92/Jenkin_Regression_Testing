*** Settings ***
Documentation    Feature Test: F444-8PF-UI-PART1
Resource    F444-UI-PART1-CONFIG.txt
#Force Tags     Buildup
Suite Setup    Load Test Data and Open Browser
#Suite Teardown    Logout And Close All Browsers
Library            Dialogs
Library    String

*** Test Cases ***

00 Log into fusion as Administrator
    [Documentation]    Log in to Appliance
    Log To Console    *********Log into Appliance as Administrator****************
    ${user} =    Get Data By Property    ${TestData.users}    name    Administrator
    fusion_ui_login_to_appliance    ${user[0].name}
    Log to Console    Successfully logged in as Administrator

02 Create a Server Profile and assign networks to all the PFs
    [Documentation]    1 Create network.Add connections and check if all the 8PF are deiplayed in profile,
    ...    2 Create a dedicated network.Assign network to all the 8 PFs.Create Server Profile.

    Log To Console    *********Creating a server profile to check if 8PFs are displayed****************
    ${Status} =    fusion_ui_create_server_profile    @{TestData.proff}
    Run Keyword If    '${Status}' == 'True'    Log to Console    Server profile created successfully with 8 PFs with networks assigned     ELSE    fail

    Log to Console    F444_TC_UI_1_2: Server profile created successfully with 8 PFs with dedicated networks assigned

03 Create a Server Profile and assign networks to each port

    [Documentation]    3 Assign network for each port and verify.Assign or Unassign and Reassign the network,4 When network is assigned to the 8 PFs verify all parameters are displayed for port.5 Assigning network to 8 PFs using virtual Mac Address and physical address and verify if all supports get virtual and physical mac addresses properly.
    #Editing Server Profile by Un assigning the network ports
    Log To Console    *********Unassigning and reassigning the profile ****************
    ${Status} =    fusion_ui_edit_server_profile    @{TestData.editprofilesunassign}
    Run Keyword If    '${Status}' == 'True'    Log to Console    Successfully edited the profile by un assigning the network     ELSE    fail

    Fusion UI Logout of Appliance
    Log to Console    Logout Completed

    ${user}=    Get Data By Property	${TestData.users}    name    Administrator
    Fusion UI Login to Appliance   ${user[0].name}

04 Editing the same profile and reassigning the networks to the ports with MAC address as Virtual
    #Editing Server Profile by Reassigning the network ports
    ${Status} =    fusion_ui_edit_server_profile    @{TestData.editprofilesreassign}
    Run Keyword If    '${Status}' == 'True'    Log to Console    Successfully edited the profile by reassigning the network to the ports     ELSE    fail

05 Verifying the profile connections with dedicated network and MAC Address as Virtual
    #verifying the profile
    Log To Console    *********Verify all parameters are displayed****************
    ${Status} =    fusion_ui_verify_server_profile_connections_info    @{TestData.proff_verify}
    Run Keyword If    '${Status}' == 'True'    Log to Console    Successfully verified all the parameters are displayed for the connections     ELSE    fail

    ${Status}=    fusion_ui_delete_server_profile    @{TestData.Delete_profile}
    Run Keyword If    '${Status}' == 'True'    Log to Console    Deleted the profile successfully after verifying all parameters     ELSE    fail

    Log to Console    F444_TC_UI_3_4_5: Server profile created successfully with 8 PFs with networks unassigned and reassigned and verify their Mac addresses

06 Verify if server NIC has support for only 4 PF and now the Profile Manager should display 4 sub ports
    [Documentation]    10 Verify if server NIC has support for only 4 PF and now the Profile Manager should display 4 sub ports
    Log To Console    *********Create a server profile with 4 ports if server NIC has support for only 4 PF  ****************
    ${Status}=  fusion_ui_create_server_profile     @{TestData.profile10}
    Run Keyword If    '${Status}' == 'True'    Log to Console    Successfully verified that the server NIC has support only 4 PFs     ELSE    fail

    #verifying the profile
    Log To Console    *********Verify all parameters are displayed****************
    ${Status} =    fusion_ui_verify_server_profile_connections_info    @{TestData.profile10_verify}
    Run Keyword If    '${Status}' == 'True'    Log to Console    Successfully verified all the parameters are displayed for the connections     ELSE    fail

    ${Status}=    fusion_ui_delete_server_profile    @{TestData.Delete_profile_1}
    Run Keyword If    '${Status}' == 'True'    Log to Console    Deleted the profile after verifying 4PFs    ELSE    fail

    Log to Console    F444_TC_UI_10: Verified successfully that Profile Manager displays 4 sub ports if server NIC has support for only 4 PF


07 Create a profile with auto option and verify if its assigned to newly added subports
    #TC14
    [Documentation]    14 Now instead of selecting the manual option select the auto option and verify if it gets assigned to the newly added ports
    Log To Console    *********Create a server Profile with auto assigning the ports for newly added ports ****************
    ${Status}=    fusion_ui_create_server_profile     @{TestData.profileauto1}
    Run Keyword If    '${Status}' == 'True'    Log to Console    Successfully Created a server profile with ports being auto assigned for the newly added ones     ELSE    fail

    ${Status}=    fusion_ui_delete_server_profile    @{TestData.Delete_profile}

    Log to Console    F444_TC_UI_14: Verified successfully that auto option is assigned to the newly added ports

08 Verify that only Specialized role user with network privileges and Full role users are able to edit
    [Documentation]    23 Verify that only Specialized role user with network privileges and Full role users are able to edit
    #TC23 Verify that only Specialized role user with network privileges and Full role users are able to edit
    #Create users accounts serveradmin backupadmin and networks required for tests

    Log To Console    *********Verifying Privileges for different users****************
    Fusion UI Navigate To Users and Groups Page
    Fusion UI Create User    ${TestData.users[1]}
    Fusion UI Create User    ${TestData.users[2]}
    Log to Console        Successfully added all the users

    ${status} =    fusion_ui_validate_privileges_edit_network    @{TestData.editethnetworks_1}
    Run Keyword If    '${status}' == 'True'    Log to Console    As expected Administrator user has privileges to add network    ELSE    fail

    #Log out of Appliance
    Fusion UI Logout of Appliance
    Log to Console    Logout Completed

    Sleep    10
    #Log into Fusion appliance as serveradmin
    ${user}=    Get Data By Property    ${TestData.users}    name    serveradmin
    Fusion UI Login to Appliance    ${user[0].name}
    Log to Console    Logged in as Serveradmin

    #User should not have any Edit or Delete Action button in page
    ${status} =        fusion_ui_validate_privileges_edit_network        @{TestData.editethnetworks}
    Run Keyword If    '${status}' == 'True'    Log to Console    As expected server user does not have privileges to add network    ELSE    fail

    #Log out of appliance
    Fusion UI Logout of Appliance
    Log to Console    Log out Success

    #Log into Fusion appliance as networkadmin
    ${user}=    Get Data By Property    ${TestData.users}    name    networkadmin
    Fusion UI Login to Appliance    ${user[0].name}
    Log to Console    Logged in as Network admin

    #User should have Edit or Delete Action button in page
    ${status} =    fusion_ui_validate_privileges_edit_network        @{TestData.editethnetworks_1}
    Run Keyword If    '${status}' == 'True'    Log to Console    As expected network user has privileges to add network    ELSE    fail

    #Log out of appliance
    Fusion UI Logout of Appliance
    Log to Console    Log out Success

    Log to Console    F444_TC_UI_23: Successfully verified the privileges for different users

    #Login as administrator
    ${user}=    Get Data By Property    ${TestData.users}    name    Administrator
    Fusion UI Login to Appliance   ${user[0].name}

09 Assign the same network to more than one PF on the same device port and ensure that it is not possible
    [Documentation]    27 Assign the same network to more than one PF on the same device port and ensure that it is not possible
    Log To Console    *********Verifying the error message displayed when trying to assign the same network to more than one PF****************
    ${Status}=    fusion_ui_validate_error_on_create_server_profile    @{TestData.profiles_27}
    Run Keyword If    '${status}' == 'True'    Log to Console    Successfully verified that same network cannot be assigned to more the one PF    ELSE    fail

    Log to Console    F444_TC_UI_27: Successfully verified the error message when trying to assign same network to more than 1 PF on the same device port

10 Verify Server Profile Requested BW defaults to the preferred BW and cannot be set higher than Max BW For verifying the invalid bandwidth error for the specified port
    [Documentation]    38 Verify Server Profile Requested BW defaults to the preferred BW and cannot be set higher than Max BW For verifying the invalid bandwidth error for the specified port
    Sleep    20
    Log To Console    *********Verifying the error message displayed when a value higher than max BW is set for a server profile ****************
    ${Status}=    fusion_ui_validate_error_on_create_server_profile     @{TestData.profile_netset_1}
    Run Keyword If    '${status}' == 'True'    Log to Console    Successfully verified that server profiles requested bandwidth can be changed from default to the preferred bandwidth    ELSE    fail

    ${Status}=    fusion_ui_delete_server_profile    @{TestData.Delete_profile}
    Run Keyword If    '${Status}' == 'True'    Log to Console    Deleted the profile successfully after verifying all parameters     ELSE    fail

    Log to Console    F444_TC_UI_38: Successfully verified the error message when Server Profile Requested BW is set to a value higher than Max BW for a specified port

11 Assign all subports to 5 GB Exceeds available bandwidth of 20 GB and verify that each subport gets a preferred bandwidth
    [Documentation]    43 Assign all subports to 5 GB Exceeds available bandwidth of 20 GB and verify that each subport gets a preferred bandwidth
    Log To Console    *********Verifying error message when assigning subports with a value which exceeds available bandwidth of 20GB****************
    ${Status}=    fusion_ui_validate_error_on_create_server_profile    @{TestData.profile_43_1}
    Run Keyword If    '${Status}' == 'True'    Log to Console    Successfully verified error message when trying to assign subports with a value which exceeds available bandwidth of 20GB    ELSE    fail

    Log to Console    F444_TC_UI_43: Successfully verified the error message on assigning all subports to 5 GB which exceeds available bandwidth of 20 GB

12 Verify when preferred and maximum speeds change at networks, Allocated Bandwidth in profile get recalibrated; bandwidth allocation on server NICs match Allocated Bandwidth of NICs port assignment in Profile Port Speeds accordingly.
    [Documentation]    41 verify when preferred and maximum speeds change at networks,Allocated Bandwidth in profile get recalibrated; bandwidth allocation on server NICs match Allocated Bandwidth of NICs port assignment in Profile Port Speeds accordingly.44 Increase and decrease the Preferred or Max bandwidth and verify server NIC transmit speed indicates the correct bandwidth value for each network setting
    #Edit an existing ethernet network
    Log To Console    ***********Verifying server NIC transmit speed when preferred or max BW is increased or decreased****************
    Fusion UI Edit Ethernet Network    @{TestData.networks_1}

    #Create server profile
    ${Status}=    fusion_ui_create_server_profile     @{TestData.profile_44_1}
    Run Keyword If    '${Status}' == 'True'    Log to Console    Server profile created with increase and decrease Preferred or Max bandwidth    ELSE    fail

    #verifying the profile
    ${Status} =    fusion_ui_verify_server_profile_connections_info    @{TestData.profile_44_1_verify}
    Run Keyword If    '${Status}' == 'True'    Log to Console    Successfully verified the server profile connections bandwidth    ELSE    fail

13 Increase and decrease the Preferred or Max bandwidth and verify server NIC transmit speed indicates the correct bandwidth value for each network setting
    #Edit the same network with different bandwidth values
    Fusion UI Edit Ethernet Network	@{TestData.editnetworks_1}

    #Edit server profile
    ${Status}=    fusion_ui_edit_server_profile     @{TestData.profile_44_2_1}
    Run Keyword If    '${Status}' == 'True'    Log to Console    Server profile edited with connections with different bandwidth values    ELSE    fail

    Fusion UI Logout of Appliance
    Log to Console    Successfully logged out of appliance

    ${user}=    Get Data By Property    ${TestData.users}    name    Administrator
    Fusion UI Login to Appliance   ${user[0].name}

    #Edit server profile
    ${Status}=    fusion_ui_edit_server_profile     @{TestData.profile_44_2_2}
    Run Keyword If    '${Status}' == 'True'    Log to Console    Successfully edited the profile with default values    ELSE    fail

    #Verify profile connections
    {Status}=    fusion_ui_verify_server_profile_connections_info    @{TestData.profile_44_2_verify}
    Run Keyword If    '${Status}' == 'True'    Log to Console    Successfully verified that NIC speed indicates the correct bandwidth value for each network setting    ELSE    fail

    ${Status}=    fusion_ui_delete_server_profile    @{TestData.Delete_profile}
    Run Keyword If    '${Status}' == 'True'    Log to Console    Deleted the profile successfully after verifying all parameters     ELSE    fail

    Log to Console    F444_TC_UI_41_44: Allocated Bandwidth in profile get recalibrated on changing the preferred and maximum speed at networks


14 Update the firmware version to 4.5, create a server profile and verify if we can create connections on new 5 to 8 sub ports
    [Documentation]    6 With supershaw firmware lower create server connections Upgrade firmware to version equal to 4.5
    ...    and now go to connections page in server profile edit and check whether we can create connections on new 5 to 8 sub ports
	...    7 With supershaw firmware equal to 4.5 create server connections Downgrade the firmware to version less than 4.5
    ...    and now verify what happens to existing connections Update the firmware to 4.5 and check the behavior
	...    11 Server NIC has 8 PF but the supershaw is loaded with firmware version less than 4.5.
    ...    Now the no of sub ports should be 4

    #Downgrade
    Log To Console    ***********Downgrade the fimware to version less than 4.5 and create a server profile to check if only 4PFs are supported****************
    ${Status}=    fusion_ui_update_firmware_logical_interconnect    @{TestData.Update_firmware_downgrade}
    Run Keyword If    '${Status}' == 'True'    Log to Console    Successfully Down graded to lower firmware version    ELSE    fail

    ${Status} =    fusion_ui_create_server_profile     @{TestData.profiledownnetwork}
    Run Keyword If    '${Status}' == 'True'    Log to Console    Server profile created with 4 ports    ELSE    fail

    Log To Console    *********Verify all parameters are displayed****************
    ${Status} =    fusion_ui_verify_server_profile_connections_info    @{TestData.profiledownnetwork_verify}
    Run Keyword If    '${Status}' == 'True'    Log to Console    Successfully verified all the parameters are displayed for 4 connections     ELSE    fail

    ${Status}=    fusion_ui_delete_server_profile    @{TestData.Delete_profile}
    Log to Console   Successfully deleted the profile.

    Fusion UI Navigate To Users and Groups Page
    Log To Console    ************Verify the error message when trying to add 8PFs to a profile whose firmware is less than 4.5************
     ${Status}=    fusion_ui_validate_error_on_create_server_profile    @{TestData.editprofilefirmware}
     Run Keyword If    '${Status}' == 'True'    Log to Console    Successfully verified error message when editing the profile with 5 to 8 PFs with lower firmware version    ELSE    fail

15 With supershaw firmware equal to 4.5 create server connections Downgrade the firmware to version less than 4.5 and now verify what happens to existing connections Update the firmware to 4.5 and check the behavior
    #Upgrade
    Log To Console    *********Upgrade the FW version to 4.5 and check if all 8PFs are enabled****************
    ${Status}=    fusion_ui_update_firmware_logical_interconnect    @{TestData.Update_firmware_upgrade}
    Run Keyword If    '${Status}' == 'True'    Log to Console    Successfully Upgraded to latest firmware version    ELSE    fail

    Fusion UI Navigate To Users and Groups Page
    ${Status} =    fusion_ui_create_server_profile     @{TestData.update_profile}
    Run Keyword If    '${Status}' == 'True'    Log to Console    Successfully created the profile with all 8 PFs    ELSE    fail

    Log To Console    *********Verify all parameters are displayed****************
    ${Status} =    fusion_ui_verify_server_profile_connections_info    @{TestData.profileupnetwork_verify}
    Run Keyword If    '${Status}' == 'True'    Log to Console    Successfully verified all the parameters are displayed for 8 connections     ELSE    fail

    Fusion UI Logout of Appliance
    Log to Console    Logout Completed

    ${user}=    Get Data By Property    ${TestData.users}    name    Administrator
    Fusion UI Login to Appliance   ${user[0].name}

16 Downgrade the firmware version with 4.45 having profile with 8 Pfs, The waring should be displayed
    #Downgrade
    Log To Console    ***********Downgrade the fimware to version less than 4.5 to check if it fails for last 4 ports ****************
    ${Status}=    fusion_ui_update_firmware_logical_interconnect    @{TestData.Update_firmware_downgrade}
    Run Keyword If    '${Status}' == 'False'    Log to Console    Successfully verified that downgrade fails    ELSE    fail

    ${Status}=    fusion_ui_delete_server_profile    @{TestData.Delete_profile}
    Log to Console   Successfully deleted the profile.

    Log to Console    F444_TC_UI_6_7_11: Successfully downgraded the firmware to 4.45,created and verified the server profile with 4 ports,verified error message on trying to add 4 more ports,updated the firmware to 4.5,created and verified server profile with 8 ports


    #TC 25: Create a server profile by adding some connections for newly added ports 1-e to 1-h and 2-e to 2-h.
    #Power on the server, navigate to interconnects page and in the downlink ports section,
    #verify the link state should be shown as "linked" for all the connections.
    #Power off the server and verify if it turns to "unlinked" state.

    [Documentation]    25 Create a server profile by adding some connections for newly added ports 1e to 1h and 2e to 2h. Power on the server, navigate to interconnects page and in the downlink ports section, verify the link state should be shown as "linked" for all the connections. Power off the server and verify if it turns to "unlinked" state.


17 Create a server profile by adding some connections for newly added ports 1e to 1h and 2e to 2h. Power on the server, navigate to interconnects page and in the downlink ports section, verify the link state should be shown as "linked" for all the connections. Power off the server and verify if it turns to "unlinked" state.
    Fusion UI Navigate To Users and Groups Page
    #Creating Server Profile
    Log To Console    *********Create Server profile****************
    ${Status}=    fusion_ui_create_server_profile    @{TestData.profiles}
    Log to Console    Server profile creation status:    ${Status}

    #Power on the server
    Log to Console    **************Power On Server Profiles********
    Log to Console    Power On Server Profiles
    fusion_ui_power_on_server_profile    @{TestData.profiles}
    sleep    300

    #Verify link state should be shown as "linked" when Server power is ON
    Log to Console    **************Verifying Link State of Downlink Port as linked**************
    ${Status}=    fusion_ui_verify_interconnect_downlinkport_view    ${TestData.enclosures_1[0].interconnectname}    ${TestData.enclosures_1[0].name}    @{TestData.enclosures_1}
    Should Be Equal As Strings    '${Status}'    '${TestData.enclosures_1[0].state}'
    Log to Console    Successfully verified that link state is "linked" when server is POWERED ON

    #Power off the server
    Log to Console    **************Power Off Server Profiles********
    Log to Console    Power Off Server Profiles
    fusion_ui_power_off_server_profile    @{TestData.profiles}
    sleep    60

    #Verify link state should be shown as "Unlinked" when Server power is OFF
    Log to Console    **************Verifying Link State of Downlink Port as unlinked**************
    ${Status}=    fusion_ui_verify_interconnect_downlinkport_view    ${TestData.enclosures_1[0].interconnectname}    ${TestData.enclosures_1[0].name}    @{TestData.enclosures_1}
    Should Not Be Equal As Strings    '${Status}'    '${TestData.enclosures_1[0].state}'
    Log to Console    Successfully verified that link state is "unlinked" when server is POWERED OFF

    Log to Console    F444_TC_UI_25: Successfully verified the state of the downlink port as "linked"

    #TC 26: After finishing the above testcase, disable the corresponding downlink port and enable it back.
    #While disabling or enabling the ports, verify if the link state is changing states properly to "disabled" and "linked" respectively.

    [Documentation]    26 After finishing the above testcase, disable the corresponding downlink port and enable it back.While disabling or enabling the ports, verify if the link state is changing states properly to "disabled" and "linked" respectively.

18 After finishing the above testcase, disable the corresponding downlink port and enable it back.While disabling or enabling the ports, verify if the link state is changing states properly to "disabled" and "linked" respectively.
    #Disable the downlink port and check for the state to be as "Disabled"
    Log to Console    **************Disable the downlink port**********
    fusion_ui_edit_interconnect    ${TestData.interconnects[0]}
    Log to Console    **************Verifying Link State of Downlink Port**************
    ${Status}=    fusion_ui_verify_interconnect_downlinkport_view    ${TestData.enclosures_1[0].interconnectname}    ${TestData.enclosures_1[0].name}    @{TestData.enclosures_1}
    Should Not Be Equal As Strings    '${Status}'    '${TestData.enclosures_1[0].state}'
    Log to Console    Successfully verified that link state is "Disabled" after disabling the downlinkports

    #Power on the server
    Log to Console    **************Power On Server Profiles********
    fusion_ui_power_on_server_profile    @{TestData.profiles}
    sleep    300

    #Enable the downlink port and check for the state to be as "linked"
    Log to Console    **************Enable the downlink port**********
    fusion_ui_edit_interconnect    ${TestData.interconnects_enable[0]}
    Log to Console    **************Verifying Link State of Downlink Port**************
    ${Status}=    fusion_ui_verify_interconnect_downlinkport_view    ${TestData.enclosures_1[0].interconnectname}    ${TestData.enclosures_1[0].name}    @{TestData.enclosures_1}
    Should Be Equal As Strings    '${Status}'    '${TestData.enclosures_1[0].state}'
    Log to Console    Successfully verified that link state is "Enabled" after enabling the downlinkports

    #Power off the server
    Log to Console**************Power Off Server Profiles********
    Log to Console    Power Off Server Profiles
    fusion_ui_power_off_server_profile    @{TestData.profiles}
    sleep  60

    ${Status}=    fusion_ui_delete_server_profile    @{TestData.Delete_profile}
    Log to Console   Successfully deleted the profile after verifying the interconnects state.

    Log to Console    F444_TC_UI_26: Successfully verified the state of the downlink port as "disabled" and "linked" on disabling and enabling the downlink ports

    Log to Console    All steps completed successfully for 8PF
