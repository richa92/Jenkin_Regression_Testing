*** Settings ***
Documentation        Feature Test:  OVF3932 - Ping and Traceroute
...                  This set of test cases is to verify the feature OVF3932 Ping and Traceroute
...
Variables              data_variables_ping.py
Resource               ../../../../Resources/api/fusion_api_resource.txt
Library                Collections
Library                json
Library                OperatingSystem
Library                SSHLibrary
Library                Selenium2Library
#Library                Telnet
Library                Dialogs
Library                FusionLibrary
Library                RoboGalaxyLibrary
Library                String

*** Variables ***
${APPLIANCE_IP}                 192.168.144.199
${LIG_1}     LIG1

*** Test Cases ***
CleanUp ALL
    [Documentation]    Edit LIG-Disable US-Check for alert message in LI
    Set Log Level    TRACE
    Fusion Api Login Appliance         ${APPLIANCE_IP}        ${admin_credentials}

TC01: Add Base Resources
    [Tags]    TC01
    Run Keyword If  ${ethernet_networks} is not ${null}    Create Bulk Ethernet Networks   ${ethernet_networks}     timeout=300  interval=10
    #Run Keyword If    ${networksets} is not ${null}      Add Networks Sets from variable async  ${networksets}

TC02: Add LIG and Create LE
    [Tags]    TC02
    ${resp}=    Run Keyword If    ${lig_nitro} is not ${null}   Add LIG from variable async    ${lig_nitro}
    Wait For Task2    ${resp}    timeout=200    interval=10
    Run Keyword If    ${enc_group_nitro} is not ${null}      Add Enclosure Group from variable async    ${enc_group_nitro}
    Run Keyword If    ${Logical_Enclosure_HA} is not ${null}      Add Logical Enclosure from lists Async    ${Logical_Enclosure_HA}


#--------------PING Starts ---------------

OVF3932_TC_01_PING_A_VALID_AND_ACTIVE_IPV4_IP
    ${output}    Ping from IC   ${IC2_nitro}     ${Valid_Ipv4[0]}
    ${status}    Get From Dictionary    ${output[-2]}    statusUpdate
    Should Contain    ${status}    0% packet loss

OVF3932_TC_02_PING_A_VALID_AND_INACTIVE_IPV4_IP
    ${output}    Ping from IC   ${IC2_nitro}    ${Valid_inactive_IPv4}
    ${status}    Get From Dictionary    ${output[-2]}    statusUpdate
    Should Contain    ${status}    100% packet loss

OVF3932_TC_03_PING_AN_INVALID_IPV4_IP
    ${output}    Ping from IC   ${IC2_nitro}    ${Invalid_ipv4}    1
    ${error}    Get From Dictionary    ${output}    errorCode
    Should Be Equal    ${error}    ${Invalid_ip_err_msg}

OVF3932_TC_04_PING_A_VALID_AND_ACTIVE_IPV6_IP
    ${output}    Ping from IC   ${IC2_nitro}    ${Valid_ipv6[0]}
    ${status}    Get From Dictionary    ${output[-2]}    statusUpdate
    Should Contain    ${status}    0% packet loss

OVF3932_TC_05_PING_A_VALID_AND_INACTIVE_IPV6_IP
    ${output}    Ping from IC   ${IC2_nitro}    ${Valid_inactive_IPv6}
    ${status}    Get From Dictionary    ${output[-1]}    statusUpdate
    Should Contain    ${status}    100% packet loss

OVF3932_TC_06_PING_AN_INVALID_IPV6_IP
    ${output}    Ping from IC   ${IC2_nitro}    ${Invalid_ipv6}    1
    ${error}    Get From Dictionary    ${output}    errorCode
    Should Be Equal    ${error}    ${Invalid_ip_err_msg}

OVF3932_TC_07_PING_AN_INVALID_FORMAT_IPV4
    ${output}    Ping from IC   ${IC2_nitro}    ${Invalid_ipv4_format}    1
    ${error}    Get From Dictionary    ${output}    errorCode
    Should Be Equal    ${error}    ${Invalid_ip_err_msg}

OVF3932_TC_08_PING_AN_INVALID_FORMAT_IPV6
    ${output}    Ping from IC   ${IC2_nitro}    ${Invalid_ipv6}    1
    ${error}    Get From Dictionary    ${output}    errorCode
    Should Be Equal    ${error}    ${Invalid_ip_err_msg}

TC_54_PING_NETMASK
    ${output}    Ping from IC   ${IC2_nitro}    ${netmask}
    ${status}    Get From Dictionary    ${output[-1]}    statusUpdate
    Should Contain    ${status}    ${Netmask_Invalid}

OVF3932_TC_49_BLANK_PING
    ${output}    Ping from IC   ${IC2_nitro}    ${blank_ip}    1
    ${error}    Get From Dictionary    ${output}    errorCode
    Should Be Equal    ${error}    ${Invalid_destination_address_msg}

OVF3932_TC_53_PING_GATEWAY
    ${output}    Ping from IC   ${IC2_nitro}    ${gateway_ip}
    ${status}    Get From Dictionary    ${output[-2]}    statusUpdate
    Should Contain    ${status}    0% packet loss

OVF3932_TC_59_PING_LOCALHOST
    ${output}    Ping from IC   ${IC2_nitro}    ${localhost_name}
    ${status}    Get From Dictionary    ${output[-2]}    statusUpdate
    Should Contain    ${status}    0% packet loss

OVF3932_TC_60_PING_127.0.0.1
    ${output}    Ping from IC   ${IC2_nitro}    ${localhost_ip}
    ${status}    Get From Dictionary    ${output[-2]}    statusUpdate
    Should Contain    ${status}    0% packet loss

OVF3932_TC_65_PING_2_IPV4_SAME_ICM
    ${output}    Ping from IC   ${IC2_nitro}     ${Valid_Ipv4[0]}   1
    ${output1}    Ping from IC  ${IC2_nitro}  ${Valid_Ipv4[1]}  1
    ${error}    Get From Dictionary    ${output1}    errorCode
    Should Be Equal    ${error}    ${ongoing_opr_err_msg}
    ${task}    Wait For Task    ${output}   timeout=5m    interval=10


OVF3932_TC_66_PING_IPV4_IPV6_SAME_ICM
    ${output}    Ping from IC   ${IC2_nitro}     ${Valid_Ipv4[0]}   1
    ${output1}    Ping from IC  ${IC2_nitro}    ${Valid_ipv6[0]}    1
    ${error}    Get From Dictionary    ${output1}    errorCode
    Should Be Equal    ${error}    ${ongoing_opr_err_msg}
    ${task}    Wait For Task    ${output}   timeout=5m    interval=10

OVF3932_TC_67_PING_2_IPV6_SAME_ICM
    ${output}    Ping from IC   ${IC2_nitro}    ${Valid_ipv6[0]}    1
    ${output1}    Ping from IC  ${IC2_nitro}    ${Valid_ipv6[1]}    1
    ${error}    Get From Dictionary    ${output1}    errorCode
    Should Be Equal    ${error}    ${ongoing_opr_err_msg}
    ${task}    Wait For Task    ${output}   timeout=5m    interval=10

OVF3932_TC_68_PING_SAME_IPV4_SAME_ICM
    ${output}    Ping from IC   ${IC2_nitro}     ${Valid_Ipv4[0]}   1
    ${output1}    Ping from IC  ${IC2_nitro}  ${Valid_Ipv4[0]}  1
    ${error}    Get From Dictionary    ${output1}    errorCode
    Should Be Equal    ${error}    ${ongoing_opr_err_msg}
    ${task}    Wait For Task    ${output}   timeout=5m    interval=10

OVF3932_TC_69_PING_SAME_IPV6_SAME_ICM
    ${output}    Ping from IC   ${IC2_nitro}     ${Valid_Ipv6[0]}   1
    ${output1}    Ping from IC  ${IC2_nitro}    ${Valid_ipv6[0]}    1
    ${error}    Get From Dictionary    ${output1}    errorCode
    Should Be Equal    ${error}    ${ongoing_opr_err_msg}
    ${task}    Wait For Task    ${output}   timeout=5m    interval=10

OVF3932_TC_72_PING_2_IPV4_DIFFERENT_ICM
    ${output}    Ping from IC   ${IC2_nitro}     ${Valid_Ipv4[0]}
    ${output1}    Ping from IC  ${IC5_nitro}  ${Valid_Ipv4[1]}
    ${status}    Get From Dictionary    ${output1[-2]}    statusUpdate
    Should Contain    ${status}    0% packet loss
    ${status}    Get From Dictionary    ${output[-2]}    statusUpdate
    Should Contain    ${status}    0% packet loss

OVF3932_TC_73_PING_IPV4_IPV6_DIFFERENT_ICM
    ${output}    Ping from IC   ${IC2_nitro}     ${Valid_Ipv4[0]}
    ${output1}    Ping from IC  ${IC5_nitro}    ${Valid_ipv6[0]}
    ${status}    Get From Dictionary    ${output1[-2]}    statusUpdate
    Should Contain    ${status}    0% packet loss
    ${status}    Get From Dictionary    ${output[-2]}    statusUpdate
    Should Contain    ${status}    0% packet loss

OVF3932_TC_74_PING_2_IPV6_DIFFERENT_ICM
    ${output}    Ping from IC   ${IC2_nitro}    ${Valid_ipv6[0]}
    ${output1}    Ping from IC  ${IC5_nitro}    ${Valid_ipv6[1]}
    ${status}    Get From Dictionary    ${output1[-2]}    statusUpdate
    Should Contain    ${status}    0% packet loss
    ${status}    Get From Dictionary    ${output[-2]}    statusUpdate
    Should Contain    ${status}    0% packet loss

OVF3932_TC_75_PING_SAME_IPV4_DIFFERENT_ICM
    ${output}    Ping from IC   ${IC2_nitro}     ${Valid_Ipv4[0]}
    ${output1}    Ping from IC  ${IC5_nitro}  ${Valid_Ipv4[0]}
    ${status}    Get From Dictionary    ${output1[-2]}    statusUpdate
    Should Contain    ${status}    0% packet loss
    ${status}    Get From Dictionary    ${output[-2]}    statusUpdate
    Should Contain    ${status}    0% packet loss

OVF3932_TC_76_PING_SAME_IPV6_DIFFERENT_ICM
    ${output}    Ping from IC   ${IC2_nitro}    ${Valid_ipv6[0]}
    ${output1}    Ping from IC  ${IC5_nitro}    ${Valid_ipv6[1]}
    ${status}    Get From Dictionary    ${output1[-2]}    statusUpdate
    Should Contain    ${status}    0% packet loss
    ${status}    Get From Dictionary    ${output[-2]}    statusUpdate
    Should Contain    ${status}    0% packet loss

#-------------- Ping Ends

#-----TRACE -------

OVF3932_TC_17_TRACEROUTE A VALID AND ACTIVE IPV4 IP
    ${output}    Trace_route from IC     ${IC2_nitro}    ${Valid_Ipv4[0]}
    ${status}    Get From Dictionary    ${output[-1]}    statusUpdate
    Should Contain    ${status}    ${Trace_15_hop}

OVF3932_TC_18_TRACEROUTE A VALID AND INACTIVE IPV4 IP
    ${output}    Trace_route from IC     ${IC2_nitro}    ${Valid_inactive_IPv4}
    ${status}    Get From Dictionary    ${output[-1]}    statusUpdate
    Should Contain    ${status}    ${Trace_invalid}

OVF3932_TC_23_TRACEROUTE AN INVALID FORMAT IPV4
    ${output}    Trace_route from IC     ${IC2_nitro}    ${Invalid_ipv4_format}     1
    ${error}    Get From Dictionary    ${output}    errorCode
    Should Contain    ${error}    ${Invalid_ip_err_msg}

OVF3932_TC_20_TRACEROUTE A VALID AND ACTIVE IPV6 IP
    ${output}    Trace_route from IC     ${IC2_nitro}    ${Ipv6_192_168_144_142}
    ${status}    Get From Dictionary    ${output[-1]}    statusUpdate
    Should Contain    ${status}    ${Trace_15_hop}

OVF3932_TC_21_TRACEROUTE A VALID AND INACTIVE IPV6 IP
    ${output}    Trace_route from IC     ${IC2_nitro}    ${Valid_inactive_IPv6}
    ${status}    Get From Dictionary    ${output[-1]}    statusUpdate
    Should Contain    ${status}    ${Trace_invalid}

OVF3932_TC_22_TRACEROUTE AN INVALID IPV6 IP
    ${output}    Trace_route from IC     ${IC2_nitro}    ${Invalid_ipv6}    1
    ${error}    Get From Dictionary    ${output}    errorCode
    Should Contain    ${error}    ${Invalid_ip_err_msg}

OVF3932_TC_24_TRACEROUTE AN INVALID FORMAT IPV6
    ${output}    Trace_route from IC     ${IC2_nitro}    ${Invalid_ipv6_format}     1
    ${error}    Get From Dictionary    ${output}    errorCode
    Should Contain    ${error}    ${Invalid_ip_err_msg}

OVF3932_TC_50_BLANK_TRACEROUTE
    ${output}    Trace_route from IC    ${IC2_nitro}    ${blank_ip}    1
    ${error}    Get From Dictionary    ${output}    errorCode
    Should Be Equal    ${error}    ${Invalid_destination_address_msg}

OVF3932_TC_56_TRACEROUTE_GATEWAY
    ${output}    Trace_route from IC     ${IC2_nitro}    ${gateway_ip}
    ${status}    Get From Dictionary    ${output[-1]}    statusUpdate
    Should Contain    ${status}    ${Trace_precedence}

OVF3932_TC_57_TRACEROUTE_NETMASK
    ${output}    Trace_route from IC     ${IC2_nitro}    ${netmask}
    ${status}    Get From Dictionary    ${output[-1]}    statusUpdate
    Should Contain    ${status}    ${Netmask_Invalid}

OVF3932_TC_61_TRACEROUTE_LOCALHOST
    ${output}    Trace_route from IC     ${IC2_nitro}    ${localhost_name}
    ${status}    Get From Dictionary    ${output[-1]}    statusUpdate
    Should Contain    ${status}    ${ms}

OVF3932_TC_62_TRACEROUTE_127.0.0.1
    ${output}    Trace_route from IC     ${IC2_nitro}    ${localhost_ip}
    ${status}    Get From Dictionary    ${output[-1]}    statusUpdate
    Should Contain    ${status}    ${ms}

TC_79_TRACEROUTE_2_IPV4_SAME_ICM
    ${output}    Trace_route from IC     ${IC2_nitro}    ${Valid_Ipv4[0]}    1
    ${output1}    Trace_route from IC     ${IC2_nitro}    ${Valid_Ipv4[1]}   1
    ${error}    Get From Dictionary    ${output1}    errorCode
    Should Be Equal    ${error}    ${ongoing_opr_err_msg}
    ${task}    Wait For Task    ${output}   timeout=5m    interval=10

TC_80_TRACEROUTE_IPV4_IPV6_SAME_ICM
    ${output}    Trace_route from IC     ${IC2_nitro}    ${Valid_Ipv4[0]}    1
    ${output1}    Trace_route from IC     ${IC2_nitro}    ${Ipv6_192_168_144_142}   1
    ${error}    Get From Dictionary    ${output1}    errorCode
    Should Be Equal    ${error}    ${ongoing_opr_err_msg}
    ${task}    Wait For Task    ${output}   timeout=5m    interval=10

OVF3932_TC_81_TRACEROUTE_2_IPV6_SAME_ICM
    ${output}    Trace_route from IC     ${IC2_nitro}    ${Ipv6_192_168_144_142}    1
    ${output1}    Trace_route from IC     ${IC2_nitro}    ${Valid_Ipv6[1]}   1
    ${error}    Get From Dictionary    ${output1}    errorCode
    Should Be Equal    ${error}    ${ongoing_opr_err_msg}
    ${task}    Wait For Task    ${output}   timeout=5m    interval=10

OVF3932_TC_82_TRACEROUTE_SAME_IPV4_SAME_ICM
    ${output}    Trace_route from IC     ${IC2_nitro}    ${Valid_Ipv4[0]}    1
    ${output1}    Trace_route from IC     ${IC2_nitro}    ${Valid_Ipv4[0]}   1
    ${error}    Get From Dictionary    ${output1}    errorCode
    Should Be Equal    ${error}    ${ongoing_opr_err_msg}
    ${task}    Wait For Task    ${output}   timeout=5m    interval=10

OVF3932_TC_83_TRACEROUTE_SAME_IPV6_SAME_ICM
    ${output}    Trace_route from IC     ${IC2_nitro}    ${Ipv6_192_168_144_142}    1
    ${output1}    Trace_route from IC     ${IC2_nitro}    ${Ipv6_192_168_144_142}   1
    ${error}    Get From Dictionary    ${output1}    errorCode
    Should Be Equal    ${error}    ${ongoing_opr_err_msg}
    ${task}    Wait For Task    ${output}   timeout=5m    interval=10


TC_86_TRACEROUTE_2_IPV4_DIFFERENT_ICM
    ${output}    Trace_route from IC     ${IC2_nitro}    ${Valid_Ipv4[0]}   1
    ${output1}    Trace_route from IC     ${IC5_nitro}    ${Valid_Ipv4[1]}
    ${status}    Get From Dictionary    ${output1[-1]}    statusUpdate
    Should Contain    ${status}    ${Trace_15_hop}
    ${task}    Wait For Task    ${output}   timeout=5m    interval=10
    ${progress}    Get From Dictionary    ${task}    progressUpdates
    ${status}    Get From Dictionary    ${progress[-1]}    statusUpdate
    Should Contain    ${status}    ${Trace_15_hop}

OVF3932_TC_87_TRACEROUTE_IPV4_IPV6_DIFFERENT_ICM
    ${output}    Trace_route from IC     ${IC2_nitro}    ${Valid_Ipv4[1]}   1
    ${output1}    Trace_route from IC     ${IC5_nitro}    ${Ipv6_192_168_144_142}
    ${status}    Get From Dictionary    ${output1[-1]}    statusUpdate
    Should Contain    ${status}    ${Trace_15_hop}
    ${task}    Wait For Task    ${output}   timeout=5m    interval=10
    ${progress}    Get From Dictionary    ${task}    progressUpdates
    ${status}    Get From Dictionary    ${progress[-1]}    statusUpdate
    Should Contain    ${status}    ${Trace_15_hop}

OVF3932_TC_88_TRACEROUTE_2_IPV6_DIFFERENT_ICM
    ${output}    Trace_route from IC     ${IC2_nitro}    ${Ipv6_192_168_144_142}    1
    ${output1}    Trace_route from IC     ${IC5_nitro}    ${Valid_Ipv6[1]}
    ${status}    Get From Dictionary    ${output1[-2]}    statusUpdate
    Should Contain    ${status}    ${Max_hops}
    ${task}    Wait For Task    ${output}   timeout=5m    interval=10
    ${progress}    Get From Dictionary    ${task}    progressUpdates
    ${status}    Get From Dictionary    ${progress[-1]}    statusUpdate
    Should Contain    ${status}    ${Trace_15_hop}

TC_89_TRACEROUTE_SAME_IPV4_DIFFERENT_ICM
    ${output}    Trace_route from IC     ${IC2_nitro}    ${Valid_Ipv4[1]}   1
    ${output1}    Trace_route from IC     ${IC5_nitro}    ${Valid_Ipv4[1]}
    ${status}    Get From Dictionary    ${output1[-1]}    statusUpdate
    Should Contain    ${status}    ${Trace_15_hop}
    ${task}    Wait For Task    ${output}   timeout=5m    interval=10
    ${progress}    Get From Dictionary    ${task}    progressUpdates
    ${status}    Get From Dictionary    ${progress[-1]}    statusUpdate
    Should Contain    ${status}    ${Trace_15_hop}

OVF3932_TC_90_TRACEROUTE_SAME_IPV6_DIFFERENT_ICM
    ${output}    Trace_route from IC     ${IC2_nitro}    ${Ipv6_192_168_144_142}    1
    ${output1}    Trace_route from IC     ${IC5_nitro}    ${Ipv6_192_168_144_142}
    ${status}    Get From Dictionary    ${output1[-1]}    statusUpdate
    Should Contain    ${status}    ${Trace_15_hop}
    ${task}    Wait For Task    ${output}   timeout=5m    interval=10
    ${progress}    Get From Dictionary    ${task}    progressUpdates
    ${status}    Get From Dictionary    ${progress[-1]}    statusUpdate
    Should Contain    ${status}    ${Trace_15_hop}


OVF3932_TC_19_TRACEROUTE AN INVALID IPV4 IP
    ${output}    Trace_route from IC    ${IC2_nitro}    ${Invalid_ipv4}    1
    ${error}    Get From Dictionary    ${output}    errorCode
    Should Be Equal    ${error}    ${Invalid_ip_err_msg}


*** Keywords ***
Ping from IC
    [Arguments]    ${IC_name}   ${IP}    ${flag}=0
    ${IC_Uri}    Get IC URI    ${IC_name}
    ${temp}    Copy Dictionary    ${ping_call}
    Set to Dictionary    ${temp}     address    ${IP}
    ${resp}    fusion_api_interconnect_diagnostic_tools    ${temp}    ${IC_Uri}
    Return From Keyword If    '${flag}' == '1'    ${resp}
    ${task}    Wait For Task    ${resp}   timeout=5m    interval=10
    ${progress}    Get From Dictionary    ${task}    progressUpdates
    [return]    ${progress}

Trace_route from IC
    [Arguments]    ${IC_name}    ${IP}    ${flag}=0
    ${IC_Uri}    Get IC URI    ${IC_name}
    ${temp}    Copy Dictionary    ${trace_call}
    Set to Dictionary    ${temp}    address    ${IP}
    ${resp}    fusion_api_interconnect_diagnostic_tools    ${temp}    ${IC_Uri}
    Return From Keyword If    '${flag}' == '1'    ${resp}
    ${task}    Wait For Task    ${resp}   timeout=5m    interval=10
    #Log    ${task}
    ${progress}    Get From Dictionary    ${task}    progressUpdates
    #Log        ${progress}
    [return]    ${progress}

