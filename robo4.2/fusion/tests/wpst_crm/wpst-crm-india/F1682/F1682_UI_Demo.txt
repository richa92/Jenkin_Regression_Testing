*** Settings ***
*** Settings ***

Documentation      F1682 UI Integration Tests for RoboGalaxy dev Branch
Resource           F1682_Config.txt
Resource            ../../../resource/fusion_api_all_resource_files.txt
Resource           ../../../RIST/UI/resource.txt
Force Tags         Buildup
Test Setup         Load Test Data and Open Browser
Test Teardown      Logout And Close All Browsers
Library             SSHLibrary
Library            String
Library            Collections
Variables          data_variables_c7k.py     


*** Variables ***
${User}     Administrator
${User1}    Backup
${User2}    Network
${SSH_PASS}                 hpvse1

${SeleniumSpeed}      0.1
${POTASSIUM}        Synergy 40Gb F8 Switch Module
${POTASH}           Virtual Connect SE 40Gb F8 Module for Synergy
${CHLORIDE20}       Synergy 20Gb Interconnect Link Module

${ui14_msg}   The uplink set cannot contain both 40 Gb/s ports and ports that require the use of a splitter cable.
${ui14_resol}   Resolution Remove port(s) Q4.2, or change the speed for port(s) Q4.1 to Auto.
${ui15_msg}   Port(s) Q1.1 are used by other uplink sets as 40 Gb/s ports and conflict with port selections in this uplink set
${ui15_resol}   Remove port(s) Q1.2 from this uplink set to proceed
${ui17_msg}   Port(s) Q1.2 are used by other uplink sets as Auto ports and conflict with port selections in this uplink set.
${ui17_resol}   nResolution Remove port(s) Q1.1, set the speed to Auto or change the configuration of the ports causing the conflict.
${ui18_msg}   The uplink set cannot contain both 40 Gb/s ports and ports that require the use of a splitter cable.
${ui18_resol}  Remove port(s) Q3.2, or change the speed for port(s) Q3.1 to Auto.
${inconmsg}   The logical interconnect is inconsistent with the logical interconnect group LIG_UI_f1682.



*** Test Cases ***
#*** comment ***

F1682_TC_UI_1_c7K: Verify CreateLIG-uplink displays speed and AutoNegotiation field for supershaw Qx:1 ports
  [Documentation]  covers F1682_TC_UI_1_c7K,F1682_TC_UI_2_c7K,F1682_TC_UI_3_c7K: Verify CreateLIG-uplinks,if Qx:1=Auto,AN = Enabled & if Qx:1=40G,AN=Disabled
  Set Log Level   TRACE
  Log into Fusion appliance as Administrator 
  ${status}=  Fusion UI Create Ethernet Network   @{TestData.networks}
  run keyword if    '${status}'=='False'    Fail      "Ethernt networks not created"
  ${status}=  Fusion UI Create fcoe Network    @{TestData.fcoenetworks}
  run keyword if    '${status}'=='False'    Fail      "fcoe networks not created"
  ${Status}=    fusion_ui_create_logical_interconnect_group    @{TestData.ligs}
  run keyword if    '${status}'=='False'    Fail      "lig not created"


F1682_TC_UI_5_c7K:Verify in CreateLIG uplink, we Cannot select both split and unsplit versions of the same port
  [Documentation]  split and unsplit
  Set Log Level   TRACE
  Log into Fusion appliance as Administrator 
  ${msg}=    run keyword and expect error    Unable to create logical interconnect group.*  fusion_ui_create_logical_interconnect_group    @{TestData.lig_UI_5}
  should contain    ${msg}   ${ui5_msg}
  log to console    Error contains status=${msg}


F1682_TC_UI_7_c7K:Verify CreateLIG uplink,when Q1:1=[Speed:Auto, AN:Enabled], Q1:2,Q1:3=[speed:Auto, AN:n/a]
  Log into Fusion appliance as Administrator 
  ${status}=    fusion_ui_create_logical_interconnect_group    @{TestData.lig_UI_7}
  log to console    status=${status}
  run keyword if    '${status}'=='False'    Fail      "lig not created"


F1682_TC_UI_8_c7K:Verify CreateLIG,if uplink1 used Q1:1=40G,then using Q1.2 in Uplink2 raises error Alert
   Set Log Level   TRACE
   Log into Fusion appliance as Administrator 
   ${status}=    run keyword and expect error  Unable to create logical interconnect group.*   fusion_ui_create_logical_interconnect_group    @{TestData.lig_UI_8}
   should contain      ${status}   ${ui8_1msg}
   should contain      ${status}   ${ui8_2msg}
   

F1682_TC_UI_9_c7K:verify CreateLIG with Uplink1 Q2.1=[auto, Enabled] & Uplink2 Q1.2,2.2=[auto, n/a] successfully
  Log into Fusion appliance as Administrator 
  ${status}=    fusion_ui_create_logical_interconnect_group    @{TestData.lig_UI_9}
  run keyword if    '${status}'=='False'    Fail      "lig not created"
  

F1682_TC_UI_10_C7K: Verify CreateLIG with uplink1 : Q1.2,Q3.2, Uplink2: Q2.1=[40G] and uplink3:Q3.1=[40G] & Q1.3 gives error for Q3.1
   Set Log Level   TRACE
   Log into Fusion appliance as Administrator 
   ${status}=    run keyword and expect error    Unable to create logical interconnect group.*      fusion_ui_create_logical_interconnect_group      @{TestData.lig_UI_10}
   should contain      ${status}   ${ui10_msg}
   should contain      ${status}   ${ui10_resol}


F1682_TC_UI_11_c7K: verify LIG page>ULS display ports, speed and AutoNeg status correctly
  Set Log Level   TRACE
   Log into Fusion appliance as Administrator 
   ${status}=    fusion_ui_create_logical_interconnect_group    @{TestData.lig_UI_11}
   run keyword if    '${status}'=='False'    Fail      "lig not created"
   ${resp}=  Run Keyword And ignore error    fusion_ui_verify_logical_interconnect_group  @{TestData.lig11v}
   


F1682_TC_UI_12_c7K::Verify CreateLIG with Q1.1=[40G] in Bay3, Q1.2=[Auto] in Bay4 and Q1.1=[40G],Q2.2=[Auto] in Bay5 is successful
  Set Log Level   TRACE
   Log into Fusion appliance as Administrator 
   ${status}=    fusion_ui_create_logical_interconnect_group    @{TestData.lig_UI_12}
   run keyword if    '${status}'=='False'    Fail      "lig not created"
   #possibly add a nnegative testcase of 40g alerady consumed
   

F1682_TC_UI_preq_c7K:: CreateLIG for next tests in LI
  Set Log Level   TRACE
   Log into Fusion appliance as Administrator 
   ${status}=    fusion_ui_create_logical_interconnect_group    @{TestData.lig_UI_preq}
   run keyword if    '${status}'=='False'    Fail      "lig not created"

 
add enclosures
    Fusion Api Login Appliance   ${APPLIANCE_IP}  ${admin_credentials}
    ${enc_groups} =	Get Variable Value	${enc_groups_ui}
	Run Keyword If	${enc_groups} is not ${null}	Run Keyword for List	${enc_groups}	Add Enclosure Group from variable
    ${encs} =	Get Variable Value	${encs}
	Run Keyword If	${encs} is not ${null}					Add Enclosures from variable	${encs}
   

F1682_TC_UI_14:c7K Verify EditLI Modifying uplink1 Q1.1 to 40G is ok, while in Uplink2,adding Q4.2 and Q4.1=40G displays Split port error
   Log into Fusion appliance as Administrator
   fusion_ui_edit_logical_interconnects   @{TestData.removeuls}
   ${status}=   Run Keyword And Ignore Error   fusion_ui_edit_logical_interconnects   @{TestData.editli_14}
   
   log to console   ${status}
   should contain      ${status[1]}   ${ui14_msg}
 

F1682_TC_UI_15_c7K: verify with Uplink1 Q1.1,Q2.1=40G,adding uplink3=Q2.2 results in Ports already used error
   Log into Fusion appliance as Administrator
   fusion_ui_edit_logical_interconnects   @{TestData.removeuls}
   ${status}=   Run Keyword And Ignore Error   fusion_ui_edit_logical_interconnects    @{TestData.editli_15}
   log to console   ${status}
   should contain      ${status[1]}   ${ui15_msg}


   
F1682_TC_UI_16:c7K Verify EditLI-Modify Uplink1:Q1.1 to 40G & adding uplink3:Q4.1[Auto] is successful
   Log into Fusion appliance as Administrator
   fusion_ui_edit_logical_interconnects   @{TestData.removeuls}
   ${status}=  fusion_ui_edit_logical_interconnects   @{TestData.editli_16}
    run keyword if    '${status}'=='False'    Fail      "li not edited"
  

 
F1682_TC_UI_17_c7K: Verify EditLI if Uplink1:Q1.2=Auto then Modify Uplink2 Q1.1 to 40G displays port already used error
   Log into Fusion appliance as Administrator
   fusion_ui_edit_logical_interconnects   @{TestData.removeuls}
   ${status}=   Run Keyword And Ignore Error   fusion_ui_edit_logical_interconnects    @{TestData.editli_17a}
   log to console   ${status}
   should contain   ${status[1]}   Port(s) Q1.2 are used by other uplink sets as Auto ports and conflict with port selections in this uplink set.
   


F1682_TC_UI_18:c7K Verify EditLI Adding Q1.2=Auto to Existing Q1.1=40G in Uplink gives splitter port error
   Log into Fusion appliance as Administrator
   fusion_ui_edit_logical_interconnects    @{TestData.removeuls}
   ${status}=  run keyword and expect error   *   fusion_ui_edit_logical_interconnects   @{TestData.editli_18}
   log to console   ${status}
   should contain      ${status}   ${ui18_msg}
   should contain      ${status}   ${ui18_resol}



F1682_TC_UI_20_c7K: verify In LI page ULS, Uplinks, Ports,Operational Speed,Requested Speed & AutoNeg is displayed correctly.
   Log into Fusion appliance as Administrator
   ${status}=  fusion_ui_edit_logical_interconnects   @{TestData.removeuls}
   ${status}=  fusion_ui_edit_logical_interconnects   @{TestData.editli_20}
   ${uplinkdata}=  fusion_ui_get_li_uplink_port_data    @{TestData.li_intents_20}
   
   
   :for  ${ports}  IN  ${uplinkdata}  
   \   ${port}=  get matches      ${ports[0]}  ${li_intents_20_val[0][0]}  
   \   run keyword if   ${port} == ${null}   continue for loop
   \   log to console    contians:${port}
   \   ${speed}=  get matches      ${ports[0]}  ${li_intents_20_val[0][1]}*
   \   should match   ${speed[0]}    ${li_intents_20_val[0][1]}
   \   ${oprspeed}=  get matches      ${ports[0]}  ${li_intents_20_val[0][2]}*
   \   should match   ${oprspeed[0]}    ${li_intents_20_val[0][2]}
   \   ${autoneg}=  get matches      ${ports[0]}  ${li_intents_20_val[0][3]}*
   \   run keyword if   ${autoneg} != ${null}   should match   ${autoneg[0]}   ${li_intents_20_val[0][3]}
   \   ${linkstate}=  get matches      ${ports[0]}  ${li_intents_20_val[0][4]}*
   \   run keyword if   ${linkstate} != ${null}   should contain   ${linkstate[0]}   ${li_intents_20_val[0][4]}
   

F1682_TC_UI_21:c7K Multi LI, LI page ULS section = Uplinks, Ports, Operational Speed, Requested Speed & AutoNeg is displayed correctly
   Log into Fusion appliance as Administrator
   ${status}=  fusion_ui_edit_logical_interconnects   @{TestData.removeuls}
   ${status}=  fusion_ui_edit_logical_interconnects   @{TestData.editli_21b}
   ${uplinkdata}=  fusion_ui_get_li_uplink_port_data    @{TestData.li_intents_21}
   :for  ${ports}  IN  ${uplinkdata}  
   \   ${port}=  get matches      ${ports[0]}  ${li_intents_21_val[0][0]}  
   \   run keyword if   ${port} == ${null}   continue for loop
   \   log to console    contians:${port}
   \   ${speed}=  get matches      ${ports[0]}  ${li_intents_21_val[0][1]}*
   \   should match   ${speed[0]}    ${li_intents_21_val[0][1]}
   \   ${oprspeed}=  get matches      ${ports[0]}  ${li_intents_21_val[0][2]}*
   \   should match   ${oprspeed[0]}    ${li_intents_21_val[0][2]}
   \   ${autoneg}=  get matches      ${ports[0]}  ${li_intents_21_val[0][3]}*
   \   run keyword if   ${autoneg} != ${null}   should match   ${autoneg[0]}   ${li_intents_21_val[0][3]}
   \   ${linkstate}=  get matches      ${ports[0]}  ${li_intents_21_val[0][4]}*
   \   run keyword if   ${linkstate} != ${null}   should contain   ${linkstate[0]}   ${li_intents_21_val[0][4]}
   

F1682_TC_UI_22:c7K- compliance
   Log into Fusion appliance as Administrator
   fusion_ui_update_logical_interconnect_from_group    @{TestData.editli_22a}
   ${li_list}=   create list   SGH439WJKT-LIG_UI_f1682
   ${status}=  fusion_ui_edit_logical_interconnects   @{TestData.remove_21a}
   ${status}=  fusion_ui_edit_logical_interconnects   @{TestData.editli_22a}
   ${msgs}=  Fusion Ui Get Li Active Message List   SGH439WJKT-LIG_UI_f1682
   ${compliancce}=   Get Matches    ${msgs}    The logical interconnect is inconsistent with the logical interconnect group LIG_UI_f1682*
   should contain    ${compliancce[0]}   ${inconmsg}   
   

#*** Test Cases ***

F1682_TC_UI_23:c7K- compliance
   Log into Fusion appliance as Administrator
   #fusion_ui_update_logical_interconnect_from_group    @{TestData.editli_22a}
   fusion_ui_edit_logical_interconnect_group     @{Testdata.editlig_23}
   ${msgs}=  Fusion Ui Get Li Active Message List   SGH439WJKT-LIG_UI_f1682
   ${compliancce}=   Get Matches    ${msgs}    The logical interconnect is inconsistent with the logical interconnect group LIG_UI_f1682*  
   should contain   ${compliancce[0]}  The logical interconnect is inconsistent with the logical interconnect group LIG_UI_f1682
  