*** Settings ***
Documentation      Continuous  Integration Tests for RoboGalaxy dev Branch for F1212
Resource           lig-config.txt
Force Tags         Buildup
Suite Setup         Load Test Data and Open Browser
Suite Teardown      Logout And Close All Browsers
Library             Dialogs
Library             Collections

*** Variables ***
${expected_build_version}    2.00.00-0210744
${li_list} =    SGH420HHYA-LIG_B1
${Encname} =        SGH420HHYA

*** Keywords ***


*** Test Cases ***

Login to appliance
        Set Log Level    TRACE
        Log Variables

        ${user}=    Get Data By Property    ${TestData.users}   name    Administrator
        Fusion UI Login to Appliance   ${user[0].name}
        ${li_list} =   Create list     ${li_list}
###############  FIRMWARE UPDATE DURING LE CREATION without flag ############
TC01 firmware update during LE creation without flag
    Log To Console   "###############  Verify the FW Update operation (Stage + Activate) of hill module during LE creation using parallel mode without force flag ############"
    [Documentation]       "1.3.1.2 LE FW Update : FW update of Hill During LE creation"
    Log to Console     "Testcase_ID: TP section 1.3.1.2_F1212_TC_UI_51: Verify the FW Update operation (Stage + Activate) of hill module during LE creation using parallel mode without force flag"

    ####### CREATIG LIG, EG and Add enclosure  ################
    Log to Console  "Create Logical Interconnect Group"
    Fusion UI Create Logical Interconnect Group         @{TestData.ligs}

    Log to Console  Create Enclosure Group
    Fusion UI Create Enclosure Group    @{TestData.encgroups}

    Log to Console  "Add Enclosure"
    Fusion UI Add Enclosure    @{TestData.FWenclosures}

    Log to Console  Create Server Profile
    Fusion UI create Server Profile    @{TestData.profiles}

    Sleep   35 minutes 1 seconds
    Log To Console    Validation of ENC activities
    #${Status}=    fusion_ui_validate_enc_messages    ${Encname}
    ${Status}=    fusion_ui_validate_enc_messages    @{TestData.LE_Testupdate_le_firmware}[1]
    Log to Console    ${Status}
    Run Keyword and Continue on Failure    Should Contain       '${Status}'     ${Enc_same_version_error_messageenc}    Expected Error Message Not seen


    #################VERIFY THE UI IC FIRMWARE VERSION and COMPARE with actual  IC version #####################
    ${Status}=  fusion_ui_verify_interconnect_firmware_from_li      ${li_list}      ${TestData.firmware1}
    ${Status1}=    Get From List    ${Status}   0
    run keyword if    '${status1}'=='False'    Fail      " Validation of  interconnects firmware versions are failed "

    #################VERIFY IC STATE OF LI AFTER UPGRADE #####################
    ${Status}=  fusion_ui_verify_ic_state_of_li      ${li_list}    ${Permissible_IC_STATES_AfterUpdate}
    run keyword if    '${status}'=='False'    Fail      " IC states are not as Desired state "Configured" "

    ############ VERIFY THE ALERT MESSAGES on ACTIVITY PAGE ########################################
    ${Status}=   fusion_ui_verify_c7k_updatefirmwarealerts_inLI  @{TestData.logicalconnect}[0]
    run keyword if    '${status}'=='False'    Fail      " Validation of alert messages are failed "



###############  FIRMWARE UPDATE DURING LE CREATION with flag ############
TC02 firmware update during LE creation with flag
    Log To Console   "###############Verify the FW Update operation (Stage + Activate) of hill module during LE creation using parallel mode with force flag ############"
    [Documentation]       "1.3.1.2 LE FW Update : FW update of Hill During LE creation"
    Log to Console     "Testcase_ID: TP section 1.3.1.2_F1212_TC_UI_23 and F1212_TC_UI_50: Verify the FW Update operation (Stage + Activate) of hill module during LE creation using parallel mode with force flag"

    ###### Delete LIG and EG #####

    ${status}=    Fusion UI delete Server Profile  @{TestData.profiles}
    Should be True    ${status}    msg=Failed to delete Server profile

    ${status}=  Fusion UI Delete Enclosure    @{TestData.enclosures}
    Should Be True  ${status}   Failed to delete enclosures

    Log to Console  Delete Enclosure Group
    Fusion UI Delete Enclosure Group    @{TestData.encgroups}

    Log to Console  Delete  LIG if it exists
    Fusion UI Delete Logical Interconnect Group         @{TestData.ligs}

    ####### CREATIG LIG, EG and Add enclosure  ################
    Log to Console  "Create Logical Interconnect Group"
    Fusion UI Create Logical Interconnect Group         @{TestData.ligs}

    Log to Console  Create Enclosure Group
    Fusion UI Create Enclosure Group    @{TestData.encgroups}

    Log to Console  "Add Enclosure"
    Fusion UI Add Enclosure    @{TestData.FWenclosures}

    Log to Console  Create Server Profile
    Fusion UI create Server Profile    @{TestData.profiles}

    Sleep   35 minutes 1 seconds
    Log To Console    Validation of ENC activities
    #${Status}=    fusion_ui_validate_enc_messages    ${Encname}
    ${Status}=    fusion_ui_validate_enc_messages    @{TestData.LE_Testupdate_le_firmware}[1]
    Log to Console    ${Status}
    Run Keyword and Continue on Failure    Should Contain       '${Status}'     ${Enc_same_version_error_messageenc}    Expected Error Message Not seen

    #################VERIFY THE UI IC FIRMWARE VERSION and COMPARE with actual  IC version #####################
    ${Status}=  fusion_ui_verify_interconnect_firmware_from_li      ${li_list}      ${TestData.firmware1}
    ${Status1}=    Get From List    ${Status}   0
    run keyword if    '${status1}'=='False'    Fail      " Validation of  interconnects firmware versions are failed "

    #################VERIFY IC STATE OF LI AFTER UPGRADE #####################
    ${Status}=  fusion_ui_verify_ic_state_of_li      ${li_list}    ${Permissible_IC_STATES_AfterUpdate}
    run keyword if    '${status}'=='False'    Fail      " IC states are not as Desired state "Configured" "

    ############ VERIFY THE ALERT MESSAGES on ACTIVITY PAGE ########################################
    ${Status}=   fusion_ui_verify_c7k_updatefirmwarealerts_inLI  @{TestData.logicalconnect}[0]
    run keyword if    '${status}'=='False'    Fail      " Validation of alert messages are failed "

    ############# VALIDATE FIRMWARE VERSION and compare to Actual IC version #############
    ${Status}=   fusion_ui_verify_li_and_ic_firmware_versions  ${TestData.Hfirmwarebb1}
    Run Keyword and Continue on Failure     Should Be Equal     '${Status}'     'True'      Error during Firmware Version and IC activity Messages Validation


###############  FIRMWARE UPDATE DURING LE CREATION with flag Downgrade ############
TC03 firmware update during LE creation with flag
    Log To Console   "###############Verify the FW Update operation (Stage + Activate) of hill module during LE creation using parallel mode with force flag ############"
    [Documentation]    "1.3.1.2 LE FW Update : FW update of Hill During LE creation"
    Log to Console     "Testcase_ID: TP section 1.3.1.2_F1212_TC_UI_23 and F1212_TC_UI_63: Verify the FW Update operation (Stage + Activate) of hill module during LE creation using parallel mode with force flag"

    ###### Delete LIG and EG #####

    ${status}=    Fusion UI delete Server Profile  @{TestData.profiles}
    Should be True    ${status}    msg=Failed to delete Server profile

    ${status}=  Fusion UI Delete Enclosure    @{TestData.enclosures}
    Should Be True  ${status}   Failed to delete enclosures

    Log to Console  Delete Enclosure Group
    Fusion UI Delete Enclosure Group    @{TestData.encgroups}

    Log to Console  Delete  LIG if it exists
    Fusion UI Delete Logical Interconnect Group         @{TestData.ligs}

    ####### CREATIG LIG, EG and Add enclosure  ################
    Log to Console  "Create Logical Interconnect Group"
    Fusion UI Create Logical Interconnect Group         @{TestData.ligs}

    Log to Console  Create Enclosure Group
    Fusion UI Create Enclosure Group    @{TestData.encgroups}

    Log to Console  "Add Enclosure"
    Fusion UI Add Enclosure    @{TestData.FWenclosuresNoflag}

    Log to Console  Create Server Profile
    Fusion UI create Server Profile    @{TestData.profiles}


    Sleep   35 minutes 1 seconds
    Log To Console    Validation of ENC activities
    #${Status}=    fusion_ui_validate_enc_messages    ${Encname}
    ${Status}=    fusion_ui_validate_enc_messages    @{TestData.LE_Testupdate_le_firmware}[1]
    Log to Console    ${Status}
    Run Keyword and Continue on Failure    Should Contain       '${Status}'     ${Enc_same_version_error_messageenc}    Expected Error Message Not seen

    #################VERIFY THE UI IC FIRMWARE VERSION and COMPARE with actual  IC version #####################
    ${Status}=  fusion_ui_verify_interconnect_firmware_from_li      ${li_list}      ${TestData.firmware1}
    ${Status1}=    Get From List    ${Status}   0
    run keyword if    '${status1}'=='False'    Fail      " Validation of  interconnects firmware versions are failed "

    #################VERIFY IC STATE OF LI AFTER UPGRADE #####################
    ${Status}=  fusion_ui_verify_ic_state_of_li      ${li_list}    ${Permissible_IC_STATES_AfterUpdate}
    run keyword if    '${status}'=='False'    Fail      " IC states are not as Desired state "Configured" "

    ############ VERIFY THE ALERT MESSAGES on ACTIVITY PAGE ########################################
    ${Status}=   fusion_ui_verify_c7k_updatefirmwarealerts_inLI  @{TestData.logicalconnect}[0]
    run keyword if    '${status}'=='False'    Fail      " Validation of alert messages are failed "

    ############# VALIDATE FIRMWARE VERSION and compare to Actual IC version #############
    ${Status}=   fusion_ui_verify_li_and_ic_firmware_versions  ${TestData.Hfirmwarebb1}
    Run Keyword and Continue on Failure     Should Be Equal     '${Status}'     'True'      Error during Firmware Version and IC activity Messages Validation

#######Try to installing same version of the firmware without force flag -- F1212_TC_UI_67  ########
TC04 Verify the alert message appears when try to set firmware baseline which is same as currently installed version and dont check the force installation option in firmware update operation while adding enclosure
    Log to Console     "Testcase_ID: TP section 1.3.1.1 F1212_TC_UI_67 --> Verify the alert message appears when try to setfirmware baseline which is same as currently installed version and dont check the force installation option in  firmware update operation while adding enclosure"

    ###### Delete LIG and EG #####

    ${status}=    Fusion UI delete Server Profile  @{TestData.profiles}
    Should be True    ${status}    msg=Failed to delete Server profile

    ${status}=  Fusion UI Delete Enclosure    @{TestData.enclosures}
    Should Be True  ${status}   Failed to delete enclosures

    Log to Console  Delete Enclosure Group
    Fusion UI Delete Enclosure Group    @{TestData.encgroups}

    Log to Console  Delete  LIG if it exists
    Fusion UI Delete Logical Interconnect Group         @{TestData.ligs}

    ####### CREATIG LIG, EG and Add enclosure  ################
    Log to Console  "Create Logical Interconnect Group"
    Fusion UI Create Logical Interconnect Group         @{TestData.ligs}

    Log to Console  Create Enclosure Group
    Fusion UI Create Enclosure Group    @{TestData.encgroups}

    Log to Console  "Add Enclosure"
    Fusion UI Add Enclosure    @{TestData.FWenclosuresNoflag}
    #Fusion UI Add Enclosure    @{TestData.FWenclosures}   # with force flag
    Sleep   35 minutes 1 seconds
    Log To Console    Validation of ENC activities
    #${Status}=    fusion_ui_validate_enc_messages    ${Encname}
    ${Status}=    fusion_ui_validate_enc_messages    @{TestData.LE_Testupdate_le_firmware}[1]
    Log to Console    ${Status}
    Run Keyword and Continue on Failure    Should Contain       '${Status}'     ${Enc_same_version_error_messageenc}    Expected Error Message Not seen
