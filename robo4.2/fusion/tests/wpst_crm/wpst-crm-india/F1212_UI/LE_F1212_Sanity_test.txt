*** Settings ***

Resource            firmware_config.txt
Force Tags          Buildup
Suite Setup         Load Test Data and Open Browser
Suite Teardown      Logout And Close All Browsers
Library             Collections


*** Variables ***

${Permissible_IC_STATES_BeforeUpdate}=    ['configured','unmanaged']
${Permissible_IC_STATES_AfterUpdate}=    ['configured']
${expected_build_version}    2.00.00-0210744

*** Test Cases ***

FW Update operation (Stage + Activate) Oneview Login
        Set Log Level    TRACE
        Log Variables

        ${user}=    Get Data By Property    ${TestData.users}   name    Administrator
        Fusion UI Login to Appliance   ${user[0].name}

###########################   21 tests in this test suite Verify the FW Update operation (Stage + Activate) of hill module from LE level using shared infrastructure  mode with force flag(downgrade for G3 enclosure)  #####################################################

TC01 Verify the FW Update operation (Stage + Activate) of hill module from LE level using shared infrastructure mode with force flag(downgrade for G3 enclosure)
        [Documentation]    "1.3.1.1 Verify the FW Update operation (Stage + Activate) of hill module from LE level using shared infrastructure  mode with force flag(downgrade for G3 enclosure) "
        Log to Console    "Testcase_ID: TP section 1.3.1.1 UI Test Cases F1212_TC_UI_64  --> Verify the FW Update operation (Stage + Activate) of hill module from LE level using shared infrastructure  mode with force flag(downgrade for G3 enclosure)"

        ${Response}=       Fusion Ui Power Off All Servers
        
        Log to Console  ****** VERIFY IC STATE OF LE BEFORE FW UPDATE ********
        ${Status}=   fusion_ui_verify_ic_state_of_le   ${Permissible_IC_STATES_BeforeUpdate}    ${TestData.firmwarebb1}
        Run Keyword If    '${Status}'=='True'   Log To Console  IC Sates as desired   ELSE     Fail

        #################### LE FIRMWARE UPDATE with shared infrastructure ######################################
        ${blnupdatefirmware} =     Fusion UI Update Logical Enclosure Firmware     @{TestData.downgrade_le_firmware_shared_infra}[1]
        run keyword if    '${blnupdatefirmware}'=='False'    Fail      " Update firmware on LE failed"

        ###################### VERIFY THE LE ACTIVITIES #############################
        Log To Console    *****Validation of LE activities******
        ${Status}=     fusion_ui_validate_le_firmware_upgrade_activity_details    ${TestData.firmwarebb1}
        Run Keyword and Continue on Failure   Should Contain    ${Status}    TEST PASSED    LE FW Update Test FAILED


        Log to Console  ****** VERIFY IC STATE OF LE AFTER FW UPDATE ********
        ${Status}=     fusion_ui_verify_ic_state_of_le    ${Permissible_IC_STATES_AfterUpdate}    ${TestData.firmwarebb1}
        Run Keyword If    '${Status}'=='True'   Log To Console  IC Sates as desired   ELSE     Fail

        ############# VALIDATE FIRMWARE VERSION and compare to Actual IC version #############
        ${Status}=     fusion_ui_verify_li_and_ic_firmware_versions    ${TestData.firmwarebb1}
        Run Keyword and Continue on Failure     Should Be Equal     '${Status}'     'True'      Error during Firmware Version and IC activity Messages Validation

TC02 Verify the FW Update operation (Stage + Activate) of hill module from LE level for shared infrastructure without Force flag(Upgrade)
        [Documentation]    "1.3.1.1 Verify the FW Update operation (Stage + Activate) of hill module from LE level for shared infrastructure without Force flag(Upgrade)"
        Log to Console    "Testcase_ID: TP section 1.3.1.1_UI Test Cases_F1212_TC_UI_40 and F1212_TC_UI_46(G1) F1212_TC_UI_47(G2)--> Verify the FW Update operation (Stage + Activate) of hill module from LE level for shared infrastructure without Force flag(Upgrade)"

        ${Response}=       Fusion Ui Power Off All Servers
        
        Log to Console  ****** VERIFY IC STATE OF LE BEFORE FW UPDATE ********
        ${Status}=    fusion_ui_verify_ic_state_of_le   ${Permissible_IC_STATES_BeforeUpdate}    ${TestData.firmwarebb1}
        Run Keyword If    '${Status}'=='True'   Log To Console  IC Sates as desired   ELSE     Fail

        #################### LE FIRMWARE UPDATE with shared infrastructure ######################################
        ${blnupdatefirmware} =    Fusion UI Update Logical Enclosure Firmware     @{TestData.update_le_firmware_shared_infra_no_flag}[1]
        run keyword if    '${blnupdatefirmware}'=='False'    Fail      " Update firmware on LE failed"

        ###################### VERIFY THE LE ACTIVITIES #############################
        Log To Console    *****Validation of LE activities******
        ${Status}=     fusion_ui_validate_le_firmware_upgrade_activity_details    ${TestData.Hfirmwarebb1}
        Run Keyword and Continue on Failure   Should Contain    ${Status}    TEST PASSED    LE FW Update Test FAILED


        Log to Console  ****** VERIFY IC STATE OF LE AFTER FW UPDATE ********
        ${Status}=     fusion_ui_verify_ic_state_of_le    ${Permissible_IC_STATES_AfterUpdate}    ${TestData.Hfirmwarebb1}
        Run Keyword If    '${Status}'=='True'   Log To Console  IC Sates as desired   ELSE     Fail

        ############# VALIDATE FIRMWARE VERSION and compare to Actual IC version #############
        ${Status}=     fusion_ui_verify_li_and_ic_firmware_versions     ${TestData.Hfirmwarebb1}
        Run Keyword and Continue on Failure     Should Be Equal     '${Status}'     'True'      Error during Firmware Version and IC activity Messages Validation
TC03 Verify the FW Update operation (Stage + Activate) of hill module from LE level using Shared infrastructure and profiles mode with force flag(downgrade for G3 enclosure)
    [Documentation]    "1.3.1.1 Verify the FW Update operation (Stage + Activate) of hill module from LE level using Shared infrastructure and profiles  mode with force flag(downgrade for G3 enclosure)"
    Log to Console    "Testcase_ID: TP section 1.3.1.1_UI Test Cases F1212_TC_UI_38 and F1212_TC_UI_48(G2)--> Verify the FW Update operation (Stage + Activate) of hill module from LE level using Shared infrastructure and profiles  mode with force flag(downgrade for G3 enclosure)"

    ${Response}=       Fusion Ui Power Off All Servers
        
    Log to Console  ****** VERIFY IC STATE OF LE BEFORE FW UPDATE ********
    ${Status}=     fusion_ui_verify_ic_state_of_le   ${Permissible_IC_STATES_BeforeUpdate}    ${TestData.firmwarebb1}
    Run Keyword If    '${Status}'=='True'   Log To Console  IC Sates as desired   ELSE     Fail

    #################### LE FIRMWARE UPDATE with shared infrastructure ######################################
    ${blnupdatefirmware} =    Fusion UI Update Logical Enclosure Firmware     @{TestData.downgrade_le_firmware_shared_infra_profile}[2]
    run keyword if    '${blnupdatefirmware}'=='False'    Fail      " Update firmware on LE failed"

    ###################### VERIFY THE LE ACTIVITIES #############################
    Log To Console    *****Validation of LE activities******
    ${Status}=     fusion_ui_validate_le_firmware_upgrade_activity_details    ${TestData.firmwarebb1}
    Log To Console     Status value:${Status}
    Run Keyword and Continue on Failure   Should Contain    ${Status}    TEST PASSED    LE FW Update Test FAILED


    Log to Console  ****** VERIFY IC STATE OF LE AFTER FW UPDATE ********
    ${Status}=     fusion_ui_verify_ic_state_of_le    ${Permissible_IC_STATES_AfterUpdate}    ${TestData.firmwarebb1}
    Run Keyword If    '${Status}'=='True'   Log To Console  IC Sates as desired   ELSE     Fail

    ############# VALIDATE FIRMWARE VERSION and compare to Actual IC version #############
    ${Status}=     fusion_ui_verify_li_and_ic_firmware_versions    ${TestData.firmwarebb1}
    Run Keyword and Continue on Failure     Should Be Equal     '${Status}'     'True'      Error during Firmware Version and IC activity Messages Validation

***Comment***

########################### Verify the FW Update operation (Stage + Activate) of hill module from LE level for shared infrastructure and profiles without Force flag(upgrade)  #####################################################
TC04 Verify the FW Update operation (Stage + Activate) of hill module from LE level for shared infrastructure and profiles without Force flag(upgrade)
    [Documentation]    "1.3.1.1 Verify the FW Update operation (Stage + Activate) of hill module from LE level for shared infrastructure and profiles without Force flag(upgrade)"
    Log to Console    "Testcase_ID: TP section 1.3.1.1_UI Test Cases_F1212_TC_UI_41 and F1212_TC_UI_45(G1) F1212_TC_UI_48(G2)--> Verify the FW Update operation (Stage + Activate) of hill module from LE level for shared infrastructure and profiles without Force flag(upgrade)"

    ${Response}=       Fusion Ui Power Off All Servers
    
    Log to Console  ****** VERIFY IC STATE OF LE BEFORE FW UPDATE ********
    ${Status}=     fusion_ui_verify_ic_state_of_le   ${Permissible_IC_STATES_BeforeUpdate}    ${TestData.firmwarebb1}
    Run Keyword If    '${Status}'=='True'   Log To Console  IC Sates as desired   ELSE     Fail

    #################### LE FIRMWARE UPDATE with shared infrastructure ######################################
    ${blnupdatefirmware} =     Fusion UI Update Logical Enclosure Firmware     @{TestData.update_le_firmware_shared_infra_profile_no_flag}[2]
    run keyword if    '${blnupdatefirmware}'=='False'    Fail      " Update firmware on LE failed"

    ###################### VERIFY THE LE ACTIVITIES #############################
    Log To Console    *****Validation of LE activities******
    ${Status}=     fusion_ui_validate_le_firmware_upgrade_activity_details     ${TestData.firmwarebb1}
    Log To Console     Status value:${Status}
    Run Keyword and Continue on Failure   Should Contain    ${Status}    TEST PASSED    LE FW Update Test FAILED


    Log to Console  ****** VERIFY IC STATE OF LE AFTER FW UPDATE ********
    ${Status}=     fusion_ui_verify_ic_state_of_le    ${Permissible_IC_STATES_AfterUpdate}    ${TestData.firmwarebb1}
    Run Keyword If    '${Status}'=='True'   Log To Console  IC Sates as desired   ELSE     Fail

    ############# VALIDATE FIRMWARE VERSION and compare to Actual IC version #############
    ${Status}=     fusion_ui_verify_li_and_ic_firmware_versions      ${TestData.Hfirmwarebb1}
    Run Keyword and Continue on Failure     Should Be Equal     '${Status}'     'True'      Error during Firmware Version and IC activity Messages Validation
        