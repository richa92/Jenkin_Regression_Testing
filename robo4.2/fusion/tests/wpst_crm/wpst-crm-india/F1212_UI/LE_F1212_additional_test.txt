** Settings ***

Resource            firmware_config.txt
Force Tags          Buildup
Suite Setup         Load Test Data and Open Browser
Suite Teardown      Logout And Close All Browsers
Library             Collections


*** Variables ***

${Permissible_IC_STATES_BeforeUpdate}=    ['configured','unmanaged']
${Permissible_IC_STATES_AfterUpdate}=    ['configured']
${expected_build_version}    2.00.00-0210744

${ExpectedErrorMsgLE4}=    no update required
${ExpectedErrorMsgLE5}=    selected enclosure firmware is older than the firmware that is already installed.
#${ExpectedErrorMsgLE5.1}=    no update required. selected enclosure firmware is older than the firmware that is already installed.
${ExpectedErrorMsgLEb1}=    No update required
${ExpectedErrorMsgLEb2}=    no update required. selected firmware is already installed for the onboard administrator.

#${ExpectedErrorMsgLE4}=    no update required
#${ExpectedErrorMsgLE5}=    selected enclosure firmware is older than the firmware that is already installed.

*** Test Cases ***

FW Update operation (Stage + Activate) Oneview Login
        Set Log Level    TRACE
        Log Variables

        ${user}=    Get Data By Property    ${TestData.users}   name    Administrator
        Fusion UI Login to Appliance   ${user[0].name}

###########################   Verify that Create LE support dump should be success while LE FW update is in progress  F1212_TC_UI_82 #####################################################
TC01Verify that Create LE support dump should be success while LE FW update is in progress.
    [Documentation]       "1.3.1.1 Verify that Create LE support dump should be success while LE FW update is in progress. "
    Log to Console     "Testcase_ID: TP section 1.3.1.1_UI Test Cases F1212_TC_UI_82 --> Verify that Create LE support dump should be success while LE FW update is in progress."



    #################### LE FIRMWARE UPDATE with shared infrastructure ######################################
    ${blnupdatefirmware} =  Fusion UI Update Logical Enclosure Firmware     @{TestData.trigger_le_FWonly_in_le}[0]
    run keyword if    '${blnupdatefirmware}'=='False'    Fail      " Triggering Update firmware on LE failed"



    # create LE support dump on LE page

    ${support_dump_status}=    fusion_ui_create_logical_enclosure_support_dump     @{TestData.Supportdump_creation_in_le}[0]
    run keyword if    '${support_dump_status}'=='False'    Fail      " Creating LE support dump failed"

###########################Verify the error message when trigger a firmware update on LE when a firmware update operation is already in progress on the LE level.  #####################################################
TC02Verify the error message when trigger a firmware update on LE when a firmware update operation is already in progress on the LE level.
    [Documentation]       "1.3.1.1 : Verify the error message when trigger a firmware update on LE when a firmware update operation is already in progress on the LE level."
    Log to Console     "Testcase_ID: TP section 1.3.1.1_UI Test F1212_TC_UI_73 and F1212_TC_UI_79 and F1212_TC_UI_80 and F1212_TC_UI_54--> Verify the error message when trigger a firmware update on LE when a firmware update operation is already in progress on the LE level.



    #################### LE FIRMWARE UPDATE with shared infrastructure ######################################
    ${blnupdatefirmware} =    fusion_ui_update_le_firmware_error_message_validation    @{TestData.update_le_firmware}[14]
    Log to Console     message is ${blnupdatefirmware}
    run keyword if    '${blnupdatefirmware}'=='False'    Fail      " Error message validation for edit,reapply and re-firmware update Failed on LE "

#######Downgrade FW of LE--without force option-Shared Infrastructure F1212_TC_UI_59 ########
TC03 Verify the alert message appears when try to set firmware baseline to the lower version and dont check the force installation flag(option) in downgrade firmware update operation In LE page
    [Documentation]       "1.3.1.1 Hill FW update LI: Verify the  alert message appears when try to set firmware baseline to the lower version and dont check the force installation flag(option) in downgrade firmware update operation In LE page"
    Log to Console     "Testcase_ID: TP section 1.3.1.1 F1212_TC_UI_59 and F1212_TC_UI_74--> Verify the  alert message appears when try to set firmware baseline to the lower version and dont check the force installation flag(option) in downgrade firmware update operation In LE page"


    #${Status}=  Fusion UI Update Logical Enclosure Firmware      @{TestData.update_le_firmware}[3]
    #run keyword if    '${status}'=='False'    Fail      " Update Firmware of Hill via LE Failed "
    ${Status}=  Fusion UI Update Logical Enclosure Firmware      @{TestData.update_le_firmware}[5]   # Lower version
    #${Status}=  Fusion UI Update Logical Enclosure Firmware      @{TestData.update_le_firmware}[12]  # Equal version

    ${Status}=  fusion_ui_validate_error_message_b  ${TestData.DWfirmwareb14}
    Log to Console    ${Status}
    ${Status}=              Convert To Lowercase    ${Status}
    Log to Console     Found the Alert messages
    Log to Console    ${Status}
    ${ExpectedErrorMsgLE4}=   Convert To Lowercase    ${ExpectedErrorMsgLE4}
    ${ExpectedErrorMsgLE5}=   Convert To Lowercase    ${ExpectedErrorMsgLE5}
#   ${ExpectedErrorMsgLE5.1}=   Convert To Lowercase    ${ExpectedErrorMsgLE5.1}

    Run Keyword and Continue on Failure    Should Contain       '${Status}'     ${ExpectedErrorMsgLE4}      Expected Error Message Not seen
    Run Keyword and Continue on Failure    Should Contain       '${Status}'     ${ExpectedErrorMsgLE5}      Expected Error Message Not seen
#   Run Keyword and Continue on Failure    Should Contain       '${Status}'     ${ExpectedErrorMsgLE5.1}    Expected Error Message Not seen

#######Try to installing same version of the firmware without force flag -- F1212_TC_UI_66 ########
TC04 Verify the alert message appears when try to set firmware baseline which is same as currently installed version and dont check the force installation option in firmware update operation on LE page
    [Documentation]    "1.3.1.2 LE FW Update : Verify the alert message appears when try to set firmware baseline which is same as currently installed version and dont check the force installation option in  firmware update operation on LE page"
    Log to Console     "Testcase_ID: TP section 1.3.1.1 F1212_TC_UI_66 --> Verify the alert message appears when try to set firmware baseline which is same as currently installed version and dont check the force installation option in firmware update operation on LE page"

    #${Status}=  Fusion UI Update Logical Enclosure Firmware      @{TestData.update_le_firmware}[3]
    #run keyword if    '${status}'=='False'    Fail      " Update Firmware of Hill via LE Failed "
    ${Status}=  Fusion UI Update Logical Enclosure Firmware      @{TestData.update_le_firmware}[16] # higher version
#   ${Status}=  Fusion UI Update Logical Enclosure Firmware      @{TestData.update_le_firmware}[15]  # Lower version
#   ${Status}=  Fusion UI Update Logical Enclosure Firmware      @{TestData.update_le_firmware}[13]   # Lower version
    #${Status}=  Fusion UI Update Logical Enclosure Firmware      @{TestData.update_le_firmware}[12]  # Equal version

    ${Status}=  fusion_ui_validate_error_message_b  ${TestData.firmwareb14}
    Log to Console    ${Status}
    ${Status}=              Convert To Lowercase    ${Status}
    ${ExpectedErrorMsgLEb1}=   Convert To Lowercase    ${ExpectedErrorMsgLEb1}
    ${ExpectedErrorMsgLEb2}=   Convert To Lowercase    ${ExpectedErrorMsgLEb2}

    Log to Console     Found the Alert messages
    Log to Console    ${Status}
    Run Keyword and Continue on Failure    Should Contain       '${Status}'     ${ExpectedErrorMsgLEb1}     Expected Error Message Not seen
    Run Keyword and Continue on Failure    Should Contain       '${Status}'     ${ExpectedErrorMsgLEb2}     Expected Error Message Not seen

TC06 Downgrade FW of LE--without force option using Shared Infrastructure and Profile

    Log to Console     "Testcase_ID: TP section 1.3.1.1 F1212_TC_UI_74 --> Verify proper error message and resolution is appeared when try to downgrading firmware with lesser versionsame version) without selecting force option (shared infra/shared infra and profiles OA only).on LE page"

    #${Status}=  Fusion UI Update Logical Enclosure Firmware      @{TestData.update_le_firmware}[3]
    #run keyword if    '${status}'=='False'    Fail      " Update Firmware of Hill via LE Failed "
    ${Status}=  Fusion UI Update Logical Enclosure Firmware      @{TestData.update_le_firmware}[5]   # Lower version
    #${Status}=  Fusion UI Update Logical Enclosure Firmware      @{TestData.update_le_firmware}[12]  # Equal version

    ${Status}=  fusion_ui_validate_error_message_b  ${TestData.DWSPfirmwareb14}
    Log to Console    ${Status}
    ${Status}=              Convert To Lowercase    ${Status}
    Log to Console     Found the Alert messages
    Log to Console    ${Status}

    ${ExpectedErrorMsgLE4}=   Convert To Lowercase    ${ExpectedErrorMsgLE4}
    ${ExpectedErrorMsgLE5}=   Convert To Lowercase    ${ExpectedErrorMsgLE5}

    Run Keyword and Continue on Failure    Should Contain       '${Status}'     ${ExpectedErrorMsgLE4}      Expected Error Message Not seen
    Run Keyword and Continue on Failure    Should Contain       '${Status}'     ${ExpectedErrorMsgLE5}      Expected Error Message Not seen



TC05Verify that Create LE support dump should be success while LE FW update is in progress.
    [Documentation]    "1.3.1.1 Verify that Create LE support dump should be success while LE FW update is in progress. "
    Log to Console     "Testcase_ID: TP section 1.3.1.1_UI Test Cases F1212_TC_UI_82 --> Verify that Create LE support dump should be success while LE FW update is in progress."



    #################### LE FIRMWARE UPDATE with shared infrastructure ######################################
    ${blnupdatefirmware} =  Fusion UI Update Logical Enclosure Firmware     @{TestData.trigger_le_FWonly_in_le}[0]
    run keyword if    '${blnupdatefirmware}'=='False'    Fail      " Triggering Update firmware on LE failed"

    # create LE support dump on LE page
    sleep   60
    ${support_dump_status}=      fusion_ui_create_logical_enclosure_support_dump     @{TestData.Supportdump_creation_in_le}[0]
    run keyword if    '${support_dump_status}'=='False'    Fail      " Creating LE support dump failed"
    sleep   1900

