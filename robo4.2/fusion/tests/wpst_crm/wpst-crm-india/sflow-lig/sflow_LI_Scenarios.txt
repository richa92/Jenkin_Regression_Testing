*** Settings ** *
Documentation        Feature Test:  OVF292
...                  This set of test cases is to verify the feature SNMPV3 IN Syneregy Module
...
Variables           ./prasanthi_data_variables_li.py
#Variables           ./data_variables.py
Resource            ../../../../Resources/api/fusion_api_resource.txt
Resource            ./sflow_resources.txt
Library                Collections
Library                json
Library                OperatingSystem
Library                Selenium2Library
Library             BuiltIn
Library             RoboGalaxyLibrary
Library             FusionLibrary


*** Variables ** *
#${SSH_PASS}                     hpvse1
${APPLIANCE_IP}                  192.168.145.50
${li}                           LE-LIG
${LIG}                          LIG
${Inconsistent_State}           NOT_CONSISTENT
${consistent_State}             CONSISTENT
${State_Configured}             Configured
${ICM_1}                     RAVIENCL10, interconnect 3
${TRAP}                      True
${Def_Port}                  163

${SLEEP_TIME}                       30
${LI_NAME}                          LE-LIG
${SLEEP_TIME}                       30
${SNMP_HOST}                        15.212.136.80
${SSH_USER}                         root
${SSH_PASS}                         12iso*help
${icmSnmpUser}                      netop
${icmSnmpPassword}                  netoppwd



*** Test Cases ***

00 Appliance LogIn
    [Tags]    AutoSplitBeforeLE
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${login_details}
    ${icmipv6}=    Get ICM ipv6 address    ${icm_name}
    Log to console and logfile     ${icmipv6}
    Set Global Variable    ${icmipv6}    ${icmipv6}
    Run Keyword and Ignore Error    Install and start filebeat on target machine    ${FileBeatLocation}

Do cleaning of the appliance
    Log to console and logfile     Cleaning Appliance
    Run Keyword and Ignore Error    Remove All Server Profiles
    Run Keyword and Ignore Error    Remove All Server Profile Templates
    Run Keyword and Ignore Error    Remove All LEs
    Run Keyword and Ignore Error    Remove All Enclosure Groups
    Run Keyword and Ignore Error    Delete sFlow Alert   ${sflowStaticIPMessage}

Create LIG EG before starting tests
    Log to console and log file     Create LIG EG before starting tests
    Add Ethernet Networks   ${eth_networks}
    Add Ethernet Networks  ${eth_networks_1}
    Create LIG    ${sflow_lig}
    Create EG    ${sflow_eg}
    Create LE     ${sflow_le}
    #Create netop account on Hafnium    ${HafniumModule1}
    #Create netop account on Hafnium    ${HafniumModule2}
    Verify sFlow alert   ${sflowStaticIPMessage}
    Create Server Profile    ${sflow_server}

*** Test Cases ***

OVF1734_API_TC_05_EDIT_LI_WITH_DIFFERENT_COLLECTOR_IP
    Log to console    Edit LI
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${admin_credentials}
    ${resp1}=    Edit LI        ${li}   ${edit_li_edit_collector_ip['sflowconfiguration']}
    ${task} =   Wait For Task   ${resp1}    300s    2s
    Run Keyword If  '${resp1['status_code']}' != '202'   Fail    ELSE    Log to Console  \n-LI  Edited successfully
    Validate sflow collector configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow agent configuration     ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow port configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}

OVF1734_API_TC_07_EDIT_LI_WITH_OPTION_3COLLECTORS
    Log to console    Edit LI
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${admin_credentials}
    ${resp1}=    Edit LI        ${li}   ${edit_li_add_3collector_ip['sflowconfiguration']}
    ${task} =   Wait For Task   ${resp1}    300s    2s
    Run Keyword If  '${resp1['status_code']}' != '202'   Fail    ELSE    Log to Console  \n-LI  Edited successfully
    Validate sflow collector configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow agent configuration     ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow port configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}

VF1734_API_TC_08_EDIT_LI_WITH_MORE_UPLINKPORTS
    Log to console    Edit LI
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${admin_credentials}
    ${resp1}=    Edit LI        ${li}   ${edit_li_add_more_uplinkports['sflowconfiguration']}
    ${task} =   Wait For Task   ${resp1}    300s    2s
    Run Keyword If  '${resp1['status_code']}' != '202'   Fail    ELSE    Log to Console  \n-LI  Edited successfully
    Validate sflow collector configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow agent configuration     ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    #Validate sflow port configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}

OVF1734_API_TC_09_EDIT_LI_WITH_CHANGING_COLLECTOR
    Log to console    Edit LI
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${admin_credentials}
    ${resp1}=    Edit LI        ${li}   ${edit_li_change_collectorid['sflowconfiguration']}
    ${task} =   Wait For Task   ${resp1}    300s    2s
    Run Keyword If  '${resp1['status_code']}' != '202'   Fail    ELSE    Log to Console  \n-LI  Edited successfully
    Validate sflow collector configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow agent configuration     ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow port configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}

OVF1734_API_TC_10_EDIT_LI_WITH_DISABLING_COLLECTOR
    Log to console    Edit LI
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${admin_credentials}
    ${resp1}=    Edit LI        ${li}   ${edit_li_disable_collector['sflowconfiguration']}
    ${task} =   Wait For Task   ${resp1}    300s    2s
    Run Keyword If  '${resp1['status_code']}' != '202'   Fail    ELSE    Log to Console  \n-LI  Edited successfully
    Validate sflow collector configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow agent configuration     ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}

OVF1734_API_TC_11_EDIT_LI_WITH_CHANGING_MAX_DATAGRAM_SIZE
    Log to console    Edit LI
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${admin_credentials}
    ${resp1}=    Edit LI        ${li}   ${edit_li_max_datagramsize['sflowconfiguration']}
    ${task} =   Wait For Task   ${resp1}    2400s    5s
    Run Keyword If  '${resp1['status_code']}' != '202'   Fail    ELSE    Log to Console  \n-LI  Edited successfully
    Validate sflow collector configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow agent configuration     ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow port configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}

OVF1734_API_TC_11_EDIT_LI_WITH_CHANGING_MAX_HEADER_SIZE
    Log to console    Edit LI
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${admin_credentials}
    ${resp1}=    Edit LI        ${li}   ${edit_li_max_headersize['sflowconfiguration']}
    ${task} =   Wait For Task   ${resp1}    2400s    5s
    Run Keyword If  '${resp1['status_code']}' != '202'   Fail    ELSE    Log to Console  \n-LI  Edited successfully
    Validate sflow collector configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow agent configuration     ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow port configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}

OVF1734_API_TC_13_EDIT_LI_WITH_CHANGINGDISABLE_ALL_COLLECTORS
    Log to console    Edit LI
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${admin_credentials}
    ${resp1}=    Edit LI        ${li}   ${edit_li_disabled_collectors['sflowconfiguration']}
    ${task} =   Wait For Task   ${resp1}    2400s    5s
    Run Keyword If  '${resp1['status_code']}' != '202'   Fail    ELSE    Log to Console  \n-LI  Edited successfully
    Validate sflow collector configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow agent configuration     ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}

OVF1734_API_TC_13_EDIT_LI_WITH_ENABLING_ONE_COLLECTOR
    Log to console    Edit LI
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${admin_credentials}
    ${resp1}=    Edit LI        ${li}   ${edit_li_enable_one_collector['sflowconfiguration']}
    ${task} =   Wait For Task   ${resp1}    2400s    5s
    Run Keyword If  '${resp1['status_code']}' != '202'   Fail    ELSE    Log to Console  \n-LI  Edited successfully
    Validate sflow collector configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow agent configuration     ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}

OVF1734_API_TC_14_EDIT_LI_WITH_CONFIGURING_SAMPLING_COLLECTOR
    Log to console    Edit LI
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${admin_credentials}
    ${resp1}=    Edit LI        ${li}   ${edit_li_sampling_collector['sflowconfiguration']}
    ${task} =   Wait For Task   ${resp1}    2400s    5s
    Run Keyword If  '${resp1['status_code']}' != '202'   Fail    ELSE    Log to Console  \n-LI  Edited successfully
    Validate sflow collector configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow agent configuration     ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow port configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}

OVF1734_API_TC_15_EDIT_LI_WITH_CHANGING_SAMPLING_TO_POLLING_COLLECTOR
    Log to console    Edit LI
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${admin_credentials}
    ${resp1}=    Edit LI        ${li}   ${edit_li_polling_collector['sflowconfiguration']}
    ${task} =   Wait For Task   ${resp1}    2400s    5s
    Run Keyword If  '${resp1['status_code']}' != '202'   Fail    ELSE    Log to Console  \n-LI  Edited successfully
    Validate sflow collector configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow agent configuration     ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow port configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}

OVF1734_API_TC_17_EDIT_LI_WITH_CHANGING_SAMPLING_TO_POLLING_CHANGING_IP_OF_COLLECTOR
    Log to console    Edit LI
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${admin_credentials}
    ${resp1}=    Edit LI        ${li}   ${edit_li_polling_changing_ip_of_collector['sflowconfiguration']}
    ${task} =   Wait For Task   ${resp1}    2400s    5s
    Run Keyword If  '${resp1['status_code']}' != '202'   Fail    ELSE    Log to Console  \n-LI  Edited successfully
    Validate sflow collector configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow agent configuration     ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow port configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}

OVF1734_API_TC_18_EDIT_LI_WITH_CONFIGURING_SAMPLING_COLLECTOR
    Log to console    Edit LI
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${admin_credentials}
    ${resp1}=    Edit LI        ${li}   ${edit_li_sampling_collector['sflowconfiguration']}
    ${task} =   Wait For Task   ${resp1}    300s    2s
    Run Keyword If  '${resp1['status_code']}' != '202'   Fail    ELSE    Log to Console  \n-LI  Edited successfully
    Validate sflow collector configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow agent configuration     ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow port configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}

OVF1734_API_TC_18_01_EDIT_LI_WITH_CONFIGURING_SAMPLING_CHANGING_IP_OF_OLLECTOR
    Log to console    Edit LI
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${admin_credentials}
    ${resp1}=    Edit LI        ${li}   ${edit_li_sampling_changing_ip_of_collector['sflowconfiguration']}
    ${task} =   Wait For Task   ${resp1}    300s    2s
    Run Keyword If  '${resp1['status_code']}' != '202'   Fail    ELSE    Log to Console  \n-LI  Edited successfully
    Validate sflow collector configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow agent configuration     ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow port configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}

OVF1734_API_TC_16_EDIT_LI_WITH_CONFIGURING_SAMPLING_CHANGING_PORT_OF_OLLECTOR
    Log to console    Edit LI
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${admin_credentials}
    ${resp1}=    Edit LI        ${li}   ${edit_li_sampling_changing_port_of_collector['sflowconfiguration']}
    ${task} =   Wait For Task   ${resp1}    300s    2s
    Run Keyword If  '${resp1['status_code']}' != '202'   Fail    ELSE    Log to Console  \n-LI  Edited successfully
    Validate sflow collector configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow agent configuration     ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow port configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}

OVF1734_API_TC_26_EDIT_LI_WITH_REMOVING_COLLECTOR
    Log to console    Edit LI
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${admin_credentials}
    ${resp1}=    Edit LI        ${li}   ${edit_li_removing_collector['sflowconfiguration']}
    ${valDict} =    Create Dictionary   status_code=${400}
    ...                                 taskState=CRM_INVALID_SFLOW_PORTCONFIG_COLLECTOR_ID
    ${actual_error} =    Create Dictionary   status_code=${resp1['status_code']}
    ...                                 taskState=${resp1['errorCode']}
    Validate Response     ${actual_error}     ${valDict}
    Log to Console  \n-LI  Edit operation is successful
    Validate sflow collector configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow agent configuration     ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}

OVF1734_API_TC_30_EDIT_LI_WITH_DUPLICATE_COLLECTOR_NAME
    Log to console    Edit LI
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${admin_credentials}
    ${resp1}=    Edit LI        ${li}   ${edit_li_duplicate_collectorname['sflowconfiguration']}
    ${valDict} =    Create Dictionary   status_code=${400}
    ...                                 taskState=CRM_INVALID_SFLOW_COLLECTOR_DUPLICATE
    ${actual_error} =    Create Dictionary   status_code=${resp1['status_code']}
    ...                                 taskState=${resp1['errorCode']}
    Validate Response     ${actual_error}     ${valDict}
    Log to Console  \n-LI  Edit operation is successful
    Validate sflow collector configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow agent configuration     ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}

OVF1734_API_TC_60_EDIT_LI_CHANGING_MODE_OF_SFLOW
    Log to console    Edit LI
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${admin_credentials}
    ${resp1}=    Edit LI        ${li}   ${edit_li_changing_mode_of_sflow['sflowconfiguration']}
    ${task} =   Wait For Task   ${resp1}    300s    2s
    Run Keyword If  '${resp1['status_code']}' != '202'   Fail    ELSE    Log to Console  \n-LI  Edited successfully

OVF1734_API_TC_77_EDIT_LI_ADDING_TUNNEL_NETWORK
    Log to console    Edit LI
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${admin_credentials}
    ${resp1}=    Edit LI        ${li}   ${edit_li_adding_tunnel_nw['sflowconfiguration']}
    ${valDict} =    Create Dictionary   status_code=${400}
    ...                                 taskState=CRM_INVALID_SFLOW_NETWORK
    ${actual_error} =    Create Dictionary   status_code=${resp1['status_code']}
    ...                                 taskState=${resp1['errorCode']}
    Validate Response     ${actual_error}     ${valDict}
    Log to Console  \n-LI  Edit operation is successful

OVF1734_API_TC_55_EDIT_LI_WITHOUT_SAMPLING_INTERVAL_VALUES
    Log to console    Edit LI
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${admin_credentials}
    ${resp1}=    Edit LI        ${li}   ${edit_li_without_sampling_interval['sflowconfiguration']}
    ${valDict} =    Create Dictionary   status_code=${400}
    ...                                 taskState=CRM_INVALID_SFLOW_CONFIGMODE_SAMPLING
    ${actual_error} =    Create Dictionary   status_code=${resp1['status_code']}
    ...                                 taskState=${resp1['errorCode']}
    Validate Response     ${actual_error}     ${valDict}
    Log to Console  \n-LI  Edit operation is successful

OVF1734_API_TC_46_EDIT_LI_WITHOUT_POLLING_INTERVAL_VALUES
    Log to console    Edit LI
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${admin_credentials}
    ${resp1}=    Edit LI        ${li}   ${edit_li_without_polling_interval['sflowconfiguration']}
    ${valDict} =    Create Dictionary   status_code=${400}
    ...                                 taskState=CRM_INVALID_SFLOW_CONFIGMODE_POLLING
    ${actual_error} =    Create Dictionary   status_code=${resp1['status_code']}
    ...                                 taskState=${resp1['errorCode']}
    Validate Response     ${actual_error}     ${valDict}
    Log to Console  \n-LI  Edit operation is successful

OVF1734_API_TC_49_EDIT_LI_WITH_STATIC_INVALID_IP
    Log to console    Edit LI
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${admin_credentials}
    ${resp1}=    Edit LI        ${li}   ${edit_li_invalid_static_ip['sflowconfiguration']}
    ${valDict} =    Create Dictionary   status_code=${400}
    ...                                 taskState=CRM_INVALID_SFLOW_MODULE_IP_CONFIGURATION
    ${actual_error} =    Create Dictionary   status_code=${resp1['status_code']}
    ...                                 taskState=${resp1['errorCode']}
    Validate Response     ${actual_error}     ${valDict}
    Log to Console  \n-LI  Edit operation is successful

OVF1734_API_TC_44_EDIT_LI_WITH_INVALID_SAMPLING_INTERVAL_VALUES
    Log to console    Edit LI
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${admin_credentials}
    ${resp1}=    Edit LI        ${li}   ${edit_li_invalid_sampling_interval['sflowconfiguration']}
    ${valDict} =    Create Dictionary   status_code=${400}
    ...                                 taskState=CRM_INVALID_SFLOW_CONFIGMODE_SAMPLING
    ${actual_error} =    Create Dictionary   status_code=${resp1['status_code']}
    ...                                 taskState=${resp1['errorCode']}
    Validate Response     ${actual_error}     ${valDict}
    Log to Console  \n-LI  Edit operation is successful

OVF1734_API_TC_44_01_EDIT_LI_WITH_INVALID_POLLING_INTERVAL_VALUES
    Log to console    Edit LI
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${admin_credentials}
    ${resp1}=    Edit LI        ${li}   ${edit_li_invalid_polling_interval['sflowconfiguration']}
    ${valDict} =    Create Dictionary   status_code=${400}
    ...                                 taskState=CRM_INVALID_SFLOW_CONFIGMODE_POLLING
    ${actual_error} =    Create Dictionary   status_code=${resp1['status_code']}
    ...                                 taskState=${resp1['errorCode']}
    Validate Response     ${actual_error}     ${valDict}
    Log to Console  \n-LI  Edit operation is successful

OVF1734_API_TC_20_EDIT_LI_ONLY_SAMPLING_INGRESS_PACKETS
    Log to console    Edit LI
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${admin_credentials}
    ${resp1}=    Edit LI        ${li}   ${edit_li_only_ingress_packets['sflowconfiguration']}
    ${task} =   Wait For Task   ${resp1}    300s    2s
    Run Keyword If  '${resp1['status_code']}' != '202'   Fail    ELSE    Log to Console  \n-LI  Edited successfully
    #Validate sflow collector configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow agent configuration     ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow port configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}

OVF1734_API_TC_22_EDIT_LI_MODIFY_SAMPLING_INGRESS_RATE
    Log to console    Edit LI
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${admin_credentials}
    ${resp1}=    Edit LI        ${li}   ${edit_li_modify_ingress_rate['sflowconfiguration']}
    ${task} =   Wait For Task   ${resp1}    300s    2s
    Run Keyword If  '${resp1['status_code']}' != '202'   Fail    ELSE    Log to Console  \n-LI  Edited successfully
    #Validate sflow collector configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow agent configuration     ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow port configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}

OVF1734_API_TC_21_EDIT_LI_ONLY_SAMPLING_EGRESS_PACKETS
    Log to console    Edit LI
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${admin_credentials}
    ${resp1}=    Edit LI        ${li}   ${edit_li_only_egress_packets['sflowconfiguration']}
    ${task} =   Wait For Task   ${resp1}    300s    2s
    Run Keyword If  '${resp1['status_code']}' != '202'   Fail    ELSE    Log to Console  \n-LI  Edited successfully
    #Validate sflow collector configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow agent configuration     ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow port configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}

OVF1734_API_TC_23_EDIT_LI_MODIFY_SAMPLING_EGRESS_RATE
    Log to console    Edit LI
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${admin_credentials}
    ${resp1}=    Edit LI        ${li}   ${edit_li_modify_egress_rate['sflowconfiguration']}
    ${task} =   Wait For Task   ${resp1}    300s    2s
    Run Keyword If  '${resp1['status_code']}' != '202'   Fail    ELSE    Log to Console  \n-LI  Edited successfully
    #Validate sflow collector configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow agent configuration     ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow port configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}

OVF1734_API_TC_42_EDIT_LI_WITH_OPTION_MORETHAN_3COLLECTORS
    Log to console    Edit LI
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${admin_credentials}
    ${resp1}=    Edit LI        ${li}   ${edit_li_add_morethan_3collector_ips['sflowconfiguration']}
    ${valDict} =    Create Dictionary   status_code=${400}
    ...                                 taskState=CRM_INVALID_SFLOW_COLLECTOR_SIZE
    ${actual_error} =    Create Dictionary   status_code=${resp1['status_code']}
    ...                                 taskState=${resp1['errorCode']}
    Validate Response     ${actual_error}     ${valDict}
    Log to Console  \n-LI  Edit operation is successful
    Validate sflow collector configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}

OVF_Update_Firmware_test_sflow
    Validate sflow collector configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow agent configuration     ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow port configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Update LI Firmware    ${LI_fw_update_Hafnium}    ${LI}
    Validate sflow collector configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow agent configuration     ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow port configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}

OVF_Downgrade_Firmware_test_sflow
    Validate sflow collector configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow agent configuration     ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow port configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Update LI Firmware    ${LI_fw_downgrade_Hafnium}    ${LI}
    Validate sflow collector configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow agent configuration     ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}
    Validate sflow port configuration    ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}

OVF1734_API_TC_50_EDIT_LI_WITH_IP_POOL
    Log to console    Edit LI
    Fusion Api Login Appliance     ${APPLIANCE_IP}   ${admin_credentials}
    Create ID Pools IPV4 Subnet     ${ipv4_subnet}
    Create ID Pools IPV4 Range      ${ipv4_range}
    Add Ethernet Networks with subnet  ${eth_networks_subnet_id}
    ${resp1}=    Edit LI        ${li}   ${edit_li_valid_ip_pool['sflowconfiguration']}
    ${task} =   Wait For Task   ${resp1}    300s    2s
    Run Keyword If  '${resp1['status_code']}' != '202'   Fail    ELSE    Log to Console  \n-LI  Edited successfully
    Validate sflow agent configuration     ${icmipv6}    ${icmSnmpUser}    ${icmSnmpPassword}

*** Keywords ***

Build LI body
    [Arguments]        ${lisflow}
    [Documentation]    Build LI body
    ${lisflow} =     Copy Dictionary    ${lisflow}
    #${sflowConfiguration}=   Get From Dictionary     ${lisflow}    sflowconfiguration
    ${sflowNetwork}=   Get From Dictionary     ${lisflow}    sflowNetwork
    ${sflowNetworkName}=   Get From Dictionary     ${sflowNetwork}    name
    ${neturi}=    Get Ethernet URI    ${sflowNetworkName}
    ${netDict} =    Create Dictionary    name=${sflowNetworkName}
    ...                                  uri=${neturi}
    log to console and log file    ${netDict}
    Set to Dictionary    ${lisflow}     sflowNetwork=${netDict}
    log to console and log file    ${lisflow}
    
    [Return]    ${lisflow}     
    
Edit LI
    [Documentation]   Editing existing LI
    [Arguments]        ${li}        ${li_body}
    ${body} =	Build LI body	${li_body}
    ${li_uri} =     Get LI URI   ${li}
    log to console    LI URI is ${li_uri}
    ${resp} =    Fusion Api Get Li    ${li_uri}
    log to console  Editing Li with sflow ${resp}
    ${respl} =    fusion_api_update_sflow_configuration    body=${body}    uri=${li_uri}
    log to console  Editing Li with snmp ${respl}
    #${task} =  Wait For Task   ${respl}    300s    2s
    #Run Keyword If '${respl['status_code']}' != '202'   Fail    ELSE    Log to Console  \n-LI  Edited successfully
    [Return]    ${respl}
