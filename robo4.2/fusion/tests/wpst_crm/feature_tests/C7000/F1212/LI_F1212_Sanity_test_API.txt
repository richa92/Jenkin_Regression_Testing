*** Settings ***
Documentation       Feature test : Firmware  update   F1212   feature of Hill Module
...                 on Enclosure G3,G2 G1
Variables           data_variables.py

Resource            ../../../../resource/fusion_api_all_resource_files.txt
Library             Collections
Library             RoboGalaxyLibrary
Library             FusionLibrary
Library             String
Library             json
Library             OperatingSystem
Library             SSHLibrary
Library             Selenium2Library
Library             Validation_c7k_firmware_version

*** Variables ***
${SSH_PASS}                 hpvse1
${APPLIANCE_IP}             192.168.147.205
${X-API-VERSION}            600
${li}                         SGH420HHYA-LIG_B1
${ExpectedErrorMsg1}=       Activate operation is not allowed at this state. One or more interconnects may not have been baselined to this firmware or all interconnects are already activated/activating to this baseline
${IP}                      192.168.144.132
${ltlv}                     0
${rtlv}                     1
${ICM_NAME1}                         SGH420HHYA, interconnect 3
${ICM_NAME2}                         SGH420HHYA, interconnect 4
${ICM_NAME3}                         SGH420HHYA, interconnect 6
${ICM_NAME4}                         SGH420HHYA, interconnect 7
${ICM_NAME5}                         SGH420HHYA, interconnect 1
${ICM_NAME6}                         SGH420HHYA, interconnect 2
${ICM_NAME7}                         SGH420HHYA, interconnect 8
${BAY1}                              1
${IP}                           192.168.144.132

# ${ExpectedErrorLiMsg1}            Unable to update firmware for the logical interconnect SGH420HHYA-LIG_B1 as an attempt was made to downgrade the firmware without selecting the force option.
# ${ExpectedErrorLiMsg3}           Retry the downgrade operation by selecting force option in the logical interconnect firmware update page

${ExpectedErrorMsgLEb1}=    No update required
# ${E-value}                       No update required. Selected firmware is already installed in the logical interconnect
# ${E-value}                       No update required. Selected firmware is already installed in the logical interconnect

# ${E-value}                       No update required. Selected firmware is already installed in the logical interconnect
${LE_N_Alert1}                  No update required. Selected firmware is already installed for the Onboard Administrator.
${LE_N_Alert2}                  No update required. Selected firmware is already installed in the logical interconnect


${ICM_Alert1_stg_star}           Staging started for the interconnect
# ${ICM_Alert1_stg_str_end}        \  with firmware version 3.01 v7.2.1_38 from baseline
${ICM_Alert1_stg_str_end}        \  with firmware version 3.05 v7.2.1_45 from baseline

# ${HICM_Alert1_stg_str_end}        \  with firmware version 3.08 v7.4.0_13 from baseline
${HICM_Alert1_stg_str_end}        \  with firmware version 3.08 from baseline

${ICM_Alert1_stg_succ}           Staging success for the interconnect
# ${ICM_Alert1_stg_succ_end}       \  with firmware version 3.01 v7.2.1_38 from baseline
${ICM_Alert1_stg_succ_end}       \  with firmware version 3.05 v7.2.1_45 from baseline
# ${HICM_Alert1_stg_succ_end}       \  with firmware version 3.08 v7.4.0_13 from baseline
${HICM_Alert1_stg_succ_end}       \  with firmware version 3.08 from baseline

${ICM_Alert1_act_star}          Activation started for the interconnect
# ${ICM_Alert1_act_star_end}      \  with firmware version 3.01 v7.2.1_38 from baseline
${ICM_Alert1_act_star_end}      \  with firmware version 3.05 v7.2.1_45 from baseline
# ${HICM_Alert1_act_star_end}      \  with firmware version 3.08 v7.4.0_13 from baseline
${HICM_Alert1_act_star_end}      \  with firmware version 3.08 from baseline

${ICM_Alert1_act_succ}          Activation success for the interconnect
# ${ICM_Alert1_act_succ_end}      \  with firmware version 3.01 v7.2.1_38 from baseline
${ICM_Alert1_act_succ_end}      \  with firmware version 3.05 v7.2.1_45 from baseline
# ${HICM_Alert1_act_succ_end}      \  with firmware version 3.08 v7.4.0_13 from baseline
${HICM_Alert1_act_succ_end}      \  with firmware version 3.08 from baseline

# 1 4.40 2014-10-12T08:56:22Z    4.40 2014-10-12T08:56:22Z
# ${ICM_Alert1_stg_star_1_end}    \  with firmware version 4.45 2015-07-20T23:55:25Z from baseline
${ICM_Alert1_stg_star_1_end}    \  with firmware version 4.50 2016-04-21T17:19:05Z from baseline
# ${HICM_Alert1_stg_star_1_end}    \  with firmware version 4.60 2016-12-12T14:16:54Z from baseline
${HICM_Alert1_stg_star_1_end}    \  with firmware version 4.60 2017-04-19T05:38:18Z from baseline

# ${ICM_Alert1_stg_star_2_end}    \  with firmware version 4.45 2015-07-20T23:55:25Z from baseline
${ICM_Alert1_stg_star_2_end}    \  with firmware version 4.50 2016-04-21T17:19:05Z from baseline
# ${HICM_Alert1_stg_star_2_end}    \  with firmware version 4.60 2016-12-12T14:16:54Z from baseline
${HICM_Alert1_stg_star_2_end}    \  with firmware version 4.60 2017-04-19T05:38:18Z from baseline

${ICM_Alert1_stg_star}           Staging started for the interconnect
# ${HICM_Alert1_stg_str_end}        \  with firmware version 3.08 v7.4.0_13 from baseline
${HICM_Alert1_stg_str_end}        \  with firmware version 3.08 from baseline


${ICM_Alert1_stg_succ}           Staging success for the interconnect
# ${HICM_Alert1_stg_succ_end}       \  with firmware version 3.08 v7.4.0_13 from baseline
${HICM_Alert1_stg_succ_end}       \  with firmware version 3.08 from baseline

${ICM_Alert1_act_star}          Activation started for the interconnect
# ${HICM_Alert1_act_star_end}      \  with firmware version 3.08 v7.4.0_13 from baseline
${HICM_Alert1_act_star_end}      \  with firmware version 3.08 from baseline

${ICM_Alert1_act_succ}          Activation success for the interconnect
# ${HICM_Alert1_act_succ_end}      \  with firmware version 3.08 v7.4.0_13 from baseline
${HICM_Alert1_act_succ_end}      \  with firmware version 3.08 from baseline


# 1 4.40 2014-10-12T08:56:22Z(4.60 2016-12-12T14:16:54Z)    4.40 2014-10-12T08:56:22Z  (4.60 2016-12-12T14:16:54Z)
# ${HICM_Alert1_stg_star_1_end}    \  with firmware version 4.60 2016-12-12T14:16:54Z from baseline
${HICM_Alert1_stg_star_1_end}    \  with firmware version 4.60 2017-04-19T05:38:18Z from baseline

# ${HICM_Alert1_stg_star_3_end}    \  with firmware version 3.08 v7.4.0_13 from baseline
# ${HICM_Alert1_stg_star_3_end}    \  with firmware version 4.60 2016-12-12T14:16:54Z from baseline
${HICM_Alert1_stg_star_3_end}    \  with firmware version 4.60 2017-04-19T05:38:18Z from baseline

@{LI_u_vc_names}=    ${ICM_NAME3}

@{LI_vc_names}=    ${ICM_NAME5}
...             ${ICM_NAME6}

@{LI_names}=    ${ICM_NAME1}
...             ${ICM_NAME2}
...             ${ICM_NAME4}
...             ${ICM_NAME7}

@{LI_namesall}=    ${ICM_NAME1}
...             ${ICM_NAME2}
...             ${ICM_NAME3}
...             ${ICM_NAME4}
...             ${ICM_NAME5}
...             ${ICM_NAME6}
...             ${ICM_NAME7}



*** Test Cases ***
   ###### Downgrade of firmware on HILL Interconnects (STAGE) Verify downgrading the firmware : Verify the staging of firmware of hill and VC modules which is lesser than currently installed version######
TC01_TC03 Verify that oneview 3(dot)0 should allow Staging of firmware of hill and VC modules with force flag (Downgrade)
    [Documentation]      "3.1.2 F1212_TC_API_01 and F1212_TC_API_04:Verify that oneview 3.0 should allow Staging of firmware of hill and VC modules with force flag (Downgrade)"
    Log to Console    Testcase_ID: TP section 1.3.1.2 API Test Cases F1212_TC_API_01 and F1212_TC_API_04: Verify that oneview 3.0 should allow Staging of firmware of hill and VC modules with force flag (Downgrade)
    [Tags]   Performance  firmware-condition-li_upgrade

    Fusion Api Login Appliance      ${APPLIANCE_IP}     ${admin_credentials}

#   ${del_resp}=    fusion_api_delete_alert    /rest/alerts
#   Log to Console       ${del_resp}

#   ${body} =   Build LI SPP body   ${Demo_li_spp_upgrade1_test_stg_lower}

    ${li_uri} =     Get LI URI   ${li}
    Log to Console    ${li_uri}

    ${resp1} =    fusion_api_li_upgrade_firmware    body=${Demo_li_spp_upgrade1_test_stg_lower}     uri=${li_uri}
    Log to Console        ${resp1}
    ${task} =       Wait For Task   ${resp1}    60 min      2s

    Log to Console        ${task}
    Log to Console      ${task}

    ${valDict} =    Create Dictionary   status_code=${200}
    ...                                 taskState=Completed
    Validate Response     ${task}    ${valDict}
    Log to Console  \nStage Firmware Upgrade complete
    Sleep   1 minutes 1 seconds


    Log to Console  Validate interconnect firmware version after firmwareupgrade is complete

    : FOR    ${BICM_NAME}    IN    @{LI_namesall}

    \    ${ic} =     Get IC             ${BICM_NAME}
    \    Log to Console       ${BICM_NAME}
    \    ${ic_bay_number} =    Split String   ${BICM_NAME}   ","

    \    Log to Console       ${ic_bay_number}

    \    ${ic_bay_number} =     Get From List    ${ic_bay_number}    0
    \    Log to Console       ${ic_bay_number}


    \    ${ic_bay_number} =     Get From List    ${ic_bay_number}    25
    \    Log to Console       ${ic_bay_number}
    \    ${firmwareVersion} =     Get From IC    ${ic}   firmwareVersion
    \    ${firmwareVersion_upgrade} =      verify_c7k_ic_version    ${ic_bay_number}    ${IP}
    \    ${version}=    Should Contain    ${firmwareVersion}    ${firmwareVersion_upgrade}
    \    Should Be Equal As Strings    ${firmwareVersion}       ${firmwareVersion_upgrade}
    \    Log to Console       Validated the firmvare version
    \    Log to Console       ${BICM_NAME}
    \    ${icstate} =     Get From IC    ${ic}   state
    \    Should Be Equal As Strings    ${icstate}       Configured
    \    Log to Console    Validated the ICstate for
    \    Log to Console       ${BICM_NAME}
    Log to Console    Validated the Firmware version by compare with ICM and From API
    Log to Console  \nFirmware version verification  complete
#   Fusion Api Logout Appliance

#TC02 verifyalerts
#   Fusion Api Login Appliance      ${APPLIANCE_IP}     ${admin_credentials}

    ${alerts} =    fusion_api_get_alerts    /rest/alerts

    Log to Console        ${alerts}
#    Run Keyword and Continue on Failure       Should Contain       '${Alert_List}'     ${RR_BB}    Expected Error Message Not seen
    : FOR    ${BICM_NAME}    IN    @{LI_names}
    # ${finalstring}    Catenate    Hello    World
    \    ${Al_stg_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_star}    ${ICM_Alert1_stg_str_end}
    \    Log to Console    ${Al_stg_str}
#   \    ${alerts} =    fusion_api_get_alerts    /rest/alerts
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_str}   Expected Error Message Not seen


    \    ${Al_stg_suc}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_succ}    ${ICM_Alert1_stg_succ_end}
    \    Log to Console    ${Al_stg_suc}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_suc}   Expected Error Message Not seen


#   \    ${Al_act_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_star}    ${ICM_Alert1_act_star_end}
#   \    Log to Console    ${Al_act_str}
#   \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_str}   Expected Error Message Not seen

#   \    ${Al_act_succ}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_succ}    ${ICM_Alert1_act_succ_end}
#   \    Log to Console    ${Al_act_succ}
#   \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_succ}  Expected Error Message Not seen


    : FOR    ${BICM_NAME}    IN    @{LI_vc_names}
    # ${finalstring}    Catenate    Hello    World
    \    ${Al_stg_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_star}    ${ICM_Alert1_stg_star_1_end}
    \    Log to Console    ${Al_stg_str}
#   \    ${alerts} =    fusion_api_get_alerts    /rest/alerts
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_str}   Expected Error Message Not seen


    \    ${Al_stg_suc}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_succ}    ${ICM_Alert1_stg_star_1_end}
    \    Log to Console    ${Al_stg_suc}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_suc}   Expected Error Message Not seen


#   \    ${Al_act_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_star}    ${ICM_Alert1_stg_star_1_end}
#   \    Log to Console    ${Al_act_str}
#   \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_str}   Expected Error Message Not seen

#   \    ${Al_act_succ}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_succ}    ${ICM_Alert1_stg_star_1_end}
#   \    Log to Console    ${Al_act_succ}
#   \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_succ}  Expected Error Message Not seen

    : FOR    ${BICM_NAME}    IN    @{LI_u_vc_names}
    # ${finalstring}    Catenate    Hello    World
    \    ${Al_stg_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_star}    ${ICM_Alert1_stg_star_2_end}
    \    Log to Console    ${Al_stg_str}
#   \    ${alerts} =    fusion_api_get_alerts    /rest/alerts
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_str}   Expected Error Message Not seen


    \    ${Al_stg_suc}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_succ}    ${ICM_Alert1_stg_star_2_end}
    \    Log to Console    ${Al_stg_suc}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_suc}   Expected Error Message Not seen


#   \    ${Al_act_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_star}    ${ICM_Alert1_stg_star_2_end}
#   \    Log to Console    ${Al_act_str}
#   \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_str}   Expected Error Message Not seen

#   \    ${Al_act_succ}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_succ}    ${ICM_Alert1_stg_star_2_end}
#   \    Log to Console    ${Al_act_succ}
#   \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_succ}  Expected Error Message Not seen

    Fusion Api Logout Appliance

    #### ACTIVATION for DOwngrade #######
TC02_TC05 Verify the activation of firmware of hill and vc modules using Odd Even mode Downgrade for G3 enclosure

    [Documentation]      "3.1.2 F1212_TC_API_10:Verify the activation of firmware of hill and vc modules using Odd Even mode (Downgrade for G3 enclosure)"
    Log to Console    Testcase_ID: TP section 1.3.1.2 API Test Cases F1212_TC_API_10: Verify the activation of firmware of hill and vc modules using Odd/Even mode (Downgrade for G3 enclosure)
    [Tags]   Performance  firmware-condition-li_upgrade
    Fusion Api Login Appliance      ${APPLIANCE_IP}     ${admin_credentials}

    ${del_resp}=    fusion_api_delete_alert    /rest/alerts
    Log to Console       ${del_resp}

#   ${body} =   Build LI SPP body   ${Demo_li_spp_upgrade5_test_act_lower}

    ${li_uri} =     Get LI URI   ${li}
#   ${resp1} =    Fusion Api Li Upgrade Firmware    body=${body}        uri=${li_uri}
    ${resp1} =    fusion_api_li_upgrade_firmware    body=${Demo_li_spp_upgrade5_test_act_lower}     uri=${li_uri}
    Log to Console        ${resp1}
    ${task} =       Wait For Task   ${resp1}    120 min      18s
    Log to Console      "Hi am in validate"
    Log to Console        ${task}
    Log to Console      ${task}

    ${valDict} =    Create Dictionary   status_code=${200}
    ...                                 taskState=Completed
    Validate Response     ${task}    ${valDict}
    Log to Console  \nStage Firmware Upgrade complete
    Sleep   1 minutes 1 seconds


    Log to Console  Validate interconnect firmware version after firmwareupgrade is complete

    : FOR    ${BICM_NAME}    IN    @{LI_namesall}

    \    ${ic} =     Get IC             ${BICM_NAME}
    \    Log to Console       ${BICM_NAME}
    \    ${ic_bay_number} =    Split String   ${BICM_NAME}   ","

    \    Log to Console       ${ic_bay_number}

    \    ${ic_bay_number} =     Get From List    ${ic_bay_number}    0
    \    Log to Console       ${ic_bay_number}


    \    ${ic_bay_number} =     Get From List    ${ic_bay_number}    25
    \    Log to Console       ${ic_bay_number}
    \    ${firmwareVersion} =     Get From IC    ${ic}   firmwareVersion
    \    ${firmwareVersion_upgrade} =      verify_c7k_ic_version    ${ic_bay_number}    ${IP}
    \    ${version}=    Should Contain    ${firmwareVersion}    ${firmwareVersion_upgrade}
    \    Should Be Equal As Strings    ${firmwareVersion}       ${firmwareVersion_upgrade}
    \    Log to Console       Validated the firmvare version
    \    Log to Console       ${BICM_NAME}
    \    ${icstate} =     Get From IC    ${ic}   state
    \    Should Be Equal As Strings    ${icstate}       Configured
    \    Log to Console    Validated the ICstate for
    \    Log to Console       ${BICM_NAME}
    Log to Console    Validated the Firmware version by compare with ICM and From API
    Log to Console  \nFirmware version verification  complete
#   Fusion Api Logout Appliance


#   Fusion Api Login Appliance      ${APPLIANCE_IP}     ${admin_credentials}

    ${alerts} =    fusion_api_get_alerts    /rest/alerts
    Log to Console    ${alerts}
    Log to Console        ${alerts}
#    Run Keyword and Continue on Failure       Should Contain       '${Alert_List}'     ${RR_BB}    Expected Error Message Not seen
    : FOR    ${BICM_NAME}    IN    @{LI_names}
    # ${finalstring}    Catenate    Hello    World
#   \    ${Al_stg_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_star}    ${ICM_Alert1_stg_str_end}
#   \    Log to Console    ${Al_stg_str}
#   \    ${alerts} =    fusion_api_get_alerts    /rest/alerts
#   \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_str}   Expected Error Message Not seen


#   \    ${Al_stg_suc}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_succ}    ${ICM_Alert1_stg_succ_end}
#   \    Log to Console    ${Al_stg_suc}
#   \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_suc}   Expected Error Message Not seen


    \    ${Al_act_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_star}    ${ICM_Alert1_act_star_end}
    \    Log to Console    ${Al_act_str}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_str}   Expected Error Message Not seen

    \    ${Al_act_succ}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_succ}    ${ICM_Alert1_act_succ_end}
    \    Log to Console    ${Al_act_succ}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_succ}  Expected Error Message Not seen


    : FOR    ${BICM_NAME}    IN    @{LI_vc_names}
    # ${finalstring}    Catenate    Hello    World
#   \    ${Al_stg_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_star}    ${ICM_Alert1_stg_star_1_end}
#   \    Log to Console    ${Al_stg_str}
#   \    ${alerts} =    fusion_api_get_alerts    /rest/alerts
#   \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_str}   Expected Error Message Not seen


#   \    ${Al_stg_suc}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_succ}    ${ICM_Alert1_stg_star_1_end}
#   \    Log to Console    ${Al_stg_suc}
#   \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_suc}   Expected Error Message Not seen


    \    ${Al_act_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_star}    ${ICM_Alert1_stg_star_1_end}
    \    Log to Console    ${Al_act_str}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_str}   Expected Error Message Not seen

    \    ${Al_act_succ}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_succ}    ${ICM_Alert1_stg_star_1_end}
    \    Log to Console    ${Al_act_succ}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_succ}  Expected Error Message Not seen

    : FOR    ${BICM_NAME}    IN    @{LI_u_vc_names}
    # ${finalstring}    Catenate    Hello    World
#   \    ${Al_stg_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_star}    ${ICM_Alert1_stg_star_2_end}
#   \    Log to Console    ${Al_stg_str}
#   \    ${alerts} =    fusion_api_get_alerts    /rest/alerts
#   \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_str}   Expected Error Message Not seen


#   \    ${Al_stg_suc}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_succ}    ${ICM_Alert1_stg_star_2_end}
#   \    Log to Console    ${Al_stg_suc}
#   \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_suc}   Expected Error Message Not seen


    \    ${Al_act_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_star}    ${ICM_Alert1_stg_star_2_end}
    \    Log to Console    ${Al_act_str}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_str}   Expected Error Message Not seen

    \    ${Al_act_succ}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_succ}    ${ICM_Alert1_stg_star_2_end}
    \    Log to Console    ${Al_act_succ}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_succ}  Expected Error Message Not seen

    Fusion Api Logout Appliance

TC03_TC01 Verify that oneview 3(dot)0 should allow Staging of firmware of hill and VC modules without force flag (upgrade)
    [Documentation]    "3.1.2 : Verify that oneview 3.0 should allow Staging of firmware of hill and VC modules without force flag (upgrade)"
    Log to Console    Testcase_ID: TP section 1.3.1.2 API Test Cases F1212_TC_API_02: Verify that oneview 3.0 should allow Staging of firmware of hill and VC modules without force flag (upgrade)
    [Tags]   Performance  firmware-condition-li_upgrade
    Fusion Api Login Appliance      ${APPLIANCE_IP}     ${admin_credentials}

    ${del_resp}=    fusion_api_delete_alert    /rest/alerts
    Log to Console       ${del_resp}
#   ${body} =   Build LI SPP body   ${Demo_li_spp_upgrade1_test_stg_higher}

    ${li_uri} =     Get LI URI   ${li}

    ${resp1} =    fusion_api_li_upgrade_firmware     body=${Demo_li_spp_upgrade1_test_stg_higher}       uri=${li_uri}
    Log to Console        ${resp1}
    ${task} =       Wait For Task   ${resp1}    99 min      15s
    Log to Console        ${task}
    Log to Console      ${task}

    ${valDict} =    Create Dictionary   status_code=${200}
    ...                                 taskState=Completed
    Validate Response    ${task}    ${valDict}
    Log to Console  \nStage Firmware Upgrade complete
    Sleep   1 minutes 1 seconds

    Log to Console  Validate interconnect firmware version after firmwareupgrade is complete


    : FOR    ${BICM_NAME}    IN    @{LI_namesall}

    \    ${ic} =     Get IC             ${BICM_NAME}
    \    Log to Console       ${BICM_NAME}
    \    ${ic_bay_number} =    Split String   ${BICM_NAME}   ","

    \    Log to Console       ${ic_bay_number}

    \    ${ic_bay_number} =     Get From List    ${ic_bay_number}    0
    \    Log to Console       ${ic_bay_number}


    \    ${ic_bay_number} =     Get From List    ${ic_bay_number}    25
    \    Log to Console       ${ic_bay_number}
    \    ${firmwareVersion} =     Get From IC    ${ic}   firmwareVersion
    \    ${firmwareVersion_upgrade} =      verify_c7k_ic_version    ${ic_bay_number}    ${IP}
    \    ${version}=    Should Contain    ${firmwareVersion}    ${firmwareVersion_upgrade}
    \    Should Be Equal As Strings    ${firmwareVersion}       ${firmwareVersion_upgrade}
    \    Log to Console       Validated the firmvare version
    \    Log to Console       ${BICM_NAME}
    \    ${icstate} =     Get From IC    ${ic}   state
    \    Should Be Equal As Strings    ${icstate}       Configured
    \    Log to Console    Validated the ICstate for
    \    Log to Console       ${BICM_NAME}
    Log to Console    Validated the Firmware version by compare with ICM and From API
    Log to Console  \nFirmware version verification  complete
#   Fusion Api Logout Appliance


    ######## Verify The ALERTS  #########################
#   Fusion Api Login Appliance      ${APPLIANCE_IP}     ${admin_credentials}
    ${alerts} =    fusion_api_get_alerts    /rest/alerts

#    Run Keyword and Continue on Failure       Should Contain       '${Alert_List}'     ${RR_BB}    Expected Error Message Not seen
    : FOR    ${BICM_NAME}    IN    @{LI_names}
    # ${finalstring}    Catenate    Hello    World
    \    ${Al_stg_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_star}    ${HICM_Alert1_stg_str_end}
    \    Log to Console    ${Al_stg_str}
    \    ${alerts} =    fusion_api_get_alerts    /rest/alerts
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_str}   Expected Error Message Not seen


    \    ${Al_stg_suc}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_succ}    ${HICM_Alert1_stg_succ_end}
    \    Log to Console    ${Al_stg_suc}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_suc}   Expected Error Message Not seen

    : FOR    ${BICM_NAME}    IN    @{LI_vc_names}
    # ${finalstring}    Catenate    Hello    World
    \    ${Al_stg_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_star}    ${HICM_Alert1_stg_star_1_end}
    \    Log to Console    ${Al_stg_str}
    \    ${alerts} =    fusion_api_get_alerts    /rest/alerts
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_str}   Expected Error Message Not seen


    \    ${Al_stg_suc}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_succ}    ${HICM_Alert1_stg_star_1_end}
    \    Log to Console    ${Al_stg_suc}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_suc}   Expected Error Message Not seen

    : FOR    ${BICM_NAME}    IN    @{LI_u_vc_names}
    # ${finalstring}    Catenate    Hello    World
    \    ${Al_stg_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_star}    ${HICM_Alert1_stg_star_2_end}
    \    Log to Console    ${Al_stg_str}
    \    ${alerts} =    fusion_api_get_alerts    /rest/alerts
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_str}   Expected Error Message Not seen


    \    ${Al_stg_suc}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_succ}    ${HICM_Alert1_stg_star_2_end}
    \    Log to Console    ${Al_stg_suc}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_suc}   Expected Error Message Not seen


    Fusion Api Logout Appliance


    ###############  Activate already staged firmware : F1212_TC_API_11 Verify the activation of firmware of hill and VC modules using Parallel mode which has firmware already staged.( for G3 enclosure) #######################
TC04_TC02 Verify the activation of firmware of hill and VC modules using Parallel mode which has firmware already staged
    [Documentation]      "3.1.2 : Verify the activation of firmware of hill and VC modules using Parallel mode which has firmware already staged.( for G3 enclosure)"
    Log to Console    Testcase_ID: TP section 1.3.1.2 API Test Cases F1212_TC_API_11: Verify the activation of firmware of hill and VC modules using Parallel mode which has firmware already staged.( for G3 enclosure)
    [Tags]   Performance  firmware-condition-li_upgrade
    Fusion Api Login Appliance      ${APPLIANCE_IP}     ${admin_credentials}

#   ${del_resp}=    fusion_api_delete_alert    /rest/alerts
#   Log to Console       ${del_resp}

#   ${body} =   Build LI SPP body   ${Demo_li_spp_upgrade5_test_higher}

    ${li_uri} =     Get LI URI   ${li}
    ${resp1} =  Fusion Api Li Upgrade Firmware  body=${Demo_li_spp_upgrade5_test_higher}        uri=${li_uri}
#   ${resp1} =    fusion_api_li_upgrade_firmware        uri=${li_uri}
    Log to Console        ${resp1}
    ${task} =       Wait For Task   ${resp1}    99 min      18s
    Log to Console      "Hi am in validate"
    Log to Console        ${task}
    Log to Console      ${task}

    ${valDict} =    Create Dictionary   status_code=${200}
    ...                                 taskState=Completed
    Validate Response     ${task}    ${valDict}
    Log to Console  \nStage Firmware Upgrade complete
    Sleep   1 minutes 1 seconds


    Log to Console  Validate interconnect firmware version after firmwareupgrade is complete

    : FOR    ${BICM_NAME}    IN    @{LI_namesall}

    \    ${ic} =     Get IC             ${BICM_NAME}
    \    Log to Console       ${BICM_NAME}
    \    ${ic_bay_number} =    Split String   ${BICM_NAME}   ","

    \    Log to Console       ${ic_bay_number}

    \    ${ic_bay_number} =     Get From List    ${ic_bay_number}    0
    \    Log to Console       ${ic_bay_number}


    \    ${ic_bay_number} =     Get From List    ${ic_bay_number}    25
    \    Log to Console       ${ic_bay_number}
    \    ${firmwareVersion} =     Get From IC    ${ic}   firmwareVersion
    \    ${firmwareVersion_upgrade} =      verify_c7k_ic_version    ${ic_bay_number}    ${IP}
    \    ${version}=    Should Contain    ${firmwareVersion}    ${firmwareVersion_upgrade}
    \    Should Be Equal As Strings    ${firmwareVersion}       ${firmwareVersion_upgrade}
    \    Log to Console       Validated the firmvare version
    \    Log to Console       ${BICM_NAME}
    \    ${icstate} =     Get From IC    ${ic}   state
    \    Should Be Equal As Strings    ${icstate}       Configured
    \    Log to Console    Validated the ICstate for
    \    Log to Console       ${BICM_NAME}
    Log to Console    Validated the Firmware version by compare with ICM and From API
    Log to Console  \nFirmware version verification  complete
#   Fusion Api Logout Appliance


#   Fusion Api Login Appliance      ${APPLIANCE_IP}     ${admin_credentials}

    ${alerts} =    fusion_api_get_alerts    /rest/alerts
    Log to Console    ${alerts}
    Log to Console        ${alerts}
#    Run Keyword and Continue on Failure       Should Contain       '${Alert_List}'     ${RR_BB}    Expected Error Message Not seen
    : FOR    ${BICM_NAME}    IN    @{LI_names}
    # ${finalstring}    Catenate    Hello    World
#   \    ${Al_stg_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_star}    ${ICM_Alert1_stg_str_end}
#   \    Log to Console    ${Al_stg_str}
#   \    ${alerts} =    fusion_api_get_alerts    /rest/alerts
#   \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_str}   Expected Error Message Not seen


#   \    ${Al_stg_suc}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_succ}    ${ICM_Alert1_stg_succ_end}
#   \    Log to Console    ${Al_stg_suc}
#   \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_suc}   Expected Error Message Not seen


    \    ${Al_act_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_star}    ${HICM_Alert1_act_star_end}
    \    Log to Console    ${Al_act_str}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_str}   Expected Error Message Not seen

    \    ${Al_act_succ}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_succ}    ${HICM_Alert1_act_succ_end}
    \    Log to Console    ${Al_act_succ}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_succ}  Expected Error Message Not seen


    : FOR    ${BICM_NAME}    IN    @{LI_vc_names}
    # ${finalstring}    Catenate    Hello    World
#   \    ${Al_stg_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_star}    ${ICM_Alert1_stg_star_1_end}
#   \    Log to Console    ${Al_stg_str}
#   \    ${alerts} =    fusion_api_get_alerts    /rest/alerts
#   \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_str}   Expected Error Message Not seen


#   \    ${Al_stg_suc}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_succ}    ${ICM_Alert1_stg_star_1_end}
#   \    Log to Console    ${Al_stg_suc}
#   \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_suc}   Expected Error Message Not seen


    \    ${Al_act_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_star}    ${HICM_Alert1_stg_star_1_end}
    \    Log to Console    ${Al_act_str}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_str}   Expected Error Message Not seen

    \    ${Al_act_succ}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_succ}    ${HICM_Alert1_stg_star_1_end}
    \    Log to Console    ${Al_act_succ}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_succ}  Expected Error Message Not seen

    : FOR    ${BICM_NAME}    IN    @{LI_u_vc_names}
    # ${finalstring}    Catenate    Hello    World
#   \    ${Al_stg_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_star}    ${ICM_Alert1_stg_star_2_end}
#   \    Log to Console    ${Al_stg_str}
#   \    ${alerts} =    fusion_api_get_alerts    /rest/alerts
#   \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_str}   Expected Error Message Not seen


#   \    ${Al_stg_suc}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_succ}    ${ICM_Alert1_stg_star_2_end}
#   \    Log to Console    ${Al_stg_suc}
#   \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_suc}   Expected Error Message Not seen


    \    ${Al_act_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_star}    ${HICM_Alert1_stg_star_2_end}
    \    Log to Console    ${Al_act_str}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_str}   Expected Error Message Not seen

    \    ${Al_act_succ}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_succ}    ${HICM_Alert1_stg_star_2_end}
    \    Log to Console    ${Al_act_succ}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_succ}  Expected Error Message Not seen

    Fusion Api Logout Appliance

TC05_TC03 Verify that oneview 3(dot)0 should allow Staging of firmware of hill and VC modules with force flag (Downgrade)
    [Documentation]      "3.1.2 F1212_TC_API_01 and F1212_TC_API_04:Verify that oneview 3.0 should allow Staging of firmware of hill and VC modules with force flag (Downgrade)"
    Log to Console    Testcase_ID: TP section 1.3.1.2 API Test Cases F1212_TC_API_01 and F1212_TC_API_04: Verify that oneview 3.0 should allow Staging of firmware of hill and VC modules with force flag (Downgrade)
    [Tags]   Performance  firmware-condition-li_upgrade
    Fusion Api Login Appliance      ${APPLIANCE_IP}     ${admin_credentials}

#   ${del_resp}=    fusion_api_delete_alert    /rest/alerts
#   Log to Console       ${del_resp}

#   ${body} =   Build LI SPP body   ${Demo_li_spp_upgrade1_test_stg_lower}

    ${li_uri} =     Get LI URI   ${li}

    ${resp1} =    fusion_api_li_upgrade_firmware    body=${Demo_li_spp_upgrade1_test_stg_lower}     uri=${li_uri}
    Log to Console        ${resp1}
    ${task} =       Wait For Task   ${resp1}    99 min      2s

    Log to Console        ${task}


    ${valDict} =    Create Dictionary   status_code=${200}
    ...                                 taskState=Completed
    Validate Response     ${task}    ${valDict}
    Log to Console  \nStage Firmware Upgrade complete
    Sleep   1 minutes 1 seconds


    Log to Console  Validate interconnect firmware version after firmwareupgrade is complete

    : FOR    ${BICM_NAME}    IN    @{LI_namesall}

    \    ${ic} =     Get IC             ${BICM_NAME}
    \    Log to Console       ${BICM_NAME}
    \    ${ic_bay_number} =    Split String   ${BICM_NAME}   ","

    \    Log to Console       ${ic_bay_number}

    \    ${ic_bay_number} =     Get From List    ${ic_bay_number}    0
    \    Log to Console       ${ic_bay_number}


    \    ${ic_bay_number} =     Get From List    ${ic_bay_number}    25
    \    Log to Console       ${ic_bay_number}
    \    ${firmwareVersion} =     Get From IC    ${ic}   firmwareVersion
    \    ${firmwareVersion_upgrade} =      verify_c7k_ic_version    ${ic_bay_number}    ${IP}
    \    ${version}=    Should Contain    ${firmwareVersion}    ${firmwareVersion_upgrade}
    \    Should Be Equal As Strings    ${firmwareVersion}       ${firmwareVersion_upgrade}
    \    Log to Console       Validated the firmvare version
    \    Log to Console       ${BICM_NAME}
    \    ${icstate} =     Get From IC    ${ic}   state
    \    Should Be Equal As Strings    ${icstate}       Configured
    \    Log to Console    Validated the ICstate for
    \    Log to Console       ${BICM_NAME}
    Log to Console    Validated the Firmware version by compare with ICM and From API
    Log to Console  \nFirmware version verification  complete
#   Fusion Api Logout Appliance

    ${alerts} =    fusion_api_get_alerts    /rest/alerts

    Log to Console        ${alerts}

    : FOR    ${BICM_NAME}    IN    @{LI_names}
    # ${finalstring}    Catenate    Hello    World
    \    ${Al_stg_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_star}    ${ICM_Alert1_stg_str_end}
    \    Log to Console    ${Al_stg_str}

    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_str}   Expected Error Message Not seen


    \    ${Al_stg_suc}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_succ}    ${ICM_Alert1_stg_succ_end}
    \    Log to Console    ${Al_stg_suc}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_suc}   Expected Error Message Not seen


#   \    ${Al_act_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_star}    ${ICM_Alert1_act_star_end}
#   \    Log to Console    ${Al_act_str}
#   \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_str}   Expected Error Message Not seen

#   \    ${Al_act_succ}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_succ}    ${ICM_Alert1_act_succ_end}
#   \    Log to Console    ${Al_act_succ}
#   \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_succ}  Expected Error Message Not seen


    : FOR    ${BICM_NAME}    IN    @{LI_vc_names}
    # ${finalstring}    Catenate    Hello    World
    \    ${Al_stg_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_star}    ${ICM_Alert1_stg_star_1_end}
    \    Log to Console    ${Al_stg_str}
#   \    ${alerts} =    fusion_api_get_alerts    /rest/alerts
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_str}   Expected Error Message Not seen


    \    ${Al_stg_suc}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_succ}    ${ICM_Alert1_stg_star_1_end}
    \    Log to Console    ${Al_stg_suc}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_suc}   Expected Error Message Not seen


#   \    ${Al_act_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_star}    ${ICM_Alert1_stg_star_1_end}
#   \    Log to Console    ${Al_act_str}
#   \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_str}   Expected Error Message Not seen

#   \    ${Al_act_succ}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_succ}    ${ICM_Alert1_stg_star_1_end}
#   \    Log to Console    ${Al_act_succ}
#   \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_succ}  Expected Error Message Not seen

    : FOR    ${BICM_NAME}    IN    @{LI_u_vc_names}
    # ${finalstring}    Catenate    Hello    World
    \    ${Al_stg_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_star}    ${ICM_Alert1_stg_star_2_end}
    \    Log to Console    ${Al_stg_str}
#   \    ${alerts} =    fusion_api_get_alerts    /rest/alerts
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_str}   Expected Error Message Not seen


    \    ${Al_stg_suc}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_succ}    ${ICM_Alert1_stg_star_2_end}
    \    Log to Console    ${Al_stg_suc}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_suc}   Expected Error Message Not seen


#   \    ${Al_act_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_star}    ${ICM_Alert1_stg_star_2_end}
#   \    Log to Console    ${Al_act_str}
#   \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_str}   Expected Error Message Not seen

#   \    ${Al_act_succ}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_succ}    ${ICM_Alert1_stg_star_2_end}
#   \    Log to Console    ${Al_act_succ}
#   \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_succ}  Expected Error Message Not seen

    Fusion Api Logout Appliance

    #### ACTIVATION for DOwngrade #######
TC06_TC05 Verify the activation of firmware of hill and vc modules using Serial mode Downgrade for G3 enclosure

    [Documentation]      "3.1.2 F1212_TC_API_10:Verify the activation of firmware of hill and vc modules using Serial mode (Downgrade for G3 enclosure)"
    Log to Console    Testcase_ID: TP section 1.3.1.2 API Test Cases F1212_TC_API_10: Verify the activation of firmware of hill and vc modules using Serial mode (Downgrade for G3 enclosure)
    [Tags]   Performance  firmware-condition-li_upgrade
    Fusion Api Login Appliance      ${APPLIANCE_IP}     ${admin_credentials}

    ${del_resp}=    fusion_api_delete_alert    /rest/alerts
    Log to Console       ${del_resp}

#   ${body} =   Build LI SPP body   ${Demo_li_spp_upgrade5_Serial_act_lower}

    ${li_uri} =     Get LI URI   ${li}
#   ${resp1} =    Fusion Api Li Upgrade Firmware    body=${body}        uri=${li_uri}
    ${resp1} =    fusion_api_li_upgrade_firmware    body=${Demo_li_spp_upgrade5_Serial_act_lower}     uri=${li_uri}
    Log to Console        ${resp1}
    ${task} =       Wait For Task   ${resp1}    190 min      1s
    Log to Console        ${task}

    ${valDict} =    Create Dictionary   status_code=${200}
    ...                                 taskState=Completed
    Validate Response     ${task}    ${valDict}
    Log to Console  \nStage Firmware Upgrade complete
    Sleep   1 minutes 1 seconds


    Log to Console  Validate interconnect firmware version after firmwareupgrade is complete

    : FOR    ${BICM_NAME}    IN    @{LI_namesall}

    \    ${ic} =     Get IC             ${BICM_NAME}
    \    Log to Console       ${BICM_NAME}
    \    ${ic_bay_number} =    Split String   ${BICM_NAME}   ","

    \    Log to Console       ${ic_bay_number}

    \    ${ic_bay_number} =     Get From List    ${ic_bay_number}    0
    \    Log to Console       ${ic_bay_number}


    \    ${ic_bay_number} =     Get From List    ${ic_bay_number}    25
    \    Log to Console       ${ic_bay_number}
    \    ${firmwareVersion} =     Get From IC    ${ic}   firmwareVersion
    \    ${firmwareVersion_upgrade} =      verify_c7k_ic_version    ${ic_bay_number}    ${IP}
    \    ${version}=    Should Contain    ${firmwareVersion}    ${firmwareVersion_upgrade}
    \    Should Be Equal As Strings    ${firmwareVersion}       ${firmwareVersion_upgrade}
    \    Log to Console       Validated the firmvare version
    \    Log to Console       ${BICM_NAME}
    \    ${icstate} =     Get From IC    ${ic}   state
    \    Should Be Equal As Strings    ${icstate}       Configured
    \    Log to Console    Validated the ICstate for
    \    Log to Console       ${BICM_NAME}
    Log to Console    Validated the Firmware version by compare with ICM and From API
    Log to Console  \nFirmware version verification  complete
#   Fusion Api Logout Appliance


#   Fusion Api Login Appliance      ${APPLIANCE_IP}     ${admin_credentials}

    ${alerts} =    fusion_api_get_alerts    /rest/alerts
    Log to Console    ${alerts}
    Log to Console        ${alerts}
#    Run Keyword and Continue on Failure       Should Contain       '${Alert_List}'     ${RR_BB}    Expected Error Message Not seen
    : FOR    ${BICM_NAME}    IN    @{LI_names}
    # ${finalstring}    Catenate    Hello    World
#   \    ${Al_stg_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_star}    ${ICM_Alert1_stg_str_end}
#   \    Log to Console    ${Al_stg_str}
#   \    ${alerts} =    fusion_api_get_alerts    /rest/alerts
#   \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_str}   Expected Error Message Not seen


#   \    ${Al_stg_suc}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_succ}    ${ICM_Alert1_stg_succ_end}
#   \    Log to Console    ${Al_stg_suc}
#   \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_suc}   Expected Error Message Not seen


    \    ${Al_act_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_star}    ${ICM_Alert1_act_star_end}
    \    Log to Console    ${Al_act_str}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_str}   Expected Error Message Not seen

    \    ${Al_act_succ}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_succ}    ${ICM_Alert1_act_succ_end}
    \    Log to Console    ${Al_act_succ}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_succ}  Expected Error Message Not seen


    : FOR    ${BICM_NAME}    IN    @{LI_vc_names}
    # ${finalstring}    Catenate    Hello    World
#   \    ${Al_stg_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_star}    ${ICM_Alert1_stg_star_1_end}
#   \    Log to Console    ${Al_stg_str}
#   \    ${alerts} =    fusion_api_get_alerts    /rest/alerts
#   \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_str}   Expected Error Message Not seen


#   \    ${Al_stg_suc}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_succ}    ${ICM_Alert1_stg_star_1_end}
#   \    Log to Console    ${Al_stg_suc}
#   \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_suc}   Expected Error Message Not seen


    \    ${Al_act_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_star}    ${ICM_Alert1_stg_star_1_end}
    \    Log to Console    ${Al_act_str}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_str}   Expected Error Message Not seen

    \    ${Al_act_succ}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_succ}    ${ICM_Alert1_stg_star_1_end}
    \    Log to Console    ${Al_act_succ}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_succ}  Expected Error Message Not seen

    : FOR    ${BICM_NAME}    IN    @{LI_u_vc_names}
    # ${finalstring}    Catenate    Hello    World
#   \    ${Al_stg_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_star}    ${ICM_Alert1_stg_star_2_end}
#   \    Log to Console    ${Al_stg_str}
#   \    ${alerts} =    fusion_api_get_alerts    /rest/alerts
#   \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_str}   Expected Error Message Not seen


#   \    ${Al_stg_suc}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_succ}    ${ICM_Alert1_stg_star_2_end}
#   \    Log to Console    ${Al_stg_suc}
#   \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_suc}   Expected Error Message Not seen


    \    ${Al_act_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_star}    ${ICM_Alert1_stg_star_2_end}
    \    Log to Console    ${Al_act_str}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_str}   Expected Error Message Not seen

    \    ${Al_act_succ}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_succ}    ${ICM_Alert1_stg_star_2_end}
    \    Log to Console    ${Al_act_succ}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_succ}  Expected Error Message Not seen

    Fusion Api Logout Appliance

TC07_TC14 Verify the FW Update operation (Stage + Activate) of hill and VC modules using serial mode without force flag(Upgrade)
    [Documentation]      "3.1.2 F1212_TC_API_22 and F1212_TC_API_28(G2):: Verify the FW Update operation (Stage + Activate) of hill and VC modules using serial mode without force flag(Upgarde)"
    Log to Console    Testcase_ID: TP section 1.3.1.2 API Test Cases F1212_TC_API_22 and F1212_TC_API_28(G2):  Verify the FW Update operation (Stage + Activate) of hill and VC modules using serial mode without force flag(Upgarde)
    [Tags]   Performance  firmware-condition-li_upgrade
    Fusion Api Login Appliance      ${APPLIANCE_IP}     ${admin_credentials}

    ${del_resp}=    fusion_api_delete_alert    /rest/alerts
    Log to Console       ${del_resp}

#   ${body} =   Build LI SPP body   ${Demo_New_li_spp_upgrade_serial_li_tst_higher}

    ${li_uri} =     Get LI URI   ${li}
    ${resp1} =    fusion_api_li_upgrade_firmware    body=${Demo_New_li_spp_upgrade_serial_li_tst_higher}        uri=${li_uri}
    Log to Console        ${resp1}
    ${task} =     Wait For Task    ${resp1}    199 min    5s
    Log to Console      "Hi am in validate"
    Log to Console        ${task}
    Log to Console      ${task}

    ${valDict} =    Create Dictionary   status_code=${200}
    ...                                 taskState=Completed
    Validate Response     ${task}    ${valDict}
    Log to Console  \nStage Firmware Upgrade complete
    Sleep   1 minutes 1 seconds


    Log to Console  Validate interconnect firmware version after firmwareupgrade is complete

    : FOR    ${BICM_NAME}    IN    @{LI_namesall}

    \    ${ic} =     Get IC             ${BICM_NAME}
    \    Log to Console       ${BICM_NAME}
    \    ${ic_bay_number} =    Split String   ${BICM_NAME}   ","

    \    Log to Console       ${ic_bay_number}

    \    ${ic_bay_number} =     Get From List    ${ic_bay_number}    0
    \    Log to Console       ${ic_bay_number}


    \    ${ic_bay_number} =     Get From List    ${ic_bay_number}    25
    \    Log to Console       ${ic_bay_number}
    \    ${firmwareVersion} =     Get From IC    ${ic}   firmwareVersion
    \    ${firmwareVersion_upgrade} =      verify_c7k_ic_version    ${ic_bay_number}    ${IP}
    \    ${version}=    Should Contain    ${firmwareVersion}    ${firmwareVersion_upgrade}
    \    Should Be Equal As Strings    ${firmwareVersion}       ${firmwareVersion_upgrade}
    \    Log to Console       Validated the firmvare version
    \    Log to Console       ${BICM_NAME}
    \    ${icstate} =     Get From IC    ${ic}   state
    \    Should Be Equal As Strings    ${icstate}       Configured
    \    Log to Console    Validated the ICstate for
    \    Log to Console       ${BICM_NAME}
    Log to Console    Validated the Firmware version by compare with ICM and From API
    Log to Console  \nFirmware version verification  complete

    ${alerts} =    fusion_api_get_alerts    /rest/alerts

    Log to Console        ${alerts}
#    Run Keyword and Continue on Failure       Should Contain       '${Alert_List}'     ${RR_BB}    Expected Error Message Not seen
    : FOR    ${BICM_NAME}    IN    @{LI_names}
    # ${finalstring}    Catenate    Hello    World
    \    ${Al_stg_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_star}    ${HICM_Alert1_stg_str_end}
    \    Log to Console    ${Al_stg_str}
#   \    ${alerts} =    fusion_api_get_alerts    /rest/alerts
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_str}   Expected Error Message Not seen


    \    ${Al_stg_suc}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_succ}    ${HICM_Alert1_stg_succ_end}
    \    Log to Console    ${Al_stg_suc}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_suc}   Expected Error Message Not seen


    \    ${Al_act_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_star}    ${HICM_Alert1_act_star_end}
    \    Log to Console    ${Al_act_str}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_str}   Expected Error Message Not seen

    \    ${Al_act_succ}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_succ}    ${HICM_Alert1_act_succ_end}
    \    Log to Console    ${Al_act_succ}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_succ}  Expected Error Message Not seen


    : FOR    ${BICM_NAME}    IN    @{LI_vc_names}
    # ${finalstring}    Catenate    Hello    World
    \    ${Al_stg_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_star}    ${HICM_Alert1_stg_star_1_end}
    \    Log to Console    ${Al_stg_str}
#   \    ${alerts} =    fusion_api_get_alerts    /rest/alerts
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_str}   Expected Error Message Not seen


    \    ${Al_stg_suc}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_succ}    ${HICM_Alert1_stg_star_1_end}
    \    Log to Console    ${Al_stg_suc}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_suc}   Expected Error Message Not seen


    \    ${Al_act_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_star}    ${HICM_Alert1_stg_star_1_end}
    \    Log to Console    ${Al_act_str}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_str}   Expected Error Message Not seen

    \    ${Al_act_succ}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_succ}    ${HICM_Alert1_stg_star_1_end}
    \    Log to Console    ${Al_act_succ}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_succ}  Expected Error Message Not seen

    : FOR    ${BICM_NAME}    IN    @{LI_u_vc_names}
    # ${finalstring}    Catenate    Hello    World
    \    ${Al_stg_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_star}    ${HICM_Alert1_stg_star_2_end}
    \    Log to Console    ${Al_stg_str}
#   \    ${alerts} =    fusion_api_get_alerts    /rest/alerts
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_str}   Expected Error Message Not seen


    \    ${Al_stg_suc}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_succ}    ${HICM_Alert1_stg_star_2_end}
    \    Log to Console    ${Al_stg_suc}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_suc}   Expected Error Message Not seen


    \    ${Al_act_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_star}    ${HICM_Alert1_stg_star_2_end}
    \    Log to Console    ${Al_act_str}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_str}   Expected Error Message Not seen

    \    ${Al_act_succ}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_succ}    ${HICM_Alert1_stg_star_2_end}
    \    Log to Console    ${Al_act_succ}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_succ}  Expected Error Message Not seen

    Fusion Api Logout Appliance

   ############# UPDATE FIRMWARE (STAGING + ACTIVATION ) using PARALLEL MODE ########################
TC08_TC10 Verify the FW Update operation (Stage + Activate) of hill and VC modules using parallel mode with force flag downgrade
    [Documentation]      "3.1.2 F1212_TC_API_19 and F1212_TC_API_27(G1) and F1212_TC_API_29(G2) and F1212_TC_API_61:Verify the FW Update operation (Stage + Activate) of hill and VC modules using parallel mode with force flag(G3 enclosure)(downgrade)."
    Log to Console    Testcase_ID: TP section 1.3.1.2 API Test Cases F1212_TC_API_19 and F1212_TC_API_26(G1) and F1212_TC_API_29(G2) and F1212_TC_API_61: Verify the FW Update operation (Stage + Activate) of hill and VC modules using parallel mode with force flag(G3 enclosure)(downgrade)
    [Tags]   Performance  firmware-condition-li_upgrade
    Fusion Api Login Appliance      ${APPLIANCE_IP}     ${admin_credentials}

    ${del_resp}=    fusion_api_delete_alert    /rest/alerts
    Log to Console       ${del_resp}

#   ${body} =   Build LI SPP body   ${demo_New_li_spp_downgrade_li_tst_lower_l}
#   Log to Console        ${body}
    ${li_uri} =     Get LI URI   ${li}
    ${resp1} =    fusion_api_li_upgrade_firmware     body=${demo_New_li_spp_downgrade_li_tst_lower_l}       uri=${li_uri}
    Log to Console        ${resp1}
    ${task} =       Wait For Task   ${resp1}    99 min      18s

    Log to Console        ${task}
    Log to Console      ${task}

    ${valDict} =    Create Dictionary   status_code=${200}
    ...                                 taskState=Completed
    Validate Response     ${task}    ${valDict}
    Log to Console  \nStage Firmware Upgrade complete
    Sleep   1 minutes 1 seconds


    Log to Console  Validate interconnect firmware version after firmwareupgrade is complete

    : FOR    ${BICM_NAME}    IN    @{LI_namesall}

    \    ${ic} =     Get IC             ${BICM_NAME}
    \    Log to Console       ${BICM_NAME}
    \    ${ic_bay_number} =    Split String   ${BICM_NAME}   ","

    \    Log to Console       ${ic_bay_number}

    \    ${ic_bay_number} =     Get From List    ${ic_bay_number}    0
    \    Log to Console       ${ic_bay_number}


    \    ${ic_bay_number} =     Get From List    ${ic_bay_number}    25
    \    Log to Console       ${ic_bay_number}
    \    ${firmwareVersion} =     Get From IC    ${ic}   firmwareVersion
    \    ${firmwareVersion_upgrade} =      verify_c7k_ic_version    ${ic_bay_number}    ${IP}
    \    ${version}=    Should Contain    ${firmwareVersion}    ${firmwareVersion_upgrade}
    \    Should Be Equal As Strings    ${firmwareVersion}       ${firmwareVersion_upgrade}
    \    Log to Console       Validated the firmvare version
    \    Log to Console       ${BICM_NAME}
    \    ${icstate} =     Get From IC    ${ic}   state
    \    Should Be Equal As Strings    ${icstate}       Configured
    \    Log to Console    Validated the ICstate for
    \    Log to Console       ${BICM_NAME}
    Log to Console    Validated the Firmware version by compare with ICM and From API
    Log to Console  \nFirmware version verification  complete



#   Fusion Api Login Appliance      ${APPLIANCE_IP}     ${admin_credentials}

    ${alerts} =    fusion_api_get_alerts    /rest/alerts

    Log to Console        ${alerts}
#    Run Keyword and Continue on Failure       Should Contain       '${Alert_List}'     ${RR_BB}    Expected Error Message Not seen
    : FOR    ${BICM_NAME}    IN    @{LI_names}
    # ${finalstring}    Catenate    Hello    World
    \    ${Al_stg_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_star}    ${ICM_Alert1_stg_str_end}
    \    Log to Console    ${Al_stg_str}
#   \    ${alerts} =    fusion_api_get_alerts    /rest/alerts
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_str}   Expected Error Message Not seen


    \    ${Al_stg_suc}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_succ}    ${ICM_Alert1_stg_succ_end}
    \    Log to Console    ${Al_stg_suc}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_suc}   Expected Error Message Not seen


    \    ${Al_act_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_star}    ${ICM_Alert1_act_star_end}
    \    Log to Console    ${Al_act_str}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_str}   Expected Error Message Not seen

    \    ${Al_act_succ}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_succ}    ${ICM_Alert1_act_succ_end}
    \    Log to Console    ${Al_act_succ}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_succ}  Expected Error Message Not seen


    : FOR    ${BICM_NAME}    IN    @{LI_vc_names}
    # ${finalstring}    Catenate    Hello    World
    \    ${Al_stg_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_star}    ${ICM_Alert1_stg_star_1_end}
    \    Log to Console    ${Al_stg_str}
#   \    ${alerts} =    fusion_api_get_alerts    /rest/alerts
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_str}   Expected Error Message Not seen


    \    ${Al_stg_suc}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_succ}    ${ICM_Alert1_stg_star_1_end}
    \    Log to Console    ${Al_stg_suc}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_suc}   Expected Error Message Not seen


    \    ${Al_act_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_star}    ${ICM_Alert1_stg_star_1_end}
    \    Log to Console    ${Al_act_str}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_str}   Expected Error Message Not seen

    \    ${Al_act_succ}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_succ}    ${ICM_Alert1_stg_star_1_end}
    \    Log to Console    ${Al_act_succ}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_succ}  Expected Error Message Not seen

    : FOR    ${BICM_NAME}    IN    @{LI_u_vc_names}
    # ${finalstring}    Catenate    Hello    World
    \    ${Al_stg_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_star}    ${ICM_Alert1_stg_star_2_end}
    \    Log to Console    ${Al_stg_str}
#   \    ${alerts} =    fusion_api_get_alerts    /rest/alerts
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_str}   Expected Error Message Not seen


    \    ${Al_stg_suc}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_succ}    ${ICM_Alert1_stg_star_2_end}
    \    Log to Console    ${Al_stg_suc}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_suc}   Expected Error Message Not seen


    \    ${Al_act_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_star}    ${ICM_Alert1_stg_star_2_end}
    \    Log to Console    ${Al_act_str}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_str}   Expected Error Message Not seen

    \    ${Al_act_succ}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_succ}    ${ICM_Alert1_stg_star_2_end}
    \    Log to Console    ${Al_act_succ}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_succ}  Expected Error Message Not seen

    Fusion Api Logout Appliance


     ###################### UPDATE FIRMWARE (STAGING + ACTIVATION) OddEven Mode F1212_TC_API_24  #################
TC09_TC22 Verify the FW Update operation (Stage + Activate) of hill and VC modules using Odd and Even mode without force flag (upgrade)
    [Documentation]      "3.1.2 F1212_TC_API_24 and F1212_TC_API_30(G2):: Verify the FW Update operation (Stage + Activate) of hill and VC modules using Odd and Even mode without force flag (upgrade)"
    Log to Console    Testcase_ID: TP section 1.3.1.2 API Test Cases F1212_TC_API_24 and F1212_TC_API_30(G2): Verify the FW Update operation (Stage + Activate) of hill and VC modules using Odd and Even mode without force flag (upgrade)
    [Tags]   Performance  firmware-condition-li_upgrade
    Fusion Api Login Appliance      ${APPLIANCE_IP}     ${admin_credentials}


    ${li_uri} =     Get LI URI   ${li}
    ${resp1} =    fusion_api_li_upgrade_firmware      body=${Demo_New_li_spp_upgrade_Oddevenb_li_no_flag_higher}        uri=${li_uri}
    Log to Console        ${resp1}
    ${task} =       Wait For Task   ${resp1}    120 min      18s

    Log to Console        ${task}
    Log to Console      ${task}

    ${valDict} =    Create Dictionary   status_code=${200}
    ...                                 taskState=Completed
    Validate Response     ${task}    ${valDict}
    Log to Console  \nStage Firmware Upgrade complete
    Sleep   1 minutes 1 seconds


    Log to Console  Validate interconnect firmware version after firmwareupgrade is complete

    : FOR    ${BICM_NAME}    IN    @{LI_namesall}

    \    ${ic} =     Get IC             ${BICM_NAME}
    \    Log to Console       ${BICM_NAME}
    \    ${ic_bay_number} =    Split String   ${BICM_NAME}   ","

    \    Log to Console       ${ic_bay_number}

    \    ${ic_bay_number} =     Get From List    ${ic_bay_number}    0
    \    Log to Console       ${ic_bay_number}


    \    ${ic_bay_number} =     Get From List    ${ic_bay_number}    25
    \    Log to Console       ${ic_bay_number}
    \    ${firmwareVersion} =     Get From IC    ${ic}   firmwareVersion
    \    ${firmwareVersion_upgrade} =      verify_c7k_ic_version    ${ic_bay_number}    ${IP}
    \    ${version}=    Should Contain    ${firmwareVersion}    ${firmwareVersion_upgrade}
    \    Should Be Equal As Strings    ${firmwareVersion}       ${firmwareVersion_upgrade}
    \    Log to Console       Validated the firmvare version
    \    Log to Console       ${BICM_NAME}
    \    ${icstate} =     Get From IC    ${ic}   state
    \    Should Be Equal As Strings    ${icstate}       Configured
    \    Log to Console    Validated the ICstate for
    \    Log to Console       ${BICM_NAME}
    Log to Console    Validated the Firmware version by compare with ICM and From API
    Log to Console  \nFirmware version verification  complete

    ${alerts} =    fusion_api_get_alerts    /rest/alerts

    Log to Console        ${alerts}

    : FOR    ${BICM_NAME}    IN    @{LI_names}
    # ${finalstring}    Catenate    Hello    World
    \    ${Al_stg_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_star}    ${HICM_Alert1_stg_str_end}
    \    Log to Console    ${Al_stg_str}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_str}   Expected Error Message Not seen


    \    ${Al_stg_suc}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_succ}    ${HICM_Alert1_stg_succ_end}
    \    Log to Console    ${Al_stg_suc}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_suc}   Expected Error Message Not seen


    \    ${Al_act_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_star}    ${HICM_Alert1_act_star_end}
    \    Log to Console    ${Al_act_str}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_str}   Expected Error Message Not seen

    \    ${Al_act_succ}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_succ}    ${HICM_Alert1_act_succ_end}
    \    Log to Console    ${Al_act_succ}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_succ}  Expected Error Message Not seen


    : FOR    ${BICM_NAME}    IN    @{LI_vc_names}
    # ${finalstring}    Catenate    Hello    World
    \    ${Al_stg_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_star}    ${HICM_Alert1_stg_star_1_end}
    \    Log to Console    ${Al_stg_str}
#   \    ${alerts} =    fusion_api_get_alerts    /rest/alerts
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_str}   Expected Error Message Not seen


    \    ${Al_stg_suc}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_succ}    ${HICM_Alert1_stg_star_1_end}
    \    Log to Console    ${Al_stg_suc}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_suc}   Expected Error Message Not seen


    \    ${Al_act_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_star}    ${HICM_Alert1_stg_star_1_end}
    \    Log to Console    ${Al_act_str}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_str}   Expected Error Message Not seen

    \    ${Al_act_succ}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_succ}    ${HICM_Alert1_stg_star_1_end}
    \    Log to Console    ${Al_act_succ}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_succ}  Expected Error Message Not seen

    : FOR    ${BICM_NAME}    IN    @{LI_u_vc_names}
    # ${finalstring}    Catenate    Hello    World
    \    ${Al_stg_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_star}    ${HICM_Alert1_stg_star_2_end}
    \    Log to Console    ${Al_stg_str}
#   \    ${alerts} =    fusion_api_get_alerts    /rest/alerts
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_str}   Expected Error Message Not seen


    \    ${Al_stg_suc}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_stg_succ}    ${HICM_Alert1_stg_star_2_end}
    \    Log to Console    ${Al_stg_suc}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_stg_suc}   Expected Error Message Not seen


    \    ${Al_act_str}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_star}    ${HICM_Alert1_stg_star_2_end}
    \    Log to Console    ${Al_act_str}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_str}   Expected Error Message Not seen

    \    ${Al_act_succ}    Catenate    SEPARATOR= ${BICM_NAME}    ${ICM_Alert1_act_succ}    ${HICM_Alert1_stg_star_2_end}
    \    Log to Console    ${Al_act_succ}
    \    Run Keyword and Continue on Failure       Should Contain       '${alerts}'     ${Al_act_succ}  Expected Error Message Not seen

    Fusion Api Logout Appliance

#####FInal######

###### Negative Test ===========


TC10 Verify the alert message appears when try to set firmware baseline which is same as currently installed version and dont check the force installation option in firmware update operation on LI page
    [Documentation]     "3.1 :Verify the alert message appears when try to set firmware baseline which is same as currently installed version and dont check the force installation option in firmware update operation on LI page"
    Log to Console    Testcase_ID: TP section 3.1.2 F1212_TC_API_65 --> Verify the alert message appears when try to set firmware baseline which is same as currently installed version and dont check the force installation option in firmware update operation on LI page


    Fusion Api Login Appliance      ${APPLIANCE_IP}     ${admin_credentials}

    ${del_resp}=    fusion_api_delete_alert    /rest/alerts
    Log to Console    ${del_resp}

    ${li_uri} =     Get LI URI   ${li}
    ${resp1} =     Fusion Api Li Upgrade Firmware      body=${LI_NEGATIVE_upgrade_SAMEVERSION_WITH_OUT_FLAG}       uri=${li_uri}
    Log to Console     ${resp1}
    ${task} =       Wait For Task   ${resp1}    12 min      1s
    Log to Console     ${task}


    ${valDict} =    Create Dictionary   status_code=${200}
    ...                                 taskState=Completed
    Validate Response      ${task}     ${valDict}
    Sleep   1 minutes 1 seconds

    ${alerts} =    fusion_api_get_alerts    /rest/alerts


    Run Keyword and Continue on Failure    Should Contain       '${alerts}'     ${ExpectedErrorMsgLEb1}     Expected Error Message Not seen

    Run Keyword and Continue on Failure    Should Contain       '${alerts}'     ${E_value}  Expected Error Message Not seen

    Fusion Api Logout Appliance



TC11 Verify the alert message appears when try to set firmware baseline which is less than as currently installed version and dont check the force installation option in firmware update operation on LI page
	[Documentation]        TC11 Verify the alert message appears when try to set firmware baseline which is less than as currently installed version and dont check the force installation option in firmware update operation on LI page
    Fusion Api Login Appliance      ${APPLIANCE_IP}     ${admin_credentials}

#   ${del_resp}=    fusion_api_delete_alert    /rest/alerts

    ${li_uri} =     Get LI URI   ${li}
    ${resp1} =     Fusion Api Li Upgrade Firmware    body=${lLI_NEGATIVE_DOWNGRADE_WITHOUT_FLAG}    uri=${li_uri}
    Log to Console     ${resp1}

    Sleep   1 minutes 1 seconds


#################################
   ${location} =       Get From Dictionary    ${resp1['headers']}    location
   Log To Console      HiLocation\n${location}
    ${task} =       Wait For Task    ${resp1}     20min    1s

#   Log to Console      ${task}

    ${valDict} =    Create Dictionary    status_code=${200}
    ...                                 taskState=Warning
    Validate Response    ${task}    ${valDict}

    ${parnt_uri} =     Fetch From Right    ${location}    tasks/
    ${LE_URI_task_rest} =    Catenate    SEPARATOR=${parnt_uri}    ${TAKS_VAR}    ${HH_VV}

    ${alerts} =    fusion_api_get_alerts    ${LE_URI_task_rest}

    Log To Console      Hi\n${alerts}


#   ${alerts} =       Get From Dictionary   ${alerts}  resource

    ${alerts} =       Get From Dictionary    ${alerts['taskErrors'][0]}    details

    Log to Console      AlertsBheemNEW\n${alerts}

    Run Keyword and Continue on Failure     Should Contain      '${alerts}'     ${ExpectedErrorLiMsg1}    Expected Error Message Not seen
#    Log to Console      ${ExpectedErrorLiMsg3}

    ${alerts_b} =    fusion_api_get_alerts    ${LE_URI_task_rest}

    Log To Console      HiSecondtime bb\n${alerts_b}


#   ${alerts_b} =       Get From Dictionary   ${alerts_b}  resource
#   Log to Console      AlertsBheem\n${alerts_b}
#   ${alerts} =       Get From Dictionary   ${alerts_bb['taskErrors'][0]}  details
    ${alerts_b} =       Get From Dictionary     ${alerts_b['taskErrors'][0]}     recommendedActions
    Run Keyword and Continue on Failure     Should Contain    '${alerts_b}'    ${ExpectedErrorLiMsg3}    Expected Error Message Not seen

#############################


    Run Keyword and Continue on Failure    Should Contain       '${alerts}'     ${ExpectedErrorLiMsg1}  Expected Error Message Not seen

    Run Keyword and Continue on Failure    Should Contain       '${alerts_b}'       ${ExpectedErrorLiMsg3}  Expected Error Message Not seen

    Fusion Api Logout Appliance


*** Keywords ***

Fusion Api Get Activity Alerts
    [Documentation]    Fetch recent Fusion Activity Alerts
    ...    (Assumes a Fusion REST Api connection is open and logged in).
    ...    Returns a list of Alerts.
    [Arguments]    ${Starting_AlertID}=1        ${Resource_Filter}=.*
    ${Alert_List}    Create List
    # Get the entire list of Alerts
    ${Response}    Fusion Api Get Alerts    /rest/alerts?sort=created:ascending
    ${Count}    Get From Dictionary    ${Response}    count
    Return From Keyword If    '${Count}'=='0'    msg=No alert events found

    ${Members}    Get From Dictionary    ${Response}    members
    :FOR    ${Index}    IN RANGE    0    ${Count}
    \    ${Alert}    Get From List    ${Members}    ${Index}

    \    # Select only the most recent events - skip any before that
    \    ${uri}    Get From Dictionary    ${Alert}    uri
    \    ${id}     Fetch From Right    ${uri}    /
    \    Run Keyword If    ${Starting_AlertID}>=${id}    Continue For Loop

    \    # Remember the last Alert ID encountered
    \    Set Suite Variable    ${Last_AlertID}    ${id}

    \    # Filter out any unrelated alerts
    \    ${resourceID}    Get From Dictionary    ${Alert}    resourceUri
    \    ${alertState}    Get From Dictionary    ${Alert}    alertState
    \    ${Found}    Run Keyword And Return Status
    \    ...    Should Match Regexp    ${resourceID}    ${Resource_Filter}

    \    Run Keyword If    '${Found}'=='False'    Continue For Loop

    \    # Include this alert into the 'List of Activity Events'
    \    Append to List    ${Alert_List}    ${Alert}
    Should Not Be Empty    ${Alert_List}    No Activity Events Found
    Log to Console            ${Alert_List}
    [Return]    ${Alert_List}

Fusion Api Get Activity Alerts_new
	[Documentation]        Fusion Api Get Activity Alerts_new
    [Arguments]    ${Starting_AlertID}=1        ${Resource_Filter}=.*
    ${Alert_List}    Create List
    # Get the entire list of Alerts
    ${Response}    Fusion Api Get Alerts    /rest/alerts

    [Return]    ${Response}


Validate Activity
    [Documentation]        Validate Activity
    [Arguments]    ${Alert_List}            ${Expected_Alerts}
    :FOR    ${Alert}    IN    @{Alert_List}
    \    ${uri}            Get From Dictionary      ${Alert}        uri
    \    ${alertState}     Get From Dictionary      ${Alert}        alertState
    \    ${alertTypeID}    Get From Dictionary      ${Alert}        alertTypeID
    \    ${description1}    Get From Dictionary     ${Alert}        description
    \    Log to Console       ${description1}
#    \    ${description2}    Get From Dictionary        ${Alert}        taskStatus
#   \    Run Keyword and Continue on Failure       Should Contain       '${Alert}'      ${description1}     Expected Error Message Not seen
    \    Run Keyword If     '${description1}' == '${Expected_Alerts}'       Exit For Loop
    \    ${description}    Get From Dictionary      ${Alert}        description
    \    ${uri}    Get From Dictionary      ${Alert}        uri

    \    Run Keyword     Should Not Contain Match    '${description}'       '${Expected_Alerts}'        Continue For Loop
    \    Log to console and logfile             Activity exists    '${description1}'
         [Return]    ${uri}
#        Log to Console            ${uri}

Open SSH to OA
    [Documentation]    Connect to Virtual Connect Interconnect via SSH
    #[Documentation]    Example:\n| Login to Fusion Via SSH | 10.0.12.106 | Administrator | hpvse123 |
    [Arguments]    ${IP}=${OA_CREDENTIAL_DATA['oaIpAddress']}   ${USERNAME}=${OA_CREDENTIAL_DATA['oaUsername']}    ${PASSWORD}=${OA_CREDENTIAL_DATA['oaPassword']}
    ...             ${PROMPT}=>    ${TIMEOUT}=${120}
    Log Many    ${IP}    ${USERNAME}    ${PASSWORD}    ${PROMPT}    ${TIMEOUT}
    Set Default Configuration    prompt=${PROMPT}    timeout=${TIMEOUT}
    ${Id}=    Open Connection      ${IP}
    ${Output}=    Login    ${USERNAME}    ${PASSWORD}
    ${stdout}    ${stderr}    ${rc}=    Execute Command    show interconnect info 4    return_stderr=True    return_rc=True
    ${OAVersion}=    Get Lines Containing String    ${stdout}   Firmware Ver.
     ${OAVersion}=      Fetch From Right      ${OAVersion}   :
    Log to console and logfile    \n Open SSH Connection to Onboard Administrator ${IP} ....
    Log to console and logfile    OA Firmware Ver: ${OAVersion}
    Set Suite Metadata     OA Firmware Version    ${OAVersion}
    [Return]    ${Id}  ${OAVersion}

ConnectOA_get_Firmversion
	[Documentation]        ConnectOA_get_Firmversion
    Open Connection      ${IP}
    ${output} = Login    Administrator    Admin
    ${stdout}    ${stderr}    ${rc}=    Execute Command    show interconnect info 4    return_stderr=True    return_rc=True
    Log to Console            ${stdout}
    ${OAVersion}=    Get Lines Containing String    ${stdout}   Firmware Version:
    Log to Console                ${OAVersion}
    [Return]    ${OAVersion}

Get ICS URI_ACTIVEURI
	[Documentation]        Get ICS URI_ACTIVEURI
    [Arguments]    ${ic}
    ${resp} =    Fusion Api Get Interconnect    param=?filter="'name'=='${ic}'"
    ${uri} =    Get From Dictionary    ${resp['members'][0]}    uri
    [Return]    ${uri}


Get IC URI_ACTIVE
	[Documentation]        Get IC URI_ACTIVE
    [Arguments]    ${ic}
    ${resp} =    Fusion Api Get Interconnect    param=?filter="'name'=='${ic}'"
    ${uri} =    Get From Dictionary    ${resp['members'][0]}    uri
    [Return]    ${uri}


Close SSH Connection
    [Documentation]    Exits the current SSH session
    Close Connection

Build LI SPP body
	[Documentation]        Build LI SPP body
    [Arguments]     ${li_spp}
    ${liedit} =     Copy Dictionary      ${li_spp}
    ${command} =                       Get Variable Value  ${li_spp['command']}
    ${ethernetActivationDelay} =              Get Variable Value  ${li_spp['ethernetActivationDelay']}
    ${ethernetActivationType} =              Get Variable Value  ${li_spp['ethernetActivationType']}
    ${fcActivationDelay} =              Get Variable Value  ${li_spp['fcActivationDelay']}
    ${fcActivationType} =              Get Variable Value  ${li_spp['fcActivationType']}
    ${force} =              Get Variable Value  ${li_spp['force']}
    ${sppUri} =           Get Variable Value  ${li_spp['sppUri']}





#   ${body} =   Fusion Api Create LI spp Body   command=${command}
#   ...                                         ethernetActivationDelay=${ethernetActivationDelay}
#   ...                                         ethernetActivationType=${ethernetActivationType}
#   ...                                         fcActivationDelay=${fcActivationDelay}
#   ...                                         fcActivationType=${fcActivationType}
#   ...                                         force=${force}
#   ...                                         sppUri=${sppUri}
#   ...

    ${body} =   Fusion Api Create LI spp Body   sppUri=${sppUri}
    ...                                         command=${command}
    ...                                         force=${force}
    ...                                         ethernetActivationType=${ethernetActivationType}
    ...                                         ethernetActivationDelay=${ethernetActivationDelay}
    ...                                         fcActivationType=${fcActivationType}
    ...                                         fcActivationDelay=${fcActivationDelay}
    ...
    [Return]    ${body}

Build SelectiveInterconnects SPP body
	[Documentation]        Build SelectiveInterconnects SPP body
    [Arguments]     ${li_spp}    ${selectiveinterconnecturis}
    ${liedit} =     Copy Dictionary      ${li_spp}
    ${command} =                       Get Variable Value  ${li_spp['command']}
    ${ethernetActivationDelay} =              Get Variable Value  ${li_spp['ethernetActivationDelay']}
    ${ethernetActivationType} =              Get Variable Value  ${li_spp['ethernetActivationType']}
    ${fcActivationDelay} =              Get Variable Value  ${li_spp['fcActivationDelay']}
    ${fcActivationType} =              Get Variable Value  ${li_spp['fcActivationType']}
    ${force} =              Get Variable Value  ${li_spp['force']}
    ${sppUri} =           Get Variable Value  ${li_spp['sppUri']}
    ${selectiveinterconnecturisvalue}=   Get From List    ${selectiveinterconnecturis}    0
    ${interconnects}=     Get Variable Value  ${selectiveinterconnecturisvalue['interconnects']}



    ${body} =     Create Dictionary

    Set To Dictionary     ${body}    sppUri    ${sppUri}
    Log To Console    in ${body}

    Set To Dictionary     ${body}    command    ${command}
    Set To Dictionary     ${body}    interconnects    ${interconnects}
    Set To Dictionary     ${body}    force    ${force}

    Set To Dictionary     ${body}    ethernetActivationType    ${ethernetActivationType}

    Set To Dictionary     ${body}    ethernetActivationDelay    ${ethernetActivationDelay}

    Set To Dictionary     ${body}    fcActivationType    ${fcActivationType}

    Set To Dictionary     ${body}    fcActivationDelay    ${fcActivationDelay}
    Log To Console    Body is ${body}
    [Return]    ${body}



00 Appliance LogIn
	[Documentation]        00 Appliance LogIn
    Fusion Api Login Appliance      ${APPLIANCE_IP}     ${admin_credentials}
    ${users} =  Get Variable Value  ${users}
    Run Keyword If  ${users} is not ${null}    Add Users from variable              ${users}
    ${ethernet_networks} =  Get Variable Value    ${ethernet_networks1}
    Run Keyword If  ${ethernet_networks1} is not ${null}    Add Ethernet Networks from variable ${ethernet_networks1}

00 Create LIG, create enclosure group and import enclosure
	[Documentation]        00 Create LIG, create enclosure group and import enclosure
    [Tags]  14
    ${body} =   Build LIG body      ${ligs['lig1']}
    ${resp} =   Fusion Api Create LIG   ${body}
    ${task} =   Wait For Task   ${resp}     60s 2s
    Add Enclosure Group from variable       ${enc_group}
    Add Enclosures from variable   ${encs}

00 Create server profile and ping blade
	[Documentation]        00 Create server profile and ping blade
    [Tags]  15
    Power off ALL servers
    ${profiles} =     Copy List     ${server_profiles}
    Add Server Profiles from variable   ${profiles}
    Power on server      SGH411DFYA, bay 6
    Log to console and logfile      Waiting 10 minutes for server to boot...
    Sleep   10min
    Wait For Appliance To Become Pingable   10.10.2.31



#Get IC
#   [Arguments]     ${ICM_NAME}
#    ${resp} =   fusion api get interconnect
#    Log to Console           ${resp}
#    ${ics} =     Get From Dictionary     ${resp}    members
#   ${l} =  Get Length  ${ics}
#   :FOR    ${x}    IN RANGE    0   ${l}
#    \   ${ic} =     Get From List   ${ics}    ${x}
#   \   Exit For Loop If    '${ic['name']}' == '${ICM_NAME}'
#   [Return]    ${ic}
#   Log to Console        ${ic}

Get LE
	[Documentation]        Get LE
    [Arguments]     ${LE_NAME}
    ${resp} =   fusion api get Logical Enclosure
    Log to Console        ${resp}
    ${les} =     Get From Dictionary     ${resp}    members
    ${l} =  Get Length  ${les}
    :FOR    ${x}    IN RANGE    0   ${l}
    \   ${le} =     Get From List   ${les}    ${x}
    \   Exit For Loop If    '${le['name']}' == '${LE_name}'
    [Return]    ${le}
    Log to Console        ${le}

Get from LE
	[Documentation]        Get from LE
    [Arguments]     ${le}   ${element}
    ${return} =     Get From Dictionary     ${le}   ${element}
    [Return]    ${return}



Edit LIG
	[Documentation]        Edit LIG
    [Arguments]    ${lig}    ${li}    ${LLDPIP}    ${ltlv}    ${rtlv}
    Fusion Api Login Appliance      ${APPLIANCE_IP}     ${admin_credentials}
    ${body} =   Build LIG body      ${lig}
    Log to console and logfile    ${body}
    ${lig} =        Get LIG Member      ${LIG1}
    ${lig_uri} =    Get LIG Uri         ${LIG1}
    ${resp} =   Fusion Api Edit LIG body=${body}        uri=${lig_uri}
    ${task} =   Wait For Task   ${resp}     120s
    ${valDict} =    Create Dictionary   status_code=${200}
    ...                                 taskState=Completed
    Validate Response     ${task}    ${valDict}
    Perform an Update From Group    ${li}   120 min     1 min
    ValidateLI LLDP Ip Address  ${li}   ${LLDPIP}
    ValidateLI TaggedLLDP and RICH TLV  ${li}   ${ltlv} ${rtlv}



Get IC
	[Documentation]        Get IC
    [Arguments]     ${ICM_NAME}
    ${resp} =   fusion api get interconnect
    Log to Console        ${resp}
    ${ics} =     Get From Dictionary     ${resp}    members
    ${l} =  Get Length  ${ics}
    :FOR    ${x}    IN RANGE    0   ${l}
    \   ${ic} =     Get From List   ${ics}    ${x}
    \   Exit For Loop If    '${ic['name']}' == '${ICM_NAME}'
    [Return]    ${ic}
    Log to Console        ${ic}

Validate Interconnects
    [Documentation]        Validate Interconnects
	[Arguments]     ${ICM_NAME}     ${ltlv}     ${rtlv}     ${LLDPIP}
    Log to console and logfile    Validating Interconnects for LLDP and taggedTLV and RichTLV flags
    ${ic} =     Get IC      ${ICM_NAME}
    ${enableRichTLV} =          Get From IC    ${ic}   enableRichTLV
    ${enableTaggedLldp} =       Get From IC    ${ic}   enableTaggedLldp
    ${lldpip} =             Get from IC     ${ic}       lldpIpv4Address
    Should be Equal as Strings    ${enableRichTLV}      ${rtlv}
    Should be Equal as Strings    ${enableTaggedLldp}       ${ltlv}
    Should be Equal as Strings    ${lldpip}     ${LLDPIP}

Perform an Update From Group
	[Documentation]        Perform an Update From Group
    [Arguments]     ${li}=${LE}-${LIG1} ${timeout}=5 min    ${interval}=15s
    ${li_uri} =     Get LI URI   ${li}
    ${resp} =       Fusion Api Update from group    ${li_uri}
    ${task} =       Wait For Task   ${resp}     ${timeout}      ${interval}
    ${valDict} =    Create Dictionary   status_code=${200}
    ...                                 taskState=Completed
    Validate Response     ${task}    ${valDict}

Edit LI
	[Documentation]        Edit LI
    [Arguments]     ${li}   ${li_set1}  ${LLDPIP}   ${ltlv}     ${rtlv}
    Fusion Api Login Appliance      ${APPLIANCE_IP}     ${admin_credentials}
    ${body} =   Build LI body   ${li_set1}
    ${li_uri} =     Get LI URI   ${li}
    ${resp} =   Fusion Api Get Li   ${li_uri}
    Log to Console      ${resp}
    ${es} =     Get From Dictionary     ${resp} ethernetSettings
    ${uri} =    Get From Dictionary     ${es}       uri
    ${id} =     Get From Dictionary     ${es}       id
    Log to Console        ${id}
    Set to Dictionary   ${body} id  ${id}
    Log to Console      ${body}
    ${resp1} =  Fusion Api Update LI Ethernet Settings  body=${body}        uri=${li_uri}
    Log to Console      ${resp1}
    ${task} =   Wait For Task   ${resp1}    120s
    ${valDict} =    Create Dictionary   status_code=${200}
    ...                                 taskState=Completed
    Validate Response     ${task}    ${valDict}
    ValidateLI LLDP Ip Address  ${li}   ${LLDPIP}
    ValidateLI TaggedLLDP and RICH TLV  ${li}   ${ltlv} ${rtlv}

Build LI body
	[Documentation]        Build LI body
    [Arguments]     ${liedit}
    ${liedit} =     Copy Dictionary ${liedit}
    ${type} =                       Get Variable Value  ${liedit['type']}
    ${enableRichTLV} =           Get Variable Value  ${liedit['enableRichTLV']}
    ${enableTaggedLldp} =              Get Variable Value  ${liedit['enableTaggedLldp']}


    ${body} =   Fusion Api Create LI Settings Payload   type=${type}
    ...                                         enableRichTLV=${enableRichTLV}
    ...                                         enableTaggedLldp=${enableTaggedLldp}
    ...
    [Return]    ${body}

SSH to host and ping x
    [Documentation]    SSH's to a given host, then pings an IP from that host
    [Arguments]        ${HOST}    ${HOST2}
    Open Connection And Log In      ${HOST}
    ${Output}=    Execute Command    ping -c 4 ${HOST2}    return_stdout=True    return_rc=False
    Log to console and logfile    ${Output}
    Should Contain    ${Output}    ttl=
    Close All Connections

Add LIG from variable
    [Documentation]    Adds an LIG to an appliance from a variable which contains a list of dicts with the entire payload
    [Arguments]     ${ligx}
    Log to Console        Adding LIG ${ligx}
    ${ligx} =   Copy Dictionary ${ligs['${ligx}']}

    ${name} =                       Get Variable Value  ${ligx['name']}
    ${enclosureIndexes} =           Get Variable Value  ${ligx['enclosureIndexes']}
    ${enclosureType} =              Get Variable Value  ${ligx['enclosureType']}
    ${ethernetSettings} =           Get Variable Value  ${ligx['ethernetSettings']}
    ${fcoeSettings} =               Get Variable Value  ${ligx['fcoeSettings']}
    ${internalNetworkUris} =        Get Variable Value  ${ligx['internalNetworkUris']}
    ${interconnectBaySet} =         Get Variable Value  ${ligx['interconnectBaySet']}
    ${interconnectMapTemplate} =    Get Variable Value  ${ligx['interconnectMapTemplate']}
    ${qosConfiguration} =           Get Variable Value  ${ligx['qosConfiguration']}
    ${redundancyType} =             Get Variable Value  ${ligx['redundancyType']}
    ${stackingMode} =               Get Variable Value  ${ligx['stackingMode']}
    ${telemetryConfiguration} =     Get Variable Value  ${ligx['telemetryConfiguration']}
    ${snmpConfiguration} =          Get Variable Value  ${ligx['snmpConfiguration']}
    ${uplinkSets} =                 Get Variable Value  ${ligx['uplinkSets']}
    #${uplinkSets} =    Copy List   ${ligx['uplinkSets']}
    ${l} =  Get Length  ${uplinkSets}


    :FOR    ${x}    IN RANGE    0   ${l}
    \   ${networkType} =    Get From Dictionary     ${uplinkSets[${x}]} networkType
    \   ${networks} =       Get From Dictionary     ${uplinkSets[${x}]} networkUris
    \   ${nativeNetworkUri} =   Get Variable Value     ${uplinkSets[${x}]['nativeNetworkUri']}
    \   Run Keyword If  '${networkType}' == 'FibreChannel'  Continue For Loop
    #\  ${networkUris} =    Get FCoE Uris   ${networks}
    #\   ${ethernetUris} =   Get Ethernet URIs   ${networks}
    #\   ${networkUris} =    combine lists   ${networkUris}  ${ethernetUris}
    \   ${networkUris} =    Get Ethernet URIs   ${networks}
    \   Set to dictionary   ${uplinkSets[${x}]} networkUris     ${networkUris}
    \   ${nativeNetworkUri} =   Run Keyword If   '${nativeNetworkUri}' != 'None'    Get Ethernet Uri    ${nativeNetworkUri}
    \   Set to dictionary   ${uplinkSets[${x}]} nativeNetworkUri     ${nativeNetworkUri}


    Log to Console      ${uplinkSets}
    ${body} =   Fusion Api Create LIG Payload   name=${name}
    ...                                         enclosureType=${enclosureType}
    ...                                         ethernetSettings=${ethernetSettings}
    ...                                         interconnectMapTemplate=${interconnectMapTemplate}
    ...                                         stackingMode=${stackingMode}
    ...                                         telemetryConfiguration=${telemetryConfiguration}
    ...                                         snmpConfiguration=${snmpConfiguration}
    ...                                         uplinkSets=${uplinkSets}

    ${resp} =   Fusion Api Create LIG   ${body}
    ${task} =   Wait For Task   ${resp}     60s    2s
    ${liguri} =     Get From Dictionary ${task['associatedResource']}   resourceUri
    [Return]    ${resp}

OA CLI EFUSE
    [Documentation]    issues an EFUSE Action to the given Device\Bay.
    ...   {DEVICE} = <BLADE|IOM|NETTRAY|SWM|FAN|OA|EM>
    ...   {BAY} = desired bay for given device
    ...   {ACTION} = <ON|OFF>
    [Arguments]        ${OA_HOST}    ${OA_USER}     ${OA_PASS}    ${DEVICE}    ${BAY}    ${ACTION}
    Open Connection     ${OA_HOST}     prompt=OA-    timeout=20s
    Login               ${OA_USER}     ${OA_PASS}
    Write    ++diag--
    Read Until    diag>
    Write    efuse ${DEVICE} ${BAY} ${ACTION}
    Write    q
    Close All Connections

#FTS
    #Set Log Level  DEBUG
    #Get VM IP   ${VM}
    #First Time Setup                   password=hpvse123

Test Specific Setup
	[Documentation]        Test Specific Setup
    Set Log Level   TRACE
    Run Keyword and Ignore Error    Write To ciDebug Log
    Log to console and logfile  [TEST-SPECIFIC SETUP]
    Fusion Api Login Appliance      ${APPLIANCE_IP}     ${admin_credentials}
    ${users} =  Get Variable Value  ${users}
    Run Keyword If  ${users} is not ${null}    Add Users from variable              ${users}
    ${ethernet_networks} =  Get Variable Value    ${ethernet_networks}
    Run Keyword If  ${ethernet_networks} is not ${null}    Add Ethernet Networks from variable  ${ethernet_networks}
    #${ethernet_ranges} =   Get Variable Value  ${ethernet_ranges}
    #Run Keyword If ${ethernet_ranges} is not ${null}       Run Keyword for List    ${ethernet_ranges}  Create Ethernet Range
    #${fc_networks} =   Get Variable Value  ${fc_networks}
    #Run Keyword If ${fc_networks} is not ${null}    Add FC Networks from variable      ${fc_networks}
    #${fcoe_networks} = Get Variable Value  ${fcoe_networks}
    #Run Keyword If ${fcoe_networks} is not ${null}    Add FCoE Networks from variable      ${fcoe_networks}
    #${licenses} =  Get Variable Value  ${licenses}
    #Run Keyword If ${licenses} is not ${null}      Add Licenses from variable      ${licenses}
    #Login all users     ${users}

Run FTS and test-specific setup
    [Documentation]        Run FTS and test-specific setup
	Set Log Level   TRACE
    #FTS
    Test Specific Setup
