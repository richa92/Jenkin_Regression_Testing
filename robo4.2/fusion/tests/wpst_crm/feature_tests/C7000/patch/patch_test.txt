*** Settings ***
Documentation		Robustness: Patch test 
...
...		
Variables 		    data_variables.py		
Suite Setup   		VM setup       ${VM}
Suite Teardown		Suite Teardown   	

Resource			resource.txt   

Library				Collections

*** Test Cases ***
Patch Test
	Set Log Level	TRACE
	:FOR	${x}	IN RANGE	0	 2
	\ 	Revert VM To Named Snapshot 	${VM}		oob-snapshot
	\	Power On VM 	${VM}
	\	Sleep	2 min
	\	${IPS} = 	Get VM IPv4 Addresses	${VM}
	\	${APPLIANCE_IP} = 	Get From List	${IPS}	0
	\ 	First Time Setup	password=hpvse123
	\	Fusion Api Login Appliance 		${APPLIANCE_IP}		${admin_credentials}
	\	${resp} =		Fusion Api Upload Appliance Firmware	localfile=c:\\HPOneVIew-sparseupdate-1.10.07-SNAPSHOT-104927.bin
	\	${valDict} = 	Create Dictionary	status_code=${rc['200']}
	\	Validate Response	${resp}	${valDict}
	\	Fusion Api Upgrade Appliance Firmware	localfile=HPOneVIew-sparseupdate-1.10.07-SNAPSHOT-104927.bin	
	\	Wait For Appliance To Be Ready
	\	Fusion Api Get Appliance Firmware Upgrade Status
	\	${valDict} = 	Create Dictionary	status_code=${rc['200']}	success=${true}
	\	Validate Response	${resp}	${valDict}	

	
*** Keywords ***
test
	Set Log Level	TRACE
	Fusion Api Login Appliance 		15.199.234.44		${admin_credentials}
	#Fusion Api Upload Appliance Firmware	localfile=c:\\HPOneVIew-sparseupdate-1.10.07-SNAPSHOT-104927.bin	
	Fusion Api Get Appliance Firmware Upgrade Status	


VM setup
	[Arguments]		${VM}
	Set Log Level	TRACE
	Log to console and logfile	[VM SETUP]
	# Log into vCenter Server	
	${resp} = 	Connect to VI Server	15.199.229.100	rbriggs	hpvse1
	# Take snapshot of VM
	Create VM Snapshot	${VM}	oob-snapshot	True	True

	
