*** Settings ***
Documentation		tears down my dev enclosure 
...
...		
Variables 		    data_variables.py
Resource            ../../../../resource/fusion_api_all_resource_files.txt
Library				Collections

Test Setup       Common Test Setup
Test Teardown    Common Test Teardown

*** Variables ***
${FULLTEARDOWN}                    ${False}

*** Test Cases ***
Teardown
    Teardown appliance

*** Keywords ***
Teardown appliance
	[Documentation]	Querys the appliance for resources and removes them
	Set Log Level	TRACE
	Power off ALL Servers
	Remove All Server Profiles
	Remove All Server Profile Templates
	Remove ALL LS
	Remove ALL LSGs
    ${type} =    Get enclosure type
    Run Keyword If 	'${type}' == 'C7000'    Remove ALL Enclosures
    Run Keyword If 	'${type}' == 'SY12000'    Remove ALL Logical Enclosures
	Remove ALL Enclosure Groups
	Remove ALL LIGs
	Remove ALL SAS LIGs
    Return from keyword if   ${FULLTEARDOWN} is ${False}
	Remove ALL Ethernet Networks
	Remove ALL FC Networks
	Remove ALL FCoE Networks
	Remove ALL Network Sets
	Remove ALL Users

Get Errors
    [Documentation]     ...
    ${ERRORS}=   Run Keyword and Ignore Error    Get from ciDebug Log     ...

Common Test Setup
    [Documentation]    Pre-conditions for ALL test cases
    Set Log Level    TRACE
    Run Keyword and Ignore Error    Write To ciDebug Log
    Fusion Api Login Appliance         ${APPLIANCE_IP}        ${admin_credentials}

Common Test Teardown
    [Documentation]    Post-conditions for ALL test cases
    fusion api logout appliance
    Run Keyword If    '${TEST_STATUS}' == 'FAIL'   Get Errors


Remove All Server Profile Templates
	[Documentation]	Querys the appliance for all Server Profile Templates and then removes them
	...             Updated to return -${resplist}, helps Async deletion.
	...   			Handle the response list in the test case using "Run Keyword for List with kwargs  ${responses}  Wait For Task2   timeout=600    interval=5"
	Log to console and logfile  	Removing SERVER PROFILE TEMPLATES
	${resplist} = 	Create List
	${profile_templates} = 	Fusion Api Get Server Profile Templates  param=?sort=name:ascending
    ${count}=            Convert To String  ${profile_templates['count']}
    Run Keyword If  '${count}'=='0'    Log   Server Profile doesn't Exists     WARN
	:FOR	${profile_template}	IN	@{profile_templates['members']}
	\		${resp} = 	Fusion Api Delete Server Profile Template		uri=${profile_template['uri']}
	\		append to list		${resplist}	${resp}
	[return]	${resplist}

Get enclosure type
    [Documentation]     ...
    ${encs} =    Fusion API Get Enclosures
    ${enctype} =   set variable     ${null}
	:FOR	${enc}	IN	@{encs['members']}
	\		${enctype} =    Get From Dictionary   ${enc}   enclosureType
    [Return]   ${enctype}
