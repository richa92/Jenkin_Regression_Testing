*** Settings ***
Documentation     This testsuite is intended to commonize applicable blocking ALM's Limitations Testcases.
...               = Usage =
...               cmdline: pybot -d ../logs  --timestampoutputs -t <target test case> <target test file>
# This test suite covers the following testcases in ALM:
#    3.5.7 Already Monitered by OneView

Library               RoboGalaxyLibrary
Library               FusionLibrary
Library               ../lib/WPSTUtil.py

Variables             ../resources/defaults.py
Variables             ../resources/credentials_wpst.py   Austin4
Force Tags            Austin4

Resource              ../resources/keywords.txt

Suite Setup                     Suite Setup Tasks
Test Setup                      Test Setup Tasks

*** Variables ***

*** Test Cases ***
TC0
    [Tags]   CleanOV.CleanVC
    CleanOV
    CleanVC

TC1-3.5.7--Already Monitered by OneView
    [Documentation]   Import enclosure as monitored
    ${enc} =    Create Dictionary    hostname=${OA_CREDENTIAL_DATA['oaIpAddress']}   username=${OA_CREDENTIAL_DATA['oaUsername']}   password=${OA_CREDENTIAL_DATA['oaPassword']}   licensingIntent=OneViewStandard   force=${False}   state=Monitored
    ${resp} =   Fusion Api Add Enclosure   ${enc}
    ${OVAVersion}   ${OVXAPIVersion}   Get OneView Appliance And Api Versions
    ${returnStatus}  ${returnValue}=   Run Keyword If  ${OVXAPIVersion} >= ${newMigrRespMinXAPIVersion}   Run Keyword and Ignore Error   Wait For MigratableVcDomainV300 Task and Fail On Error   ${resp}     ${timeout}     10 s
    ...         ELSE   Run Keyword and Ignore Error   Wait For Task and Fail On Error   ${resp}     20min     10 s

    Import VC

    # [Documentation]   Validate error code and severity
    ${validation}     Create Dictionary   errorCode=GENERAL_ENCLOSURE_ALREADY_MONITORED
    ...                                   level=Critical
    ...                                   recommendation=Remove the monitored enclosure from OneView before retrying the migration.
    Validate Detail Report If General Issue Exists    incompatibilities/migrationGeneralIssues/issues    errorCode   ${validation}

