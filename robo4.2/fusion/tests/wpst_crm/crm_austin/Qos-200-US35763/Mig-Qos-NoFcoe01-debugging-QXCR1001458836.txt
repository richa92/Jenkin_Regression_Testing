*** Settings ***
Documentation     VC to OV Migration QoS  -- without FCoE

Library           RoboGalaxyLibrary
Library           FusionLibrary
Library           ../lib/WPSTUtil.py

Variables                       ../resources/defaults.py
Variables                       ../resources/credentials_wpst.py   Austin3

Resource                        ../resources/keywords.txt
Suite Setup                     Suite Setup Tasks
Suite Teardown                  Suite Teardown Tasks    ${grepDefaultString2}
Test Setup                      Test Setup Tasks

*** Variables ***
${vc_config_file1}     config/vc_austin3_Qos-NoFcoe01-NewLIG.txt
${vc_config_file2}     config/vc_austin3_Qos-NoFcoe01a-ExistingLIG.txt
${vc_config_file3}     config/vc_austin3_Qos-NoFcoe01b-ExistingLIG.txt
@{delResList}                   server-profiles   enclosures
@{ignoreL}          status


*** Test Cases ***
1--Reconfig VC
    :FOR  ${i}  IN RANGE  0  999
    \    Delete VC Domain
    \    Import.ConfigVC    ${vc_config_file3}
    \    ${validation_unmatch_qosDot1pMappingInactive}   Create Dictionary   errorCode=FAIL_TO_MATCH_QOS_DOT1P_MAPPING_INACTIVE
    \    ...                                 level=High
    \    ...                                 key=qosDot1pMappingInactive
    \    ${validation_unmatch_qosDSCPMappingInactive}   Create Dictionary   errorCode=FAIL_TO_MATCH_QOS_DSCP_MAPPING_INACTIVE
    \    ...                                 level=High
    \    ...                                 key=qosDSCPMappingInactive
    \    Validate Detail Report with Existing EG If General Issues Exists       allMigrationIssues   EG_2S1320P2RW   errorCode
    \    ...                 ${validation_unmatch_qosDot1pMappingInactive}
    \    ...                 ${validation_unmatch_qosDSCPMappingInactive}

2a--Debugging QXCR1001458836 - Get OA show All
    ${showAll} =   WPST Execute Oacli Command   ${OA_CREDENTIAL_DATA}   show all

2b--Debugging QXCR1001458836 - Get OVA support dump
    ${body} =   Create Dictionary   encrypt=${false}   errorCode=CI
    ${response} =   Fusion Api Create Support Dump   ${body}
    ${uri} =   Get From Dictionary   ${response}   uri
    ${response} =   Fusion Api Download Support Dump   uri=${uri}   localfile=QXCR1001458836-Austin2/applianceSupportDump.sdmp

2c--Debugging QXCR1001458836 - Get OA show syslog
    ${showSyslog} =   WPST Execute Oacli Command   ${OA_CREDENTIAL_DATA}   show syslog oa 1

3--Retry
    :FOR  ${i}  IN RANGE  0  999
    \    ${validation_unmatch_qosDot1pMappingInactive}   Create Dictionary   errorCode=FAIL_TO_MATCH_QOS_DOT1P_MAPPING_INACTIVE
    \    ...                                 level=High
    \    ...                                 key=qosDot1pMappingInactive
    \    ${validation_unmatch_qosDSCPMappingInactive}   Create Dictionary   errorCode=FAIL_TO_MATCH_QOS_DSCP_MAPPING_INACTIVE
    \    ...                                 level=High
    \    ...                                 key=qosDSCPMappingInactive
    \     ${status}   ${Output}=   Run Keyword And Ignore Error    Validate Detail Report with Existing EG If General Issues Exists       allMigrationIssues   EG_2S1320P2RW   errorCode
    \    ...                 ${validation_unmatch_qosDot1pMappingInactive}
    \    ...                 ${validation_unmatch_qosDSCPMappingInactive}
    \    Run Keyword If   "${status}" == "FAIL"   Sleep 2 min
    \    ...         ELSE    Fail   msg=Successfully retried 

