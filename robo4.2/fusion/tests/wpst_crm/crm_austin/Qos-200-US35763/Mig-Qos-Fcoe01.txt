*** Settings ***
Documentation     VC to OV Migration QoS  -- with FCoE
...               Covers the following test cases in ALM: 
...                 The following are under 4.1.4.1 Migrate to a new enclosure group (no existing LIG) in WPST F678 VCMigration2.0 Test Plan document:
...                   17434 - [1]QoS Configuration Type - Custom (with FCoE Lossless) - RealTime is selected, all traffic classes are Enabled, same Classification for uplinks and downlinks
...                   17436 - [1]QoS Configuration Type . Custom (with FCoE Lossless) . RealTime is selected, some traffic classes are Disabled, same Classification for uplinks and downlinks
...                   17435 - [1]QoS Configuration Type . Custom (with FCoE Lossless) . RealTime is unselected, some traffic classes are Disabled, different Classification for uplinks and downlinks
...
...                 The following are under 4.1.4.10 Migrate to an existing enclosure group (with existing LIG) in WPST F678 VCMigration2.0 Test Plan document:
...                   17441 - QoS Configuration Type . Custom (with FCoE Lossless) . RealTime is selected, all traffic classes are Enabled, same Classification for uplinks and downlinks (Active)
...                   17477 - QoS Configuration Type . Custom (with FCoE Lossless) . RealTime is selected, all traffic classes are Enabled, same Classification for uplinks and downlinks (Inactive)
...                   17442 - [1]QoS Configuration Type . Custom (with FCoE Lossless) . RealTime is unselected, some traffic classes are Disabled, different Classification for uplinks and downlinks (Active)
...                   17478 - [1]QoS Configuration Type . Custom (with FCoE Lossless) . RealTime is unselected, some traffic classes are Disabled, different Classification for uplinks and downlinks (Inactive)
...                   [NOTE: Also in Mig-Qos-NoFcoe01.txt, Mig-Qos-PassThru01.txt] 17445 - [1]Verify error when one or more traffic classes are present in VC but not in the LIG (Active configuration)
...                   [NOTE: Also in Mig-Qos-NoFcoe01.txt, Mig-Qos-PassThru01.txt] 17483 - [1]Verify error when one or more traffic classes are present in VC but not in the LIG (Inactive configuration)
...                   [NOTE: Also in Mig-Qos-NoFcoe01.txt, Mig-Qos-PassThru01.txt] 17446 - [1]Verify error when one or more traffic classes are present in LIG but not in VC (Active configuraton)
...                   [NOTE: Also in Mig-Qos-NoFcoe01.txt, Mig-Qos-PassThru01.txt] 17482 - [1]Verify error when one or more traffic classes are present in LIG but not in VC (Inactive configuraton)
...                   [NOTE: Also in Mig-Qos-NoFcoe01.txt, Mig-Qos-PassThru01.txt] 17447 - [1]Verify error when traffic class contains different attribute values between VC and the LIG (Active configuraton)
...                   [NOTE: Also in Mig-Qos-NoFcoe01.txt, Mig-Qos-PassThru01.txt] 17484 - [1]Verify error when traffic class contains different attribute values between VC and the LIG (Inactive configuraton)
...                   [NOTE: Also in Mig-Qos-NoFcoe01.txt, Mig-Qos-PassThru01.txt] 17448 - [1]Verify error when Classification for uplinks setting is different between VC and the LIG (Active configuraton)
...                   [NOTE: Also in Mig-Qos-NoFcoe01.txt, Mig-Qos-PassThru01.txt] 17481 - [1]Verify error when Classification for uplinks setting is different between VC and the LIG (Inactive configuraton)
...                   [NOTE: Also in Mig-Qos-NoFcoe01.txt, Mig-Qos-PassThru01.txt] 17449 - [1]Verify error when Classification for downlinks setting is different between VC and the LIG (Active configuraton)
...                   [NOTE: Also in Mig-Qos-NoFcoe01.txt, Mig-Qos-PassThru01.txt] 17480 - [1]Verify error when Classification for downlinks setting is different between VC and the LIG (Inactive configuraton)
...                   [NOTE: Also in Mig-Qos-NoFcoe01.txt, Mig-Qos-PassThru01.txt] 17450 - [1]Verify error when Traffic Classes having different DOT1P mappings between VC and the LIG (Active configuraton)
...                   [NOTE: Also in Mig-Qos-NoFcoe01.txt, Mig-Qos-PassThru01.txt] 17485 - [1]Verify error when Traffic Classes having different DOT1P mappings between VC and the LIG (Inactive configuraton)
...                   [NOTE: Also in Mig-Qos-NoFcoe01.txt, Mig-Qos-PassThru01.txt] 17451 - [1]Verify error when Traffic Classes having different DSCP mappings between VC and the LIG (Active configuraton)
...                   [NOTE: Also in Mig-Qos-NoFcoe01.txt, Mig-Qos-PassThru01.txt] 17486 - [1]Verify error when Traffic Classes having different DSCP mappings between VC and the LIG (Inactive configuraton)
...
...               Note: Configuration for without FCoE Lossless is inactive, domain has network and profile


Library           RoboGalaxyLibrary
Library           FusionLibrary
Library           ../lib/WPSTUtil.py

Variables                       ../resources/defaults.py
Variables                       ../resources/credentials_wpst.py   Austin3
Force Tags                      OV200   QOS   Austin3

Resource                        ../resources/keywords.txt
Suite Setup                     Suite Setup Tasks
Suite Teardown                  Suite Teardown Tasks    ${grepDefaultString2}
Test Setup                      Test Setup Tasks

*** Variables ***
${vc_config_file1}     config/vc_austin3_Qos-Fcoe01-NewLIG.txt
${vc_config_file2}     config/vc_austin3_Qos-Fcoe01a-ExistingLIG.txt
${vc_config_file3}     config/vc_austin3_Qos-Fcoe01b-ExistingLIG.txt
@{delResList}                   server-profiles   enclosures
@{ignoreL}          status   iscsiInitiatorName


*** Test Cases ***
TC001--CleanOV
    [Tags]   CleanOV
    CleanOV

TC002--CleanVC
    [Tags]   CleanVC
    CleanVC

TC300--Config VC
    Import.ConfigVC    ${vc_config_file1}

TC301--Test report against new LIG
    Report.Write.Compare
    Set Suite Variable    ${DATA_RPT_301}   ${DATA_OV}

TC301--Migrate
    Migrate       runReport=${True}
    GetOVResources.Write.Compare   ignoreList=${ignoreL}

TC310--Reconfig VC
    Delete OneView Selected    ${delResList}
    Import.ConfigVC    ${vc_config_file2}

TC311--Validate errorCode in detail report (active config is modified)
    ${validation_unmatch_qosTrafficClass}   Create Dictionary   errorCode=FAIL_TO_MATCH_QOS_TRAFFIC_CLASS_CONFIGURATION
    ...                                 level=Critical
    ...                                 key=qosTrafficClass
    ${validation_unmatch_qosDot1pMapping}   Create Dictionary   errorCode=FAIL_TO_MATCH_QOS_DOT1P_MAPPING
    ...                                 level=Critical
    ...                                 key=qosDot1pMapping
    ${validation_unmatch_qosDSCPMapping}   Create Dictionary   errorCode=FAIL_TO_MATCH_QOS_DSCP_MAPPING
    ...                                 level=Critical
    ...                                 key=qosDSCPMapping
    Validate Detail Report with Existing EG If General Issues Exists       allMigrationIssues   EG_2S1320P2RW   errorCode
    ...                 ${validation_unmatch_qosTrafficClass}
    ...                 ${validation_unmatch_qosDot1pMapping}
    ...                 ${validation_unmatch_qosDSCPMapping}

TC311b--Compare compatiblity report (active config is modified)
    Report.Write.Compare      ${EMPTYLIST}  ${OAVC_CREDENTIALS}   ${EMPTYLIST}   ${True}   EG_2S1320P2RW

TC320--Reconfig VC
    Delete VC Domain
    Import.ConfigVC    ${vc_config_file3}

TC321--Validate errorCode in detail report (inactive config is modified)
    ${validation_unmatch_qosTrafficClassInactive}   Create Dictionary   errorCode=FAIL_TO_MATCH_QOS_TRAFFIC_CLASS_CONFIGURATION_INACTIVE
    ...                                 level=High
    ...                                 key=qosTrafficClassInactive
    ${validation_unmatch_qosTrafficClassNotFoundInactive}   Create Dictionary   errorCode=FAIL_QOS_CLASS_DOES_NOT_EXIST_INACTIVE
    ...                                 level=High
    ...                                 key=qosTrafficClassNotFoundInactive
    ${validation_unmatch_qosClassificationTypeInactive}   Create Dictionary   errorCode=FAIL_TO_MATCH_QOS_CLASSIFICATION_TYPE_INACTIVE
    ...                                 level=High
    ...                                 key=qosClassificationTypeInactive
    Validate Detail Report with Existing EG If General Issues Exists       allMigrationIssues   EG_2S1320P2RW   errorCode
    ...                 ${validation_unmatch_qosTrafficClassInactive}
    ...                 ${validation_unmatch_qosTrafficClassNotFoundInactive}
    ...                 ${validation_unmatch_qosClassificationTypeInactive}

TC322--Test report against existing LIG
    Report.Write.Compare      ${EMPTYLIST}  ${OAVC_CREDENTIALS}  ${EMPTYLIST}  ${True}   EG_2S1320P2RW
    Set Suite Variable    ${DATA_RPT_322}   ${DATA_OV}

TC322--Migrate
    Migrate    runReport=${True}
    GetOVResources.Write.Compare       ignoreList=${ignoreL}

TC323--Verify modified inactive config not get into OV
    Compare All with Expected    ${DATA_RPT_301}   ${DATA_RPT_322}   ${ignoreL}

