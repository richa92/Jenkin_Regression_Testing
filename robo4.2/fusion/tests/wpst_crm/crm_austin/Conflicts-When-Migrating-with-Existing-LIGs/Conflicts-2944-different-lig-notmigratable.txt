*** Settings ***
Documentation     
...    Covers the following testcases:
...              :3.5.5.12 Different LIG where Ethernet Network configuration does not match
...              :3.5.5.13 Different LIG where FC Network configuration does not match
...    Note: Update the Uplink ports X*, fabric ports, EG, LIG name when the test is moved into production environment
Library           RoboGalaxyLibrary
Library           FusionLibrary
Library           ../lib/WPSTUtil.py

Variables                       ../resources/defaults.py
Variables                       ../resources/credentials_wpst.py   Austin5
Force Tags                      Austin5
Resource                        ../resources/keywords.txt
Suite Setup                     Suite Setup Tasks
Test Setup                      Test Setup Tasks

*** Variables ***
${vc_config_file_1}     config/Conflicts-Existing-lig-cases-config.txt
${vc_config_file_2}     config/Conflicts-Existing-lig-cases-mismatch-config.txt
${uniqueValidationKey}   message

*** Test Cases ***
DifferentLIG-cases--Test Compatibility
    [Documentation]     Configuring different LIG in OV and doing VC config
    CleanOV.CleanVC
    Import.ConfigVC    ${vc_config_file_1}    
    Report.Write.Compare
        
DifferentLIG-cases--Migrate
    [Documentation]     Configuring different LIG in OV and doing VC config
    Migrate
    GetOVResources.Write.Compare
        
3.5.5.12--Different LIG where Ethernet Network configuration does not match
    [Tags]   OV300
    [Documentation]     US31298 Validate and Translate networks where existing OneView networks or limits may collide
    Remove All Server Profiles
    Remove All Enclosures
    ${OVAVersion}   ${OVXAPIVersion}   Get OneView Appliance And Api Versions
    ${response} =   Run Keyword If   ${OVAVersion} >= 300   Set LIG    LIG_2S1420PBPH_1   ROOT   name=LIG_USE12345XP
    ...                         ELSE   Set LIG    LIG_2S1420PBPH   ROOT   name=LIG_USE12345XP
    ${task} =   Wait For Task and Fail On Error  ${response}
    CleanVC
    ##Importing mismatch config file to VC
    Import.ConfigVC    ${vc_config_file_2}
    ##Running test compatibility againt EG_2S1420PBPH
    ${validation_network_mismatch}   Create Dictionary   errorCode=FAIL_TO_MATCH_CONFIGURATION
    ...                                  level=Critical
    ...                                  message=The selected enclosure's Virtual Connect configuration does not match logical interconnect group \"LIG_USE12345XP\". The following element(s) are inconsistent: UplinkSet Net3 attribute(s) do not match: Port different Enclosure 1, Bay 2, Port X2,Port not found Enclosure 1, Bay 1, Port X4.
    ${validation_uplink_mismatch}   Create Dictionary   errorCode=FAIL_TO_MATCH_UPLINK_CONFIGURATION
    ...                                  level=Critical
    ...                                  message=The selected enclosure's Virtual Connect configuration does not match the selected OneView logical interconnect group \"LIG_USE12345XP\". The follow uplinkset \"Private\" from existing logical interconnect group \"LIG_USE12345XP\" are not present in the Virtual Connect configuration. They must match in size, name, and configuration.
    ${validation_uplink_not_found}   Create Dictionary   errorCode=FAIL_TO_MATCH_UPLINK_NOT_FOUND
    ...                                  level=Critical
    ...                                  message=The selected enclosure's Virtual Connect configuration does not match the selected OneView logical interconnect group \"LIG_USE12345XP\". The uplinkset \"Net4,Net5,Net_1001,Net_1002\" from the Virtual Connect configuration did not match one in the existing logical interconnect group \"LIG_USE12345XP\". They must match in name, number of uplinks, and configuration.
    ${validation_smartlink_mismatch}   Create Dictionary   errorCode=FAIL_TO_MATCH_CONFIGURATION
    ...                                  level=Critical
    ...                                  message=The selected enclosure's Virtual Connect configuration does not match logical interconnect group \"LIG_USE12345XP\". The following element(s) are inconsistent: Network Network_316 attribute(s) do not match: Smart Link.
    ${validation_bandwidth_mismatch}   Create Dictionary   errorCode=FAIL_TO_MATCH_CONFIGURATION
    ...                                  level=Medium
    ...                                  message=The selected enclosure's Virtual Connect configuration does not match logical interconnect group \"LIG_USE12345XP\". The following element(s) are inconsistent: Network Net1 attribute(s) do not match: Typical Bandwidth,Maximum Bandwidth.
    ${validation_vlan_pvtntwk_mismatch}   Create Dictionary   errorCode=FAIL_TO_MATCH_CONFIGURATION
    ...                                  level=Critical
    ...                                  message=The selected enclosure's Virtual Connect configuration does not match logical interconnect group \"LIG_USE12345XP\". The following element(s) are inconsistent: Network Net1 attribute(s) do not match: VLAN Id,Private Network.
    ${validation_vlan_mismatch}   Create Dictionary   errorCode=FAIL_TO_MATCH_CONFIGURATION
    ...                                  level=Critical
    ...                                  message=The selected enclosure's Virtual Connect configuration does not match logical interconnect group \"LIG_USE12345XP\". The following element(s) are inconsistent: Network Net2 attribute(s) do not match: VLAN Id.
    ${validation_type_mismatch}   Create Dictionary   errorCode=FAIL_TO_MATCH_CONFIGURATION
    ...                                  level=Critical
    ...                                  message=The selected enclosure's Virtual Connect configuration does not match logical interconnect group \"LIG_USE12345XP\". The following element(s) are inconsistent: Network Net3 attribute(s) do not match: Ethernet Network Type,Smart Link.
    ${validation_failover_enet_network}   Create Dictionary   errorCode=FEATURE_ISSUE_NETWORK_NO_UPLINK_WITH_FAILOVER
    ...                                  level=Medium
    ...                                  message=The Ethernet network \"Net4\" has no uplinks and a connection mode of failover; this configuration is not supported by OneView.
    ${validation_limits_collide}   Create Dictionary   errorCode=FEATURE_CODE_ISSUE_4K_VLANS_SUPPORT
    ...                                  level=Critical
    ...                                  message=The Virtual Connect domain has more than 1000 networks defined. OneView supports a maximum of 1000 Ethernet and/or FCoE networks.
    ${validation_connection_mode}   Create Dictionary   errorCode=FAIL_TO_MATCH_CONFIGURATION
    ...                                  level=Critical
    ...                                  message=The selected enclosure's Virtual Connect configuration does not match logical interconnect group \"LIG_USE12345XP\". The following element(s) are inconsistent: UplinkSet UplinkSet_1 attribute(s) do not match: Connection Mode,Networks associated.
    ${validation_diff_networks_associated}   Create Dictionary   errorCode=FAIL_TO_MATCH_CONFIGURATION
    ...                                  level=Critical
    ...                                  message=The selected enclosure's Virtual Connect configuration does not match logical interconnect group \"LIG_USE12345XP\". The following element(s) are inconsistent: UplinkSet UplinkSet_2 attribute(s) do not match: Networks associated,Port different Enclosure 1, Bay 1, Port X4,Port not found Enclosure 1, Bay 2, Port X3,Port not found Enclosure 1, Bay 2, Port X5.
    ${validation_diff_port}   Create Dictionary   errorCode=FAIL_TO_MATCH_CONFIGURATION
    ...                                  level=Critical
    ...                                  message=The selected enclosure's Virtual Connect configuration does not match logical interconnect group \"LIG_USE12345XP\". The following element(s) are inconsistent: UplinkSet UplinkSet_3 attribute(s) do not match: Port different Enclosure 1, Bay 3, Port X2,Port not found Enclosure 1, Bay 4, Port X2.
    ${validation_uplink_port_disabled}   Create Dictionary   errorCode=FEATURE_ISSUE_UPLINK_PORT_DISABLED_IN_UPLINKSET
    ...                                  level=High
    ...                                  message=The uplink set \"UplinkSet_2\" contains at least one uplink that is administratively disabled.
    @{validation_errors}    Create List   ${validation_network_mismatch}   ${validation_uplink_mismatch}   ${validation_uplink_not_found}   ${validation_smartlink_mismatch}   ${validation_bandwidth_mismatch}
    ...   ${validation_vlan_pvtntwk_mismatch}   ${validation_vlan_mismatch}   ${validation_type_mismatch}   ${validation_failover_enet_network}   ${validation_limits_collide}   ${validation_connection_mode}   
    ...   ${validation_diff_networks_associated}   ${validation_diff_port}   ${validation_uplink_port_disabled}
    ${resp}  ${resp_state}     ReportDetail against Existing EG     EG_2S1420PBPH
    Validate Existing Detail Report with Existing EG If General Issues Exists       ${resp}    allMigrationIssues    ${uniqueValidationKey}    @{validation_errors}
    CleanVC
    Import.ConfigVC    ${vc_config_file_1}
    ${resp}  ${resp_state}     ReportDetail against Existing EG     EG_2S1420PBPH
    Validate Existing Detail Report If General Issues Removed        ${resp}    allMigrationIssues    ${uniqueValidationKey}    @{validation_errors}
  
3.5.5.13--Different LIG where FC Network configuration does not match
    [Tags]   OV300
    [Documentation]     US33536 Validate and Translate fabrics where existing OneView FC Networks or limits may collide
    Remove All Server Profiles
    Remove All Enclosures
    ${response} =       Fusion Api Get LIG              param=?filter="name=LIG_USE12345XP"
    Run Keyword If   ${response['members']} == []     Check OneView Version And Set Compatible LIG Name    LIG_2S1420PBPH_1   ROOT   LIG_USE12345XP
    CleanVC
    ##Importing mismatch config file to VC
    Import.ConfigVC    ${vc_config_file_2}
    ${validation_fc1}   Create Dictionary   errorCode=FAIL_TO_MATCH_CONFIGURATION
    ...                                  level=Critical
    ...                                  message=The selected enclosure's Virtual Connect configuration does not match logical interconnect group \"LIG_USE12345XP\". The following element(s) are inconsistent: UplinkSet FC1 attribute(s) do not match: FC speed.
    ${validation_fc2}   Create Dictionary   errorCode=FAIL_TO_MATCH_CONFIGURATION
    ...                                  level=Critical
    ...                                  message=The selected enclosure's Virtual Connect configuration does not match logical interconnect group \"LIG_USE12345XP\". The following element(s) are inconsistent: UplinkSet FC2 attribute(s) do not match: Port different Enclosure 1, Bay 6, Port 1,Port not found Enclosure 1, Bay 6, Port 2.
    ${validation_fcoe1}   Create Dictionary   errorCode=FAIL_TO_MATCH_CONFIGURATION
    ...                                  level=Critical
    ...                                  message=The selected enclosure's Virtual Connect configuration does not match logical interconnect group \"LIG_USE12345XP\". The following element(s) are inconsistent: UplinkSet FCOE1 attribute(s) do not match: Port different Enclosure 1, Bay 1, Port X1,Port not found Enclosure 1, Bay 1, Port X2.
    ${resp}  ${resp_state}     ReportDetail against Existing EG     EG_2S1420PBPH
    @{validation_errors}    Create List   ${validation_fc1}   ${validation_fc2}   ${validation_fcoe1}
    Validate Existing Detail Report with Existing EG If General Issues Exists       ${resp}    allMigrationIssues    ${uniqueValidationKey}    @{validation_errors}
    CleanVC
    Import.ConfigVC    ${vc_config_file_1}
    ${resp}  ${resp_state}     ReportDetail against Existing EG     EG_2S1420PBPH
    Validate Existing Detail Report If General Issues Removed        ${resp}    allMigrationIssues    ${uniqueValidationKey}    @{validation_errors}

3.5.5.12--Different LIG where Ethernet Network configuration does not match
    [Tags]   BelowOV300
    [Documentation]     US31298 Validate and Translate networks where existing OneView networks or limits may collide
    Remove All Server Profiles
    Remove All Enclosures
    ${OVAVersion}   ${OVXAPIVersion}   Get OneView Appliance And Api Versions
    ${response} =   Run Keyword If   ${OVAVersion} >= 300   Set LIG    LIG_2S1420PBPH_1   ROOT   name=LIG_USE12345XP
    ...                         ELSE   Set LIG    LIG_2S1420PBPH   ROOT   name=LIG_USE12345XP
    ${task} =   Wait For Task and Fail On Error  ${response}
    CleanVC
    ##Importing mismatch config file to VC
    Import.ConfigVC    ${vc_config_file_2}
    ##Running test compatibility againt EG_2S1420PBPH
    ${validation_network_mismatch}   Create Dictionary   errorCode=FAIL_TO_MATCH_CONFIGURATION
    ...                                  level=Critical
    ...                                  message=The selected enclosure's Virtual Connect configuration does not match the selected OneView logical interconnect group \"LIG_USE12345XP\". The following element(s) are inconsistent: UplinkSet Net3 attribute(s) do not match: Port different Enclosure 1, Bay 2, Port X2,Port not found Enclosure 1, Bay 1, Port X4.
    ${validation_uplink_mismatch}   Create Dictionary   errorCode=FAIL_TO_MATCH_UPLINK_CONFIGURATION
    ...                                  level=Critical
    ...                                  message=The selected enclosure's Virtual Connect configuration does not match the selected OneView logical interconnect group \"LIG_USE12345XP\". The follow uplinkset \"Private\" from existing logical interconnect group \"LIG_USE12345XP\" are not present in the Virtual Connect configuration. They must match in size, name, and configuration.
    ${validation_uplink_not_found}   Create Dictionary   errorCode=FAIL_TO_MATCH_UPLINK_NOT_FOUND
    ...                                  level=Critical
    ...                                  message=The selected enclosure's Virtual Connect configuration does not match the selected OneView logical interconnect group \"LIG_USE12345XP\". The uplinkset \"Net4,Net5,Net_1001,Net_1002\" from the Virtual Connect configuration did not match one in the existing logical interconnect group \"LIG_USE12345XP\". They must match in name, number of uplinks, and configuration.
    ${validation_smartlink_mismatch}   Create Dictionary   errorCode=FAIL_TO_MATCH_CONFIGURATION
    ...                                  level=Critical
    ...                                  message=The selected enclosure's Virtual Connect configuration does not match the selected OneView logical interconnect group \"LIG_USE12345XP\". The following element(s) are inconsistent: Network Network_316 attribute(s) do not match: Smart Link.
    ${validation_bandwidth_mismatch}   Create Dictionary   errorCode=FAIL_TO_MATCH_CONFIGURATION
    ...                                  level=Medium
    ...                                  message=The selected enclosure's Virtual Connect configuration does not match the selected OneView logical interconnect group \"LIG_USE12345XP\". The following element(s) are inconsistent: Network Net1 attribute(s) do not match: Typical Bandwidth,Maximum Bandwidth.
    ${validation_vlan_pvtntwk_mismatch}   Create Dictionary   errorCode=FAIL_TO_MATCH_CONFIGURATION
    ...                                  level=Critical
    ...                                  message=The selected enclosure's Virtual Connect configuration does not match the selected OneView logical interconnect group \"LIG_USE12345XP\". The following element(s) are inconsistent: Network Net1 attribute(s) do not match: VLAN Id,Private Network.
    ${validation_vlan_mismatch}   Create Dictionary   errorCode=FAIL_TO_MATCH_CONFIGURATION
    ...                                  level=Critical
    ...                                  message=The selected enclosure's Virtual Connect configuration does not match the selected OneView logical interconnect group \"LIG_USE12345XP\". The following element(s) are inconsistent: Network Net2 attribute(s) do not match: VLAN Id.
    ${validation_type_mismatch}   Create Dictionary   errorCode=FAIL_TO_MATCH_CONFIGURATION
    ...                                  level=Critical
    ...                                  message=The selected enclosure's Virtual Connect configuration does not match the selected OneView logical interconnect group \"LIG_USE12345XP\". The following element(s) are inconsistent: Network Net3 attribute(s) do not match: Ethernet Network Type,Smart Link.
    ${validation_failover_enet_network}   Create Dictionary   errorCode=FEATURE_ISSUE_NETWORK_NO_UPLINK_WITH_FAILOVER
    ...                                  level=Medium
    ...                                  message=The Ethernet network \"Net4\" has no uplinks and a connection mode of failover; this configuration is not supported by OneView.
    ${validation_limits_collide}   Create Dictionary   errorCode=FEATURE_CODE_ISSUE_4K_VLANS_SUPPORT
    ...                                  level=Critical
    ...                                  message=The Virtual Connect domain has more than 1000 networks defined. OneView supports a maximum of 1000 Ethernet and/or FCoE networks.
    ${validation_connection_mode}   Create Dictionary   errorCode=FAIL_TO_MATCH_CONFIGURATION
    ...                                  level=Critical
    ...                                  message=The selected enclosure's Virtual Connect configuration does not match the selected OneView logical interconnect group \"LIG_USE12345XP\". The following element(s) are inconsistent: UplinkSet UplinkSet_1 attribute(s) do not match: Connection Mode,Networks associated.
    ${validation_diff_networks_associated}   Create Dictionary   errorCode=FAIL_TO_MATCH_CONFIGURATION
    ...                                  level=Critical
    ...                                  message=The selected enclosure's Virtual Connect configuration does not match the selected OneView logical interconnect group \"LIG_USE12345XP\". The following element(s) are inconsistent: UplinkSet UplinkSet_2 attribute(s) do not match: Networks associated,Port different Enclosure 1, Bay 1, Port X4,Port not found Enclosure 1, Bay 2, Port X3,Port not found Enclosure 1, Bay 2, Port X5.
    ${validation_diff_port}   Create Dictionary   errorCode=FAIL_TO_MATCH_CONFIGURATION
    ...                                  level=Critical
    ...                                  message=The selected enclosure's Virtual Connect configuration does not match the selected OneView logical interconnect group \"LIG_USE12345XP\". The following element(s) are inconsistent: UplinkSet UplinkSet_3 attribute(s) do not match: Port different Enclosure 1, Bay 3, Port X2,Port not found Enclosure 1, Bay 4, Port X2.
    ${validation_uplink_port_disabled}   Create Dictionary   errorCode=FEATURE_ISSUE_UPLINK_PORT_DISABLED_IN_UPLINKSET
    ...                                  level=High
    ...                                  message=The uplink set \"UplinkSet_2\" contains at least one uplink that is administratively disabled.
    @{validation_errors}    Create List   ${validation_network_mismatch}   ${validation_uplink_mismatch}   ${validation_uplink_not_found}   ${validation_smartlink_mismatch}   ${validation_bandwidth_mismatch}
    ...   ${validation_vlan_pvtntwk_mismatch}   ${validation_vlan_mismatch}   ${validation_type_mismatch}   ${validation_failover_enet_network}   ${validation_limits_collide}   ${validation_connection_mode}   
    ...   ${validation_diff_networks_associated}   ${validation_diff_port}   ${validation_uplink_port_disabled}
    ${resp}  ${resp_state}     ReportDetail against Existing EG     EG_2S1420PBPH
    Validate Existing Detail Report with Existing EG If General Issues Exists       ${resp}    allMigrationIssues    ${uniqueValidationKey}    @{validation_errors}
    CleanVC
    Import.ConfigVC    ${vc_config_file_1}
    ${resp}  ${resp_state}     ReportDetail against Existing EG     EG_2S1420PBPH
    Validate Existing Detail Report If General Issues Removed        ${resp}    allMigrationIssues    ${uniqueValidationKey}    @{validation_errors}
  
3.5.5.13--Different LIG where FC Network configuration does not match
    [Tags]   BelowOV300
    [Documentation]     US33536 Validate and Translate fabrics where existing OneView FC Networks or limits may collide
    Remove All Server Profiles
    Remove All Enclosures
    ${response} =       Fusion Api Get LIG              param=?filter="name=LIG_USE12345XP"
    Run Keyword If   ${response['members']} == []     Check OneView Version And Set Compatible LIG Name    LIG_2S1420PBPH   ROOT   LIG_USE12345XP
    CleanVC
    ##Importing mismatch config file to VC
    Import.ConfigVC    ${vc_config_file_2}
    ${validation_fc1}   Create Dictionary   errorCode=FAIL_TO_MATCH_CONFIGURATION
    ...                                  level=Critical
    ...                                  message=The selected enclosure's Virtual Connect configuration does not match the selected OneView logical interconnect group \"LIG_USE12345XP\". The following element(s) are inconsistent: UplinkSet FC1 attribute(s) do not match: FC speed.
    ${validation_fc2}   Create Dictionary   errorCode=FAIL_TO_MATCH_CONFIGURATION
    ...                                  level=Critical
    ...                                  message=The selected enclosure's Virtual Connect configuration does not match the selected OneView logical interconnect group \"LIG_USE12345XP\". The following element(s) are inconsistent: UplinkSet FC2 attribute(s) do not match: Port different Enclosure 1, Bay 6, Port 1,Port not found Enclosure 1, Bay 6, Port 2.
    ${validation_fcoe1}   Create Dictionary   errorCode=FAIL_TO_MATCH_CONFIGURATION
    ...                                  level=Critical
    ...                                  message=The selected enclosure's Virtual Connect configuration does not match the selected OneView logical interconnect group \"LIG_USE12345XP\". The following element(s) are inconsistent: UplinkSet FCOE1 attribute(s) do not match: Port different Enclosure 1, Bay 1, Port X1,Port not found Enclosure 1, Bay 1, Port X2.
    ${resp}  ${resp_state}     ReportDetail against Existing EG     EG_2S1420PBPH
    @{validation_errors}    Create List   ${validation_fc1}   ${validation_fc2}   ${validation_fcoe1}
    Validate Existing Detail Report with Existing EG If General Issues Exists       ${resp}    allMigrationIssues    ${uniqueValidationKey}    @{validation_errors}
    CleanVC
    Import.ConfigVC    ${vc_config_file_1}
    ${resp}  ${resp_state}     ReportDetail against Existing EG     EG_2S1420PBPH
    Validate Existing Detail Report If General Issues Removed        ${resp}    allMigrationIssues    ${uniqueValidationKey}    @{validation_errors}
