*** Settings ***

Documentation     OneView Migration Manager Test Suite for LLDP existing LIG blocking tests
...	= Usage =
...		Enclosure Used: WSPT-Austin-1
...		pybot LLDPtlv.txt
...	There are two files generated in the dataFiles directory:
...             "data-rpt-LLDP.json" contains the compatibility report
...             "data-ov-LLDP.json" contains the migration result
...	There are three log files files generated
...		output.html
...		log.html
...		report.html
...     This testsuite covers the following testcases in ALM:
...             LLLP TLV False existing LIG True
...             LLLP TLV True existing LIG False
...             LLLP TLV True new LIG
...             Tagged LLDP True existing LIG
######## IMPORTANT NOTES #######
# [1] When executing this test suite under VC <4.45 and OV 1.20 environment, you have to use --exclude VC445OROV200
# [2] When executing this test suite under VC <4.45 and OV 2.00 environment, you have to use --exclude OV120


Library           RoboGalaxyLibrary
Library           FusionLibrary
Library           BuiltIn
Library           ../lib/WPSTUtil.py

Variables                       ../resources/defaults.py
Variables                       ../resources/DTOtemplates.py
Variables                       ../resources/credentials_wpst.py   Austin1
Force Tags                      Austin1
Resource                        ../resources/keywords.txt
Resource                        ../resources/keywords_ovcli.txt
Suite Setup                     Suite Setup Tasks
Test Setup                      Test Setup Tasks

*** Variables ***

@{ignoreL}                              uuid  qosConfiguration
@{delResList}                           server-profiles   enclosures
@{issueLevels}				Critical   High   Medium   Low
@{myResourcesList}                      lig
${vc_config_file_1}          config/LLDPblocking101.txt
${vc_config_file_2}          config/LLDPblocking102.txt
${vc_config_file_3}          config/LLDPblocking103.txt
${vc_config_file_3_ov120}    config/LLDPblocking103-ov120.txt


*** Test Cases ***
TC000--CleanOV
    [Tags]   CleanOV
    CleanOV

TC000--CleanVC
    [Tags]   CleanVC
    CleanVC

TC101--LLDP TLV True new LIG Test Compatibility
    [Documentation]   VC 4.3x LLDP TLV True new LIG Test Compatibility
    Import.ConfigVC    ${vc_config_file_1}
    Report.Write.Compare

TC101--LLDP TLV True new LIG Migrate
    [Documentation]   VC 4.3x LLDP TLV True new LIG Migrate
    Migrate
    GetOVResources.Write.Compare        ignoreList=${ignoreL}

TC101--Minor Cleaning
    [Documentation]   Minor cleaning of TC101 in prep of TC102
    Delete OneView Selected    ${delResList}
    CleanVC
    Import VC

TC102--LLDP TLV False existing LIG True; Tagged LLDP True existing LIG
    [Tags]   VC445-API200
    [Documentation]   LLDP TLV False existing LIG True; Tagged LLDP True existing LIG
    ...               Tagged LLDP is NOT support in VC <4.45
    ${OVAVersion}   ${OVXAPIVersion}   Get OneView Appliance And Api Versions
    ${response} =   Run Keyword If   ${OVAVersion} >= 300   Set LIG    LIG_2S1408P9XC_1   ethernetSettings   enableRichTLV=True
    ...                         ELSE   Set LIG   LIG_2S1408P9XC   ethernetSettings   enableRichTLV=True
    ${task} =   Wait For Task and Fail On Error  ${response}
    Delete VC Config
    Config VC    ${vc_config_file_2}
    Report.Write.Compare    ${EMPTYLIST}   ${OAVC_CREDENTIALS}   ${EMPTYLIST}   ${True}   EG_2S1408P9XC

TC102--API120 Only For Tagged LLDP True existing LIG
    [Tags]   VC445-API120
    [Documentation]   Tagged LLDP True existing LIG
    ...               Tagged LLDP is NOT support in VC <4.45
    Delete VC Config
    Config VC    ${vc_config_file_2}
    Report.Write.Compare    ${EMPTYLIST}   ${OAVC_CREDENTIALS}   ${EMPTYLIST}   ${True}   EG_2S1408P9XC

TC102-OV120--LLDP TLV False existing LIG True; VC <4.45 Does NOT Support Tagged LLDP
    [Tags]   OV120
    [Documentation]   LLDP TLV False existing LIG True; Tagged LLDP is not a supported property in VC <4.45
    ...               Expected result is NO Issue since OV-1.20 automatically disables Enhanced LLDP TLV
    ...               As per the Tag, this is a OV120 test case-only. Expect this to fail in OV 2.00.
    ...               NOTE: There's a recent change in Set LIG that detect
    ...                     failure and when setting existing LIG TLV to True fail this will fail. Will
    ...                     need to retest this in 1.20 to see this test case can be applied there.
    ${OVAVersion}   ${OVXAPIVersion}   Get OneView Appliance And Api Versions
    ${response} =   Run Keyword If   ${OVAVersion} >= 300   Set LIG    LIG_2S1408P9XC_1   ethernetSettings   enableRichTLV=True
    ...                         ELSE   Set LIG   LIG_2S1408P9XC   ethernetSettings   enableRichTLV=True
    ${task} =   Wait For Task and Fail On Error  ${response}
    Delete VC Config
 
    @{commands}   Create List   add network NetA
    ...                             add network NetB
    ...                             add profile Profile_5 -NoDefaultEnetConn -NoDefaultFcConn -NoDefaultFcoeConn
    ...                             add enet-connection Profile_5 Network=NetA
    ...                             add enet-connection Profile_5 Network=NetB
    ...                             add profile Profile_6 -NoDefaultEnetConn -NoDefaultFcConn -NoDefaultFcoeConn
    ...                             add enet-connection Profile_6 Network=NetA
    ...                             add enet-connection Profile_6 Network=NetB
    ...                             assign profile Profile_5 enc0:5
    ...                             assign profile Profile_6 enc0:9
    ...                             set lldp enhancedTlv=false
    ...                             set snmp FC SmisEnabled=true
    Run CLI In Interconnect From List    ${commands}
    ${resp}  ${resp_state}=     ReportDetail against Existing EG    EG_2S1408P9XC
    @{validation}   Create List Of Dictionaries Of OneView Issue Levels   ${issueLevels}
    Validate Existing Detail Report If General Issues Removed   ${resp}   incompatibilities/migrationGeneralIssues/issues   @{validation} 

TC102-OV200--LLDP TLV False existing LIG True; VC <4.45 Does NOT Support Tagged LLDP
    [Tags]   OV200-API200
    [Documentation]   LLDP TLV False existing LIG True; Tagged LLDP is an invalid property in VC <4.45
    ...               Expected result is High severity warning in OV-2.00
    ...               This test is tagged with OV200 only because OV120 does not support enhancedTlv and always stay 
    ...               False. Therefore, no issue will be reported in OV120.
    ${OVAVersion}   ${OVXAPIVersion}   Get OneView Appliance And Api Versions
    ${response} =   Run Keyword If   ${OVAVersion} >= 300   Set LIG    LIG_2S1408P9XC_1   ethernetSettings   enableRichTLV=True
    ...                         ELSE   Set LIG   LIG_2S1408P9XC   ethernetSettings   enableRichTLV=True
    ${task} =   Wait For Task and Fail On Error  ${response}
    Delete VC Config
 
    @{commands}   Create List   add network NetA
    ...                             add network NetB
    ...                             add profile Profile_5 -NoDefaultEnetConn -NoDefaultFcConn -NoDefaultFcoeConn
    ...                             add enet-connection Profile_5 Network=NetA
    ...                             add enet-connection Profile_5 Network=NetB
    ...                             add profile Profile_6 -NoDefaultEnetConn -NoDefaultFcConn -NoDefaultFcoeConn
    ...                             add enet-connection Profile_6 Network=NetA
    ...                             add enet-connection Profile_6 Network=NetB
    ...                             assign profile Profile_5 enc0:5
    ...                             assign profile Profile_6 enc0:9
    ...                             set lldp enhancedTlv=false
    ...                             set snmp FC SmisEnabled=true
    Run CLI In Interconnect From List    ${commands}
    ${validation}    Create Dictionary   errorCode=FAIL_TO_MATCH_RICH_TLV_CONFIGURATION
    ...                                  level=High
    Validate Detail Report with Existing EG If General Issues Exists   oneViewResourceCompatibility/logicalInterconnectGroup/issues   EG_2S1408P9XC   errorCode   ${validation}

TC103--LLLP TLV True existing LIG False;
    [Tags]   API200
    [Documentation]   LLLP TLV True existing LIG False
    ...               This also tests taggedLldp=true against an existing LIG with default value (false).
    ...               That is if you are running against OV 2.00 due to VC config left over of the test case TC102
    ...               not reverted up this point and got carried over for this run.
    ${OVAVersion}   ${OVXAPIVersion}   Get OneView Appliance And Api Versions
    ${response} =   Run Keyword If   ${OVAVersion} >= 300   Set LIG    LIG_2S1408P9XC_1   ethernetSettings   enableRichTLV=False
    ...                         ELSE   Set LIG   LIG_2S1408P9XC   ethernetSettings   enableRichTLV=False
    ${task} =   Wait For Task and Fail On Error  ${response}
    Delete VC Config
    Config VC    ${vc_config_file_3}
    ${ovData}=   Get OneView Resources   ${myResourcesList}
    Log   ${ovData}
    Report.Write.Compare    ${EMPTYLIST}   ${OAVC_CREDENTIALS}   ${EMPTYLIST}   ${True}   EG_2S1408P9XC

TC103--OV200-API120 LLLP TLV True existing LIG False;
    [Tags]   OV200-API120
    [Documentation]   LLLP TLV True existing LIG False
    ...               This also tests taggedLldp=true against an existing LIG with default value (false).
    ...               That is if you are running against OV 2.00 due to VC config left over of the test case TC102
    ...               not reverted up this point and got carried over for this run.
    ...               There is an existing LIG LIG_2S1408P9XC but we cannot modify it using API120 due to its limitation.
    ...               I think API120 disables (False)  this since it does not support TLV.
    Delete VC Config
    Config VC    ${vc_config_file_3}
    ${ovData}=   Get OneView Resources   ${myResourcesList}
    Log   ${ovData}
    Report.Write.Compare    ${EMPTYLIST}   ${OAVC_CREDENTIALS}   ${EMPTYLIST}   ${True}   EG_2S1408P9XC

TC103-OV120--LLLP TLV True existing LIG False;
    [Tags]   OV120
    [Documentation]   LLLP TLV True existing LIG False
    ...               This also tests taggedLldp=false against an existing LIG with default value (false).
    ...               There is an existing LIG LIG_2S1408P9XC but we cannot modify it using API120 due to its limitation.
    ...               I think API120 disables (False)  this since it does not support TLV.
    Delete VC Config
    Config VC    ${vc_config_file_3_ov120}
    ${ovData}=   Get OneView Resources   ${myResourcesList}
    Log   ${ovData}
    Report.Write.Compare    ${EMPTYLIST}   ${OAVC_CREDENTIALS}   ${EMPTYLIST}   ${True}   EG_2S1408P9XC

#TC104-jasonIsolationTestingOnly
#    [Documentation]   This is intended for semi-manual testing use only to isolate things.
#    ...               Like the LLDP TLV which doesn't allow API-1.20 to modify existing LIG
#    Import Variables   ../resources/credentials_jason.py   vc-bvt-backup   ${OV_IP}
#    ${ovData}=   Get OneView Resources   ${myResourcesList}
#    Log   ${ovData}
#    Report.Write.Compare    ${EMPTYLIST}   ${OAVC_CREDENTIALS}   ${EMPTYLIST}   ${True}   EG_2S1409P9XS

