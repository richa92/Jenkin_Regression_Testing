*** Settings ***

Documentation     OneView Migration Manager Test Suite for LLDP
...	= Usage =
...		Enclosure Used: WSPT-Austin-1
...		pybot LLDPtlv.txt
...	There are two files generated in the dataFiles directory:
...		"data-rpt-LLDP.json" contains the compatibility report
...		"data-ov-LLDP.json" contains the migration result
...	There are three log files generated
...		output.html
...		log.html
...		report.html
...     This testsuite covers the following testcases in ALM:
...             Tagged LLDP True new LIG
...             Tagged LLDP False existing LIG
...             Tagged LLDP False new LIG
...             LLDP TLV True existing LIG True
...             LLDP TLV False new LIG
...             LLDP TLV False existing LIG False
######## IMPORTANT NOTES #######
# [1] When executing this test suite under VC <4.45 environment, you have to use --exclude VC445
# [1] When executing this test suite under VC 4.45, you have to use --exclude BelowVC445

Library           RoboGalaxyLibrary
Library           FusionLibrary
Library           BuiltIn
Library           ../lib/WPSTUtil.py

Variables                       ../resources/defaults.py
Variables                       ../resources/DTOtemplates.py
Variables                       ../resources/credentials_wpst.py   Austin1
Force Tags                      Austin1
Default Tags                    VC445
Resource                        ../resources/keywords.txt
Resource                        ../resources/keywords_ovcli.txt
Suite Setup                     Suite Setup Tasks
Test Setup                      Test Setup Tasks

*** Variables ***

@{ignoreL}                      uuid  qosConfiguration
@{delResList}                   server-profiles   enclosures
@{issueLevels}			Critical   High   Medium   Low
${vc_config_file_3}          	config/LLDP003.txt

*** Test Cases ***
TC000-CleanOV
    [Tags]   CleanOV
    CleanOV

TC000-CleanVC
    [Tags]   CleanVC
    CleanVC

TC000-ImportEnclosure
    [Tags]   ImportEnclosure
    @{commands}    Create List   import enclosure username=${OA_CREDENTIAL_DATA['oaUsername']} password=${OA_CREDENTIAL_DATA['oaPassword']}
    Run CLI In Interconnect From List   ${commands}

TC001-VC445--Tagged LLDP True new LIG
    [Tags]   VC445-BelowOV300
    [Documentation]   VC 4.45 supports set lldp taggedLldp true and expects errorCode FEATURE_CODE_ISSUE_TAGGED_LLDP
    @{commands_on}    Create List   set lldp taggedLldp=true
    @{commands_off}   Create List   set lldp taggedLldp=false
    ${validation}   Create Dictionary   errorCode=FEATURE_CODE_ISSUE_TAGGED_LLDP
    ...                                 level=Critical
    ...                                 recommendation=Use the Virtual Connect command line \"set lldp taggedLldp=false\" to disable the capability.
    Run CLI In Interconnect From List   ${commands_on}
    Validate Detail Report If General Issue Exists   incompatibilities/migrationGeneralIssues/issues   errorCode   ${validation}
    Run CLI In Interconnect From List   ${commands_off}
    Validate Detail Report If General Issues Removed   incompatibilities/migrationGeneralIssues/issues   ${validation}

TC001-VC445--Tagged LLDP True new LIG
    [Tags]   OV300
    [Documentation]   VC 4.45 supports set lldp taggedLldp true and expects errorCode FEATURE_CODE_ISSUE_TAGGED_LLDP
    @{commands_on}    Create List   set lldp taggedLldp=true
    @{commands_off}   Create List   set lldp taggedLldp=false
    ${validation}   Create Dictionary   errorCode=FEATURE_CODE_ISSUE_TAGGED_LLDP
    ...                                 level=Critical
    ...                                 recommendation=Use the Virtual Connect command line \"set lldp taggedLldp=false\" to disable the capability.
    Run CLI In Interconnect From List   ${commands_on}
    Validate Detail Report If General Issues Removed   incompatibilities/migrationGeneralIssues/issues   ${validation}
    Run CLI In Interconnect From List   ${commands_off}
    Validate Detail Report If General Issues Removed   incompatibilities/migrationGeneralIssues/issues   ${validation}

TC001-VC445--Tagged LLDP False new LIG; LLDP TLV False new LIG Test Compatibility
    [Documentation]   LLDP TLV False new LIG; Tagged LLDP False new LIG
    ...               Tagged LLDP is NOT supported in VC <4.45
    @{commands}   Create List   add network NetA
    ...                             add network NetB
    ...                             add profile Profile_5 -NoDefaultEnetConn -NoDefaultFcConn -NoDefaultFcoeConn
    ...                             add enet-connection Profile_5 Network=NetA
    ...                             add enet-connection Profile_5 Network=NetB
    ...                             add profile Profile_6 -NoDefaultEnetConn -NoDefaultFcConn -NoDefaultFcoeConn
    ...                             add enet-connection Profile_6 Network=NetA
    ...                             add enet-connection Profile_6 Network=NetB
    ...                             assign profile Profile_5 enc0:5
    ...                             assign profile Profile_6 enc0:9
    ...                             set lldp enhancedTlv=false
    ...                             set lldp taggedLldp=false
    ...                             set snmp FC SmisEnabled=true
    Run CLI In Interconnect From List    ${commands}
    ${resp}  ${resp_state}      ReportDetail
    @{validation}   Create List Of Dictionaries Of OneView Issue Levels   ${issueLevels}
    Validate Existing Detail Report If General Issues Removed   ${resp}   incompatibilities/migrationGeneralIssues/issues   @{validation}

TC001-VC445--Tagged LLDP False new LIG; LLDP TLV False new LIG Migrate
    [Documentation]   LLDP TLV False new LIG; Tagged LLDP False new LIG
    Migrate
    GetOVResources.Write.Compare        ignoreList=${ignoreL}

TC001-Less-Than-VC-4.45--LLDP TLV False New LIG Test Compatibility
    [Tags]   BelowVC445
    [Documentation]   LLDP TLV False new LIG; Tagged LLDP is not supported in VC <4.45 and this covers it.
    @{commands}   Create List   add network NetA
    ...                             add network NetB
    ...                             add profile Profile_5 -NoDefaultEnetConn -NoDefaultFcConn -NoDefaultFcoeConn
    ...                             add enet-connection Profile_5 Network=NetA
    ...                             add enet-connection Profile_5 Network=NetB
    ...                             add profile Profile_6 -NoDefaultEnetConn -NoDefaultFcConn -NoDefaultFcoeConn
    ...                             add enet-connection Profile_6 Network=NetA
    ...                             add enet-connection Profile_6 Network=NetB
    ...                             assign profile Profile_5 enc0:5
    ...                             assign profile Profile_6 enc0:9
    ...                             set lldp enhancedTlv=false
    ...                             set snmp FC SmisEnabled=true
    Run CLI In Interconnect From List    ${commands}
    ${resp}  ${resp_state}      ReportDetail
    @{validation}   Create List Of Dictionaries Of OneView Issue Levels   ${issueLevels}
    Validate Existing Detail Report If General Issues Removed   ${resp}   incompatibilities/migrationGeneralIssues/issues   @{validation}

TC001-Less-Than-VC-4.45--LLDP TLV False New LIG Migrate
    [Tags]   BelowVC445
    [Documentation]   LLDP TLV False new LIG; Tagged LLDP is not supported in VC <4.45 and this covers it.
    Migrate
    GetOVResources.Write.Compare        ignoreList=${ignoreL}

TC001-Cleanup
    Delete OneView Selected    ${delResList}

TC002-VC445--Tagged LLDP False Existing LIG; LLLP TLV False existing LIG False Test Compatibility
    [Documentation]   Tagged LLDP False existing LIG; LLLP TLV False existing LIG False

    @{commands}   Create List   import enclosure username=${OA_CREDENTIAL_DATA['oaUsername']} password=${OA_CREDENTIAL_DATA['oaPassword']}
    ...                             add network NetA
    ...                             add network NetB
    ...                             add profile Profile_5 -NoDefaultEnetConn -NoDefaultFcConn -NoDefaultFcoeConn
    ...                             add enet-connection Profile_5 Network=NetA
    ...                             add enet-connection Profile_5 Network=NetB
    ...                             add profile Profile_6 -NoDefaultEnetConn -NoDefaultFcConn -NoDefaultFcoeConn
    ...                             add enet-connection Profile_6 Network=NetA
    ...                             add enet-connection Profile_6 Network=NetB
    ...                             assign profile Profile_5 enc0:5
    ...                             assign profile Profile_6 enc0:9
    ...                             set lldp enhancedTlv=false
    ...                             set lldp taggedLldp=false
    ...                             set snmp FC SmisEnabled=true
    Run CLI In Interconnect From List    ${commands}
    ${resp}  ${resp_state}=     ReportDetail against Existing EG    EG_2S1408P9XC
    @{validation}   Create List Of Dictionaries Of OneView Issue Levels   ${issueLevels}
    Validate Existing Detail Report If General Issues Removed   ${resp}   incompatibilities/migrationGeneralIssues/issues   @{validation}

TC002-VC445--Tagged LLDP False Existing LIG; LLLP TLV False existing LIG False Migrate
    [Documentation]   Tagged LLDP False existing LIG; LLLP TLV False existing LIG False
    Migrate
    GetOVResources.Write.Compare        ignoreList=${ignoreL}

TC002-Less-Than-VC-4.45--LLDP TLV False Existing LIG False Test Compatibility
    [Tags]   BelowVC445-API200
    [Documentation]   LLLP TLV False existing LIG False; Tagged LLDP is not supported in VC <4.45
    Delete OneView Selected    ${delResList}
    ${OVAVersion}   ${OVXAPIVersion}   Get OneView Appliance And Api Versions
    ${response} =   Run Keyword If   ${OVAVersion} >= 300   Set LIG   LIG_2S1408P9XC_1   ethernetSettings   enableRichTLV=False
    ...                         ELSE   Set LIG   LIG_2S1408P9XC  ethernetSettings   enableRichTLV=False
    ${task} =   Wait For Task and Fail On Error  ${response}

    @{commands}   Create List   import enclosure username=${OA_CREDENTIAL_DATA['oaUsername']} password=${OA_CREDENTIAL_DATA['oaPassword']}
    ...                             add network NetA
    ...                             add network NetB
    ...                             add profile Profile_5 -NoDefaultEnetConn -NoDefaultFcConn -NoDefaultFcoeConn
    ...                             add enet-connection Profile_5 Network=NetA
    ...                             add enet-connection Profile_5 Network=NetB
    ...                             add profile Profile_6 -NoDefaultEnetConn -NoDefaultFcConn -NoDefaultFcoeConn
    ...                             add enet-connection Profile_6 Network=NetA
    ...                             add enet-connection Profile_6 Network=NetB
    ...                             assign profile Profile_5 enc0:5
    ...                             assign profile Profile_6 enc0:9
    ...                             set lldp enhancedTlv=false
    ...                             set snmp FC SmisEnabled=true
    Run CLI In Interconnect From List    ${commands}
    ${resp}  ${resp_state}=     ReportDetail against Existing EG    EG_2S1408P9XC
    @{validation}   Create List Of Dictionaries Of OneView Issue Levels   ${issueLevels}
    Validate Existing Detail Report If General Issues Removed   ${resp}   incompatibilities/migrationGeneralIssues/issues   @{validation}

TC002-Less-Than-VC-4.45--LLDP TLV False Existing LIG False Migrate
    [Tags]   BelowVC445-API200
    [Documentation]   LLLP TLV False existing LIG False; Tagged LLDP is not supported in VC <4.45
    Migrate
    GetOVResources.Write.Compare        ignoreList=${ignoreL}

TC002-Cleanup
    [Tags]   API200
    Delete OneView Selected    ${delResList}

TC003--LLLP TLV True existing LIG True Test Compatibility
    [Tags]   API200
    [Documentation]   LLLP TLV True existing LIG True
    ${OVAVersion}   ${OVXAPIVersion}   Get OneView Appliance And Api Versions
    ${response} =   Run Keyword If   ${OVAVersion} >= 300   Set LIG   LIG_2S1408P9XC_1   ethernetSettings   enableRichTLV=True
    ...                         ELSE   Set LIG   LIG_2S1408P9XC  ethernetSettings   enableRichTLV=True
    ${task} =   Wait For Task and Fail On Error  ${response}

    Import.ConfigVC   ${vc_config_file_3}
    Report.Write.Compare        ${EMPTYLIST}   ${OAVC_CREDENTIALS}   ${EMPTYLIST}   ${True}   EG_2S1408P9XC

TC003--LLLP TLV True existing LIG True Migrate
    [Tags]   API200
    [Documentation]   LLLP TLV True existing LIG True
    Migrate
    GetOVResources.Write.Compare        ignoreList=${ignoreL}

