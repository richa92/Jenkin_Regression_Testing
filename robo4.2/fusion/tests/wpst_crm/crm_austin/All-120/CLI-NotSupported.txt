*** Settings ***
Documentation     VC CLI for Critial/High/Medium General Issues and no HW requirement
...    Covers the following testcases:
...        3.1.2.6--enet-connection-McastFilter
...        3.1.2.14--iscsi-connection
...        3.1.2.13--iscsi-boot-param

Library           RoboGalaxyLibrary
Library           FusionLibrary
Library           ../lib/WPSTUtil.py

Variables                       ../resources/defaults.py
Variables                       ../resources/credentials_wpst.py   Austin1
Force Tags                      Austin1
Resource                        ../resources/keywords.txt
Suite Setup                     Suite Setup Tasks
Test Setup                      Test Setup Tasks

*** Variables ***
@{issueLevels}    Critical   High   Medium   Low

*** Test Cases ***
TC0--Clean OV and VC
    [Tags]    CleanOV.CleanVC
    CleanOV.CleanVC

TC0--Import Enclosure in VC
    [Tags]    ImportEnclosure
    @{commands}     Create List    import enclosure username=${OA_CREDENTIAL_DATA['oaUsername']} password=${OA_CREDENTIAL_DATA['oaPassword']}
    Run CLI In Interconnect From List    ${commands}

#-----------The following test cases has no hardware configuration requirements---------

3.1.2.6--enet-connection-McastFilter-OV120
    [Documentation]  enet-connection-McastFilter testcase to be run in Oneview 1.20.
    ...    A critical issue "FEATURE_ISSUE_PROFILE_WITH_BOOT_MODE_NOT_AUTO" for Gen 9 servers is reported only when executed in Oneview 1.2.
    [Tags]    OV120
    @{commands_on}     Create List    add profile Profile1 -NoDefaultEnetConn -NoDefaultFcConn -NoDefaultFcoeConn -quiet BootMode=UEFI
    ...     add network net001
    ...     add network net002
    ...     add mcast-filter MCF111
    ...     add enet-connection Profile1 Network=net001 McastFilter=MCF111 PXE=enabled pxeBootOrder=IPv4Only AddressType=Factory-Default SpeedType=Disabled
    ...     add enet-connection Profile1 Network=net002 PXE=UseBIOS AddressType=User-Defined EthernetMAC=00-17-A4-77-00-00 iScsiMAC=00-17-A4-77-00-01 SpeedType=Preferred
    
    @{commands_off}    Create List    remove profile Profile1
    ...                               remove mcast-filter MCF111
    ...                               remove network net001
    ...                               remove network net002
    Run CLI In Interconnect From List    ${commands_on}
    
    ${validation_mcast_filter}   Create Dictionary   errorCode=FEATURE_CODE_ISSUE_MCAST_FILTER 
    ...                                 level=Critical
    ${validation_profile_boot_setting}   Create Dictionary   errorCode=FEATURE_ISSUE_PROFILE_WITH_BOOT_SETTING_USE_BIOS_MIXED 
    ...                                 level=High
    ${validation_ethernet_connection_type}   Create Dictionary   errorCode=FEATURE_ISSUE_PROFILE_WITH_ETHERNET_CONNECTION_SPEED_TYPE_DISABLED
    ...                                 level=Critical
    ${filter}       Create Dictionary       name=Profile1
    ${validation_boot_mode}   Create Dictionary   errorCode=FEATURE_ISSUE_PROFILE_WITH_BOOT_MODE_NOT_AUTO
    ...                                 level=Critical
    ${resp}   ${resp_state}      ReportDetail
    Validate Existing Detail Report If General Issues Exists      ${resp}   incompatibilities/migrationGeneralIssues/issues   errorCode   ${validation_mcast_filter}
    Validate Existing Detail Report If Issues Exists with Filter   ${resp}   oneViewResourceCompatibility/profiles/serverProfiles    ${validation_ethernet_connection_type}   ${filter}
    Validate Existing Detail Report If Issues Exists with Filter   ${resp}   oneViewResourceCompatibility/profiles/serverProfiles     ${validation_profile_boot_setting}   ${filter}
    Validate Existing Detail Report If Issues Exists with Filter   ${resp}   oneViewResourceCompatibility/profiles/serverProfiles     ${validation_boot_mode}   ${filter} 
    Run CLI In Interconnect From List    ${commands_off}
    ${resp}  ${resp_state}      ReportDetail
    Validate Existing Detail Report If General Issues Removed      ${resp}   incompatibilities/migrationGeneralIssues/issues   ${validation_mcast_filter}
    Validate Existing Detail Report If Issues Removed with Filter      ${resp}   oneViewResourceCompatibility/profiles/serverProfiles   ${validation_profile_boot_setting}   ${filter}
    Validate Existing Detail Report If Issues Removed with Filter      ${resp}   oneViewResourceCompatibility/profiles/serverProfiles   ${validation_ethernet_connection_type}   ${filter}

3.1.2.6--enet-connection-McastFilter-ov200+
    [Documentation]  enet-connection-McastFilter testcase to be run in Oneview 2.0. 
    ...     pxeBootOrder is only supported in Gen9 with UEFI mode, only in OV 2.0. So "FEATURE_ISSUE_PROFILE_WITH_BOOT_MODE_NOT_AUTO" is not reported in OV200 and later
    [Tags]    OV200
    @{commands_on}     Create List    add profile Profile1 -NoDefaultEnetConn -NoDefaultFcConn -NoDefaultFcoeConn -quiet BootMode=UEFI
    ...     add network net001
    ...     add network net002
    ...     add mcast-filter MCF111
    ...     add enet-connection Profile1 Network=net001 McastFilter=MCF111 PXE=enabled pxeBootOrder=IPv4Only AddressType=Factory-Default SpeedType=Disabled
    ...     add enet-connection Profile1 Network=net002 PXE=UseBIOS AddressType=User-Defined EthernetMAC=00-17-A4-77-00-00 iScsiMAC=00-17-A4-77-00-01 SpeedType=Preferred
    
    @{commands_off}    Create List    remove profile Profile1
    ...                               remove mcast-filter MCF111
    ...                               remove network net001
    ...                               remove network net002
    
    Run CLI In Interconnect From List    ${commands_on}
    ${resp}   ${resp_state}      ReportDetail
    ${validation_mcast_filter}   Create Dictionary   errorCode=FEATURE_CODE_ISSUE_MCAST_FILTER 
    ...                                 level=Critical
    ${validation_profile_boot_setting}   Create Dictionary   errorCode=FEATURE_ISSUE_PROFILE_WITH_BOOT_SETTING_USE_BIOS_MIXED 
    ...                                 level=High
    ${validation_ethernet_connection_type}   Create Dictionary   errorCode=FEATURE_ISSUE_PROFILE_WITH_ETHERNET_CONNECTION_SPEED_TYPE_DISABLED
    ...                                 level=Critical
    Validate Existing Detail Report If General Issues Exists      ${resp}    incompatibilities/migrationGeneralIssues/issues   errorCode   ${validation_mcast_filter}
    Validate Existing Detail Report If General Issues Exists      ${resp}      oneViewResourceCompatibility/allMigrationIssues   errorCode   
    ...                                                  ${validation_ethernet_connection_type}
    ...                                                  ${validation_profile_boot_setting}
    
    Run CLI In Interconnect From List    ${commands_off}
    ${resp}   ${resp_state}      ReportDetail
    Validate Existing Detail Report If General Issues Removed      ${resp}      incompatibilities/migrationGeneralIssues/issues   ${validation_mcast_filter}
    Validate Existing Detail Report If General Issues Removed      ${resp}      oneViewResourceCompatibility/allMigrationIssues   ${validation_profile_boot_setting}
    Validate Existing Detail Report If General Issues Removed      ${resp}      oneViewResourceCompatibility/allMigrationIssues   ${validation_ethernet_connection_type}
 
3.1.2.14--iscsi-connection-ov120
    [Documentation]  Apply Ethernet CLI config to VCM
    [Tags]    OV120
    @{commands_on}     Create List    add profile Profile1 -NoDefaultEnetConn -NoDefaultFcConn -NoDefaultFcoeConn -quiet 
    ...     add network net001
    ...     add network net002
    ...     add iscsi-connection Profile1 Network=net001 AddressType=User-Defined iScsiMAC=00-17-A4-77-00-01 SpeedType=Auto
    ...     add iscsi-connection Profile1 Network=net002 AddressType=User-Defined iScsiMAC=00-17-A4-77-00-02 SpeedType=Preferred
    
    @{commands_off}    Create List    remove iscsi-connection Profile1
    ...                               remove profile Profile1
    ...                               remove network net001
    ...                               remove network net002
    ${validation}   Create Dictionary   errorCode=FEATURE_ISSUE_ISCSI_CONNECTION_FOUND_INSIDE_PROFILE 
    ...                                 level=Critical
    ${filter}       Create Dictionary       name=Profile1
    Run CLI In Interconnect From List    ${commands_on}
    ${resp}   ${resp_state}      ReportDetail
    Validate Existing Detail Report If Issues Exists with Filter   ${resp}   oneViewResourceCompatibility/profiles/serverProfiles    ${validation}   ${filter}
    Run CLI In Interconnect From List    ${commands_off}
    ${resp}  ${resp_state}      ReportDetail
    Validate Existing Detail Report If Issues Removed with Filter      ${resp}   oneViewResourceCompatibility/profiles/serverProfiles   ${validation}   ${filter}

3.1.2.14--iscsi-connection-ov200-blocker
    [Documentation]  Apply Ethernet CLI config to VCM
    [Tags]    OnlyOV200
    @{commands_on}     Create List    add profile Profile1 -NoDefaultEnetConn -NoDefaultFcConn -NoDefaultFcoeConn -quiet 
    ...     add network net001
    ...     add network net002
    ...     add iscsi-connection Profile1 Network=net001 AddressType=User-Defined iScsiMAC=00-17-A4-77-00-01 SpeedType=Auto
    ...     add iscsi-connection Profile1 Network=net002 AddressType=User-Defined iScsiMAC=00-17-A4-77-00-02 SpeedType=Preferred
    
    @{commands_off}    Create List    remove iscsi-connection Profile1
    ...                               remove profile Profile1
    ...                               remove network net001
    ...                               remove network net002
    ${validation}   Create Dictionary   errorCode=FEATURE_ISSUE_ISCSI_CONNECTION_FOUND_INSIDE_PROFILE 
    ...                                 level=Critical
    Run CLI In Interconnect From List    ${commands_on}
    Validate Detail Report If General Issue Exists      oneViewResourceCompatibility/allMigrationIssues   errorCode   ${validation}
    Run CLI In Interconnect From List    ${commands_off}
    Validate Detail Report If General Issues Removed      oneViewResourceCompatibility/allMigrationIssues   ${validation}

3.1.2.13--iscsi-boot-param 
    [Tags]   BelowOV300
    [Documentation]  iSCSI boot param for OneView <3.00
    @{commands_on}     Create List    add profile Profile1 -NoDefaultEnetConn -NoDefaultFcConn -NoDefaultFcoeConn -quiet 
    ...     add profile Profile2 -NoDefaultEnetConn -NoDefaultFcConn -NoDefaultFcoeConn -quiet
    ...     add network net001
    ...     add network net002
    ...     add iscsi-connection Profile1 Network=net001 AddressType=User-Defined iScsiMAC=00-17-A4-77-00-01 SpeedType=Auto
    ...     add iscsi-connection Profile2 Network=net002 AddressType=User-Defined iScsiMAC=00-17-A5-77-00-01 SpeedType=Preferred
    ...     set iscsi-boot-param Profile1:1 BootOrder=Primary Lun=100 InitiatorName="iqn.2009-09.com.someorg.iSCSI-Initiator" InitiatorIp=192.128.3.1 Mask=255.255.0.0 TargetName="iqn.2009-09.com.someorg.iSCSI-Target" TargetIp=192.128.3.2 TargetPort=40000 Authentication=CHAP Username=SomeUserName Secret=SomePassword123
    ...     set iscsi-boot-param Profile2:1 BootOrder=Primary ISCSIBootParamDHCP=Enabled NetworkParamDHCP=Enabled DHCPVendorID=SomeVendorIDValue
    
    @{commands_off}    Create List    remove iscsi-boot-param Profile1:1
    ...                               remove iscsi-boot-param Profile2:1
    ...                               remove iscsi-connection Profile1
    ...                               remove iscsi-connection Profile2
    ...                               remove profile Profile1
    ...                               remove profile Profile2
    ...                               remove network net001
    ...                               remove network net002
    ${validation}   Create Dictionary   errorCode=FEATURE_ISSUE_ISCSI_CONNECTION_FOUND_INSIDE_PROFILE 
    ...                                 level=Critical
    Run CLI In Interconnect From List    ${commands_on}
    ${filter}       Create Dictionary       name=Profile1
    ${resp}   ${resp_state}      ReportDetail
    Validate Existing Detail Report If Issues Exists with Filter   ${resp}       oneViewResourceCompatibility/profiles/serverProfiles   ${validation}   ${filter}
    ${filter}       Create Dictionary       name=Profile2
    Validate Existing Detail Report If Issues Exists with Filter   ${resp}       oneViewResourceCompatibility/profiles/serverProfiles   ${validation}   ${filter}
    Run CLI In Interconnect From List    ${commands_off}
    ${filter}       Create Dictionary       name=Profile1
    ${resp}   ${resp_state}      ReportDetail
    Validate Existing Detail Report If Issues Removed with Filter      ${resp}      oneViewResourceCompatibility/profiles/serverProfiles   ${validation}   ${filter}
    ${filter}       Create Dictionary       name=Profile2
    Validate Existing Detail Report If Issues Removed with Filter      ${resp}      oneViewResourceCompatibility/profiles/serverProfiles   ${validation}   ${filter}
 
3.1.2.13--iscsi-boot-param-DHCP-Enabled 
    [Tags]   OV300
    [Documentation]  iSCSI boot param for OneView 3.00
    @{commands_on}     Create List   add profile Profile1 -NoDefaultEnetConn -NoDefaultFcConn -NoDefaultFcoeConn -quiet
    ...     add network net001
    ...     add network net002
    ...     add iscsi-connection Profile1 Network=net002 AddressType=User-Defined iScsiMAC=00-17-A5-77-00-01 SpeedType=Preferred
    ...     set iscsi-boot-param Profile1:1 BootOrder=Primary ISCSIBootParamDHCP=Enabled NetworkParamDHCP=Enabled DHCPVendorID=SomeVendorIDValue
    
    @{commands_off}    Create List    remove iscsi-boot-param Profile1:1
    ...                               remove iscsi-connection Profile1
    ...                               remove profile Profile1
    ...                               remove network net001
    ...                               remove network net002
    ${validation}   Create Dictionary   errorCode=FEATURE_ISSUE_ISCSI_CONNECTION_DHCP_ENABLED 
    ...                                 level=Critical
    Run CLI In Interconnect From List    ${commands_on}
    ${filter}       Create Dictionary       name=Profile1
    ${resp}   ${resp_state}      ReportDetail
    Validate Existing Detail Report If Issues Exists with Filter   ${resp}       oneViewResourceCompatibility/profiles/serverProfiles   ${validation}   ${filter}
    Run CLI In Interconnect From List    ${commands_off}
    ${filter}       Create Dictionary       name=Profile1
    ${resp}   ${resp_state}      ReportDetail
    Validate Existing Detail Report If Issues Removed with Filter      ${resp}      oneViewResourceCompatibility/profiles/serverProfiles   ${validation}   ${filter}
 
3.1.2.14--iscsi-connection-ov300-migratable
    [Documentation]  Apply Ethernet CLI config to VCM
    [Tags]    OV300
    @{commands_on}     Create List    add profile Profile1 -NoDefaultEnetConn -NoDefaultFcConn -NoDefaultFcoeConn -quiet 
    ...     add network net001
    ...     add network net002
    ...     add iscsi-connection Profile1 Network=net001 AddressType=User-Defined iScsiMAC=00-17-A4-77-00-01 SpeedType=Auto
    ...     add iscsi-connection Profile1 Network=net002 AddressType=User-Defined iScsiMAC=00-17-A4-77-00-02 SpeedType=Preferred
    ...     assign profile Profile1 enc0:9
    ...     set snmp fc SmisEnabled=true
    
    Run CLI In Interconnect From List    ${commands_on}
    ${resp}   ${resp_state}      ReportDetail
    @{validation}   Create List Of Dictionaries Of OneView Issue Levels   ${issueLevels}
    Validate Existing Detail Report If General Issues Removed   ${resp}   incompatibilities/migrationGeneralIssues/issues   @{validation}
    Migrate.GetOVResources.Write.Compare

