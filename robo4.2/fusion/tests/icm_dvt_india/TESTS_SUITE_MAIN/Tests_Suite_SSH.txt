*** Settings ***
Documentation       Run this Automation Test Suite with features like SSH currently included in this suite.
...
Resource           ../../../Resources/api/fusion_api_resource.txt
Resource           FCoE.txt
Resource           PotashSSH.txt
Variables           Data_Variables.py

Library             RoboGalaxyLibrary
Library             FusionLibrary


*** Variables ***

*** Keywords ***

*** Test cases ***

Login
    Fusion Api Login Appliance      ${APPLIANCE_IP}     ${Appliance_credentials}

Set Suite Variables before running Automation Suite
    Set Suite Variables before running Automation Suite  ${INTERCONNECT1}   ${INTERCONNECT2}

FC/FCOE :: Get Random Password for Potash
    ${Random_Password}=    Get Random Password for Potash  ${APPLIANCE_IP}  ${OV_root_usr}  ${OV_root_pwd}  ${Enclosure1}   ${Enc1_Potash_Module_Bay_No}
    Set Suite Variable    ${Random_Password}

Connect to Appliance
    ${SSH}=    ssh_connect    ${APPLIANCE_IP}  ${OV_root_usr}  ${OV_root_pwd}
    Set Suite Variable     ${SSH}

Verify SSH is allowed through static IPv4 and IPv6
    Verify SSH is allowed through static IPv4 and IPv6    ${SSH}  ${PotashUserName}  ${Random_Password}  ${PotashIP1}  ${PotashIP1_IPV6}%bond0  OneView#
    Verify SSH is allowed through static IPv4 and IPv6    ${SSH}  ${PotashUserName}  ${Random_Password}  ${PotashIP2}  ${PotashIP2_IPV6}%bond0  OneView>

Verify SSH is allowed for netop user
    Verify SSH is allowed through static IPv4 and IPv6    ${SSH}  netop  netoppwd   ${PotashIP1}  ${PotashIP1_IPV6}%bond0  OneView#
    Verify SSH is allowed through static IPv4 and IPv6    ${SSH}  netop  netoppwd  ${PotashIP2}  ${PotashIP2_IPV6}%bond0  OneView>

Verify SSH is allowed after Active/Standby force fail-over in ICM
    Verify SSH is allowed after Active/Standby force fail-over in ICM    ${APPLIANCE_IP}  ${Random_Password}  ${PotashIP1}  ${PotashIP1_IPV6}  ${PotashIP2}  ${PotashIP2_IPV6}  OneView#

Verify SSH is allowed after ICM Reset
    Verify SSH is allowed after ICM Reset    ${APPLIANCE_IP}  ${Random_Password}  ${PotashIP1}  ${PotashIP1_IPV6}  ${PotashIP2}  ${PotashIP2_IPV6}  OneView#

Connect to Linux box and execute scripts
    ${ssh_linux_vm}=    ssh_connect    ${linuxip}  ${linuxuser}  ${linuxpassword}
    Set Suite Variable     ${ssh_linux_vm}
    execute_cmd    ${ssh_linux_vm}   cd /root/POTASH/1GB/COMMON_SCRIPTS; rm -rf /root/.ssh/known_hosts; python potash_main.py&
    ssh_close   ${ssh_linux_vm}

*** comments ***

Set Required Suite Variables before Hot Plug ICM
    Set Required Suite Variables before Hot Plug ICM    ${APPLIANCE_IP}   ${OV_root_usr}  ${OV_root_pwd}

Verify SSH is allowed after EFuse Reset ICM
    FCoE/FC - Hot Plug the Potash module and Check Traffic flow   ${APPLIANCE_IP}  ${Random_Password}  ${Enclosure1}  ${Enc1_Potash_Module_Bay_No}  ${PotashIP1}  ${PotashIP2}    ${FCOE_Downlink_Port2}  ${FCOE_Downlink_Port1}
    Sleep  5 minutes
    Verify SSH is allowed through static IPv4 and IPv6    ${PotashUserName}  ${Random_Password}  ${PotashIP2}  ${PotashIP2_IPV6}  OneView#

Verify SSH is allowed after EFuse Reset ICM Again
    FCoE/FC - Hot Plug the Potash module and Check Traffic flow   ${APPLIANCE_IP}  ${Random_Password}  ${Enclosure2}  ${Enc2_Potash_Module_Bay_No}  ${PotashIP2}  ${PotashIP1}   ${FC_Downlink_Port1}  ${FC_Downlink_Port2}
    Sleep  5 minutes
    Verify SSH is allowed through static IPv4 and IPv6    ${PotashUserName}  ${Random_Password}  ${PotashIP1}  ${PotashIP1_IPV6}  OneView#

Verify the maximum SSH sessions are supported in ICM
    Verify the maximum SSH sessions are supported in ICM   ${Random_Password}  ${PotashIP1}