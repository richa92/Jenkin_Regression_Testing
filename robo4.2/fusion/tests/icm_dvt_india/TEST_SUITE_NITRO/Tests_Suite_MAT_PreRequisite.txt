*** Settings ***
Documentation       Run Prerequisites and run the MAT Prerequsites
...
Resource           ../../../Resources/api/fusion_api_resource.txt
Variables           Data_Variables.py
Library             RoboGalaxyLibrary
Library             FusionLibrary

*** Test cases ***

Login
    [Documentation]
    Set Log Level    TRACE
    Fusion Api Login Appliance      ${APPLIANCE_IP}     ${Appliance_credentials}

Creating Network and NetworkSets
    Add Ethernet Networks from variable    ${MAT_networks}
    sleep    30sec
    Add Network Sets from variable    ${MAT_networkset}

    ${nets}     Fusion Api Get Network Set
    ${net}    Get From Dictionary    ${nets}    members
    ${l}    Get Length    ${net}
    :FOR    ${x}    IN RANGE    0   ${l}
    \    ${ct}    Fusion Api Get Connection Templates    ${net[${x}]['connectionTemplateUri']}
    \    ${bw}    Create Dictionary    maximumBandwidth=50000    typicalBandwidth=2500
    \    Set to Dictionary    ${ct}    bandwidth=${bw}
    \    Remove From Dictionary    ${ct}    status_code    headers
    \    ${resp}    Fusion Api Update Connection Template    ${ct}    ${net[${x}]['connectionTemplateUri']}

Creating MAT LIG
    Add LIG from variable    ${MAT_LIGS[0]}
    Add LIG from variable    ${MAT_LIGS[1]}

Create EG
    Add Enclosure Group from variable       ${enc_group[0]}

Creating LE
    Add Logical Enclosure from variable     ${Logical_Enclosure}


Create MLAG Server profile
    :FOR    ${profile}  IN  @{profile_MAT}
    \    ${power_status} =    Get Server Power    ${profile['serverHardwareUri']}
    \    Run Keyword If    '${power_status}'=='On'    Power off Server    ${profile['serverHardwareUri']}
    sleep    30 secs
    Add Server Profiles from variable    ${profile_MAT}
    sleep    60 secs
    Wait For ALL Server Profile In Normal State
    :FOR    ${profile}  IN  @{profile_MAT}
    \    Power on server    ${profile['serverHardwareUri']}