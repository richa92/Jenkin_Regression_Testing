"""
Contains utility methods for determining the file path to important Vulcan Locations.

"""
import platform

_DEFAULT_UNIX_DM_PATH = "/opt/vulcan/"
_UNIX_PATH_SEPARATOR = "/"
_DEFAULT_WIN_DM_PATH = "C:\\opt\\vulcan\\"
_WIN_PATH_SEPARATOR = "\\"
_CURRENT_DM_PATH = None
_PATH_SEPARATOR = None

if "Windows" in platform.system():
    _CURRENT_DM_PATH = _DEFAULT_WIN_DM_PATH
    _PATH_SEPARATOR = _WIN_PATH_SEPARATOR
else:
    _CURRENT_DM_PATH = _DEFAULT_UNIX_DM_PATH
    _PATH_SEPARATOR = _UNIX_PATH_SEPARATOR


def set_base_path(base_path):
    """Change the path to the base of all Vulcan files to the supplied base_path value.

    This method analyzes the supplied path to determine if it is a Windows path
    (with backslashes "\" as path separators) or a Unix path (with forward slashes "/"
    as path separators). Any subsequent get_binary_path() or get_path_separator()
    calls will use this detected path separator.

    If base_path does not end with a path separator, a separator will be added.
    """
    # these "global" declarations are necessary to make changes to these
    # variables
    global _CURRENT_DM_PATH
    global _PATH_SEPARATOR

    # do some path separator detection - see if there are more slashes than
    # backslashes
    win_separator_count = base_path.count(_WIN_PATH_SEPARATOR)
    unix_separator_count = base_path.count(_UNIX_PATH_SEPARATOR)
    if win_separator_count > unix_separator_count:
        _PATH_SEPARATOR = _WIN_PATH_SEPARATOR
    elif unix_separator_count > win_separator_count:
        _PATH_SEPARATOR = _UNIX_PATH_SEPARATOR

    # make sure we append a trailing slash
    if base_path[-1] != _PATH_SEPARATOR:
        base_path += _PATH_SEPARATOR

    _CURRENT_DM_PATH = base_path


def get_base_path():
    """Retrieve the path to the base of all DM files."""
    return _CURRENT_DM_PATH


def get_binary_path(binary_name):
    """Retrieve the path to the specified DM binary."""
    return _CURRENT_DM_PATH + "bin" + _PATH_SEPARATOR + binary_name


def get_path_separator():
    """Retrieve the current file system path separator."""
    return _PATH_SEPARATOR
