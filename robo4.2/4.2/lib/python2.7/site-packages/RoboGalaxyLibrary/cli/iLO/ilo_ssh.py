'''

This module provides all the iLO ssh keywords

'''

# import serial
import re
from RoboGalaxyLibrary.utilitylib import logging as logger


def convert_ilo_cli_output_properties_to_dictionary(cli_output):
    """
        Convert the iLO CLI output properties field to a dictionary.
        We are only interested in the attributes under "Properties".  Don't care about "Targets" or "Verbs"

        Sample output from iLO CLI that we are parsing:

        </>hpiLO-> show map1/blade1

        status=0
        status_tag=COMMAND COMPLETED
        Thu Jan  1 18:39:18 1970



        /map1/blade1
          Targets
            rack
          Properties
            bay_number=2
            auto_power=off
            ip_address=Unknown
            mac_address=Unknown
            sys_health=Unknown
          Verbs
            cd version exit show set

    """

    properties_obj = {}
    try:
        # Grab substring between 'Properties' and 'Verbs'
        cli_output = re.findall(
            r'Properties\r\n(.*?)\s+Verbs', cli_output, re.DOTALL)
        cli_output = cli_output[0].split("\r\n")
        for line in cli_output:
            key, value = line.split("=")[0].strip(), line.split("=")[1].strip()
            properties_obj[key] = value

        return properties_obj
    except Exception as e:
        logger._log_to_console_and_log_file("Exception: %s" % e)
        logger._log_to_console_and_log_file(
            "Failed to convert iLO CLI output properties to dictionary : %s" %
            cli_output)
        raise
